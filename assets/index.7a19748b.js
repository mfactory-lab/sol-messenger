var cn=Object.defineProperty;var un=(t,e,n)=>e in t?cn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var O=(t,e,n)=>(un(t,typeof e!="symbol"?e+"":e,n),n);import{c as dn,Q as mn,P as hn,D as pn,N as gn,a as fn,i as yn,u as we,b as Ne,d as R,o as y,e as D,f as h,g as I,w as _e,v as bn,h as d,F as H,r as te,t as N,j as F,k as v,l as z,m as ke,n as _n,p as vn,S as wn,q as M,s as m,x as Lt,y as T,z as l,A as X,B as V,C as Ie,E as kn,G as j,H as Y,I as An,J as pe,K as $t,W as Wt,L as Be,M as Ke,O as Le,R as Sn,T as Ot,U as ve,V as Fe,X as ee,Y as Mn,Z as Et,_ as Ze,$ as Cn,a0 as xn,a1 as Vt,a2 as Ve,a3 as qt,a4 as et,a5 as Dn,a6 as Ce,a7 as bt,a8 as $n,a9 as It,aa as f,ab as me,ac as Pt,ad as ne,ae as le,af as qe,ag as Ut,ah as Pe,ai as En,aj as tt,ak as Ht,al as At,am as In,an as Pn,ao as Tn,ap as Bn,aq as Kn,ar as se,as as ae,at as zt,au as re,av as jt,aw as Ln,ax as Wn,ay as Ue,az as he,aA as We,aB as xe,aC as zn,aD as Ee,aE as Nn,aF as Fn,aG as Rn,aH as On,aI as Tt,aJ as Vn,aK as qn,aL as Qt,aM as Un,aN as Hn,aO as Nt,aP as jn,aQ as Qn,aR as Gn,aS as Jn,aT as Yn,aU as Xn,aV as Zn,aW as ea,aX as ta,aY as na,aZ as aa,a_ as sa,a$ as ia,b0 as oa,b1 as ra,b2 as la,b3 as ca,b4 as ua,b5 as da,b6 as ma,b7 as ha,b8 as pa,b9 as ga,ba as fa,bb as ya,bc as ba,bd as _a,be as va,bf as wa,bg as ka,bh as Aa,bi as Sa,bj as Ma,bk as Ca,bl as xa,bm as Da,bn as $a,bo as Ea,bp as Ia,bq as Pa,br as Ta,bs as Ba,bt as Ka,bu as La,bv as Wa,bw as za,bx as Na}from"./vendor.af8bb8a3.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const Fa=({app:t})=>{const e=dn();t.use(e)},Ra=Object.freeze(Object.defineProperty({__proto__:null,install:Fa},Symbol.toStringTag,{value:"Module"})),Oa=({app:t})=>{t.use(mn,{plugins:{Dark:hn,Dialog:pn,Notify:gn,LocalStorage:fn},iconSet:yn})},Va=Object.freeze(Object.defineProperty({__proto__:null,install:Oa},Symbol.toStringTag,{value:"Module"}));function qa(){const{dark:t}=we(),e=Ne("theme-mode",t.isActive);return t.set(e.value),{isActive:e,set(n){t.set(n),e.value=t.isActive},toggle(){t.toggle(),e.value=t.isActive}}}const Re=[],Gt={id:"devnet",name:"DevNet",cluster:"devnet",url:"https://devnet.rpcpool.com/"};Re.push(Gt);var Rt;const Ua=(Rt=Re.find(t=>t.id==={VITE_USER_NODE_ENV:"production",BASE_URL:"/",MODE:"staging",DEV:!1,PROD:!0}.VITE_CONNECTION_ENDPOINT))!=null?Rt:Gt,Ha="confirmed",ja=12e4,_t=[`<span>Public channels</span> are non-encrypted and available to anyone, both for reading and writing.</br></br>
    <span>Public channels</span> are encrypted, and new users need to request approval to join them.</br>
    Depending on the \u2018Members can approve\u2019 setting, such requests can be approved either by channel\u2019s 
    owner/admin only, or by any authorized member of the channel.
    `,"Any authorized channel member can approve new requests to join","This setting determines how many messages will be available in chat until they are updated with new messages"],Qa="https://twitter.com/JPoolSolana",Ga="https://t.me/jpool_solana",Ja="https://t.me/jpoolsolana",Ya="https://discord.gg/qR4BA9QXVR",Xa="https://jfactory.ch",Za="https://jpool.one",es="https://svt.one",ts="https://staking.kiwi/",ns={class:"container"},as={class:"footer-section"},ss={class:"footer-info"},is={class:"theme"},os={class:"switch"},rs=h("span",{class:"slider round"},null,-1),ls=h("div",{class:"copyright"},[I(" \xA9 Copyright 2022 cgram.one. All rights reserved."),h("br"),I("Powered by jFactory ")],-1),cs={class:"footer-links"},us={class:"social"},ds=["href"],ms=h("span",null,[I("official"),h("br"),I("channel")],-1),hs=[ms],ps=["href"],gs=["href"],fs=["href"],ys=["href"],bs=R({__name:"AppFooter",setup(t){const e=qa(),n=[{name:"JFACTORY",link:Xa},{name:"JPOOL",link:Za},{name:"STAKING KIWI",link:ts},{name:"SOLANA VALIDATOR TOOLKIT",link:es}];return(i,s)=>(y(),D("footer",null,[h("div",ns,[h("div",as,[h("div",ss,[h("div",is,[I(" Dark mode "),h("label",os,[_e(h("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>d(e).isActive.value=a),type:"checkbox",onClick:s[1]||(s[1]=(...a)=>d(e).toggle&&d(e).toggle(...a))},null,512),[[bn,d(e).isActive.value]]),rs])]),ls]),h("div",cs,[h("div",us,[h("a",{href:d(Ga),target:"_blank",class:"social-link social-link-text"},hs,8,ds),h("a",{href:d(Ja),target:"_blank",class:"social-link telegram"},null,8,ps),h("a",{href:d(Qa),target:"_blank",class:"social-link twitter"},null,8,gs),h("a",{href:d(Ya),target:"_blank",class:"social-link discord"},null,8,fs)]),h("nav",null,[h("ul",null,[(y(),D(H,null,te(n,({name:a,link:o})=>h("li",{key:a},[h("a",{target:"_blank",href:o},N(a),9,ys)])),64))])])])])])]))}});function _s(){const t=F(vs());return{userAgent:t,isMobileOs:v(()=>ws(t.value)),isWebView:v(()=>ks(t.value))}}let vt;function vs(){var t,e;return vt===void 0&&(vt=(e=(t=globalThis.navigator)==null?void 0:t.userAgent)!=null?e:null),vt}function ws(t){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)}function ks(t){return/(WebView|(Phantom|Solflare)|Version\/.+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+)|; wv\).+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+))/i.test(t)}function nt(t,e=4){return t instanceof z&&(t=t.toBase58()),`${t.slice(0,e)}...${t.slice(-e)}`}function Jt(t){return(t==null?void 0:t.name)&&t.name!==""?t.name:nt(t.authority)}const Yt=t=>{if(!t)return{background:"#000"};let e=0;for(let i=0;i<t.length;i++)e=t.charCodeAt(i)+((e<<5)-e),e=e&e;let n="#";for(let i=0;i<3;i++)n+=`00${(e>>i*8&255).toString(16)}`.substr(-2);return{background:n}},As="/assets/clover.968404b0.svg",Ss="/assets/ledger.40cf6861.svg",Ms="/assets/mathwallet.1d763e81.svg",at=t=>(Be("data-v-269ee747"),t=t(),Ke(),t),Cs=at(()=>h("div",{class:"text-h6 text-center"}," Your wallet ",-1)),xs={class:"q-gutter-md row justify-between"},Ds=at(()=>h("span",{name:"wallet"},"Disconnect",-1)),$s=at(()=>h("span",{name:"wallet"},"Ok",-1)),Es=at(()=>h("div",{class:"text-h6"}," Connect to a wallet ",-1)),Is={class:"text-light-gray text-caption full-width text-no-wrap",style:{"text-overflow":"ellipsis",overflow:"hidden"}},Ps=["src","alt"],Ts=R({__name:"ConnectWallet",setup(t){const e={priority:{solflare:10,phantom:20,sollet:5,nufi:5,blocto:1},icons:{clover:As},darkIcons:{ledger:Ss,mathwallet:Ms},deepLinks:{phantom:"https://phantom.app/ul/browse/{uri}?ref={ref}",solflare:"https://solflare.com/ul/browse/{uri}?ref={ref}"}},{userAgent:n,isWebView:i,isMobileOs:s}=_s(),a={close:$t},o=x=>[Wt.Installed,Wt.Loadable].includes(x.readyState);we();const r=ke(),{connected:c,connecting:u}=r;_n();const g=v(()=>s.value&&!i.value);if(i.value){const x=String(n.value).toLowerCase();x.includes("phantom")?(r.select(vn),r.connect()):x.includes("solflare")&&(r.select(wn),r.connect())}const p=v(()=>{var x,P;return(P=(x=r.publicKey.value)==null?void 0:x.toBase58())!=null?P:""}),_=v(()=>nt(p.value)),w=v(()=>[...r.wallets.value].map(x=>{var E,Q;const P=x.adapter.name.toLowerCase();return x.adapter.icon=(Q=(E=e.darkIcons[P])!=null?E:e.icons[P])!=null?Q:x.adapter.icon,g.value&&e.deepLinks[P]&&(x.deepLink=e.deepLinks[P].replace("{uri}",location.href).replace("{ref}",location.origin)),x}).sort((x,P)=>{var ue,De;const E=(ue=e.priority[x.adapter.name.toLowerCase()])!=null?ue:1;return((De=e.priority[P.adapter.name.toLowerCase()])!=null?De:1)-E+((o(P)?1:0)-(o(x)?1:0))})),k=v(()=>g.value?w.value.filter(x=>!!x.deepLink):w.value),A=F(!1);async function C(x){await r.select(x.adapter.name),A.value=!1,await r.connect()}function S(){A.value=!1,r.disconnect()}function B(){A.value=!0}function U(){A.value=!1}return(x,P)=>(y(),D(H,null,[d(c)?(y(),M(T,Lt({key:0},x.$attrs,{ripple:!1,color:"primary-gray","text-color":"white",square:"",unelevated:"",onClick:B}),{default:m(()=>[I(N(d(_)),1)]),_:1},16)):(y(),M(T,Lt({key:1},x.$attrs,{color:"primary-gray",class:"q-pa-none btn","text-color":"white",square:"",flat:"",ripple:!1,loading:d(u),onClick:B}),{default:m(()=>[I(" CONNECT WALLET ")]),_:1},16,["loading"])),l(pe,{modelValue:A.value,"onUpdate:modelValue":P[0]||(P[0]=E=>A.value=E),"transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:m(()=>[d(c)?(y(),M(X,{key:0},{default:m(()=>[l(V,{class:"relative-position"},{default:m(()=>[Cs,l(T,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:U},null,8,["icon"])]),_:1}),l(Ie),l(V,null,{default:m(()=>[I(N(d(p)),1)]),_:1}),l(Ie),l(V,null,{default:m(()=>[h("div",xs,[l(T,{class:"disconnect-btn","text-color":"black",square:"",flat:"",onClick:S},{default:m(()=>[Ds]),_:1}),l(T,{class:"disconnect-btn","text-color":"black",square:"",flat:"",onClick:U},{default:m(()=>[$s]),_:1})])]),_:1})]),_:1})):(y(),M(X,{key:1,class:"wallet-connect-card"},{default:m(()=>[l(V,null,{default:m(()=>[Es,l(T,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:U},null,8,["icon"])]),_:1}),l(Ie),l(V,{style:{"max-height":"80vh"},class:"scroll"},{default:m(()=>[l(kn,{grid:"",rows:d(k),"row-key":"name","hide-pagination":"","hide-header":"","rows-per-page-options":[100]},{item:m(({row:E})=>[(y(),D("div",{key:`wallet-${E.adapter.name}`,class:"col-12 col-md-6"},[l(j,{clickable:"",href:E.deepLink,onClick:Q=>E.deepLink?!0:C(E)},{default:m(()=>[l(Y,null,{default:m(()=>[h("b",null,N(E.adapter.name),1),h("div",Is,N(E.adapter.url),1)]),_:2},1024),l(Y,{avatar:""},{default:m(()=>[l(An,{square:""},{default:m(()=>[h("img",{src:E.adapter.icon,alt:E.adapter.name},null,8,Ps)]),_:2},1024)]),_:2},1024)]),_:2},1032,["href","onClick"])]))]),_:1},8,["rows"])]),_:1})]),_:1}))]),_:1},8,["modelValue"])],64))}});const Z=(t,e)=>{const n=t.__vccOpts||t;for(const[i,s]of e)n[i]=s;return n},Bs=Z(Ts,[["__scopeId","data-v-269ee747"]]),st=Le({id:"connection",state:()=>({commitment:Ha,confirmTransactionInitialTimeout:ja,rpc:Sn("rpc","")}),getters:{endpoint(t){var e;return(e=Re.find(n=>n.id===t.rpc))!=null?e:Ua},connection(t){return console.log("[connection]",this.endpoint.url),new Ot(this.endpoint.url,{confirmTransactionInitialTimeout:t.confirmTransactionInitialTimeout,commitment:t.commitment})},cluster(){return this.endpoint.cluster}},actions:{setRpc(t){this.rpc=t},setCommitment(t){this.commitment=t}}}),Ks=R({__name:"ClusterSelector",setup(t){const e=st(),{connected:n,connect:i,disconnect:s,autoConnect:a}=ke(),o=[Re.filter(u=>u.cluster==="mainnet-beta"),Re.filter(u=>u.cluster!=="mainnet-beta")],r=v(()=>e.endpoint),c=u=>{n&&e.cluster!==u.cluster&&(s(),a.value&&i()),e.setRpc(u.id)};return(u,g)=>(y(),M(Mn,{label:d(r).name,"model-value":!1,"auto-close":"",color:"secondary","text-color":"#000",square:"",unelevated:"",ripple:!1},{default:m(()=>[l(ve,null,{default:m(()=>[(y(),D(H,null,te(o,(p,_)=>(y(),D(H,{key:`${_}-cluster-group`},[(y(!0),D(H,null,te(p,w=>(y(),M(j,{key:w.id,clickable:"",onClick:k=>c(w)},{default:m(()=>[(y(),M(Y,{key:`${w.id}-item`},{default:m(()=>[l(Fe,null,{default:m(()=>[h("b",null,N(w.name),1)]),_:2},1024),I(" "+N(w.url),1)]),_:2},1024))]),_:2},1032,["onClick"]))),128)),_!==o.length-1?(y(),M(Ie,{key:0})):ee("",!0)],64))),64))]),_:1})]),_:1},8,["label"]))}});const Ls={},Ws={class:"app-header"},zs={class:"container"},Ns={class:"app-header__info"},Fs={class:"app-header__logo"},Rs={class:"logo-wrapper"},Os=h("div",{class:"app-header__title"},[h("h1",null,[I("BLOCKCHAIN "),h("br"),I(" messenger "),h("span",{class:"marked"},"SOLANA")])],-1),Vs={class:"app-header__right"},qs={class:"app-header__buttons"};function Us(t,e){const n=Et("router-link"),i=Ks,s=Bs;return y(),D("header",Ws,[h("div",zs,[h("div",Ns,[h("div",Fs,[h("div",Rs,[l(n,{to:"/"})])]),Os]),l(Ze),h("div",Vs,[h("div",qs,[l(i,{class:"app-header__cluster-btn header-btn"}),l(s,{class:"app-header__wallet-btn header-btn"})])])])])}const Hs=Z(Ls,[["render",Us]]),js={};function Qs(t,e){const n=Hs,i=Et("router-view"),s=bs;return y(),M(Cn,{view:"lfh Lpr lff"},{default:m(()=>[l(n),l(xn,null,{default:m(()=>[l(i)]),_:1}),l(s)]),_:1})}const Gs=Z(js,[["render",Qs]]),Js={default:Gs,empty:()=>Vt(()=>import("./empty.5b8310b7.js"),["assets/empty.5b8310b7.js","assets/vendor.af8bb8a3.js"])};function Ys(t){return t.map(e=>{var n;return{path:e.path,component:Js[((n=e.meta)==null?void 0:n.layout)||"default"],children:[{...e,path:""}]}})}const Xs="/assets/search.b4fadb1c.svg",Zs="/assets/transfer.796e9da5.svg",ei="/assets/plus.ee413328.svg",ti={class:"how-it-works"},ni={class:"app-info"},ai=h("div",{class:"app-info__title"}," JOIN A CHANNEL ",-1),si={class:"app-info__list"},ii=["innerHTML"],oi={class:"app-info"},ri=h("div",{class:"app-info__title"}," CREATE YOUR OWN CHANNEL ",-1),li={class:"app-info__list"},ci=["innerHTML"],ui=R({__name:"HowItWorks",setup(t){const e=["For <span>public channels</span>, you can read or send messages without limitations.",`In order to join one of the existing private channels, click
        <img src="${Xs}" class="icon" alt="search">
        (BROWSE CHANNELS) at the bottom of the left-side panel.`,`Find a channel you are interested in and click
        <img src="${Zs}" class="icon" alt="transfer">
        (REQUEST TO JOIN). Your status for that channel will be set to Pending
        Approval until your request has been accepted. While awaiting approval,
        all messages in the channel will appear scrambled.`,`After the private channel's owner or admin approves your membership,your
        status will change to Authorized. You will be able to read the channel
        and send messages.`],n=["You can create a channel of your own as well.",`Click <img src="${ei}" class="icon" alt="search"> (CREATE A CHANNEL) 
  at the bottom of the left-side panel, then choose between Private and Public options.`,"A public channel is open to anyone for reading and writing, and no encryption is used.",`If you create a private channel, joining it will require your approval. You will see a red 
  notification badge above the channel list if there are approval requests pending.`];return(i,s)=>(y(),D("div",ti,[h("div",ni,[ai,h("ul",si,[(y(),D(H,null,te(e,a=>h("li",{key:a},[h("p",{innerHTML:a},null,8,ii)])),64))])]),h("div",oi,[ri,h("ul",li,[(y(),D(H,null,te(n,a=>h("li",{key:a},[h("p",{innerHTML:a},null,8,ci)])),64))])])]))}});const di=R({props:{text:{type:String,default:""},padding:{type:String,default:"0"}}});const mi=["innerHTML"];function hi(t,e,n,i,s,a){return y(),M(qt,{class:"bg-white text-primary shadow-1 custom-tooltip",style:{"border-radius":"0"},anchor:"top middle",self:"bottom middle"},{default:m(()=>[h("div",{style:Ve({fontSize:"11px",padding:`${t.padding}`}),innerHTML:t.text},null,12,mi)]),_:1})}const ze=Z(di,[["render",hi]]),He=Le("user",()=>{const t=et(),e=F();Dn(()=>{var c;const r=(c=t.value)==null?void 0:c.publicKey;if(r){const u=Ne(r.toString(),()=>bt.encode(Ce.generate().secretKey));n(u.value)}else e.value=void 0});function n(r){e.value=Ce.fromSecretKey(bt.decode(r))}function i(){var u;const r=(u=t.value)==null?void 0:u.publicKey;if(!r)return;const c=Ne(r.toString(),"");n(c.value=bt.encode(Ce.generate().secretKey))}function s(r){var g;const c=(g=t.value)==null?void 0:g.publicKey;if(!c)return;const u=Ne(c.toString(),"");n(u.value=r)}function a(){var _;const r=(_=t.value)==null?void 0:_.publicKey;if(!r)return;const u={secretKey:Ne(r.toString(),"").value},g=`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(u))}`,p=document.createElement("a");p.setAttribute("href",g),p.setAttribute("download","secret_key.json"),p.click()}async function o(){var p;const r=(p=t.value)==null?void 0:p.publicKey;return await await new Ot($n("devnet"),"confirmed").getBalance(r)/It>.1}return{keypair:e,generateKey:i,importKey:s,exportKey:a,userBalance:o}}),pi="0.0.11",gi="messenger",fi=[{name:"initChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"device",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"InitChannelData"}}]},{name:"deleteChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"joinChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"device",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"JoinChannelData"}}]},{name:"leaveChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"grantAccessMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"GrantAccessMemberData"}}]},{name:"addMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"invitee",isMut:!1,isSigner:!1},{name:"inviteeMembership",isMut:!0,isSigner:!1},{name:"inviteeDevice",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AddMemberData"}}]},{name:"authorizeMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"device",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AuthorizeMemberData"}}]},{name:"deleteMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"membershipAuthority",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"addDevice",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"device",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AddDeviceData"}}]},{name:"deleteDevice",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"device",isMut:!0,isSigner:!1},{name:"deviceAuthority",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"postMessage",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!1,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"message",type:"string"}]},{name:"readMessage",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"messageId",type:"u64"}]}],yi=[{name:"Channel",type:{kind:"struct",fields:[{name:"workspace",docs:["Workspace used to group channels"],type:"string"},{name:"name",docs:["Name of the channel"],type:"string"},{name:"creator",docs:["Channel creator"],type:"publicKey"},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"lastMessageAt",docs:["Last message date"],type:"i64"},{name:"flags",docs:["Channel flags"],type:"u8"},{name:"memberCount",docs:["Number of members"],type:"u16"},{name:"messageCount",docs:["Message counter"],type:"u64"},{name:"maxMessages",docs:["The maximum number of messages that are stored in [messages]"],type:"u16"},{name:"messages",docs:["List of latest messages"],type:{vec:{defined:"Message"}}}]}},{name:"ChannelDevice",type:{kind:"struct",fields:[{name:"channel",docs:["Associated [Channel] address"],type:"publicKey"},{name:"authority",docs:["Authority of the [ChannelKey]"],type:"publicKey"},{name:"key",docs:["The device key used to encrypt the `cek`"],type:"publicKey"},{name:"cek",docs:["The content encryption key (CEK)"],type:{defined:"CEKData"}},{name:"bump",docs:["Bump seed for deriving PDA seeds"],type:"u8"}]}},{name:"ChannelMembership",type:{kind:"struct",fields:[{name:"channel",docs:["Associated [Channel] address"],type:"publicKey"},{name:"authority",docs:["Authority of membership"],type:"publicKey"},{name:"status",docs:["Status of membership"],type:{defined:"ChannelMembershipStatus"}},{name:"statusTarget",docs:["Status target key"],type:{option:"publicKey"}},{name:"name",docs:["Name of the channel member"],type:"string"},{name:"lastReadMessageId",docs:["The last read message id"],type:"u64"},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"flags",docs:["Membership flags"],type:"u8"},{name:"bump",docs:["Bump seed for deriving PDA seeds"],type:"u8"}]}}],bi=[{name:"AddDeviceData",type:{kind:"struct",fields:[{name:"key",type:"publicKey"},{name:"cek",type:{defined:"CEKData"}}]}},{name:"AddMemberData",type:{kind:"struct",fields:[{name:"name",docs:["Member name"],type:"string"},{name:"flags",docs:["Membership flags, only `admin` and `owner` can set membership flags"],type:"u8"},{name:"cek",docs:["Content Encryption Key"],type:{defined:"CEKData"}},{name:"key",docs:["Device key"],type:"publicKey"}]}},{name:"AuthorizeMemberData",type:{kind:"struct",fields:[{name:"cek",type:{defined:"CEKData"}}]}},{name:"GrantAccessMemberData",type:{kind:"struct",fields:[{name:"flags",type:"u8"}]}},{name:"InitChannelData",type:{kind:"struct",fields:[{name:"workspace",type:"string"},{name:"name",type:"string"},{name:"maxMessages",type:"u16"},{name:"memberName",type:"string"},{name:"cek",type:{defined:"CEKData"}},{name:"public",type:"bool"},{name:"permissionless",type:"bool"}]}},{name:"JoinChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"authority",type:{option:"publicKey"}}]}},{name:"CEKData",type:{kind:"struct",fields:[{name:"header",docs:["The header information for the CEK"],type:"string"},{name:"encryptedKey",docs:["The CEK itself"],type:"string"}]}},{name:"Message",type:{kind:"struct",fields:[{name:"id",docs:["Uniq message id"],type:"u64"},{name:"sender",docs:["The message sender id"],type:"publicKey"},{name:"createdAt",docs:["The unix timestamp at which the message was received"],type:"i64"},{name:"flags",docs:["Message flags"],type:"u8"},{name:"content",docs:["The (typically encrypted) message content"],type:"string"}]}},{name:"ChannelMembershipStatus",type:{kind:"enum",variants:[{name:"Authorized"},{name:"Pending"}]}}],_i=[{name:"NewChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"NewMessageEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"message",type:{defined:"Message"},index:!1}]},{name:"JoinChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"device",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"LeaveChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"authority",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AddMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"AuthorizeMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"AddDeviceEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"device",type:"publicKey",index:!0},{name:"authority",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteDeviceEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"device",type:"publicKey",index:!0},{name:"authority",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]}],vi=[{code:6e3,name:"Unauthorized",msg:"Unauthorized"},{code:6001,name:"InvalidChannel",msg:"Invalid channel"},{code:6002,name:"InvalidMembership",msg:"Invalid membership"},{code:6003,name:"InvalidDevice",msg:"Invalid device"},{code:6004,name:"InvalidMessage",msg:"Invalid message"},{code:6005,name:"NameTooLong",msg:"Name too long"},{code:6006,name:"WorkspaceTooLong",msg:"Workspace too long"},{code:6007,name:"MessageTooLong",msg:"Message too long"}],wi={address:"4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw",origin:"anchor",binaryVersion:"0.25.0",libVersion:"0.25.0"},ki={version:pi,name:gi,instructions:fi,accounts:yi,types:bi,events:_i,errors:vi,metadata:wi},Ai=new f.FixableBeetArgsStruct([["id",f.u64],["sender",me],["createdAt",f.i64],["flags",f.u8],["content",f.utf8String]],"Message"),St=[49,159,99,106,220,87,219,88];class de{constructor(e,n,i,s,a,o,r,c,u,g){this.workspace=e,this.name=n,this.creator=i,this.createdAt=s,this.lastMessageAt=a,this.flags=o,this.memberCount=r,this.messageCount=c,this.maxMessages=u,this.messages=g}static fromArgs(e){return new de(e.workspace,e.name,e.creator,e.createdAt,e.lastMessageAt,e.flags,e.memberCount,e.messageCount,e.maxMessages,e.messages)}static fromAccountInfo(e,n=0){return de.deserialize(e.data,n)}static async fromAccountAddress(e,n,i){const s=await e.getAccountInfo(n,i);if(s==null)throw new Error(`Unable to find Channel account at ${n}`);return de.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){return Pt.fromStruct(e,Ge)}static deserialize(e,n=0){return Ge.deserialize(e,n)}serialize(){return Ge.serialize({accountDiscriminator:St,...this})}static byteSize(e){const n=de.fromArgs(e);return Ge.toFixedFromValue({accountDiscriminator:St,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,i){return n.getMinimumBalanceForRentExemption(de.byteSize(e),i)}pretty(){return{workspace:this.workspace,name:this.name,creator:this.creator.toBase58(),createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),lastMessageAt:(()=>{const e=this.lastMessageAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,memberCount:this.memberCount,messageCount:(()=>{const e=this.messageCount;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),maxMessages:this.maxMessages,messages:this.messages}}}const Ge=new f.FixableBeetStruct([["accountDiscriminator",f.uniformFixedSizeArray(f.u8,8)],["workspace",f.utf8String],["name",f.utf8String],["creator",me],["createdAt",f.i64],["lastMessageAt",f.i64],["flags",f.u8],["memberCount",f.u16],["messageCount",f.u64],["maxMessages",f.u16],["messages",f.array(Ai)]],de.fromArgs,"Channel"),je=new f.FixableBeetArgsStruct([["header",f.utf8String],["encryptedKey",f.utf8String]],"CEKData"),Mt=[163,153,9,169,176,51,204,146];class ge{constructor(e,n,i,s,a){this.channel=e,this.authority=n,this.key=i,this.cek=s,this.bump=a}static fromArgs(e){return new ge(e.channel,e.authority,e.key,e.cek,e.bump)}static fromAccountInfo(e,n=0){return ge.deserialize(e.data,n)}static async fromAccountAddress(e,n,i){const s=await e.getAccountInfo(n,i);if(s==null)throw new Error(`Unable to find ChannelDevice account at ${n}`);return ge.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){return Pt.fromStruct(e,Je)}static deserialize(e,n=0){return Je.deserialize(e,n)}serialize(){return Je.serialize({accountDiscriminator:Mt,...this})}static byteSize(e){const n=ge.fromArgs(e);return Je.toFixedFromValue({accountDiscriminator:Mt,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,i){return n.getMinimumBalanceForRentExemption(ge.byteSize(e),i)}pretty(){return{channel:this.channel.toBase58(),authority:this.authority.toBase58(),key:this.key.toBase58(),cek:this.cek,bump:this.bump}}}const Je=new f.FixableBeetStruct([["accountDiscriminator",f.uniformFixedSizeArray(f.u8,8)],["channel",me],["authority",me],["key",me],["cek",je],["bump",f.u8]],ge.fromArgs,"ChannelDevice");var Oe=(t=>(t[t.Authorized=0]="Authorized",t[t.Pending=1]="Pending",t))(Oe||{});const Si=f.fixedScalarEnum(Oe),Xe=[238,149,255,251,116,131,86,170];class oe{constructor(e,n,i,s,a,o,r,c,u){this.channel=e,this.authority=n,this.status=i,this.statusTarget=s,this.name=a,this.lastReadMessageId=o,this.createdAt=r,this.flags=c,this.bump=u}static fromArgs(e){return new oe(e.channel,e.authority,e.status,e.statusTarget,e.name,e.lastReadMessageId,e.createdAt,e.flags,e.bump)}static fromAccountInfo(e,n=0){return oe.deserialize(e.data,n)}static async fromAccountAddress(e,n,i){const s=await e.getAccountInfo(n,i);if(s==null)throw new Error(`Unable to find ChannelMembership account at ${n}`);return oe.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){return Pt.fromStruct(e,Ye)}static deserialize(e,n=0){return Ye.deserialize(e,n)}serialize(){return Ye.serialize({accountDiscriminator:Xe,...this})}static byteSize(e){const n=oe.fromArgs(e);return Ye.toFixedFromValue({accountDiscriminator:Xe,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,i){return n.getMinimumBalanceForRentExemption(oe.byteSize(e),i)}pretty(){return{channel:this.channel.toBase58(),authority:this.authority.toBase58(),status:`ChannelMembershipStatus.${Oe[this.status]}`,statusTarget:this.statusTarget,name:this.name,lastReadMessageId:(()=>{const e=this.lastReadMessageId;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,bump:this.bump}}}const Ye=new f.FixableBeetStruct([["accountDiscriminator",f.uniformFixedSizeArray(f.u8,8)],["channel",me],["authority",me],["status",Si],["statusTarget",f.coption(me)],["name",f.utf8String],["lastReadMessageId",f.u64],["createdAt",f.i64],["flags",f.u8],["bump",f.u8]],oe.fromArgs,"ChannelMembership"),ye=new Map,be=new Map;class it extends Error{constructor(){super("Unauthorized");O(this,"code",6e3);O(this,"name","Unauthorized");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,it)}}ye.set(6e3,()=>new it);be.set("Unauthorized",()=>new it);class ot extends Error{constructor(){super("Invalid channel");O(this,"code",6001);O(this,"name","InvalidChannel");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ot)}}ye.set(6001,()=>new ot);be.set("InvalidChannel",()=>new ot);class rt extends Error{constructor(){super("Invalid membership");O(this,"code",6002);O(this,"name","InvalidMembership");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,rt)}}ye.set(6002,()=>new rt);be.set("InvalidMembership",()=>new rt);class lt extends Error{constructor(){super("Invalid device");O(this,"code",6003);O(this,"name","InvalidDevice");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,lt)}}ye.set(6003,()=>new lt);be.set("InvalidDevice",()=>new lt);class ct extends Error{constructor(){super("Invalid message");O(this,"code",6004);O(this,"name","InvalidMessage");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ct)}}ye.set(6004,()=>new ct);be.set("InvalidMessage",()=>new ct);class ut extends Error{constructor(){super("Name too long");O(this,"code",6005);O(this,"name","NameTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ut)}}ye.set(6005,()=>new ut);be.set("NameTooLong",()=>new ut);class dt extends Error{constructor(){super("Workspace too long");O(this,"code",6006);O(this,"name","WorkspaceTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,dt)}}ye.set(6006,()=>new dt);be.set("WorkspaceTooLong",()=>new dt);class mt extends Error{constructor(){super("Message too long");O(this,"code",6007);O(this,"name","MessageTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,mt)}}ye.set(6007,()=>new mt);be.set("MessageTooLong",()=>new mt);function ie(t){const e=ye.get(t);return e!=null?e():null}function Se(t){const e=be.get(t);return e!=null?e():null}const Mi=new f.FixableBeetArgsStruct([["key",me],["cek",je]],"AddDeviceData"),Ci=new f.FixableBeetArgsStruct([["instructionDiscriminator",f.uniformFixedSizeArray(f.u8,8)],["data",Mi]],"AddDeviceInstructionArgs"),xi=[21,27,66,42,18,30,14,18];function Di(t,e,n=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){var o;const[i]=Ci.serialize({instructionDiscriminator:xi,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.device,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ne.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)s.push(r);return new le({programId:n,keys:s,data:i})}const $i=new f.FixableBeetArgsStruct([["name",f.utf8String],["flags",f.u8],["cek",je],["key",me]],"AddMemberData"),Ei=new f.FixableBeetArgsStruct([["instructionDiscriminator",f.uniformFixedSizeArray(f.u8,8)],["data",$i]],"AddMemberInstructionArgs"),Ii=[13,116,123,130,126,198,57,34];function Pi(t,e,n=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){var o;const[i]=Ei.serialize({instructionDiscriminator:Ii,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.invitee,isWritable:!1,isSigner:!1},{pubkey:t.inviteeMembership,isWritable:!0,isSigner:!1},{pubkey:t.inviteeDevice,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ne.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)s.push(r);return new le({programId:n,keys:s,data:i})}const Ti=new f.FixableBeetArgsStruct([["cek",je]],"AuthorizeMemberData"),Bi=new f.FixableBeetArgsStruct([["instructionDiscriminator",f.uniformFixedSizeArray(f.u8,8)],["data",Ti]],"AuthorizeMemberInstructionArgs"),Ki=[194,123,189,175,86,225,93,128];function Li(t,e,n=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){var o;const[i]=Bi.serialize({instructionDiscriminator:Ki,...e}),s=[{pubkey:t.channel,isWritable:!1,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.device,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:(o=t.systemProgram)!=null?o:ne.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)s.push(r);return new le({programId:n,keys:s,data:i})}const Wi=new f.BeetArgsStruct([["instructionDiscriminator",f.uniformFixedSizeArray(f.u8,8)]],"DeleteChannelInstructionArgs"),zi=[145,225,187,221,157,142,114,133];function Ni(t,e=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){var a;const[n]=Wi.serialize({instructionDiscriminator:zi}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:ne.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)i.push(o);return new le({programId:e,keys:i,data:n})}const Fi=new f.BeetArgsStruct([["instructionDiscriminator",f.uniformFixedSizeArray(f.u8,8)]],"DeleteDeviceInstructionArgs"),Ri=[168,96,86,82,105,2,215,144];function Oi(t,e=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){var a;const[n]=Fi.serialize({instructionDiscriminator:Ri}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.device,isWritable:!0,isSigner:!1},{pubkey:t.deviceAuthority,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:ne.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)i.push(o);return new le({programId:e,keys:i,data:n})}const Vi=new f.BeetArgsStruct([["instructionDiscriminator",f.uniformFixedSizeArray(f.u8,8)]],"DeleteMemberInstructionArgs"),qi=[95,14,98,112,252,218,205,173];function Ui(t,e=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){var a;const[n]=Vi.serialize({instructionDiscriminator:qi}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.membershipAuthority,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:ne.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)i.push(o);return new le({programId:e,keys:i,data:n})}const Hi=new f.BeetArgsStruct([["flags",f.u8]],"GrantAccessMemberData"),ji=new f.BeetArgsStruct([["instructionDiscriminator",f.uniformFixedSizeArray(f.u8,8)],["data",Hi]],"GrantAccessMemberInstructionArgs"),Qi=[236,46,184,64,57,158,80,142];function Gi(t,e,n=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){var o;const[i]=ji.serialize({instructionDiscriminator:Qi,...e}),s=[{pubkey:t.channel,isWritable:!1,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ne.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)s.push(r);return new le({programId:n,keys:s,data:i})}const Ji=new f.FixableBeetArgsStruct([["workspace",f.utf8String],["name",f.utf8String],["maxMessages",f.u16],["memberName",f.utf8String],["cek",je],["public",f.bool],["permissionless",f.bool]],"InitChannelData"),Yi=new f.FixableBeetArgsStruct([["instructionDiscriminator",f.uniformFixedSizeArray(f.u8,8)],["data",Ji]],"InitChannelInstructionArgs"),Xi=[21,200,152,39,19,178,76,47];function Zi(t,e,n=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){var o;const[i]=Yi.serialize({instructionDiscriminator:Xi,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.device,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ne.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)s.push(r);return new le({programId:n,keys:s,data:i})}const eo=new f.FixableBeetArgsStruct([["name",f.utf8String],["authority",f.coption(me)]],"JoinChannelData"),to=new f.FixableBeetArgsStruct([["instructionDiscriminator",f.uniformFixedSizeArray(f.u8,8)],["data",eo]],"JoinChannelInstructionArgs"),no=[124,39,115,89,217,26,38,29];function ao(t,e,n=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){var o;const[i]=to.serialize({instructionDiscriminator:no,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.device,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ne.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)s.push(r);return new le({programId:n,keys:s,data:i})}const so=new f.BeetArgsStruct([["instructionDiscriminator",f.uniformFixedSizeArray(f.u8,8)]],"LeaveChannelInstructionArgs"),io=[104,0,75,134,95,80,68,186];function oo(t,e=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){var a;const[n]=so.serialize({instructionDiscriminator:io}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:ne.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)i.push(o);return new le({programId:e,keys:i,data:n})}const ro=new f.FixableBeetArgsStruct([["instructionDiscriminator",f.uniformFixedSizeArray(f.u8,8)],["message",f.utf8String]],"PostMessageInstructionArgs"),lo=[214,50,100,209,38,34,7,76];function co(t,e,n=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){var o;const[i]=ro.serialize({instructionDiscriminator:lo,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ne.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)s.push(r);return new le({programId:n,keys:s,data:i})}const uo=new f.BeetArgsStruct([["instructionDiscriminator",f.uniformFixedSizeArray(f.u8,8)],["messageId",f.u64]],"ReadMessageInstructionArgs"),mo=[54,166,48,51,234,46,110,163];function ho(t,e,n=new z("4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw")){var o;const[i]=uo.serialize({instructionDiscriminator:mo,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ne.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)s.push(r);return new le({programId:n,keys:s,data:i})}const po="4AnSBTc21f4wTBHmnFyarbosr28Qk4CgGFBHcRh4kYPw",go=new z(po);function Ct(t,e=new Uint8Array(4)){const n=qe(t.toString(),"base10");return e.set(n,4-n.length),e}const wt=t=>Pe([Ct(t.length),t]);function Xt(t,e,n){if(e!==256)throw new Error(`Unsupported key length: ${e}`);const i=Pe([wt(qe(n)),wt(new Uint8Array(0)),wt(new Uint8Array(0)),Ct(e)]),s=1;return En.hash(Pe([Ct(s),t,i]))}const xt=t=>qe(t,"base64pad"),Dt=t=>Ut(t,"base64pad"),fo=t=>qe(t),yo=t=>Ut(t),bo=t=>qe(t,"base58btc"),Me=tt.NONCE_LENGTH,Te=tt.TAG_LENGTH,Zt=t=>{const e=new tt.XChaCha20Poly1305(t);return(n,i)=>{const s=Ht.randomBytes(Me),a=e.seal(s,n,i);return{ciphertext:a.subarray(0,a.length-Te),tag:a.subarray(a.length-Te),iv:s}}},en=t=>{const e=new tt.XChaCha20Poly1305(t);return(n,i,s,a)=>e.open(s,Pe([n,i]),a)},tn="ECDH-ES+XC20PKW",nn=256,_o=t=>e=>{const n=At.generateKeyPair(),i=At.sharedKey(n.secretKey,t),s=Xt(i,nn,tn),a=Zt(s)(e);return{encryptedKey:a.ciphertext,tag:a.tag,iv:a.iv,epPubKey:n.publicKey}},vo=t=>(e,n,i,s)=>{const a=At.sharedKey(t,s),o=Xt(a,nn,tn);return en(o)(e,n,i)},wo=t=>Array.isArray(t)?Ce.fromSecretKey(Tn.Buffer.from(t)):typeof t=="string"?Ce.fromSecretKey(bo(t)):Ce.fromSecretKey(t),ko=async(t=32)=>{const e=Ht.randomBytes(t);return Promise.resolve(e)},Ao=async(t,e)=>{const n=await _o(In(e.toBytes()))(t);return{header:Dt(Pe([n.iv,n.tag,n.epPubKey])),encryptedKey:Dt(n.encryptedKey)}},So=async(t,e)=>{const n=xt(t.header),i=n.subarray(0,Me),s=n.subarray(Me,Me+Te),a=n.subarray(Me+Te),o=xt(t.encryptedKey),r=wo(e).secretKey,c=Pn(r),u=await vo(c)(o,s,i,a);if(u===null)throw new Error("There was a problem decrypting the CEK");return u},Mo=async(t,e)=>{const n=await Zt(e)(fo(t));return Dt(Pe([n.iv,n.ciphertext,n.tag]))},Co=async(t,e)=>{const n=xt(t),i=n.subarray(0,Me),s=n.subarray(Me,-Te),a=n.subarray(-Te),o=await en(e)(s,a,i);if(o===null)throw new Error("There was an error decoding the message!");return yo(o)},xo={maxWorkspaceLength:32,maxChannelNameLength:32,maxMemberNameLength:32,maxMessageLength:400,maxCEKLength:100};class Do{constructor(e,n){O(this,"programId",go);O(this,"constants",xo);O(this,"workspace");O(this,"_coder");O(this,"_events");O(this,"utils",{channel:{isPublic:e=>(e.flags&1)>0,isPermissionless:e=>(e.flags&2)>0},member:{isAuthorized:e=>e.status===Oe.Authorized,isPending:e=>e.status===Oe.Pending,isOwner:e=>e.flags>=255,isAdmin:e=>(e.flags&7)===7,canAddMember:e=>(e.flags&1)>0,canDeleteMember:e=>(e.flags&2)>0,canAuthorizeMember:e=>(e.flags&4)>0},message:{isEncrypted:e=>(e.flags&1)>0}});this.provider=e,this.keypair=n,this._coder=new Bn(ki),this._events=new Kn(this.programId,e,this._coder)}get connection(){return this.provider.connection}addEventListener(e,n){return this._events.addEventListener(e,n)}async removeEventListener(e){return await this._events.removeEventListener(e)}setKeypair(e){this.keypair=e}async loadAllChannels(e={}){const n=de.gpaBuilder().addFilter("accountDiscriminator",St);return this.workspace!==void 0&&n.addFilter("workspace",this.workspace),e.name&&n.addFilter("name",e.name),e.creator&&n.addFilter("creator",e.creator),(await n.run(this.provider.connection)).map(i=>({pubkey:i.pubkey,data:de.fromAccountInfo(i.account)[0]}))}async loadChannel(e,n){return de.fromAccountAddress(this.provider.connection,e,n)}async loadChannelMembers(e){return(await oe.gpaBuilder().addFilter("accountDiscriminator",Xe).addFilter("channel",e).run(this.provider.connection)).map(i=>({pubkey:i.pubkey,data:oe.fromAccountInfo(i.account)[0]}))}async loadMemberships(){return(await oe.gpaBuilder().addFilter("accountDiscriminator",Xe).addFilter("authority",this.provider.publicKey).run(this.provider.connection)).map(i=>({pubkey:i.pubkey,data:oe.fromAccountInfo(i.account)[0]}))}async loadMembership(e,n){return oe.fromAccountAddress(this.provider.connection,e,n)}async getMembershipPDA(e,n){return n=n!=null?n:this.provider.publicKey,await z.findProgramAddress([e.toBuffer(),n.toBuffer()],this.programId)}async loadDevices(e,n){return(await ge.gpaBuilder().addFilter("accountDiscriminator",Mt).addFilter("authority",n!=null?n:this.provider.publicKey).addFilter("channel",e).run(this.provider.connection)).map(a=>({pubkey:a.pubkey,data:ge.fromAccountInfo(a.account)[0]}))}async loadDevice(e,n){return ge.fromAccountAddress(this.provider.connection,e,n)}async getDevicePDA(e,n){return n=n!=null?n:this.keypair.publicKey,await z.findProgramAddress([e.toBuffer(),n.toBuffer()],this.programId)}async encryptCEK(e,n){return Ao(e,n!=null?n:this.keypair.publicKey)}async decryptCEK(e,n){return So(e,n!=null?n:this.keypair.secretKey)}async encryptMessage(e,n){return Mo(e,n)}async decryptMessage(e,n){return Co(e,n)}async initChannel(e,n){var _,w,k,A,C,S;const i=(_=e.channel)!=null?_:Ce.generate(),s=await ko(),a=await this.encryptCEK(s),[o]=await this.getMembershipPDA(i.publicKey),[r]=await this.getDevicePDA(o),c=this.provider.publicKey,u=new se,g=this.channelSpace(e.maxMessages);u.add(ne.createAccount({fromPubkey:c,newAccountPubkey:i.publicKey,lamports:await this.connection.getMinimumBalanceForRentExemption(g,n==null?void 0:n.commitment),space:g,programId:this.programId})),u.add(Zi({key:this.keypair.publicKey,channel:i.publicKey,membership:o,device:r,authority:c},{data:{workspace:(w=e.workspace)!=null?w:"",name:e.name,public:(k=e.public)!=null?k:!1,permissionless:(A=e.permissionless)!=null?A:!1,memberName:(C=e.memberName)!=null?C:"",maxMessages:e.maxMessages,cek:a}}));let p;try{p=await this.provider.sendAndConfirm(u,[i,this.keypair],n)}catch(B){throw(S=ie(B.code))!=null?S:B}return{signature:p,channel:i,cek:s,cekEncrypted:a}}async deleteChannel({channel:e},n){var r;const i=this.provider.publicKey,[s]=await this.getMembershipPDA(e),a=new se;a.add(Ni({channel:e,authority:i,authorityMembership:s}));let o;try{o=await this.provider.sendAndConfirm(a,void 0,n)}catch(c){throw(r=ie(c.code))!=null?r:Se("Unauthorized")}return{signature:o}}async joinChannel(e,n){var u,g;const[i]=await this.getMembershipPDA(e.channel),[s]=await this.getDevicePDA(i),a=this.provider.publicKey,o=this.keypair.publicKey,r=new se;r.add(ao({channel:e.channel,membership:i,device:s,authority:a,key:o},{data:{name:e.name,authority:(u=e.authority)!=null?u:null}}));let c;try{c=await this.provider.sendAndConfirm(r,[this.keypair],n)}catch(p){throw(g=ie(p.code))!=null?g:p}return{signature:c}}async leaveChannel(e,n){var c;const[i]=await this.getMembershipPDA(e.channel),s=this.provider.publicKey,a=new se,o=await this.loadDevices(e.channel);a.add(oo({channel:e.channel,membership:i,authority:s,anchorRemainingAccounts:o.map(u=>({pubkey:u.pubkey,isSigner:!1,isWritable:!0}))}));let r;try{r=await this.provider.sendAndConfirm(a,void 0,n)}catch(u){throw(c=ie(u.code))!=null?c:u}return{signature:r}}async addMember(e,n){var w,k,A,C;const i=(w=e.key)!=null?w:e.invitee,[s]=await this.getMembershipPDA(e.channel),[a]=await this.getDevicePDA(s),[o]=await this.getMembershipPDA(e.channel,e.invitee),[r]=await this.getDevicePDA(o,i),c=await this.loadDevice(a);if(!c.cek.encryptedKey)throw Se("Unauthorized");const u=await this.decryptCEK(c.cek),g=await this.encryptCEK(u,i),p=new se;p.add(Pi({channel:e.channel,authority:this.provider.publicKey,invitee:e.invitee,authorityMembership:s,inviteeMembership:o,inviteeDevice:r},{data:{name:(k=e.name)!=null?k:"",flags:(A=e.flags)!=null?A:0,cek:g,key:i}}));let _;try{_=await this.provider.sendAndConfirm(p,void 0,n)}catch(S){throw(C=ie(S.code))!=null?C:S}return{signature:_}}async deleteMember(e,n){var u;const[i]=await this.getMembershipPDA(e.channel,e.authority),[s]=await this.getMembershipPDA(e.channel),a=this.provider.publicKey,o=await this.loadDevices(e.channel,e.authority),r=new se;r.add(Ui({channel:e.channel,membership:i,membershipAuthority:e.authority,authority:a,authorityMembership:s,anchorRemainingAccounts:o.map(g=>({pubkey:g.pubkey,isSigner:!1,isWritable:!0}))}));let c;try{c=await this.provider.sendAndConfirm(r,void 0,n)}catch(g){throw console.log(g),(u=ie(g.code))!=null?u:g}return{signature:c}}async authorizeMember(e,n){var w,k;const i=(w=e.key)!=null?w:e.authority,[s]=await this.getMembershipPDA(e.channel),[a]=await this.getDevicePDA(s),[o]=await this.getMembershipPDA(e.channel,e.authority),[r]=await this.getDevicePDA(o,i),c=await this.loadDevice(a);if(!c.cek.encryptedKey)throw Se("Unauthorized");const u=await this.decryptCEK(c.cek),g=await this.encryptCEK(u,i),p=new se;p.add(Li({channel:e.channel,membership:o,device:r,authority:this.provider.publicKey,authorityMembership:s},{data:{cek:g}}));let _;try{_=await this.provider.sendAndConfirm(p,void 0,n)}catch(A){throw(k=ie(A.code))!=null?k:Se("Unauthorized")}return{signature:_}}async grantAccessMember(e,n){var r;const[i]=await this.getMembershipPDA(e.channel),[s]=await this.getMembershipPDA(e.channel,e.authority),a=new se;a.add(Gi({channel:e.channel,membership:s,authority:this.provider.publicKey,authorityMembership:i},{data:{flags:e.flags}}));let o;try{o=await this.provider.sendAndConfirm(a,void 0,n)}catch(c){throw(r=ie(c.code))!=null?r:Se("Unauthorized")}return{signature:o}}async addDevice(e,n){var p;const[i]=await this.getMembershipPDA(e.channel),[s]=await this.getDevicePDA(i),[a]=await this.getDevicePDA(i,e.key),o=await this.loadDevice(s);if(!(o!=null&&o.cek.encryptedKey))throw Se("Unauthorized");const r=await this.decryptCEK(o.cek),c=await this.encryptCEK(r,e.key),u=new se;u.add(Di({channel:e.channel,authority:this.provider.publicKey,membership:i,device:a},{data:{cek:c,key:e.key}}));let g;try{g=await this.provider.sendAndConfirm(u,void 0,n)}catch(_){throw(p=ie(_.code))!=null?p:_}return{signature:g}}async deleteDevice(e,n){var c,u;const i=(c=e.authority)!=null?c:this.provider.publicKey,[s]=await this.getMembershipPDA(e.channel,i),[a]=await this.getDevicePDA(s,e.key),o=new se;o.add(Oi({channel:e.channel,authority:this.provider.publicKey,device:a,deviceAuthority:i}));let r;try{r=await this.provider.sendAndConfirm(o,void 0,n)}catch(g){throw(u=ie(g.code))!=null?u:g}return{signature:r}}async postMessage(e,n){var u;const[i]=await this.getMembershipPDA(e.channel),[s]=await this.getDevicePDA(i);let a,o=0;if(e.encrypt){const g=await this.loadDevice(s);if(!g.cek.header)throw Se("Unauthorized");const p=await this.decryptCEK(g.cek);a=await this.encryptMessage(e.message,p),o|=1}else a=e.message;const r=new se;r.add(co({channel:e.channel,membership:i,authority:this.provider.publicKey},{message:String.fromCharCode(o)+a}));let c;try{c=await this.provider.sendAndConfirm(r,void 0,n)}catch(g){throw(u=ie(g.code))!=null?u:g}return{signature:c}}async readMessage(e,n){var o;const[i]=await this.getMembershipPDA(e.channel),s=new se;s.add(ho({channel:e.channel,membership:i,authority:this.provider.publicKey},{messageId:e.messageId}));let a;try{a=await this.provider.sendAndConfirm(s,void 0,n)}catch(r){throw(o=ie(r.code))!=null?o:r}return{signature:a}}channelSpace(e=1){return de.byteSize({workspace:"x".repeat(this.constants.maxWorkspaceLength),name:"x".repeat(this.constants.maxChannelNameLength),creator:z.default,createdAt:0,lastMessageAt:0,flags:0,memberCount:0,messageCount:0,maxMessages:e,messages:Array(e).fill({id:0,sender:z.default,createdAt:0,flags:0,content:"x".repeat(this.constants.maxMessageLength)})})}}const Ft=t=>"***** *** *** *** *******",q=Le("messenger",()=>{const t=st(),e=He(),n=et(),i=v(()=>e.keypair),s={allChannels:[],ownChannels:[],channel:void 0,channelAddr:void 0,channelMembershipAddr:void 0,channelMembership:void 0,channelMembers:[],channelMessages:[],channelLoading:!1,memberDevices:[],loading:!1,creating:!1,sending:!1},a=ae({...s}),o=v(()=>{var b;return new Do(new zt(t.connection,(b=n.value)!=null?b:{publicKey:z.default},zt.defaultOptions()),e.keypair)});let r=[];re(n,b=>{b?g().then():p()},{immediate:!0}),re([i,()=>a.allChannels],()=>{c().then()},{immediate:!0});async function c(){const $=(await o.value.loadMemberships()).map(L=>({pubkey:L.data.channel.toBase58(),status:L.data.status}));a.ownChannels=$}async function u(){console.log("Register events...");for(const b of r)await o.value.removeEventListener(b);r.push(o.value.addEventListener("NewMessageEvent",async b=>{if(console.log("[Event] NewMessageEvent",b),`${b.channel}`!=`${a.channelAddr}`)return;let $=b.message.content;if(o.value.utils.message.isEncrypted(b.message)){const J=await S();J?$=await o.value.decryptMessage(b.message.content,J):$=Ft(b.message.content)}a.channelMessages.push({...b.message,content:$})})),r.push(o.value.addEventListener("AuthorizeMemberEvent",async b=>{console.log("[Event] AuthorizeMemberEvent",b),!(a.channelAddr&&`${b.channel}`!=`${a.channelAddr}`)&&(`${b.membership}`==`${a.channelMembershipAddr}`?C(a.channelAddr).then():U().then())})),r.push(o.value.addEventListener("JoinChannelEvent",async b=>{console.log("[Event] JoinChannelEvent",b),`${b.channel}`==`${a.channelAddr}`&&U().then()})),r.push(o.value.addEventListener("LeaveChannelEvent",async b=>{console.log("[Event] LeaveChannelEvent",b),`${b.channel}`==`${a.channelAddr}`&&U().then()}))}async function g(){p(),r=[],a.loading=!0;const b=await o.value.loadAllChannels();await u(),a.allChannels=b,a.loading=!1,console.log(a)}function p(){Object.assign(a,s)}async function _(b,$){try{a.creating=!0;const{channel:L}=await o.value.initChannel({name:b,maxMessages:Number($.maxMessages),public:$.public,permissionless:$.permissionless});await C(L.publicKey),a.channel&&a.allChannels.push({pubkey:L.publicKey,data:a.channel})}finally{a.creating=!1}}async function w(b){const $=new z(b);await o.value.deleteChannel({channel:$}),Qe(b)}async function k(b){console.log("leaveChannel channel === ",b.toBase58()),await o.value.leaveChannel({channel:b}),Qe(b)}async function A(b,$){const L=new z(b);try{await o.value.joinChannel({channel:L,name:$}),await C(b);const J={pubkey:b.toString(),status:1};a.ownChannels.push(J)}catch(J){console.log(J)}}async function C(b){var $,L,J,W;a.channelLoading=!0,a.channelMessages=($=a.channelMessages)!=null?$:[],a.channelMembers=(L=a.channelMembers)!=null?L:[],a.channelMembershipAddr=void 0,a.channelMembership=(J=a.channelMembership)!=null?J:void 0,a.channelAddr=new z(b),a.memberDevices=[];try{if((W=n.value)!=null&&W.publicKey)try{const[fe]=await o.value.getMembershipPDA(a.channelAddr);a.channelMembershipAddr=fe,a.channelMembership=await o.value.loadMembership(fe)}catch(fe){console.log(fe),a.channelMembershipAddr=void 0,a.channelMembership=void 0}await $e(),await U(),await B()}catch(fe){console.log("Error",fe)}finally{a.channelLoading=!1}}async function S(){if(!(!a.channelMembership||!i.value))try{const[b]=await o.value.getMembershipPDA(a.channelAddr),[$]=await o.value.getDevicePDA(b,i.value.publicKey),L=await o.value.loadDevice($);return await o.value.decryptCEK(L.cek,i.value.secretKey)}catch(b){console.log(b)}}async function B(){if(!a.channelAddr){console.log("Invalid channel");return}a.channel=await o.value.loadChannel(a.channelAddr);const $=o.value.utils.channel.isPublic(a.channel)?null:await S();a.channelMessages=await Promise.all(a.channel.messages.map(async L=>{let W=o.value.utils.message.isEncrypted(L)?Ft(L.content):L.content;const fe=nt(L.sender);if($)try{W=await o.value.decryptMessage(L.content,$)}catch{console.log(`Failed to decrypt message #${L.id}`)}return{...L,senderDisplayName:fe,content:W}}))}async function U(){if(!a.channelAddr){console.error("Invalid channel");return}a.channelMembers=await x()}async function x(b=a.channelAddr){return await o.value.loadChannelMembers(b)}async function P(b){if(!a.channelAddr){console.log("Please select a channel");return}try{a.sending=!0;let $;a.channel&&($=o.value.utils.channel.isPublic(a.channel)),await o.value.postMessage({channel:a.channelAddr,message:b,encrypt:!$}),await B()}finally{a.sending=!1}}async function E(b,$,L,J){if(!a.channelAddr){console.log("Invalid channel");return}await o.value.addMember({channel:a.channelAddr,invitee:new z(b),key:$?new z($):void 0,name:L,flags:J})}async function Q(b){if(!a.channelAddr){console.log("Invalid channel");return}await o.value.deleteMember({channel:a.channelAddr,authority:new z(b)})}async function ue(b){if(!a.channelAddr){console.log("Invalid channel");return}await o.value.addDevice({channel:a.channelAddr,key:new z(b)}),await $e()}async function De(b){if(!a.channelAddr){console.log("Invalid channel");return}await o.value.deleteDevice({channel:a.channelAddr,key:b}),await $e()}async function ht(b){return(await o.value.loadDevices(a.channelAddr,b)).filter($=>{var L;return((L=$.data.cek)==null?void 0:L.encryptedKey)===""})[0]}async function $e(){a.channelAddr&&a.channelMembership&&(a.memberDevices=await o.value.loadDevices(a.channelAddr,a.channelMembership.authority))}async function G(b){if(!a.channelAddr){console.log("Invalid channel");return}const $=await ht(b);await o.value.authorizeMember({channel:a.channelAddr,authority:b,key:$.data.key}),await pt()}async function K(){await g()}async function pt(){a.channelMembers=await x()}async function gt(b){a.channelAddr=b}function Qe(b){const $=a.allChannels.findIndex(L=>L.pubkey.toBase58()===b.toString());a.allChannels.splice($,1),a.channelMessages=[],a.channel=void 0}async function ft(b){const $=await o.value.channelSpace(b);return Number(await t.connection.getMinimumBalanceForRentExemption($)/It)}async function yt(){if(!a.channelAddr)return;const[b]=await o.value.getMembershipPDA(a.channelAddr),[$]=await o.value.getDevicePDA(b);return(await o.value.loadDevice($)).key.toBase58()}return{channelMessagesCost:ft,addDevice:ue,deleteDevice:De,channelAuthorityDevice:yt,state:a,client:o.value,leaveChannel:k,loadChannel:C,joinChannel:A,createChannel:_,deleteChannel:w,postMessage:P,addMember:E,deleteMember:Q,authorizeMember:G,refreshList:K,loadMembers:x,selectChannel:gt}});function $o(){const{connection:t}=st(),e=ke(),{notify:n}=we(),i=F(!1);return{isAirdrop:i,airdropSol:async()=>{try{const a=await t.requestAirdrop(e.publicKey.value,1*It);await t.confirmTransaction(a),n({type:"positive",message:"you got 1 sol",timeout:2e3,position:"top"}),i.value=!0}catch(a){console.log(a)}}}}const an=15;function Eo(){const{createChannel:t}=q(),{isWalletConnected:e,ok:n,error:i,noSol:s}=ce(),{userBalance:a}=He(),o=ae({dialog:!1,name:"",maxMessages:an,public:!1,permissionless:!1,loading:!1});async function r(){if(e())try{if(!await a()){s();return}await t(o.name,{maxMessages:o.maxMessages,public:o.public,permissionless:o.permissionless}),c(),n("Channel was created!")}catch(u){i("Something went wrong"),console.log(u)}}function c(){o.dialog=!1,o.public=!1,o.loading=!1,o.name="",o.maxMessages=15}return{state:o,submit:r,reset:c}}function Io(){const t=q(),{info:e,ok:n,error:i}=ce(),s=ae({loading:!1});async function a(){if(!t.state.channelAddr){e("Please select a channel");return}try{s.loading=!0,await t.deleteChannel(t.state.channelAddr),n("Channel was deleted!")}catch(o){console.log("Error",o),i("Something went wrong")}finally{s.loading=!1}}return{state:s,submit:a}}function sn(){const{authorizeMember:t,loadChannel:e,state:n}=q(),{ok:i,error:s}=ce(),a=ae({loading:!1,dialog:!1});async function o(r){var c;try{a.loading=!0,await t(r),await e((c=n.channelAddr)!=null?c:""),i("Member was authorized")}catch(u){s("Something went wrong"),console.log(u)}finally{a.loading=!1}}return{state:a,submit:o}}function Po(){const{state:t,addMember:e,loadChannel:n}=q(),{ok:i,info:s,error:a,noSol:o}=ce(),{userBalance:r}=He(),c=ae({dialog:!1,loading:!1});async function u(p){var _;if(c.loading=!0,!t.channelAddr){s("Please select a channel");return}try{if(!await r()){o();return}return await e(p.wallet,p.key,p.name),await n((_=t.channelAddr)!=null?_:""),i("Member was added"),!0}catch(w){a("Something went wrong"),console.log(w)}finally{c.loading=!1,c.dialog=!1}return!1}function g(){c.loading=!1,c.dialog=!1}return{state:c,submit:u,reset:g}}function on(){const{deleteMember:t,loadChannel:e,state:n}=q(),{ok:i,error:s}=ce(),a=ae({loading:!1});async function o(r){var c;try{a.loading=!0,await t(r),await e((c=n.channelAddr)!=null?c:""),i("Member was deleted")}catch(u){s("Something went wrong"),console.log(u)}finally{a.loading=!1}}return{state:a,submit:o}}function To(){const{state:t,joinChannel:e}=q(),{ok:n,info:i,error:s,noSol:a}=ce(),{userBalance:o}=He(),r=ae({dialog:!1,loading:!1,name:""});async function c(){if(!t.channelAddr){i("Please select a channel");return}r.loading=!0;try{if(!await o()){a();return}await e(t.channelAddr,r.name),u(),n("Request was sent")}catch(g){console.log("Error",g),s("Something went wrong")}finally{r.loading=!1}}function u(){r.loading=!1,r.dialog=!1,r.name=""}return{state:r,submit:c,reset:u}}function Bo(){const t=q(),{info:e,ok:n,error:i}=ce(),s=ae({loading:!1});async function a(){if(!t.state.channelAddr){e("Please select a channel");return}try{s.loading=!0,await t.leaveChannel(t.state.channelAddr),n("Channel was abandoned!")}catch(o){console.log("Error",o),i("Something went wrong")}finally{s.loading=!1}}return{state:s,submit:a}}function Ko(){const t=q(),{ok:e}=ce(),n=ae({loading:!1});async function i(s){try{n.loading=!0,await t.addDevice(s),e("device added")}finally{n.loading=!1}}return{state:n,submit:i}}function Lo(){const t=q(),{ok:e}=ce(),n=ae({loading:!1});async function i(s){try{n.loading=!0,await t.deleteDevice(s),e("device removed")}finally{n.loading=!1}}return{state:n,submit:i}}function ce(){const t=ke(),{airdropSol:e}=$o(),{notify:n}=we(),i=c=>n({type:"info",message:c,timeout:2e3}),s=c=>n({type:"negative",message:c,timeout:2e3}),a=(c,u="bottom")=>n({type:"positive",message:c,timeout:2e3,position:u}),o=()=>n({type:"warning",message:"You don't have enough SOL on your balance!",position:"top",timeout:0,actions:[{label:"GET SOL",class:"btn--no-hover",padding:"0 15px 0 10px",size:"14px",color:"black",handler:()=>e()}]});function r(){return t.publicKey.value?!0:(i("Please connect wallet"),!1)}return{ok:a,info:i,error:s,noSol:o,isWalletConnected:r}}const Wo={class:"q-gutter-md row justify-between q-px-sm"},zo=R({__name:"DevicesControl",props:{addLoading:Boolean,isAuthorityDevice:Boolean},emits:["handleExport","handleAddDevice","handleImport"],setup(t,{emit:e}){const{ok:n}=ce(),i=F(!1),s=F(!1),a=F(""),o=F(),r=async()=>{await e("handleAddDevice",a.value),i.value=!1},c=()=>{const g=o.value[0];new FileReader;const p=new FileReader;p.addEventListener("load",()=>{const _=JSON.parse(p.result);e("handleImport",_.secretKey),n("secret key imported"),i.value=!1},!1),g&&p.readAsText(g)},u=()=>{e("handleExport")};return(g,p)=>{const _=ze;return y(),D(H,null,[h("div",Wo,[l(T,{class:"control-btn",square:"",flat:"",onClick:p[0]||(p[0]=w=>i.value=!0)},{default:m(()=>[l(_,{text:"Add new device"}),l(d(jt))]),_:1}),l(T,{class:"control-btn",square:"",flat:"",onClick:p[1]||(p[1]=w=>s.value=!0)},{default:m(()=>[l(_,{text:"Import device key"}),l(d(Ln))]),_:1}),l(T,{class:"control-btn",square:"",flat:"",disabled:!t.isAuthorityDevice,onClick:u},{default:m(()=>[l(_,{text:"Export device key"}),l(d(Wn))]),_:1},8,["disabled"])]),l(pe,{modelValue:i.value,"onUpdate:modelValue":p[3]||(p[3]=w=>i.value=w)},{default:m(()=>[l(X,{flat:"",square:"",class:"add-device-dialog"},{default:m(()=>[l(j,{class:"justify-center items-center text-body1"},{default:m(()=>[I(" Enter device key ")]),_:1}),l(j,{class:"justify-center"},{default:m(()=>[l(Ue,{onSubmit:r},{default:m(()=>[l(he,{modelValue:a.value,"onUpdate:modelValue":p[2]||(p[2]=w=>a.value=w),class:"input",label:"Device key",borderless:"",dense:"","lazy-rules":"",rules:[w=>w&&w.length>0||"Please enter device key"]},null,8,["modelValue","rules"]),l(T,{type:"submit",class:"dialog-submit-btn",flat:"",square:""},{default:m(()=>[I(" add device ")]),_:1})]),_:1})]),_:1}),l(We,{showing:t.addLoading},null,8,["showing"])]),_:1})]),_:1},8,["modelValue"]),l(pe,{modelValue:s.value,"onUpdate:modelValue":p[5]||(p[5]=w=>s.value=w)},{default:m(()=>[l(X,{flat:"",square:""},{default:m(()=>[l(j,null,{default:m(()=>[l(he,{modelValue:o.value,"onUpdate:modelValue":p[4]||(p[4]=w=>o.value=w),type:"file",hint:"Secret Key"},null,8,["modelValue"])]),_:1}),l(j,null,{default:m(()=>[l(T,{class:"dialog-submit-btn",flat:"",square:"",onClick:c},{default:m(()=>[I(" import device key ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});const No=Z(zo,[["__scopeId","data-v-bc01f0a4"]]),Fo=t=>(Be("data-v-466534d0"),t=t(),Ke(),t),Ro=Fo(()=>h("div",{class:"text-body1 text-blue-grey-8 text-left"}," Devices ",-1)),Oo=R({__name:"DevicesList",props:{selectDevicekey:Object,deleteLoading:Boolean,devices:Object,authorityDevice:String},emits:["handleSelect","handleDelete"],setup(t,{emit:e}){const n=t,i=o=>e("handleSelect",o),s=o=>e("handleDelete",o),a=o=>o.toBase58()===n.authorityDevice;return(o,r)=>{const c=ze;return y(),D(H,null,[Ro,l(ve,{bordered:"",separator:"",class:"devices-list"},{default:m(()=>[(y(!0),D(H,null,te(t.devices,u=>(y(),M(j,{key:u,"active-class":"bg-blue-grey-8 text-white active",class:xe(["devices-item",{"authority-device":a(u.data.key)}]),clickable:"",active:t.selectDevicekey===u.data.key,onClick:g=>i(u.data.key)},{default:m(()=>[h("span",null,[a(u.data.key)?(y(),M(c,{key:0,text:"Authority device"})):ee("",!0),I(" "+N(u.data.key),1)]),l(Ze),a(u.data.key)?ee("",!0):(y(),M(zn,{key:0,name:d($t),size:"18px",class:"delete-device-btn",onClick:g=>s(u.data.key)},{default:m(()=>[l(c,{text:"Delete device"})]),_:2},1032,["name","onClick"]))]),_:2},1032,["class","active","onClick"]))),128))]),_:1}),l(We,{showing:t.deleteLoading},null,8,["showing"])],64)}}});const Vo=Z(Oo,[["__scopeId","data-v-466534d0"]]),qo=t=>(Be("data-v-b6604df2"),t=t(),Ke(),t),Uo=qo(()=>h("div",{class:"text-body1 text-blue-grey-8 text-left"}," Device Key ",-1)),Ho={class:"text-body2"},jo=R({__name:"UserInfoDialog",props:{devices:Object,authorityDevice:String},emits:["regenerate","channelAuthorityDevice","loadChannel"],setup(t,{emit:e}){const n=t,i=He();ce();const s=Ko(),a=Lo(),o=F(),r=v(()=>{var k;return n.authorityDevice===((k=o.value)==null?void 0:k.toBase58())}),c=()=>{var k,A;return Rn(String((A=(k=i.keypair)==null?void 0:k.publicKey)!=null?A:""))},u=k=>o.value=k,g=k=>{s.submit(k)},p=()=>{i.exportKey()},_=k=>{i.importKey(k),setTimeout(()=>e("loadChannel"),1e3)},w=k=>{a.submit(k)};return(k,A)=>{const C=Vo,S=No;return y(),M(pe,{class:"dialog-wrapper","transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:m(()=>[l(X,{square:"",flat:""},{default:m(()=>[l(V,{class:"row items-center q-pa-xs"},{default:m(()=>[l(Ze),_e(l(T,{flat:"",round:"",dense:"",icon:d($t)},null,8,["icon"]),[[Ee]])]),_:1}),l(V,{class:"q-py-none"},{default:m(()=>{var B;return[Uo,l(T,{flat:"",round:"",dense:"",icon:d(Nn),onClick:c},{default:m(()=>[l(qt,{delay:0,anchor:"bottom middle",self:"top middle","transition-duration":"0"},{default:m(()=>[I(" Copy to clipboard ")]),_:1})]),_:1},8,["icon"]),h("span",Ho,N((B=d(i).keypair)==null?void 0:B.publicKey),1)]}),_:1}),l(Ie),l(V,null,{default:m(()=>[l(C,{devices:t.devices,"authority-device":t.authorityDevice,"select-devicekey":o.value,"delete-loading":d(a).state.loading,onHandleSelect:u,onHandleDelete:w},null,8,["devices","authority-device","select-devicekey","delete-loading"])]),_:1}),l(Ie),l(Fn,{align:"right"},{default:m(()=>[l(S,{"add-loading":d(s).state.loading,"is-authority-device":d(r),onHandleExport:p,onHandleAddDevice:g,onHandleImport:_},null,8,["add-loading","is-authority-device"])]),_:1})]),_:1})]),_:1})}}});const Qo=Z(jo,[["__scopeId","data-v-b6604df2"]]),Ae=Le("channel",()=>{const t=et(),{state:e,client:n}=q(),i=v(()=>e.channelLoading),s=v(()=>e.sending),a=v(()=>{var E;return!!((E=t.value)!=null&&E.publicKey)}),o=v(()=>!!e.channel&&n.utils.channel.isPublic(e.channel)),r=v(()=>!!e.channel&&n.utils.channel.isPermissionless(e.channel)),c=v(()=>{var E;return((E=e.channelMembership)==null?void 0:E.status)===0}),u=v(()=>{var E;return((E=e.channelMembership)==null?void 0:E.status)===1}),g=v(()=>{var E,Q,ue;return String((E=e.channel)==null?void 0:E.creator)===String((ue=(Q=t.value)==null?void 0:Q.publicKey)!=null?ue:"-")}),p=v(()=>!!e.channelMembership&&n.utils.member.canAddMember(e.channelMembership)),_=v(()=>!!e.channelMembership&&n.utils.member.canAuthorizeMember(e.channelMembership)),w=v(()=>!!e.channelMembership&&n.utils.member.canDeleteMember(e.channelMembership)),k=v(()=>!!e.channelMembership&&n.utils.member.isAdmin(e.channelMembership)),A=v(()=>!!e.channelMembership&&n.utils.member.isOwner(e.channelMembership)),C=v(()=>a.value&&!!e.channel&&!e.loading&&!c.value),S=v(()=>a.value),B=v(()=>A.value),U=v(()=>A.value),x=v(()=>!e.sending&&(o.value||c.value));return{ownChannels:v(()=>e.allChannels.filter(E=>{var Q;return!!e.ownChannels.find(ue=>ue.pubkey===E.pubkey.toBase58())||E.data.flags===1||E.data.creator.toBase58()===String((Q=t.value)==null?void 0:Q.publicKey)})),isChannelLoading:i,isSendMessage:s,isPublicChannel:o,isWalletConnected:a,isPermissionlessChannel:r,isAuthorizedMember:c,isPendingMember:u,isChannelCreator:g,isAdmin:k,isOwner:A,canJoinChannel:C,canAddMember:p,canAuthorizeMember:_,canDeleteMember:w,canCreateChannel:S,canDeleteChannel:B,canGrantAccess:U,canPostMessage:x}}),Go={class:"text-weight-medium wallet"},Jo={class:"memberlist-info__details"},Yo=h("span",null,"Authority:",-1),Xo={class:"memberlist-btns"},Zo=R({__name:"MemberListDialog",props:{membersDialog:{type:Boolean,default:!1},authorizeMemberState:{type:Object},deleteMemberState:{type:Object},wallet:{type:Object}},emits:["submit","deleteMember"],setup(t,{emit:e}){const{state:n}=q(),i=Ae(),s=r=>r>0?"pending":"authorized",a=r=>s(r)==="pending"&&i.canAuthorizeMember,o=r=>{var c;return((c=n.channel)==null?void 0:c.creator.toBase58())===r};return(r,c)=>(y(),M(pe,{class:"memberlist"},{default:m(()=>[l(X,{square:"",flat:"",horizontal:""},{default:m(()=>[l(V,{class:"q-px-lg"},{default:m(()=>[I(" MEMBERS ")]),_:1}),l(V,{class:"memberlist-card"},{default:m(()=>[l(ve,{separator:""},{default:m(()=>[(y(!0),D(H,null,te(d(n).channelMembers,u=>(y(),M(j,{key:u.pubkey.toString(),"active-class":"owner",active:`${u.pubkey}`==`${d(n).channelMembershipAddr}`,class:"memberlist-item"},{default:m(()=>[l(Y,{class:"memberlist-info"},{default:m(()=>[l(Fe,{class:"row"},{default:m(()=>[h("span",Go,N(d(Jt)(u.data)),1),l(On,{class:xe([s(u.data.status),"memberlist-status q-pa-xs q-ml-lg"])},{default:m(()=>[I(N(s(u.data.status)),1)]),_:2},1032,["class"])]),_:2},1024),l(Fe,{caption:"",lines:"2"},{default:m(()=>[h("div",Jo,[Yo,h("span",null,N(u.data.authority),1)])]),_:2},1024)]),_:2},1024),h("div",Xo,[a(u.data.status)?(y(),M(T,{key:0,color:"positive",size:"sm",unelevated:"",class:"full-width",loading:t.authorizeMemberState.loading,disabled:t.authorizeMemberState.loading,onClick:g=>r.$emit("submit",u.data.authority)},{default:m(()=>[I(" Authorize ")]),_:2},1032,["loading","disabled","onClick"])):ee("",!0),d(i).canDeleteMember&&!o(u.data.authority.toBase58())?(y(),M(T,{key:1,color:"negative",size:"sm",unelevated:"",class:"full-width",loading:t.deleteMemberState.loading,disabled:t.deleteMemberState.loading,onClick:g=>r.$emit("deleteMember",u.data.authority)},{default:m(()=>[I(" Delete ")]),_:2},1032,["loading","disabled","onClick"])):ee("",!0)])]),_:2},1032,["active"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}}),er=h("br",null,null,-1),tr=R({__name:"JoinChennalModal",emits:["join"],setup(t,{emit:e}){const n=F("");return(i,s)=>(y(),M(pe,null,{default:m(()=>[l(X,{square:"",flat:""},{default:m(()=>[l(V,{class:"text-body1"},{default:m(()=>[I(" Join Channel ")]),_:1}),l(V,{class:"text-body1 text-blue-grey-8"},{default:m(()=>[l(Ue,{class:"join-channel-form",onSubmit:s[1]||(s[1]=Tt(a=>i.$emit("join",n.value),["prevent"]))},{default:m(()=>[l(he,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value=a),label:"Member name *","lazy-rules":"",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),er,l(T,{type:"submit",class:"dialog-submit-btn","text-color":"black",ripple:!1,square:""},{default:m(()=>[I(" Join Channel ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}});const nr=t=>(Be("data-v-157586e8"),t=t(),Ke(),t),ar=nr(()=>h("span",{class:"text-blue-grey-8 q-pb-xs"},"Search by name or address",-1)),sr={class:"search-block"},ir={class:"channel-info text-weight-medium"},or={class:"channel-info"},rr={key:0,class:"already-in-chat"},lr={class:"control-btns"},cr=R({__name:"JoinChannelDialog",props:{loading:{type:Boolean},defaultState:Object},emits:["submit","reset"],setup(t,{emit:e}){const n=t;F(n.defaultState);const{state:i,selectChannel:s,refreshList:a}=q(),o=Ae(),r=F(!1),c=F(""),u=F([]),g=v(()=>i.allChannels.filter(S=>S.data.flags===0||S.data.flags===2)),p=v(()=>i.loading),_=S=>S.name.slice(0,2),w=()=>{if(c.value===""){u.value=[],c.value="";return}u.value=g.value.filter(S=>S.data.name.toLocaleLowerCase().includes(c.value.toLocaleLowerCase())||S.pubkey.toBase58().toLocaleLowerCase().includes(c.value.toLocaleLowerCase()))},k=v(()=>{var S;return((S=c.value)==null?void 0:S.length)>0?u.value:g.value}),A=S=>{e("submit",S)};re(c,()=>{w()}),re(()=>n.loading,S=>{S&&(r.value=!1)});const C=S=>o.ownChannels.find(B=>String(B.pubkey)===String(S.pubkey));return(S,B)=>{const U=ze,x=tr;return y(),M(pe,{class:"join-channel-dialog",onHide:B[3]||(B[3]=P=>S.$emit("reset"))},{default:m(()=>[l(X,{square:"",flat:""},{default:m(()=>[l(V,{class:"text-body1 text-blue-grey-8"},{default:m(()=>[I(" Join channel ")]),_:1}),l(V,{class:"q-py-none"},{default:m(()=>[ar,h("div",sr,[l(he,{modelValue:c.value,"onUpdate:modelValue":B[0]||(B[0]=P=>c.value=P),class:"input no-margin q-pa-none",placeholder:"Search ...",borderless:"",dense:"",debounce:"300"},null,8,["modelValue"])])]),_:1}),l(V,null,{default:m(()=>[d(k).length?(y(),M(ve,{key:0,bordered:"",separator:"",class:"privat-channels"},{default:m(()=>[(y(!0),D(H,null,te(d(k),P=>_e((y(),M(j,{key:P,"active-class":"bg-blue-grey-8 text-white",class:"privat-channels-item",active:`${d(i).channelAddr}`==`${P.pubkey}`,clickable:"",onClick:E=>d(s)(P.pubkey)},{default:m(()=>[h("div",{class:"chat-avatar",style:Ve(d(Yt)(`${P.pubkey}`))},[h("span",null,N(_(P.data)),1)],4),l(Y,null,{default:m(()=>[h("span",ir,N(P.data.name),1),h("span",or,N(P.pubkey),1)]),_:2},1024),C(P)?(y(),D("div",rr,[l(U,{text:"already in channel"}),l(d(Vn),{size:"18"})])):ee("",!0)]),_:2},1032,["active","onClick"])),[[qn]])),128))]),_:1})):(y(),M(j,{key:1,class:"privat-channels justify-center items-center text-blue-grey-5"},{default:m(()=>[I(" Channels not found ")]),_:1}))]),_:1}),h("div",lr,[l(T,{class:xe(["control-button",{"refresh-btn":d(p)}]),square:"",flat:"",disable:!d(i).channelAddr,onClick:d(a)},{default:m(()=>[l(d(Qt),{style:{color:"#fff"}}),l(U,{text:"Refresh channels"})]),_:1},8,["disable","class","onClick"]),l(T,{class:"control-button",square:"",flat:"",disable:!d(i).channelAddr,onClick:B[1]||(B[1]=P=>r.value=!0)},{default:m(()=>[l(d(Un),{style:{color:"#fff"}}),l(U,{text:"Request to join"})]),_:1},8,["disable"]),l(x,{modelValue:r.value,"onUpdate:modelValue":B[2]||(B[2]=P=>r.value=P),onJoin:A},null,8,["modelValue"])]),l(We,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})}}});const ur=Z(cr,[["__scopeId","data-v-157586e8"]]),dr=t=>(Be("data-v-e91edd23"),t=t(),Ke(),t),mr=dr(()=>h("br",null,null,-1)),hr=R({__name:"AddMemberDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t,{emit:e}){const i=F(t.defaultState),s=()=>e("submit",i.value);return(a,o)=>(y(),M(pe,{class:"add-member-dialog",onHide:o[3]||(o[3]=r=>a.$emit("reset"))},{default:m(()=>[l(X,{square:"",flat:""},{default:m(()=>[l(V,null,{default:m(()=>[l(Ue,{class:"add-member-form",onSubmit:Tt(s,["prevent"])},{default:m(()=>[l(he,{modelValue:i.value.name,"onUpdate:modelValue":o[0]||(o[0]=r=>i.value.name=r),label:"Member name *",hint:"Min length 3 chars","lazy-rules":"",rules:[r=>r&&r.length>2||"Please type something"]},null,8,["modelValue","rules"]),l(he,{modelValue:i.value.wallet,"onUpdate:modelValue":o[1]||(o[1]=r=>i.value.wallet=r),label:"Member Wallet *","lazy-rules":"",rules:[r=>r&&r.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),l(he,{modelValue:i.value.key,"onUpdate:modelValue":o[2]||(o[2]=r=>i.value.key=r),label:"Member Device Key",hint:"Default: The same as member wallet","lazy-rules":"",rules:[r=>!r||r.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),mr,l(T,{type:"submit",class:"dialog-submit-btn","text-color":"black",ripple:!1,square:"",flat:""},{default:m(()=>[I(" Add Member ")]),_:1})]),_:1},8,["onSubmit"]),l(We,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const pr=Z(hr,[["__scopeId","data-v-e91edd23"]]),Bt="/assets/info.bfade5eb.svg",gr={class:"relative-position"},fr={class:"messages-cost"},yr={class:"toggle-info max-messages-tooltip"},br=h("img",{src:Bt,alt:"info"},null,-1),_r={class:"row q-mt-md relative-position",style:{height:"42px"}},vr={class:"toggle-info"},wr=h("img",{src:Bt,alt:"info"},null,-1),kr={key:0,class:"row text-primary toggle-approve"},Ar={class:"toggle-info"},Sr=h("img",{src:Bt,alt:"info"},null,-1),Mr=R({__name:"NewChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t,{emit:e}){const n=t,{channelMessagesCost:i}=q(),s=F(n.defaultState),a=()=>e("submit",s),o=F(0),r=v(()=>`~${o.value.toFixed(3)} SOL`);return re(()=>{var c;return(c=s.value)==null?void 0:c.maxMessages},async c=>{o.value=await i(Number(c))}),Hn(async()=>{const c=an;o.value=await i(Number(c))}),(c,u)=>{const g=ze;return y(),M(pe,{class:"new-channel-dialog",onHide:u[4]||(u[4]=p=>c.$emit("reset"))},{default:m(()=>[l(X,{square:"",flat:""},{default:m(()=>[l(V,null,{default:m(()=>[l(Ue,{class:"messenger-new-channel-form",onSubmit:a},{default:m(()=>[l(he,{modelValue:s.value.name,"onUpdate:modelValue":u[0]||(u[0]=p=>s.value.name=p),label:"Channel name *","lazy-rules":"",maxlength:"32",rules:[p=>p&&p.length>2||"Please type something"]},null,8,["modelValue","rules"]),h("div",gr,[l(he,{modelValue:s.value.maxMessages,"onUpdate:modelValue":u[1]||(u[1]=p=>s.value.maxMessages=p),label:"Max messages","lazy-rules":"",type:"number",debounce:"500",rules:[p=>+p>0||"Invalid value"]},null,8,["modelValue","rules"]),h("div",fr,N(d(r)),1),h("div",yr,[l(g,{text:d(_t)[2],padding:"8px"},null,8,["text"]),br])]),h("div",_r,[h("div",vr,[l(g,{text:d(_t)[0],padding:"8px"},null,8,["text"]),wr]),h("div",{class:xe(["col text-primary",{"toggle-border":!s.value.public}])},[I(" Private"),l(Nt,{modelValue:s.value.public,"onUpdate:modelValue":u[2]||(u[2]=p=>s.value.public=p),label:"Public"},null,8,["modelValue"])],2),s.value.public?ee("",!0):(y(),D("div",kr,[l(Nt,{modelValue:s.value.permissionless,"onUpdate:modelValue":u[3]||(u[3]=p=>s.value.permissionless=p)},null,8,["modelValue"]),h("span",null,[h("div",Ar,[l(g,{text:d(_t)[1],padding:"8px"},null,8,["text"]),Sr]),I(" Members can approve")])]))]),l(T,{type:"submit",class:"dialog-submit-btn q-mt-md","text-color":"black",ripple:!1,square:"",flat:""},{default:m(()=>[I(" Create the Channel ")]),_:1})]),_:1}),l(We,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1})}}});const Cr=R({__name:"ChannelForm",props:{message:{type:String,default:""},disabled:{type:Boolean,default:!1},sending:{type:Boolean,default:!1}},emits:["submit"],setup(t,{emit:e}){const i=F(t.message),s=()=>{e("submit",i),i.value=""};return(a,o)=>(y(),M(Ue,{class:"channel-form",onSubmit:Tt(s,["prevent"])},{default:m(()=>[l(jn,{class:"row message-control"},{default:m(()=>[l(he,{ref:"inputFocus",modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=r=>i.value=r),class:"col-grow message-input",placeholder:"Type a message",dense:"",borderless:"",autofocus:"",disable:t.disabled},null,8,["modelValue","disable"]),l(T,{class:"send-btn",square:"",flat:"",type:"submit",disable:t.disabled,loading:t.sending},{default:m(()=>[I(" Send ")]),_:1},8,["disable","loading"])]),_:1})]),_:1},8,["onSubmit"]))}});const xr=Z(Cr,[["__scopeId","data-v-bb5ae488"]]),Dr="/assets/solana-logo.3caace62.svg",Kt=t=>(Be("data-v-a765a3c1"),t=t(),Ke(),t),$r={class:"messenger-content"},Er={key:0,class:"preloader"},Ir={key:1,class:"messenger-empty"},Pr={key:2,class:"messenger-empty"},Tr=Kt(()=>h("img",{src:Dr,alt:"logo"},null,-1)),Br=Kt(()=>h("span",{name:"connect"},"Please connect a wallet",-1)),Kr=[Tr,Br],Lr={key:3,class:"messenger-empty"},Wr=Kt(()=>h("span",{name:"select"},"Please select a channel",-1)),zr=[Wr],Nr=R({__name:"ChannelWrapper",props:{postMessageState:{type:Object}},emits:["sendMessage"],setup(t,{emit:e}){const n=ke(),{state:i}=q(),s=Ae();function a(p){const _=n.publicKey.value;return _?String(_)!==String(p):!0}const o=v(()=>{const p=[];let _=0,w;for(const k of i.channelMessages)w&&`${k.sender}`==`${w}`?p[_-1].text.push(k.content):(w=k.sender,p.push({id:k.id,sender:k.sender,senderDisplayName:k.senderDisplayName,text:[k.content],date:k.createdAt}),_++);return p}),r=v(()=>s.canPostMessage),c=p=>e("sendMessage",p),u=F(),g=F();return re(g,p=>{p&&(u.value.scrollTop=p.scrollHeight)}),(p,_)=>{const w=xr;return y(),M(X,{class:"messenger-card",square:"",flat:""},{default:m(()=>[h("div",$r,[d(s).isChannelLoading?(y(),D("div",Er,[l(Qn,{color:"primary",size:"2em"})])):d(i).channel?(y(),D("div",{key:1,ref_key:"chat",ref:u,class:"row justify-center channel-wrapper"},[d(o).length>0?(y(),D("div",{key:0,ref_key:"mes",ref:g,class:"messenger-messages"},[(y(!0),D(H,null,te(d(o),k=>(y(),M(Gn,{key:k.id,name:k.senderDisplayName,text:k.text,sent:a(k.sender)},null,8,["name","text","sent"]))),128))],512)):(y(),D("div",Ir," No messages "))],512)):d(s).isWalletConnected?(y(),D("div",Lr,zr)):(y(),D("div",Pr,Kr))]),l(w,{message:t.postMessageState.message,sending:d(s).isSendMessage,disabled:!d(r),onSubmit:c},null,8,["message","sending","disabled"])]),_:1})}}});const Fr=Z(Nr,[["__scopeId","data-v-a765a3c1"]]),Rr=R({__name:"ChannelControl",props:{isLoading:{type:Boolean}},emits:["createChannel","joinChannel","refreshList"],setup(t,{emit:e}){const n=Ae();ce();const{notify:i}=we();v(()=>n.isPendingMember),v(()=>n.canCreateChannel);const s=a=>{if(!n.isWalletConnected){i({message:"Please connect wallet",color:"negative",position:"top"});return}e(a)};return(a,o)=>{const r=ze;return y(),M(j,null,{default:m(()=>[l(Y,{class:"button-wrapper"},{default:m(()=>[l(T,{class:xe(["control-button",{"refresh-btn":t.isLoading}]),square:"",flat:"",onClick:o[0]||(o[0]=c=>s("refreshList"))},{default:m(()=>[l(d(Qt),{style:{color:"#fff"}}),l(r,{text:"Refresh channels"})]),_:1},8,["class"]),l(T,{class:"control-button",square:"",flat:"",onClick:o[1]||(o[1]=c=>s("createChannel"))},{default:m(()=>[l(d(jt),{style:{color:"#fff"}}),l(r,{text:"Create a channel"})]),_:1}),l(T,{class:"control-button",square:"",flat:"",onClick:o[2]||(o[2]=c=>s("joinChannel"))},{default:m(()=>[l(d(Jn),{style:{color:"#fff"}}),l(r,{text:"Browse channels"})]),_:1})]),_:1})]),_:1})}}});const Or=Z(Rr,[["__scopeId","data-v-26b76d99"]]),Vr={class:"chat-name"},qr={key:0,class:"message-public"},Ur={key:1,class:"pending-icon"},Hr=R({__name:"MessengerChannel",props:{pubkey:{type:Object,required:!0},channel:{type:Object,required:!0},isActive:Boolean},emits:["select"],setup(t){const e=t,{state:n}=q(),i=v(()=>{var r;return(r=n.ownChannels.find(c=>c.pubkey===e.pubkey.toString()))==null?void 0:r.status}),s=v(()=>i.value===1),a=v(()=>e.channel.name.slice(0,2)),o=v(()=>e.channel.flags===1);return(r,c)=>{const u=ze;return y(),M(j,{"active-class":"bg-blue-grey-8 text-white",style:{"min-height":"42px"},active:t.isActive},{default:m(()=>[l(Y,{class:"chat-item cursor-pointer",onClick:c[0]||(c[0]=g=>r.$emit("select"))},{default:m(()=>[h("div",{class:"chat-badge",style:Ve(d(Yt)(`${t.pubkey}`))},[h("span",null,N(d(a)),1)],4),h("div",Vr,N(t.channel.name),1),d(o)?(y(),D("div",qr,[l(u,{text:"Public channel"}),I(" P ")])):ee("",!0),d(s)?(y(),D("div",Ur,[l(u,{text:"waiting for confirmation"}),l(Yn,{color:"primary",size:"16px"})])):ee("",!0)]),_:1})]),_:1},8,["active"])}}});const jr=Z(Hr,[["__scopeId","data-v-705989c7"]]),Qr=h("div",{class:"text-h5"}," Channels ",-1),Gr={class:"text-weight-medium"},Jr={class:"memberlist-info__details"},Yr=h("span",null,"Authority:",-1),Xr={class:"memberlist-info__details"},Zr=h("span",null,"Key:",-1),el=R({__name:"PendingUsersDialog",props:{pendingChannels:Object},setup(t){F(!1);const{state:e}=q(),n=sn(),i=on(),s=async(c,u)=>{e.channelAddr=u,await n.submit(c)},a=async(c,u)=>{e.channelAddr=u,await i.submit(c)},o=v(()=>n.state.loading),r=v(()=>i.state.loading);return(c,u)=>(y(),M(pe,null,{default:m(()=>[l(X,{class:"pending-channels",square:"",flat:"",horizontal:""},{default:m(()=>[l(V,null,{default:m(()=>[Qr]),_:1}),l(V,null,{default:m(()=>[l(ve,{bordered:""},{default:m(()=>[(y(!0),D(H,null,te(t.pendingChannels,(g,p)=>(y(),M(Xn,{key:g.name,"expand-separator":"",label:g.channel.data.name,caption:"channel","default-opened":p===0,"header-class":"owner"},{default:m(()=>[l(ve,{separator:""},{default:m(()=>[(y(!0),D(H,null,te(g.pendingMembers,_=>(y(),M(j,{key:_,class:"row justify-between pending-item"},{default:m(()=>[l(Y,{class:"memberlist-info"},{default:m(()=>[l(Fe,{class:"row justify-between"},{default:m(()=>[h("span",Gr,N(d(Jt)(_.data)),1)]),_:2},1024),l(Fe,{caption:"",lines:"2"},{default:m(()=>[h("div",Jr,[Yr,h("span",null,N(_.data.authority),1)]),h("div",Xr,[Zr,h("span",null,N(_.data.key),1)])]),_:2},1024)]),_:2},1024),l(Y,{side:"",class:"memberlist-btns"},{default:m(()=>[l(T,{color:"teal",size:"xs",unelevated:"",class:"full-width",loading:d(o),disabled:d(o),onClick:w=>s(_.data.authority,g.channel.pubkey)},{default:m(()=>[I(" Authorize ")]),_:2},1032,["loading","disabled","onClick"]),l(T,{color:"negative",size:"xs",unelevated:"",class:"full-width",loading:d(r),disabled:d(r),onClick:w=>a(_.data.key,g.channel.pubkey)},{default:m(()=>[I(" Delete ")]),_:2},1032,["loading","disabled","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["label","default-opened"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}});const tl={class:"bell",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",fill:"none","xmlns:v":"https://vecta.io/nano"},nl=["fill"],al=R({__name:"iconBell",props:{color:{type:String,default:"AABEC8"}},setup(t){return(e,n)=>(y(),D("svg",tl,[h("path",{d:"M5.352 14.359h3.294c0 .821-.59 1.641-1.647 1.641s-1.647-.82-1.647-1.641zm8.434-3.467l-.911-1.515a3.68 3.68 0 0 1-.527-1.897V5.325C12.348 2.389 9.949 0 7 0S1.651 2.389 1.651 5.325v2.155a3.68 3.68 0 0 1-.527 1.897l-.911 1.515c-.278.461-.285 1.018-.018 1.487s.749.749 1.29.749h11.03a1.47 1.47 0 0 0 1.291-.749 1.46 1.46 0 0 0-.021-1.487z",fill:`#${t.color}`},null,8,nl)]))}}),rn=Le("notifications",()=>{const t=et(),{loadMembers:e,state:n}=q(),i=Ae(),s=ae({showInfo:!1,showDialog:!1,pendingChannels:[]});re([()=>i.ownChannels,()=>n.channelMembers],async(o,r)=>{r.length>0&&await a(r[0])});async function a(o){try{const r=await Promise.all(o.map(async c=>{var p;const{pubkey:u,data:g}=c;if(g.creator.toBase58()===((p=t.value)==null?void 0:p.publicKey.toBase58())){const _=await e(u);if(_.length===0)return;const w=_.filter(k=>k.data.status===1);return w.length?{channel:c,pendingMembers:w}:void 0}}));s.pendingChannels=r.filter(c=>c),s.pendingChannels.length>0?(setTimeout(()=>s.showInfo=!0,2e3),setTimeout(()=>s.showInfo=!1,7e3)):s.showDialog=!1}catch(r){console.log(r)}}return{state:s}});function sl(){const{state:t}=rn();return{showDialog:v(()=>t.showDialog),showInfo:v(()=>t.showInfo),pendingChannels:v(()=>t.pendingChannels)}}const il={class:"panel-notifications__info"},ol=R({__name:"MessengerNotification",setup(t){const{pendingChannels:e,showInfo:n,showDialog:i}=sl(),{state:s}=rn(),a=v(()=>{var u,g;return(g=(u=e.value)==null?void 0:u.length)!=null?g:0}),o=v(()=>a.value>0),r=v(()=>n.value?"width: 100%; padding-right: 14px":"width: 0; padding-right: 0;"),c=()=>{!o.value||(s.showDialog=!s.showDialog)};return(u,g)=>{const p=al,_=el;return y(),D("div",{class:xe(["panel-notifications",{"has-notifications":d(o)}]),onClick:c},[h("div",il,[l(p,{class:"ring",color:d(o)?"FF5C5C":"AABEC8"},null,8,["color"]),h("span",null,N(a.value),1)]),h("div",{ref:"notificationsInfo",class:"panel-notifications__details",style:Ve(d(r))}," channels are awaiting user confirmation ",4),l(_,{modelValue:d(s).showDialog,"onUpdate:modelValue":g[0]||(g[0]=w=>d(s).showDialog=w),"pending-channels":d(e),onCloseDialog:g[1]||(g[1]=w=>u.isShow.value=!1)},null,8,["modelValue","pending-channels"])],2)}}});const ln=Le("mobile",()=>{const{screen:t}=we(),e=ae({searchOrInfo:"search"}),n=v(()=>t.xs);return re(n,i=>{i&&(e.searchOrInfo="search")}),{state:e,isMobile:n}}),rl={class:"panel-search"},ll={class:"search-wrapper"},cl={class:"panel-info"},ul={class:"chat-info"},dl={class:"chat-members"},ml={class:"chat-messages"},hl=["title"],pl={key:0,class:"members-count bg-cyan-9"},gl=R({__name:"MessengerToolbar",emits:["search","showMembers","deleteChannel","addMember","showDeviceKey","leaveChannel"],setup(t,{emit:e}){const n=ke(),{state:i}=q(),s=Ae(),a=ln();we(),v(()=>!!n.publicKey.value);const o=F(""),r=v(()=>i.channel),c=v(()=>{var A,C,S;return((A=r.value)==null?void 0:A.memberCount)===null||((C=r.value)==null?void 0:C.memberCount)===void 0?"":`${(S=r.value)==null?void 0:S.memberCount}\xA0members`}),u=v(()=>{var A,C,S;return((A=r.value)==null?void 0:A.messageCount)===null||((C=r.value)==null?void 0:C.messageCount)===void 0?"":`${(S=r.value)==null?void 0:S.messageCount}\xA0messages`}),g=A=>e("search",A),p=()=>e("showMembers"),_=()=>e("addMember"),w=v(()=>{if(!(!s.isOwner||!s.isAdmin))return i.channelMembers.filter(A=>A.data.status===1).length});re(o,A=>{g(String(A))});const k=v(()=>a.isMobile&&a.state.searchOrInfo==="info");return re(()=>i.channelAddr,A=>{A&&a.isMobile&&(a.state.searchOrInfo="info")}),(A,C)=>{var B,U;const S=ol;return y(),D("div",{class:xe(["panel-toolbar",d(a).state.searchOrInfo])},[l(S),d(k)?(y(),M(d(Zn),{key:0,class:"back-arrow",onClick:C[0]||(C[0]=x=>d(a).state.searchOrInfo="search")})):ee("",!0),h("div",rl,[h("div",ll,[l(he,{modelValue:o.value,"onUpdate:modelValue":C[1]||(C[1]=x=>o.value=x),class:"search-input no-margin q-pa-none",placeholder:"Search ...",clearable:"",debounce:"300",borderless:"",onClear:C[2]||(C[2]=x=>o.value="")},null,8,["modelValue"])])]),h("div",cl,[h("div",ul,[h("div",dl,N(d(c)),1),h("div",ml,N(d(u)),1)]),l(Ze,{class:""}),h("div",{class:"chat-name",title:(B=d(r))==null?void 0:B.name},N((U=d(r))==null?void 0:U.name),9,hl),h("div",null,[l(T,{class:"chat-menu",flat:"",square:"",disabled:!d(r)},{default:m(()=>[l(d(ea),{size:"18"}),l(ta,{anchor:"bottom middle",self:"top middle"},{default:m(()=>[l(ve,{style:{"min-width":"120px"},bordered:""},{default:m(()=>[_e((y(),M(j,{class:"q-my-sm q-mx-sm q-pa-none chat-menu__item",clickable:"",onClick:C[3]||(C[3]=x=>A.$emit("showDeviceKey"))},{default:m(()=>[l(Y,{class:"q-pa-none"},{default:m(()=>[l(T,{flat:"",square:"",size:"sm",class:"bg-blue-grey-7 text-white q-px-xs"},{default:m(()=>[I(" Devices ")]),_:1})]),_:1})]),_:1})),[[Ee]]),_e((y(),M(j,{class:"q-my-sm q-mx-sm q-pa-none chat-menu__item relative-position",clickable:"",disable:!d(r),onClick:p},{default:m(()=>[l(Y,null,{default:m(()=>[d(w)>0?(y(),D("div",pl,N(d(w)),1)):ee("",!0),l(T,{flat:"",square:"",size:"sm",class:"bg-cyan-9 text-white q-px-xs"},{default:m(()=>[I(" Members ")]),_:1})]),_:1})]),_:1},8,["disable"])),[[Ee]]),d(s).isOwner?_e((y(),M(j,{key:0,class:"q-my-sm q-mx-sm q-pa-none chat-menu__item",clickable:"",disable:!d(s).canAddMember,onClick:_},{default:m(()=>[l(Y,null,{default:m(()=>[l(T,{flat:"",square:"",size:"sm",class:"bg-amber-7 text-white q-px-xs"},{default:m(()=>[I(" Add member ")]),_:1})]),_:1})]),_:1},8,["disable"])),[[Ee]]):ee("",!0),d(s).isOwner?_e((y(),M(j,{key:1,class:"q-my-sm q-mx-sm q-pa-none chat-menu__item",clickable:"",disable:!d(s).isChannelCreator,onClick:C[4]||(C[4]=x=>A.$emit("deleteChannel"))},{default:m(()=>[l(Y,null,{default:m(()=>[l(T,{flat:"",square:"",size:"sm",class:"bg-negative text-white q-px-xs"},{default:m(()=>[I(" Delete ")]),_:1})]),_:1})]),_:1},8,["disable"])),[[Ee]]):_e((y(),M(j,{key:2,class:"q-my-sm q-mx-sm q-pa-none chat-menu__item",clickable:"",disable:!d(r),onClick:C[5]||(C[5]=x=>A.$emit("leaveChannel"))},{default:m(()=>[l(Y,null,{default:m(()=>[l(T,{flat:"",square:"",size:"sm",class:"bg-negative text-white q-px-xs"},{default:m(()=>[I(" Leave ")]),_:1})]),_:1})]),_:1},8,["disable"])),[[Ee]])]),_:1})]),_:1})]),_:1},8,["disabled"])])])],2)}}});const fl={class:"col col-4"},yl={class:"col"},bl={class:"no-margin"},_l=R({__name:"DebugBtn",setup(t){const{state:e}=q(),{isAuthorizedMember:n,isPendingMember:i,isChannelCreator:s}=Ae(),a=F(!1),o=na(a);return(r,c)=>(y(),D(H,null,[l(T,{flat:"",class:"text-blue-2",onClick:c[0]||(c[0]=u=>d(o)())},{default:m(()=>[I(" Debug info ")]),_:1}),l(pe,{modelValue:a.value,"onUpdate:modelValue":c[1]||(c[1]=u=>a.value=u)},{default:m(()=>[l(X,{style:{width:"800px","max-width":"80vw"}},{default:m(()=>[l(V,null,{default:m(()=>[(y(!0),D(H,null,te([["Authorized",d(n)],["Pending Access",d(i)],["Channel Creator",d(s)],["Channel Address",d(e).channelAddr],["Channel",d(e).channel],["Membership",d(e).channelMembership],["Members",d(e).channelMembers]],u=>(y(),D("div",{key:u[0],class:"row q-mt-md"},[h("div",fl,N(u[0]),1),h("div",yl,[h("pre",bl,N(u[1]),1)])]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),vl={class:"messenger-wrapper"},wl={class:"messenger-main"},kl={key:1,class:"messenger-channels-empty"},Al={key:0,class:"q-my-md q-px-lg"},Sl=R({__name:"Messenger",setup(t){const e=ke(),{state:n,postMessage:i,loadChannel:s,refreshList:a,channelAuthorityDevice:o}=q(),r=Ae(),c=ln(),u=Eo(),g=To(),p=Po(),_=sn(),w=on(),k=Io(),A=Bo(),C=ae({message:""});v(()=>n.allChannels);const S=F([]),B=F("");async function U(G){await i(G.value),C.message=""}const x=G=>{if(G===""){S.value=[],B.value="";return}S.value=r.ownChannels.filter(K=>K.data.name.toLocaleLowerCase().includes(G.toLocaleLowerCase())||K.pubkey.toBase58().toLocaleLowerCase().includes(G.toLocaleLowerCase())),B.value=G},P=v(()=>n.loading),E=F(!1),Q=v(()=>S.value.length>0||B.value.length>0?S.value:r.ownChannels),ue=G=>p.submit(G),De=G=>{g.state.name=G,g.submit()},ht=v(()=>c.isMobile?c.state.searchOrInfo==="search"?1:2:1),$e=F("");return re(()=>n.memberDevices,async G=>{G.length>0&&($e.value=await o())}),(G,K)=>{const pt=gl,gt=jr,Qe=Or,ft=Fr,yt=Mr,b=pr,$=ur,L=Zo,J=Qo;return y(),D(H,null,[h("div",vl,[l(pt,{onSearch:x,onShowMembers:K[0]||(K[0]=W=>d(_).state.dialog=!0),onDeleteChannel:K[1]||(K[1]=W=>d(k).submit(d(n).channelAddr)),onLeaveChannel:K[2]||(K[2]=W=>d(A).submit(d(n).channelAddr)),onAddMember:K[3]||(K[3]=W=>d(p).state.dialog=!0),onShowDeviceKey:K[4]||(K[4]=W=>E.value=!0)}),h("div",wl,[l(X,{class:"messenger-channels",square:"",flat:""},{default:m(()=>[d(Q).length>0?(y(),M(ve,{key:0,separator:"",class:"channels-list"},{default:m(()=>[(y(!0),D(H,null,te(d(Q),W=>(y(),M(gt,{key:W.name,pubkey:W.pubkey,channel:W.data,"active-class":"select-channel","is-active":`${d(n).channelAddr}`==`${W.pubkey}`,onSelect:fe=>d(s)(W.pubkey)},null,8,["pubkey","channel","is-active","onSelect"]))),128))]),_:1})):(y(),D("div",kl," No channels ")),l(Qe,{"is-joining":d(g).state.loading,"is-loading":d(P),onCreateChannel:K[5]||(K[5]=W=>d(u).state.dialog=!0),onJoinChannel:K[6]||(K[6]=W=>d(g).state.dialog=!0),onRefreshList:d(a)},null,8,["is-joining","is-loading","onRefreshList"])]),_:1}),l(ft,{style:Ve({"z-index":d(ht)}),"post-message-state":C,onSendMessage:U},null,8,["style","post-message-state"]),l(We,{showing:d(n).loading,color:"primary"},null,8,["showing"])])]),l(yt,{modelValue:d(u).state.dialog,"onUpdate:modelValue":K[7]||(K[7]=W=>d(u).state.dialog=W),loading:d(u).state.loading,"default-state":d(u).state,onSubmit:d(u).submit,onReset:d(u).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),l(b,{modelValue:d(p).state.dialog,"onUpdate:modelValue":K[8]||(K[8]=W=>d(p).state.dialog=W),loading:d(p).state.loading,"default-state":d(p).state,onSubmit:ue,onReset:d(p).reset},null,8,["modelValue","loading","default-state","onReset"]),l($,{modelValue:d(g).state.dialog,"onUpdate:modelValue":K[9]||(K[9]=W=>d(g).state.dialog=W),loading:d(g).state.loading,"default-state":d(g).state,onSubmit:De,onReset:d(g).reset},null,8,["modelValue","loading","default-state","onReset"]),l(L,{modelValue:d(_).state.dialog,"onUpdate:modelValue":K[10]||(K[10]=W=>d(_).state.dialog=W),wallet:d(e),"authorize-member-state":d(_).state,"delete-member-state":d(w).state,onSubmit:d(_).submit,onDeleteMember:d(w).submit},null,8,["modelValue","wallet","authorize-member-state","delete-member-state","onSubmit","onDeleteMember"]),l(J,{modelValue:E.value,"onUpdate:modelValue":K[11]||(K[11]=W=>E.value=W),devices:d(n).memberDevices,"authority-device":$e.value,onLoadChannel:K[12]||(K[12]=W=>d(s)(d(n).channelAddr))},null,8,["modelValue","devices","authority-device"]),d(n).channel?(y(),D("div",Al,[l(_l)])):ee("",!0)],64)}}});const Ml={},Cl={class:"container"},xl={class:"messenger-container"},Dl={class:"container"};function $l(t,e){const n=Sl,i=ui;return y(),M(aa,{class:"page-wrapper"},{default:m(()=>[h("div",Cl,[h("div",xl,[l(n)])]),h("div",Dl,[l(i)])]),_:1})}const El=Z(Ml,[["render",$l],["__scopeId","data-v-d4ef5e8f"]]),Il=()=>Vt(()=>import("./_...all_.c1a990b7.js"),["assets/_...all_.c1a990b7.js","assets/vendor.af8bb8a3.js","assets/_...all_.73169310.css"]),Pl=[{name:"index",path:"/",component:El,props:!0},{name:"all",path:"/:all(.*)*",component:Il,props:!0,meta:{layout:"empty"}}],Tl=Ys(Pl),Bl="/",Kl=sa({history:ia(Bl),scrollBehavior:()=>({left:0,top:0}),strict:!0,routes:Tl}),Ll=({app:t})=>{t.use(Kl)},Wl=Object.freeze(Object.defineProperty({__proto__:null,install:Ll},Symbol.toStringTag,{value:"Module"})),zl=({app:t})=>{t.use(oa,{wallets:[new ra,new la,new ca,new ua,new da,new ma,new ha,new pa,new ga,new fa,new ya,new ba,new _a,new va,new wa,new ka,new Aa,new Sa,new Ma,new Ca,new xa,new Da,new $a,new Ea,new Ia,new Pa,new Ta,new Ba,new Ka,new La],autoConnect:!1})},Nl=Object.freeze(Object.defineProperty({__proto__:null,install:zl},Symbol.toStringTag,{value:"Module"})),Fl=Wa();function Rl(){return Fl}const Ol=Symbol("WALLET_CONNECT_EVENT"),Vl=Symbol("WALLET_DISCONNECT_EVENT"),ql=Symbol("ACCOUNT_CHANGE_EVENT"),kt=5e3;function Ul(){const{connection:t}=st(),{emit:e}=Rl(),{notify:n}=we(),{wallet:i}=ke();re(i,s=>{if(!s)return;const a=()=>{const c=s.adapter.publicKey;t.onAccountChange(c,u=>{e(ql,u)}),t.onLogs(c,u=>{console.log(u)}),n({message:"Wallet update",caption:`Connected to wallet ${nt(c.toBase58(),7)}`,timeout:kt}),e(Ol,s)},o=()=>{n({message:"Wallet update",caption:"Disconnected from wallet",timeout:kt}),e(Vl,s)},r=c=>{!(c!=null&&c.message)||n({type:"negative",message:"Wallet update",caption:c.message,timeout:kt})};s.adapter.once("connect",a),s.adapter.once("disconnect",o),s.adapter.removeAllListeners("error"),s.adapter.on("error",r)},{immediate:!0})}const Hl=R({__name:"App",setup(t){return za(()=>{Ul()}),(e,n)=>{const i=Et("router-view");return y(),M(i)}}});async function jl(){const t=Na(Hl);Object.values(Object.assign({"./plugins/pinia.ts":Ra,"./plugins/quasar.ts":Va,"./plugins/router.ts":Wl,"./plugins/wallet.ts":Nl})).forEach(e=>{var n;return(n=e.install)==null?void 0:n.call(e,{app:t})}),t.mount("#app")}jl().then();export{Z as _};
