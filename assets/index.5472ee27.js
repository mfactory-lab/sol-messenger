var Ut=Object.defineProperty;var jt=(t,e,n)=>e in t?Ut(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var W=(t,e,n)=>(jt(t,typeof e!="symbol"?e+"":e,n),n);import{c as Qt,Q as qt,P as Jt,D as Gt,N as Ht,a as Xt,i as Zt,u as Oe,b as Ve,d as N,o as g,e as C,w as c,f as u,g as E,h as r,j as lt,k as d,l as Yt,r as F,m as y,n as B,p as pe,q as en,s as tn,S as nn,t as D,v as P,x as _t,y as K,z as X,A as L,B as me,C as an,E as ee,F as G,G as sn,H as re,I as q,J as At,W as vt,K as Se,L as ke,M as on,O as Ie,R as ln,T as rn,U as ve,V as oe,X as Ke,Y as le,Z as cn,_ as Fe,$ as ht,a0 as pt,a1 as un,a2 as dn,a3 as mn,a4 as St,a5 as Ue,a6 as hn,a7 as he,a8 as at,a9 as De,aa as Pe,ab as pn,ac as kt,ad as gn,ae as fn,af as p,ag as te,ah as xt,ai as ce,aj as ue,ak as ze,al as $t,am as we,an as yn,ao as je,ap as Et,aq as rt,ar as bn,as as _n,at as vn,au as wn,av as Cn,aw as se,ax as ae,ay as wt,az as Ce,aA as Mn,aB as gt,aC as Qe,aD as ft,aE as ne,aF as qe,aG as Ee,aH as An,aI as Dt,aJ as Sn,aK as kn,aL as xn,aM as $n,aN as En,aO as Dn,aP as Pn,aQ as Kn,aR as In,aS as zn,aT as Bn,aU as Tn,aV as Nn,aW as Wn,aX as Ln,aY as Vn,aZ as Rn,a_ as On,a$ as Fn,b0 as Un,b1 as jn,b2 as Qn,b3 as qn,b4 as Jn,b5 as Gn,b6 as Hn,b7 as Xn,b8 as Zn,b9 as Yn,ba as ea,bb as ta,bc as na,bd as aa,be as sa,bf as ia,bg as oa,bh as la,bi as ra,bj as ca,bk as ua,bl as da,bm as ma,bn as ha}from"./vendor.c86cdafd.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();const pa=({app:t})=>{const e=Qt();t.use(e)},ga=Object.freeze(Object.defineProperty({__proto__:null,install:pa},Symbol.toStringTag,{value:"Module"})),fa=({app:t})=>{t.use(qt,{plugins:{Dark:Jt,Dialog:Gt,Notify:Ht,LocalStorage:Xt},iconSet:Zt})},ya=Object.freeze(Object.defineProperty({__proto__:null,install:fa},Symbol.toStringTag,{value:"Module"}));function ba(){const{dark:t}=Oe(),e=Ve("theme-mode",t.isActive);return t.set(e.value),{isActive:e,set(n){t.set(n),e.value=t.isActive},toggle(){t.toggle(),e.value=t.isActive}}}const _a={class:"container"},va={class:"row"},wa=u("div",{class:"col-12 col-md-6"},[u("div",{class:"footer-links"},[u("ul",null,[u("li",null,[u("a",{target:"_blank",href:"https://jpool.one"},"JPOOL")]),u("li",null,[u("a",{target:"_blank",href:"https://heartandsol.one"},"GAME")]),u("li",null,[u("a",{href:"https://magiceden.io/marketplace/heartandsol"},"NFT Marketplace")])])]),u("div",{class:"copyright"},[u("span",null,"\xA9 Copyright 2022 jpool.one. All rights reserved. Powered by mFactory GmbH")])],-1),Ca={class:"col-12 col-md-6 social-col"},Ma={class:"social"},Aa={class:"theme"},Sa=u("div",{class:"social-link social-link-text"},[u("span",null,[E("official"),u("br"),E("channel")])],-1),ka=u("div",{class:"social-link telegram"},null,-1),xa=u("div",{class:"social-link twitter"},null,-1),$a=u("div",{class:"social-link discord"},null,-1),Ea=N({__name:"AppFooter",setup(t){const e=ba();return(n,s)=>(g(),C(Yt,null,{default:c(()=>[u("div",_a,[u("div",va,[wa,u("div",Ca,[u("div",Ma,[u("div",Aa,[E(" Dark theme "),r(lt,{"model-value":d(e).isActive.value,onClick:d(e).toggle},null,8,["model-value","onClick"])]),Sa,ka,xa,$a])])])])]),_:1}))}});function Da(){const t=F(Pa());return{userAgent:t,isMobileOs:y(()=>Ka(t.value)),isWebView:y(()=>Ia(t.value))}}let st;function Pa(){var t,e;return st===void 0&&(st=(e=(t=globalThis.navigator)==null?void 0:t.userAgent)!=null?e:null),st}function Ka(t){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)}function Ia(t){return/(WebView|(Phantom|Solflare)|Version\/.+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+)|; wv\).+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+))/i.test(t)}function Je(t,e=4){return t instanceof B&&(t=t.toBase58()),`${t.slice(0,e)}...${t.slice(-e)}`}function Pt(t){return(t==null?void 0:t.name)&&t.name!==""?t.name:Je(t.authority)}const za=t=>{if(!t)return{background:"#000"};let e=0;for(let s=0;s<t.length;s++)e=t.charCodeAt(s)+((e<<5)-e),e=e&e;let n="#";for(let s=0;s<3;s++)n+=`00${(e>>s*8&255).toString(16)}`.substr(-2);return{background:n}},Ba="/sol-messenger/assets/clover.968404b0.svg",Ta="/sol-messenger/assets/ledger.40cf6861.svg",Na="/sol-messenger/assets/mathwallet.1d763e81.svg",Kt=t=>(Se("data-v-b79b08f0"),t=t(),ke(),t),Wa=Kt(()=>u("div",{class:"text-h6 text-center"}," Your wallet ",-1)),La={class:"q-gutter-md row justify-between"},Va=Kt(()=>u("div",{class:"text-h6"}," Connect to a wallet ",-1)),Ra={class:"text-light-gray text-caption full-width text-no-wrap",style:{"text-overflow":"ellipsis",overflow:"hidden"}},Oa=["src","alt"],Fa=N({__name:"ConnectWallet",setup(t){const e={priority:{solflare:10,phantom:20,sollet:5,nufi:5,blocto:1},icons:{clover:Ba},darkIcons:{ledger:Ta,mathwallet:Na},deepLinks:{phantom:"https://phantom.app/ul/browse/{uri}?ref={ref}",solflare:"https://solflare.com/ul/browse/{uri}?ref={ref}"}},{userAgent:n,isWebView:s,isMobileOs:i}=Da(),a={close:At},o=k=>[vt.Installed,vt.Loadable].includes(k.readyState);Oe();const l=pe(),{connected:m,connecting:f}=l;en();const _=y(()=>i.value&&!s.value);if(s.value){const k=String(n.value).toLowerCase();k.includes("phantom")?(l.select(tn),l.connect()):k.includes("solflare")&&(l.select(nn),l.connect())}const w=y(()=>{var k,T;return(T=(k=l.publicKey.value)==null?void 0:k.toBase58())!=null?T:""}),M=y(()=>Je(w.value)),v=y(()=>[...l.wallets.value].map(k=>{var A,O;const T=k.adapter.name.toLowerCase();return k.adapter.icon=(O=(A=e.darkIcons[T])!=null?A:e.icons[T])!=null?O:k.adapter.icon,_.value&&e.deepLinks[T]&&(k.deepLink=e.deepLinks[T].replace("{uri}",location.href).replace("{ref}",location.origin)),k}).sort((k,T)=>{var I,h;const A=(I=e.priority[k.adapter.name.toLowerCase()])!=null?I:1;return((h=e.priority[T.adapter.name.toLowerCase()])!=null?h:1)-A+((o(T)?1:0)-(o(k)?1:0))})),b=y(()=>_.value?v.value.filter(k=>!!k.deepLink):v.value),S=F(!1);async function j(k){await l.select(k.adapter.name),S.value=!1,await l.connect()}function R(){S.value=!1,l.disconnect()}function H(){S.value=!0}function Z(){S.value=!1}return(k,T)=>(g(),D(q,null,[d(m)?(g(),C(K,_t({key:0},k.$attrs,{class:k.$style.btn,ripple:!1,color:"primary-gray","text-color":"white",rounded:"",unelevated:"",onClick:H}),{default:c(()=>[E(P(d(M)),1)]),_:1},16,["class"])):(g(),C(K,_t({key:1},k.$attrs,{color:"primary-gray","text-color":"white",rounded:"",unelevated:"",ripple:!1,loading:d(f),onClick:H}),{default:c(()=>[E(" CONNECT WALLET ")]),_:1},16,["loading"])),r(re,{modelValue:S.value,"onUpdate:modelValue":T[0]||(T[0]=A=>S.value=A),"transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:c(()=>[d(m)?(g(),C(X,{key:0},{default:c(()=>[r(L,{class:"relative-position"},{default:c(()=>[Wa,r(K,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:Z},null,8,["icon"])]),_:1}),r(me),r(L,null,{default:c(()=>[E(P(d(w)),1)]),_:1}),r(me),r(L,null,{default:c(()=>[u("div",La,[r(K,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:R},{default:c(()=>[E(" Disconnect ")]),_:1}),r(K,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:Z},{default:c(()=>[E(" Ok ")]),_:1})])]),_:1})]),_:1})):(g(),C(X,{key:1,class:"wallet-connect-card"},{default:c(()=>[r(L,null,{default:c(()=>[Va,r(K,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:Z},null,8,["icon"])]),_:1}),r(me),r(L,{style:{"max-height":"80vh"},class:"scroll"},{default:c(()=>[r(an,{grid:"",rows:d(b),"row-key":"name","hide-pagination":"","hide-header":"","rows-per-page-options":[100]},{item:c(({row:A})=>[(g(),D("div",{key:`wallet-${A.adapter.name}`,class:"col-12 col-md-6"},[r(ee,{clickable:"",href:A.deepLink,onClick:O=>A.deepLink?!0:j(A)},{default:c(()=>[r(G,null,{default:c(()=>[u("b",null,P(A.adapter.name),1),u("div",Ra,P(A.adapter.url),1)]),_:2},1024),r(G,{avatar:""},{default:c(()=>[r(sn,{square:""},{default:c(()=>[u("img",{src:A.adapter.icon,alt:A.adapter.name},null,8,Oa)]),_:2},1024)]),_:2},1024)]),_:2},1032,["href","onClick"])]))]),_:1},8,["rows"])]),_:1})]),_:1}))]),_:1},8,["modelValue"])],64))}});const Ua="_btn_6n1iw_1",ja={btn:Ua},V=(t,e)=>{const n=t.__vccOpts||t;for(const[s,i]of e)n[s]=i;return n},Qa={$style:ja},qa=V(Fa,[["__cssModules",Qa],["__scopeId","data-v-b79b08f0"]]),Me=[{id:"serum-mainnet",name:"Serum RPC",cluster:"mainnet-beta",url:"https://solana-api.projectserum.com/"},{id:"rpcpool-mainnet",name:"RPCPool RPC",cluster:"mainnet-beta",url:"https://mainnet.rpcpool.com/"},{id:"mainnet",name:"Solana RPC",cluster:"mainnet-beta",url:on("mainnet-beta")}],It={id:"devnet",name:"DevNet",cluster:"devnet",url:"https://devnet.rpcpool.com/"};Me.push(It);const Ja={id:"testnet",name:"TestNet",cluster:"testnet",url:"https://testnet.rpcpool.com/"};Me.push(Ja);var Mt;const Ga=(Mt=Me.find(t=>t.id==={VITE_BASE_PATH:"/sol-messenger/",VITE_USER_NODE_ENV:"production",BASE_URL:"/sol-messenger/",MODE:"staging",DEV:!1,PROD:!0}.VITE_CONNECTION_ENDPOINT))!=null?Mt:It,Ha="confirmed",Xa=12e4,yt=Ie({id:"connection",state:()=>({commitment:Ha,confirmTransactionInitialTimeout:Xa,rpc:ln("rpc","")}),getters:{endpoint(t){var e;return(e=Me.find(n=>n.id===t.rpc))!=null?e:Ga},connection(t){return console.log("[connection]",this.endpoint.url),new rn(this.endpoint.url,{confirmTransactionInitialTimeout:t.confirmTransactionInitialTimeout,commitment:t.commitment})},cluster(){return this.endpoint.cluster}},actions:{setRpc(t){this.rpc=t},setCommitment(t){this.commitment=t}}}),Za=N({__name:"ClusterSelector",setup(t){const e=yt(),{connected:n,connect:s,disconnect:i,autoConnect:a}=pe(),o=[Me.filter(f=>f.cluster==="mainnet-beta"),Me.filter(f=>f.cluster!=="mainnet-beta")],l=y(()=>e.endpoint),m=f=>{n&&e.cluster!==f.cluster&&(i(),a.value&&s()),e.setRpc(f.id)};return(f,_)=>(g(),C(cn,{label:d(l).name,"model-value":!1,"auto-close":"",color:"secondary","text-color":"#000",rounded:"",unelevated:"",ripple:!1},{default:c(()=>[r(ve,null,{default:c(()=>[(g(),D(q,null,oe(o,(w,M)=>(g(),D(q,{key:`${M}-cluster-group`},[(g(!0),D(q,null,oe(w,v=>(g(),C(ee,{key:v.id,clickable:"",onClick:b=>m(v)},{default:c(()=>[(g(),C(G,{key:`${v.id}-item`},{default:c(()=>[r(Ke,null,{default:c(()=>[u("b",null,P(v.name),1)]),_:2},1024),E(" "+P(v.url),1)]),_:2},1024))]),_:2},1032,["onClick"]))),128)),M!==o.length-1?(g(),C(me,{key:0})):le("",!0)],64))),64))]),_:1})]),_:1},8,["label"]))}});const Ya={},es={class:"container"},ts={class:"app-header__info"},ns={class:"app-header__logo"},as={class:"logo-wrapper"},ss=u("div",{class:"app-header__title"},[u("h1",null,[E("BLOCKCHAIN messenger "),u("span",{class:"marked"},"SOLANA")])],-1),is={class:"app-header__right"},os={class:"app-header__buttons"};function ls(t,e){const n=Fe("router-link"),s=Za,i=qa;return g(),C(un,{class:"app-header"},{default:c(()=>[u("div",es,[r(ht,null,{default:c(()=>[u("div",ts,[u("div",ns,[u("div",as,[r(n,{to:"/"})])]),ss]),r(pt),u("div",is,[u("div",os,[r(s,{class:"app-header__cluster-btn header-btn"}),r(i,{class:"app-header__wallet-btn header-btn"})])])]),_:1})])]),_:1})}const rs=V(Ya,[["render",ls]]),cs={};function us(t,e){const n=rs,s=Fe("router-view"),i=Ea;return g(),C(dn,{view:"lfh Lpr lff"},{default:c(()=>[r(n),r(mn,null,{default:c(()=>[r(s)]),_:1}),r(i)]),_:1})}const ds=V(cs,[["render",us]]),ms={default:ds,empty:()=>St(()=>import("./empty.6e3531c3.js"),["assets/empty.6e3531c3.js","assets/vendor.c86cdafd.js"])};function hs(t){return t.map(e=>{var n;return{path:e.path,component:ms[((n=e.meta)==null?void 0:n.layout)||"default"],children:[{...e,path:""}]}})}const ps="/sol-messenger/assets/solana-logo.3caace62.svg";const gs={},Ge=t=>(Se("data-v-5ffd3a8e"),t=t(),ke(),t),fs={class:"row info-row"},ys=Ge(()=>u("div",{class:"offset-0 offset-md-3"},null,-1)),bs=Ge(()=>u("div",{class:"col-6 col-md-3 flex-center info-col"},[u("div",{class:"info-title"}," How IT WORKS "),u("div",{class:"info-text"},[u("ul",null,[u("li",null,"Connect your wallet"),u("li",null,"Enter the amount of JPLT you want to swap or enter the amount of JPLU you want to get"),u("li",null,"Click SWAP button"),u("li",null,"Confirm the transaction in your wallet"),u("li",null,"Done")])])],-1)),_s={class:"col-6 col-md-5 logo-wrap"},vs=Ge(()=>u("img",{src:ps,alt:"solana logo"},null,-1)),ws=Ge(()=>u("div",{class:"offset-0 offset-md-1"},null,-1));function Cs(t,e){const n=Fe("router-link");return g(),D("div",fs,[ys,bs,u("div",_s,[r(n,{to:"/"},{default:c(()=>[vs]),_:1})]),ws])}const Ms=V(gs,[["render",Cs],["__scopeId","data-v-5ffd3a8e"]]),zt=Ie("user",()=>{const t=Ue(),e=F();hn(()=>{var o;const a=(o=t.value)==null?void 0:o.publicKey;if(a){const l=Ve(a.toString(),()=>at.encode(he.generate().secretKey));n(l.value)}else e.value=void 0});function n(a){e.value=he.fromSecretKey(at.decode(a))}function s(){var l;const a=(l=t.value)==null?void 0:l.publicKey;if(!a)return;const o=Ve(a.toString(),"");n(o.value=at.encode(he.generate().secretKey))}function i(a){var m;const o=(m=t.value)==null?void 0:m.publicKey;if(!o)return;const l=Ve(o.toString(),"");n(l.value=a)}return{keypair:e,generateKey:s,importKey:i}}),As=t=>(Se("data-v-4f30d8b8"),t=t(),ke(),t),Ss=As(()=>u("div",{class:"text-h6 text-center"}," Device Key ",-1)),ks={class:"q-gutter-md row justify-between"},xs=N({__name:"UserInfoDialog",emits:["regenerate"],setup(t){const e=zt(),n=()=>{var s,i;fn(((i=(s=e.keypair)==null?void 0:s.publicKey)!=null?i:"").toString())};return(s,i)=>(g(),C(re,{class:"dialog-wrapper","transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:c(()=>[r(X,null,{default:c(()=>[r(L,{class:"row items-center"},{default:c(()=>[Ss,r(pt),De(r(K,{flat:"",round:"",dense:"",icon:d(At)},null,8,["icon"]),[[Pe]])]),_:1}),r(me),r(L,null,{default:c(()=>{var a;return[r(K,{flat:"",round:"",dense:"",icon:d(pn),onClick:n},{default:c(()=>[r(kt,{delay:0,anchor:"bottom middle",self:"top middle","transition-duration":"0"},{default:c(()=>[E(" Copy to clipboard ")]),_:1})]),_:1},8,["icon"]),u("span",null,P((a=d(e).keypair)==null?void 0:a.publicKey),1)]}),_:1}),r(me),r(gn,{align:"right"},{default:c(()=>[u("div",ks,[r(K,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:d(e).generateKey},{default:c(()=>[E(" Regenerate ")]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1}))}});const $s=V(xs,[["__scopeId","data-v-4f30d8b8"]]),Es="0.0.8",Ds="messenger",Ps=[{name:"initChannel",accounts:[{name:"channel",isMut:!0,isSigner:!0},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"InitChannelData"}}]},{name:"deleteChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"joinChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"JoinChannelData"}}]},{name:"leaveChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"grantAccessMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"GrantAccessMemberData"}}]},{name:"addMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"invitee",isMut:!1,isSigner:!1},{name:"inviteeMembership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AddMemberData"}}]},{name:"authorizeMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AuthorizeMemberData"}}]},{name:"deleteMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"postMessage",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!1,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"message",type:"string"}]}],Ks=[{name:"Channel",type:{kind:"struct",fields:[{name:"name",docs:["Name of the channel"],type:"string"},{name:"creator",docs:["Channel creator"],type:"publicKey"},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"flags",docs:["Channel flags"],type:"u8"},{name:"memberCount",docs:["Number of members"],type:"u16"},{name:"messageCount",docs:["Message counter"],type:"u32"},{name:"maxMessages",docs:["The maximum number of messages that are stored in [messages]"],type:"u16"},{name:"messages",docs:["List of messages"],type:{vec:{defined:"Message"}}}]}},{name:"ChannelMembership",type:{kind:"struct",fields:[{name:"channel",docs:["Associated [Channel] address"],type:"publicKey"},{name:"authority",docs:["Authority of membership"],type:"publicKey"},{name:"key",docs:["The device key used to encrypt the `CEK`"],type:"publicKey"},{name:"cek",docs:["The content encryption key (CEK) of the channel"],type:{defined:"CEKData"}},{name:"status",docs:["Status of membership"],type:{defined:"ChannelMembershipStatus"}},{name:"name",docs:["Name of the channel member"],type:"string"},{name:"invitedBy",docs:["Inviter address"],type:{option:"publicKey"}},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"flags",docs:["Membership flags"],type:"u8"},{name:"bump",docs:["Bump seed for deriving PDA seeds"],type:"u8"}]}}],Is=[{name:"AddMemberData",type:{kind:"struct",fields:[{name:"name",docs:["Member name"],type:"string"},{name:"flags",docs:["Membership flags, only `admin` and `owner` can set membership flags"],type:"u8"},{name:"cek",docs:["Content Encryption Key"],type:{defined:"CEKData"}},{name:"key",docs:["Device key"],type:{option:"publicKey"}}]}},{name:"AuthorizeMemberData",type:{kind:"struct",fields:[{name:"cek",type:{defined:"CEKData"}}]}},{name:"GrantAccessMemberData",type:{kind:"struct",fields:[{name:"flags",type:"u8"}]}},{name:"InitChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"maxMessages",type:"u16"},{name:"memberName",type:"string"},{name:"cek",type:{defined:"CEKData"}},{name:"public",type:"bool"},{name:"permissionless",type:"bool"}]}},{name:"JoinChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"authority",type:{option:"publicKey"}}]}},{name:"CEKData",type:{kind:"struct",fields:[{name:"header",docs:["The header information for the CEK"],type:"string"},{name:"encryptedKey",docs:["The CEK itself"],type:"string"}]}},{name:"Message",type:{kind:"struct",fields:[{name:"id",docs:["Uniq message id"],type:"u32"},{name:"sender",docs:["The message sender id"],type:"publicKey"},{name:"createdAt",docs:["The unix timestamp at which the message was received"],type:"i64"},{name:"flags",docs:["Message flags"],type:"u8"},{name:"content",docs:["The (typically encrypted) message content"],type:"string"}]}},{name:"ChannelMembershipStatus",type:{kind:"enum",variants:[{name:"Authorized",fields:[{name:"by",type:{option:"publicKey"}}]},{name:"Pending",fields:[{name:"authority",type:{option:"publicKey"}}]}]}}],zs=[{name:"NewChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"NewMessageEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"message",type:{defined:"Message"},index:!1}]},{name:"JoinChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"LeaveChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"authority",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AddMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"AuthorizeMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]}],Bs=[{code:6e3,name:"Unauthorized",msg:"Unauthorized"},{code:6001,name:"InvalidChannel",msg:"Invalid channel"},{code:6002,name:"InvalidMembership",msg:"Invalid membership"},{code:6003,name:"InvalidMessage",msg:"Invalid message"},{code:6004,name:"NameTooLong",msg:"Name too long"},{code:6005,name:"MessageTooLong",msg:"Message too long"}],Ts={address:"6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",origin:"anchor",binaryVersion:"0.25.0",libVersion:"0.25.0"},Ns={version:Es,name:Ds,instructions:Ps,accounts:Ks,types:Is,events:zs,errors:Bs,metadata:Ts},Ws=new p.FixableBeetArgsStruct([["id",p.u32],["sender",te],["createdAt",p.i64],["flags",p.u8],["content",p.utf8String]],"Message"),ct=[49,159,99,106,220,87,219,88];class Y{constructor(e,n,s,i,a,o,l,m){this.name=e,this.creator=n,this.createdAt=s,this.flags=i,this.memberCount=a,this.messageCount=o,this.maxMessages=l,this.messages=m}static fromArgs(e){return new Y(e.name,e.creator,e.createdAt,e.flags,e.memberCount,e.messageCount,e.maxMessages,e.messages)}static fromAccountInfo(e,n=0){return Y.deserialize(e.data,n)}static async fromAccountAddress(e,n,s){const i=await e.getAccountInfo(n,s);if(i==null)throw new Error(`Unable to find Channel account at ${n}`);return Y.fromAccountInfo(i,0)[0]}static gpaBuilder(e=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return xt.fromStruct(e,We)}static deserialize(e,n=0){return We.deserialize(e,n)}serialize(){return We.serialize({accountDiscriminator:ct,...this})}static byteSize(e){const n=Y.fromArgs(e);return We.toFixedFromValue({accountDiscriminator:ct,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,s){return n.getMinimumBalanceForRentExemption(Y.byteSize(e),s)}pretty(){return{name:this.name,creator:this.creator.toBase58(),createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,memberCount:this.memberCount,messageCount:this.messageCount,maxMessages:this.maxMessages,messages:this.messages}}}const We=new p.FixableBeetStruct([["accountDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["name",p.utf8String],["creator",te],["createdAt",p.i64],["flags",p.u8],["memberCount",p.u16],["messageCount",p.u32],["maxMessages",p.u16],["messages",p.array(Ws)]],Y.fromArgs,"Channel"),He=new p.FixableBeetArgsStruct([["header",p.utf8String],["encryptedKey",p.utf8String]],"CEKData"),Ls=p.dataEnum([["Authorized",new p.FixableBeetArgsStruct([["by",p.coption(te)]],'ChannelMembershipStatusRecord["Authorized"]')],["Pending",new p.FixableBeetArgsStruct([["authority",p.coption(te)]],'ChannelMembershipStatusRecord["Pending"]')]]),Re=[238,149,255,251,116,131,86,170];class J{constructor(e,n,s,i,a,o,l,m,f,_){this.channel=e,this.authority=n,this.key=s,this.cek=i,this.status=a,this.name=o,this.invitedBy=l,this.createdAt=m,this.flags=f,this.bump=_}static fromArgs(e){return new J(e.channel,e.authority,e.key,e.cek,e.status,e.name,e.invitedBy,e.createdAt,e.flags,e.bump)}static fromAccountInfo(e,n=0){return J.deserialize(e.data,n)}static async fromAccountAddress(e,n,s){const i=await e.getAccountInfo(n,s);if(i==null)throw new Error(`Unable to find ChannelMembership account at ${n}`);return J.fromAccountInfo(i,0)[0]}static gpaBuilder(e=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return xt.fromStruct(e,Le)}static deserialize(e,n=0){return Le.deserialize(e,n)}serialize(){return Le.serialize({accountDiscriminator:Re,...this})}static byteSize(e){const n=J.fromArgs(e);return Le.toFixedFromValue({accountDiscriminator:Re,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,s){return n.getMinimumBalanceForRentExemption(J.byteSize(e),s)}pretty(){return{channel:this.channel.toBase58(),authority:this.authority.toBase58(),key:this.key.toBase58(),cek:this.cek,status:this.status.__kind,name:this.name,invitedBy:this.invitedBy,createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,bump:this.bump}}}const Le=new p.FixableBeetStruct([["accountDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["channel",te],["authority",te],["key",te],["cek",He],["status",Ls],["name",p.utf8String],["invitedBy",p.coption(te)],["createdAt",p.i64],["flags",p.u8],["bump",p.u8]],J.fromArgs,"ChannelMembership"),ge=new Map,fe=new Map;class Xe extends Error{constructor(){super("Unauthorized");W(this,"code",6e3);W(this,"name","Unauthorized");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Xe)}}ge.set(6e3,()=>new Xe);fe.set("Unauthorized",()=>new Xe);class Ze extends Error{constructor(){super("Invalid channel");W(this,"code",6001);W(this,"name","InvalidChannel");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ze)}}ge.set(6001,()=>new Ze);fe.set("InvalidChannel",()=>new Ze);class Ye extends Error{constructor(){super("Invalid membership");W(this,"code",6002);W(this,"name","InvalidMembership");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ye)}}ge.set(6002,()=>new Ye);fe.set("InvalidMembership",()=>new Ye);class et extends Error{constructor(){super("Invalid message");W(this,"code",6003);W(this,"name","InvalidMessage");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,et)}}ge.set(6003,()=>new et);fe.set("InvalidMessage",()=>new et);class tt extends Error{constructor(){super("Name too long");W(this,"code",6004);W(this,"name","NameTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,tt)}}ge.set(6004,()=>new tt);fe.set("NameTooLong",()=>new tt);class nt extends Error{constructor(){super("Message too long");W(this,"code",6005);W(this,"name","MessageTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,nt)}}ge.set(6005,()=>new nt);fe.set("MessageTooLong",()=>new nt);function ie(t){const e=ge.get(t);return e!=null?e():null}function _e(t){const e=fe.get(t);return e!=null?e():null}const Vs=new p.FixableBeetArgsStruct([["name",p.utf8String],["flags",p.u8],["cek",He],["key",p.coption(te)]],"AddMemberData"),Rs=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",Vs]],"AddMemberInstructionArgs"),Os=[13,116,123,130,126,198,57,34];function Fs(t,e,n=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var o;const[s]=Rs.serialize({instructionDiscriminator:Os,...e}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.invitee,isWritable:!1,isSigner:!1},{pubkey:t.inviteeMembership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)i.push(l);return new ue({programId:n,keys:i,data:s})}const Us=new p.FixableBeetArgsStruct([["cek",He]],"AuthorizeMemberData"),js=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",Us]],"AuthorizeMemberInstructionArgs"),Qs=[194,123,189,175,86,225,93,128];function qs(t,e,n=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var o;const[s]=js.serialize({instructionDiscriminator:Qs,...e}),i=[{pubkey:t.channel,isWritable:!1,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:(o=t.systemProgram)!=null?o:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)i.push(l);return new ue({programId:n,keys:i,data:s})}const Js=new p.BeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)]],"DeleteChannelInstructionArgs"),Gs=[145,225,187,221,157,142,114,133];function Hs(t,e=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=Js.serialize({instructionDiscriminator:Gs}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)s.push(o);return new ue({programId:e,keys:s,data:n})}const Xs=new p.BeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)]],"DeleteMemberInstructionArgs"),Zs=[95,14,98,112,252,218,205,173];function Ys(t,e=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=Xs.serialize({instructionDiscriminator:Zs}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)s.push(o);return new ue({programId:e,keys:s,data:n})}const ei=new p.BeetArgsStruct([["flags",p.u8]],"GrantAccessMemberData");new p.BeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",ei]],"GrantAccessMemberInstructionArgs");const ti=new p.FixableBeetArgsStruct([["name",p.utf8String],["maxMessages",p.u16],["memberName",p.utf8String],["cek",He],["public",p.bool],["permissionless",p.bool]],"InitChannelData"),ni=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",ti]],"InitChannelInstructionArgs"),ai=[21,200,152,39,19,178,76,47];function si(t,e,n=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var o;const[s]=ni.serialize({instructionDiscriminator:ai,...e}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!0},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)i.push(l);return new ue({programId:n,keys:i,data:s})}const ii=new p.FixableBeetArgsStruct([["name",p.utf8String],["authority",p.coption(te)]],"JoinChannelData"),oi=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",ii]],"JoinChannelInstructionArgs"),li=[124,39,115,89,217,26,38,29];function ri(t,e,n=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var o;const[s]=oi.serialize({instructionDiscriminator:li,...e}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)i.push(l);return new ue({programId:n,keys:i,data:s})}const ci=new p.BeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)]],"LeaveChannelInstructionArgs"),ui=[104,0,75,134,95,80,68,186];function di(t,e=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=ci.serialize({instructionDiscriminator:ui}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)s.push(o);return new ue({programId:e,keys:s,data:n})}const mi=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["message",p.utf8String]],"PostMessageInstructionArgs"),hi=[214,50,100,209,38,34,7,76];function pi(t,e,n=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var o;const[s]=mi.serialize({instructionDiscriminator:hi,...e}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)i.push(l);return new ue({programId:n,keys:i,data:s})}const gi="6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",fi=new B(gi);function ut(t,e=new Uint8Array(4)){const n=ze(t.toString(),"base10");return e.set(n,4-n.length),e}const it=t=>we([ut(t.length),t]);function Bt(t,e,n){if(e!==256)throw new Error(`Unsupported key length: ${e}`);const s=we([it(ze(n)),it(new Uint8Array(0)),it(new Uint8Array(0)),ut(e)]),i=1;return yn.hash(we([ut(i),t,s]))}const dt=t=>ze(t,"base64pad"),mt=t=>$t(t,"base64pad"),yi=t=>ze(t),bi=t=>$t(t),_i=t=>ze(t,"base58btc"),de=je.NONCE_LENGTH,Ae=je.TAG_LENGTH,Tt=t=>{const e=new je.XChaCha20Poly1305(t);return(n,s)=>{const i=Et.randomBytes(de),a=e.seal(i,n,s);return{ciphertext:a.subarray(0,a.length-Ae),tag:a.subarray(a.length-Ae),iv:i}}},Nt=t=>{const e=new je.XChaCha20Poly1305(t);return(n,s,i,a)=>e.open(i,we([n,s]),a)},Wt="ECDH-ES+XC20PKW",Lt=256,vi=t=>e=>{const n=rt.generateKeyPair(),s=rt.sharedKey(n.secretKey,t),i=Bt(s,Lt,Wt),a=Tt(i)(e);return{encryptedKey:a.ciphertext,tag:a.tag,iv:a.iv,epPubKey:n.publicKey}},wi=t=>(e,n,s,i)=>{const a=rt.sharedKey(t,i),o=Bt(a,Lt,Wt);return Nt(o)(e,n,s)},Ci=t=>Array.isArray(t)?he.fromSecretKey(vn.Buffer.from(t)):typeof t=="string"?he.fromSecretKey(_i(t)):he.fromSecretKey(t),Mi=async(t=32)=>{const e=Et.randomBytes(t);return Promise.resolve(e)},Ai=async(t,e)=>{const n=await vi(bn(e.toBytes()))(t);return{header:mt(we([n.iv,n.tag,n.epPubKey])),encryptedKey:mt(n.encryptedKey)}},Si=async(t,e)=>{const n=dt(t.header),s=n.subarray(0,de),i=n.subarray(de,de+Ae),a=n.subarray(de+Ae),o=dt(t.encryptedKey),l=Ci(e).secretKey,m=_n(l),f=await wi(m)(o,i,s,a);if(f===null)throw new Error("There was a problem decrypting the CEK");return f},ki=async(t,e)=>{const n=await Tt(e)(yi(t));return mt(we([n.iv,n.ciphertext,n.tag]))},xi=async(t,e)=>{const n=dt(t),s=n.subarray(0,de),i=n.subarray(de,-Ae),a=n.subarray(-Ae),o=await Nt(e)(i,a,s);if(o===null)throw new Error("There was an error decoding the message!");return bi(o)};class $i{constructor(e,n){W(this,"programId",fi);W(this,"_coder");W(this,"_events");W(this,"utils",{channel:{isPublic:e=>(e.flags&1)>0,isPermissionless:e=>(e.flags&2)>0},member:{isOwner:e=>e.flags>=255,isAdmin:e=>(e.flags&7)===7,canAddMember:e=>(e.flags&1)>0,canDeleteMember:e=>(e.flags&2)>0,canAuthorizeMember:e=>(e.flags&4)>0},message:{isEncrypted:e=>(e.flags&1)>0}});this.provider=e,this.keypair=n,this._coder=new wn(Ns),this._events=new Cn(this.programId,e,this._coder)}get connection(){return this.provider.connection}addEventListener(e,n){return this._events.addEventListener(e,n)}async removeEventListener(e){return await this._events.removeEventListener(e)}setKeypair(e){this.keypair=e}async loadAllChannels(){return(await Y.gpaBuilder().addFilter("accountDiscriminator",ct).run(this.provider.connection)).map(n=>({pubkey:n.pubkey,data:Y.fromAccountInfo(n.account)[0]}))}async loadChannel(e,n){return Y.fromAccountAddress(this.provider.connection,e,n)}async loadMyChannels(){return await this.loadMemberships()}async loadChannelMembers(e){return(await J.gpaBuilder().addFilter("accountDiscriminator",Re).addFilter("channel",e).run(this.provider.connection)).map(s=>({pubkey:s.pubkey,data:J.fromAccountInfo(s.account)[0]}))}async loadMemberships(e){const n=J.gpaBuilder().addFilter("accountDiscriminator",Re).addFilter("authority",this.provider.publicKey);return e&&n.addFilter("key",e),(await n.run(this.provider.connection)).map(i=>({pubkey:i.pubkey,data:J.fromAccountInfo(i.account)}))}async loadMembership(e,n){return J.fromAccountAddress(this.provider.connection,e,n)}async getMembershipPDA(e,n){return n=n!=null?n:this.keypair.publicKey,await B.findProgramAddress([e.toBuffer(),n.toBuffer()],this.programId)}async encryptCEK(e,n){return Ai(e,n!=null?n:this.keypair.publicKey)}async decryptCEK(e,n){return Si(e,n!=null?n:this.keypair.secretKey)}async encryptMessage(e,n){return ki(e,n)}async decryptMessage(e,n){return xi(e,n)}async initChannel(e){var f,_,w,M,v;const n=(f=e.channel)!=null?f:he.generate(),s=await Mi(),i=await this.encryptCEK(s),[a]=await this.getMembershipPDA(n.publicKey),o=this.provider.publicKey,l=new se;l.add(si({key:this.keypair.publicKey,channel:n.publicKey,membership:a,authority:o},{data:{name:e.name,public:(_=e.public)!=null?_:!1,permissionless:(w=e.permissionless)!=null?w:!1,memberName:(M=e.memberName)!=null?M:"",maxMessages:e.maxMessages,cek:i}}));let m;try{m=await this.provider.sendAndConfirm(l,[n,this.keypair],e.opts)}catch(b){throw(v=ie(b.code))!=null?v:b}return{signature:m,channel:n,cek:s,cekEncrypted:i}}async deleteChannel({channel:e,opts:n}){var l;const s=this.provider.publicKey,[i]=await this.getMembershipPDA(e),a=new se;a.add(Hs({channel:e,authority:s,authorityMembership:i}));let o;try{o=await this.provider.sendAndConfirm(a,void 0,n)}catch(m){throw(l=ie(m.code))!=null?l:_e("Unauthorized")}return{signature:o}}async joinChannel(e){var o,l;const[n]=await this.getMembershipPDA(e.channel),s=this.provider.publicKey,i=new se;i.add(ri({channel:e.channel,key:this.keypair.publicKey,membership:n,authority:s},{data:{name:e.name,authority:(o=e.authority)!=null?o:null}}));let a;try{a=await this.provider.sendAndConfirm(i,[this.keypair],e.opts)}catch(m){throw(l=ie(m.code))!=null?l:m}return{signature:a}}async leaveChannel(e){var o;const[n]=await this.getMembershipPDA(e.channel),s=this.provider.publicKey,i=new se;i.add(di({channel:e.channel,membership:n,authority:s}));let a;try{a=await this.provider.sendAndConfirm(i)}catch(l){throw(o=ie(l.code))!=null?o:l}return{signature:a}}async addMember(e){var _,w,M,v;const n=(_=e.key)!=null?_:e.invitee,[s]=await this.getMembershipPDA(e.channel),[i]=await this.getMembershipPDA(e.channel,n),a=await this.loadMembership(s);if(!a.cek.encryptedKey)throw _e("Unauthorized");const o=await this.decryptCEK(a.cek),l=await this.encryptCEK(o,n),m=new se;m.add(Fs({channel:e.channel,authority:this.provider.publicKey,invitee:e.invitee,authorityMembership:s,inviteeMembership:i},{data:{name:(w=e.name)!=null?w:"",flags:(M=e.flags)!=null?M:0,cek:l,key:n}}));let f;try{f=await this.provider.sendAndConfirm(m)}catch(b){throw(v=ie(b.code))!=null?v:_e("Unauthorized")}return{signature:f}}async deleteMember(e){var l;const[n]=e.membership?[e.membership]:await this.getMembershipPDA(e.channel,e.key),[s]=await this.getMembershipPDA(e.channel),i=this.provider.publicKey,a=new se;a.add(Ys({channel:e.channel,membership:n,authority:i,authorityMembership:s}));let o;try{o=await this.provider.sendAndConfirm(a)}catch(m){throw(l=ie(m.code))!=null?l:m}return{signature:o}}async authorizeMember(e){var f;const[n]=await this.getMembershipPDA(e.channel),[s]=await this.getMembershipPDA(e.channel,e.key),i=await this.loadMembership(n);if(!i.cek.encryptedKey)throw _e("Unauthorized");const a=await this.decryptCEK(i.cek),o=await this.encryptCEK(a,e.key),l=new se;l.add(qs({channel:e.channel,membership:s,authority:this.provider.publicKey,authorityMembership:n},{data:{cek:o}}));let m;try{m=await this.provider.sendAndConfirm(l)}catch(_){throw(f=ie(_.code))!=null?f:_e("Unauthorized")}return{signature:m}}async postMessage(e){var l;const[n]=await this.getMembershipPDA(e.channel);let s,i=0;if(e.encrypt){const m=await this.loadMembership(n);if(!m.cek.header)throw _e("Unauthorized");const f=await this.decryptCEK(m.cek);s=await this.encryptMessage(e.message,f),i|=1}else s=e.message;const a=new se;a.add(pi({channel:e.channel,membership:n,authority:this.provider.publicKey},{message:String.fromCharCode(i)+s}));let o;try{o=await this.provider.sendAndConfirm(a)}catch(m){throw(l=ie(m.code))!=null?l:m}return{signature:o}}}const Ct="***** *** *** *** *******",U=Ie("messenger",()=>{const t=yt(),e=zt(),n=Ue(),s=y(()=>e.keypair),i={allChannels:[],ownChannels:[],channel:void 0,channelAddr:void 0,channelMembershipAddr:void 0,channelMembership:void 0,channelMembers:[],channelMessages:[],channelLoading:!1,loading:!1,creating:!1,sending:!1},a=ae({...i}),o=y(()=>{var h;return new $i(new wt(t.connection,(h=n.value)!=null?h:{publicKey:B.default},wt.defaultOptions()),e.keypair)});let l=[];Ce(n,h=>{h?_().then():w()},{immediate:!0}),Ce([s,()=>a.allChannels],()=>{m().then()},{immediate:!0});async function m(){var $;const x=(await o.value.loadMemberships(($=e.keypair)==null?void 0:$.publicKey)).map(Q=>({pubkey:Q.data[0].channel.toBase58(),status:Q.data[0].status.__kind}));a.ownChannels=x,console.log("myChannels ====== ",a.ownChannels)}async function f(){console.log("Register events...");for(const h of l)await o.value.removeEventListener(h);l.push(o.value.addEventListener("NewMessageEvent",async h=>{if(console.log("[Event] NewMessageEvent",h),`${h.channel}`!=`${a.channelAddr}`)return;let x=h.message.content;if(o.value.utils.message.isEncrypted(h.message)){const Q=await j();Q?x=await o.value.decryptMessage(h.message.content,Q):x=Ct}a.channelMessages.push({...h.message,content:x})})),l.push(o.value.addEventListener("AuthorizeMemberEvent",async h=>{console.log("[Event] AuthorizeMemberEvent",h),!(a.channelAddr&&`${h.channel}`!=`${a.channelAddr}`)&&(`${h.membership}`==`${a.channelMembershipAddr}`?S(a.channelAddr).then():H().then())})),l.push(o.value.addEventListener("JoinChannelEvent",async h=>{console.log("[Event] JoinChannelEvent",h),`${h.channel}`==`${a.channelAddr}`&&H().then()})),l.push(o.value.addEventListener("LeaveChannelEvent",async h=>{console.log("[Event] LeaveChannelEvent",h),`${h.channel}`==`${a.channelAddr}`&&H().then()}))}async function _(){w(),l=[],a.loading=!0;const h=await o.value.loadAllChannels();await f(),a.allChannels=h,a.loading=!1,console.log(a)}function w(){Object.assign(a,i)}async function M(h,x){var $,Q;try{a.creating=!0,await o.value.initChannel({name:h,maxMessages:($=x.maxMessages)!=null?$:15,public:x.public,permissionless:x.permissionless,opts:{commitment:(Q=x.commitment)!=null?Q:"confirmed"}}),await _()}finally{a.creating=!1}}async function v(h){const x=new B(h);await o.value.deleteChannel({channel:x,opts:{commitment:"confirmed"}}),await _()}async function b(h,x){const $=new B(h);await o.value.joinChannel({channel:$,name:x,opts:{commitment:"confirmed"}}),await S(h)}async function S(h){var x;a.channelLoading=!0,a.channelMessages=[],a.channelMembers=[],a.channelMembershipAddr=void 0,a.channelMembership=void 0,a.channelAddr=new B(h);try{if((x=n.value)!=null&&x.publicKey)try{const[$]=await o.value.getMembershipPDA(a.channelAddr);a.channelMembershipAddr=$,a.channelMembership=await o.value.loadMembership($)}catch($){console.log($),a.channelMembershipAddr=void 0,a.channelMembership=void 0}await H(),await R()}catch($){console.log("Error",$)}finally{a.channelLoading=!1}}async function j(){if(!!a.channelMembership)try{return await o.value.decryptCEK(a.channelMembership.cek)}catch(h){console.log(h)}}async function R(){if(!a.channelAddr){console.log("Invalid channel");return}a.channel=await o.value.loadChannel(a.channelAddr);const x=o.value.utils.channel.isPublic(a.channel)?null:await j();a.channelMessages=await Promise.all(a.channel.messages.map(async $=>{var Ne;let Be=o.value.utils.message.isEncrypted($)?Ct:$.content,Te=Je($.sender);if((Ne=n.value)!=null&&Ne.publicKey){const be=a.channelMembers.find(({data:$e})=>$e.name!==""&&(`${$e.authority}`==`${$.sender}`||`${$e.key}`==`${$.sender}`));be&&be.data.name!==""&&(Te=be.data.name)}if(x)try{Be=await o.value.decryptMessage($.content,x)}catch{console.log(`Failed to decrypt message #${$.id}`)}return{...$,senderDisplayName:Te,content:Be}}))}async function H(){if(!a.channelAddr){console.error("Invalid channel");return}a.channelMembers=await Z()}async function Z(h=a.channelAddr){return await o.value.loadChannelMembers(h)}async function k(h){if(!a.channelAddr){console.log("Please select a channel");return}try{a.sending=!0;let x;a.channel&&(x=o.value.utils.channel.isPublic(a.channel)),await o.value.postMessage({channel:a.channelAddr,message:h,encrypt:!x}),await R()}finally{a.sending=!1}}async function T(h,x,$,Q){if(!a.channelAddr){console.log("Invalid channel");return}await o.value.addMember({channel:a.channelAddr,invitee:new B(h),key:x?new B(x):void 0,name:$,flags:Q})}async function A(h){if(!a.channelAddr){console.log("Invalid channel");return}await o.value.deleteMember({channel:a.channelAddr,key:new B(h)})}async function O(h){if(!a.channelAddr){console.log("Invalid channel");return}await o.value.authorizeMember({channel:a.channelAddr,key:new B(h)}),await R()}async function I(){await _()}return{state:a,client:o.value,loadChannel:S,joinChannel:b,createChannel:M,deleteChannel:v,postMessage:k,addMember:T,deleteMember:A,authorizeMember:O,refreshList:I,loadMembers:Z}}),ye=Ie("channel",()=>{const t=Ue(),{state:e,client:n}=U(),s=y(()=>e.channelLoading),i=y(()=>e.sending),a=y(()=>{var A;return!!((A=t.value)!=null&&A.publicKey)}),o=y(()=>!!e.channel&&n.utils.channel.isPublic(e.channel)),l=y(()=>!!e.channel&&n.utils.channel.isPermissionless(e.channel)),m=y(()=>{var A;return((A=e.channelMembership)==null?void 0:A.status.__kind)==="Authorized"}),f=y(()=>{var A;return((A=e.channelMembership)==null?void 0:A.status.__kind)==="Pending"}),_=y(()=>{var A,O,I;return String((A=e.channel)==null?void 0:A.creator)===String((I=(O=t.value)==null?void 0:O.publicKey)!=null?I:"-")}),w=y(()=>!!e.channelMembership&&n.utils.member.canAddMember(e.channelMembership)),M=y(()=>!!e.channelMembership&&n.utils.member.canAuthorizeMember(e.channelMembership)),v=y(()=>!!e.channelMembership&&n.utils.member.canDeleteMember(e.channelMembership)),b=y(()=>!!e.channelMembership&&n.utils.member.isAdmin(e.channelMembership)),S=y(()=>!!e.channelMembership&&n.utils.member.isOwner(e.channelMembership)),j=y(()=>a.value&&!!e.channel&&!e.loading&&!m.value),R=y(()=>a.value),H=y(()=>S.value),Z=y(()=>S.value),k=y(()=>!e.sending&&(o.value||m.value));return{ownChannels:y(()=>e.allChannels.filter(A=>{var O;return!!e.ownChannels.find(I=>I.pubkey===A.pubkey.toBase58())||A.data.flags===1||A.data.creator.toBase58()===String((O=t.value)==null?void 0:O.publicKey)})),isChannelLoading:s,isSendMessage:i,isPublicChannel:o,isPermissionlessChannel:l,isAuthorizedMember:m,isPendingMember:f,isChannelCreator:_,isAdmin:b,isOwner:S,canJoinChannel:j,canAddMember:w,canAuthorizeMember:M,canDeleteMember:v,canCreateChannel:R,canDeleteChannel:H,canGrantAccess:Z,canPostMessage:k}}),Ei={class:"text-weight-medium"},Di={class:"memberlist-info__details"},Pi=u("span",null,"Authority:",-1),Ki={class:"memberlist-info__details"},Ii=u("span",null,"Key:",-1),zi={class:"memberlist-btns"},Bi=N({__name:"MemberListDialog",props:{membersDialog:{type:Boolean,default:!1},authorizeMemberState:{type:Object},deleteMemberState:{type:Object},wallet:{type:Object}},emits:["submit","deleteMember"],setup(t,{emit:e}){const{state:n}=U(),s=ye();function i(a){return String(a).toLowerCase()}return(a,o)=>(g(),C(re,{class:"memberlist"},{default:c(()=>[r(X,{square:"",flat:"",horizontal:""},{default:c(()=>[r(L,{class:"q-px-lg"},{default:c(()=>[E(" MEMBERS ")]),_:1}),r(L,{class:"memberlist-card"},{default:c(()=>[r(ve,{separator:""},{default:c(()=>[(g(!0),D(q,null,oe(d(n).channelMembers,l=>(g(),C(ee,{key:l.pubkey.toString(),"active-class":"bg-teal-1",active:`${l.pubkey}`==`${d(n).channelMembershipAddr}`,class:"memberlist-item"},{default:c(()=>[r(G,{class:"memberlist-info"},{default:c(()=>[r(Ke,{class:"row justify-between"},{default:c(()=>[u("span",Ei,P(d(Pt)(l.data)),1),r(Mn,{class:gt([i(l.data.status.__kind),"memberlist-status q-px-xs"])},{default:c(()=>[E(P(l.data.status.__kind),1)]),_:2},1032,["class"])]),_:2},1024),r(Ke,{caption:"",lines:"2"},{default:c(()=>[u("div",Di,[Pi,u("span",null,P(l.data.authority),1)]),u("div",Ki,[Ii,u("span",null,P(l.data.key),1)])]),_:2},1024)]),_:2},1024),u("div",zi,[l.data.status.__kind==="Pending"?(g(),C(K,{key:0,color:"teal",size:"xs",unelevated:"",class:"full-width",loading:t.authorizeMemberState.loading,disabled:t.authorizeMemberState.loading,onClick:m=>a.$emit("submit",l.data.key)},{default:c(()=>[E(" Authorize ")]),_:2},1032,["loading","disabled","onClick"])):le("",!0),d(s).canDeleteMember?(g(),C(K,{key:1,color:"negative",size:"xs",unelevated:"",class:"full-width",loading:t.deleteMemberState.loading,disabled:t.deleteMemberState.loading,onClick:m=>a.$emit("deleteMember",l.data.key)},{default:c(()=>[E(" Delete ")]),_:2},1032,["loading","disabled","onClick"])):le("",!0)])]),_:2},1032,["active"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}}),Ti=t=>(Se("data-v-65f173ca"),t=t(),ke(),t),Ni=Ti(()=>u("br",null,null,-1)),Wi=N({__name:"JoinChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=F(t.defaultState);return(s,i)=>(g(),C(re,{class:"join-channel-dialog",onHide:i[3]||(i[3]=a=>s.$emit("reset"))},{default:c(()=>[r(X,null,{default:c(()=>[r(L,null,{default:c(()=>[r(Qe,{class:"join-channel-form",onSubmit:i[2]||(i[2]=ft(a=>s.$emit("submit",n.value),["prevent"]))},{default:c(()=>[r(ne,{modelValue:n.value.name,"onUpdate:modelValue":i[0]||(i[0]=a=>n.value.name=a),label:"Member name *","lazy-rules":"",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),r(ne,{modelValue:n.value.authority,"onUpdate:modelValue":i[1]||(i[1]=a=>n.value.authority=a),label:"Authorize By","lazy-rules":"",rules:[a=>!a||a&&a.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),Ni,r(K,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[E(" Join Channel ")]),_:1})]),_:1}),r(qe,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Li=V(Wi,[["__scopeId","data-v-65f173ca"]]),Vi=t=>(Se("data-v-fe97e637"),t=t(),ke(),t),Ri=Vi(()=>u("br",null,null,-1)),Oi=N({__name:"AddMemberDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t,{emit:e}){const s=F(t.defaultState),i=()=>e("submit",s.value);return(a,o)=>(g(),C(re,{class:"add-member-dialog",onHide:o[3]||(o[3]=l=>a.$emit("reset"))},{default:c(()=>[r(X,null,{default:c(()=>[r(L,null,{default:c(()=>[r(Qe,{class:"add-member-form",onSubmit:ft(i,["prevent"])},{default:c(()=>[r(ne,{modelValue:s.value.name,"onUpdate:modelValue":o[0]||(o[0]=l=>s.value.name=l),label:"Member name *",hint:"Min length 3 chars","lazy-rules":"",rules:[l=>l&&l.length>2||"Please type something"]},null,8,["modelValue","rules"]),r(ne,{modelValue:s.value.wallet,"onUpdate:modelValue":o[1]||(o[1]=l=>s.value.wallet=l),label:"Member Wallet *","lazy-rules":"",rules:[l=>l&&l.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),r(ne,{modelValue:s.value.key,"onUpdate:modelValue":o[2]||(o[2]=l=>s.value.key=l),label:"Member Device Key",hint:"Default: The same as member wallet","lazy-rules":"",rules:[l=>!l||l.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),Ri,r(K,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[E(" Add Member ")]),_:1})]),_:1},8,["onSubmit"]),r(qe,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Fi=V(Oi,[["__scopeId","data-v-fe97e637"]]),Ui={class:"row"},ji={class:"col"},Qi={class:"col"},qi=N({__name:"NewChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t,{emit:e}){const s=F(t.defaultState),i=()=>e("submit",s);return(a,o)=>(g(),C(re,{class:"new-channel-dialog",onHide:o[4]||(o[4]=l=>a.$emit("reset"))},{default:c(()=>[r(X,null,{default:c(()=>[r(L,null,{default:c(()=>[r(Qe,{class:"messenger-new-channel-form"},{default:c(()=>[r(ne,{modelValue:s.value.name,"onUpdate:modelValue":o[0]||(o[0]=l=>s.value.name=l),label:"Channel name *","lazy-rules":"",maxlength:"32",rules:[l=>l&&l.length>2||"Please type something"]},null,8,["modelValue","rules"]),r(ne,{modelValue:s.value.maxMessages,"onUpdate:modelValue":o[1]||(o[1]=l=>s.value.maxMessages=l),label:"Max messages","lazy-rules":"",rules:[l=>+l>0||"Invalid value"]},null,8,["modelValue","rules"]),u("div",Ui,[u("div",ji,[r(lt,{modelValue:s.value.public,"onUpdate:modelValue":o[2]||(o[2]=l=>s.value.public=l),label:"Public"},null,8,["modelValue"])]),u("div",Qi,[s.value.public?le("",!0):(g(),C(lt,{key:0,modelValue:s.value.permissionless,"onUpdate:modelValue":o[3]||(o[3]=l=>s.value.permissionless=l),label:"Permissionless"},null,8,["modelValue"]))])])]),_:1}),r(qe,{showing:t.loading},null,8,["showing"])]),_:1}),r(me),r(L,null,{default:c(()=>[r(K,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:"",onClick:i},{default:c(()=>[E(" Create Channel ")]),_:1})]),_:1})]),_:1})]),_:1}))}});const Ji=V(qi,[["__scopeId","data-v-96ab7f96"]]),Gi=N({__name:"ChannelForm",props:{message:{type:String,default:""},disabled:{type:Boolean,default:!1},sending:{type:Boolean,default:!1}},emits:["submit"],setup(t,{emit:e}){const n=t,s=F(n.message),i=()=>{e("submit",s),s.value=""};return console.log(n),(a,o)=>(g(),C(Qe,{class:"channel-form",onSubmit:ft(i,["prevent"])},{default:c(()=>[r(ht,{class:"row message-control"},{default:c(()=>[r(ne,{ref:"inputFocus",modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=l=>s.value=l),class:"col-grow message-input","bg-color":"white",placeholder:"Type a message",dense:"",borderless:"",autofocus:"",disable:t.disabled},null,8,["modelValue","disable"]),r(K,{class:"send-btn",square:"",flat:"",type:"submit",disable:t.disabled,loading:t.sending},{default:c(()=>[E(" Send ")]),_:1},8,["disable","loading"])]),_:1})]),_:1},8,["onSubmit"]))}});const Hi=V(Gi,[["__scopeId","data-v-6a48a63e"]]),Xi={},Zi={class:"column q-ma-md"},Yi={class:"column items-end q-ma-md"};function eo(t,e){return g(),D(q,null,[u("div",Zi,[r(Ee,{class:"q-my-xs",width:"250px",height:"47px"}),r(Ee,{class:"q-my-xs",width:"250px",height:"47px"})]),u("div",Yi,[r(Ee,{class:"q-my-xs",width:"250px",height:"47px"}),r(Ee,{class:"q-my-xs",width:"250px",height:"47px"}),r(Ee,{class:"q-my-xs",width:"250px",height:"47px"})])],64)}const to=V(Xi,[["render",eo]]),no={key:1,class:"row justify-center channel-wrapper"},ao={key:1,class:"messenger-empty"},so={key:2,class:"messenger-empty"},io=N({__name:"ChannelWrapper",props:{postMessageState:{type:Object}},emits:["sendMessage"],setup(t,{emit:e}){const n=pe(),{state:s}=U(),i=ye();function a(w){const M=n.publicKey.value;return M?String(M)!==String(w):!0}const o=y(()=>{const w=[];let M=0,v;for(const b of s.channelMessages)v&&`${b.sender}`==`${v}`?w[M-1].text.push(b.content):(v=b.sender,w.push({id:b.id,sender:b.sender,senderDisplayName:b.senderDisplayName,text:[b.content],date:b.createdAt}),M++);return w}),l=y(()=>i.canPostMessage),m=w=>e("sendMessage",w),f=F(),_=F();return Ce(_,w=>{w&&(f.value.scrollTop=w.scrollHeight)}),(w,M)=>{const v=to,b=Hi;return g(),C(X,{class:"messenger-card",square:""},{default:c(()=>[u("div",{ref_key:"chat",ref:f,class:"messenger-content"},[d(i).isChannelLoading?(g(),C(v,{key:0})):d(s).channel?(g(),D("div",no,[d(o).length>0?(g(),D("div",{key:0,ref_key:"mes",ref:_,class:"messenger-messages"},[(g(!0),D(q,null,oe(d(o),S=>(g(),C(An,{key:S.id,name:S.senderDisplayName,text:S.text,sent:a(S.sender)},null,8,["name","text","sent"]))),128))],512)):(g(),D("div",ao," No messages "))])):(g(),D("div",so," Please select a channel "))],512),r(b,{message:t.postMessageState.message,sending:d(i).isSendMessage,disabled:!d(l),onSubmit:m},null,8,["message","sending","disabled"])]),_:1})}}});const oo=V(io,[["__scopeId","data-v-7ebf5d4f"]]),lo=N({props:{text:{type:String,default:""}}});function ro(t,e,n,s,i,a){return g(),C(kt,{anchor:"top middle",self:"center middle",class:"bg-grey-9 text-body2"},{default:c(()=>[E(P(t.text),1)]),_:1})}const co=V(lo,[["render",ro]]),uo="/sol-messenger/assets/refresh.e0cf4262.svg",mo="/sol-messenger/assets/add.1481b8ed.svg",ho="/sol-messenger/assets/join.627c8616.svg",bt=t=>(Se("data-v-cc02cbfe"),t=t(),ke(),t),po=bt(()=>u("img",{src:uo,alt:"refresh"},null,-1)),go=bt(()=>u("img",{src:mo,alt:"create"},null,-1)),fo=bt(()=>u("img",{src:ho,alt:"join"},null,-1)),yo=N({__name:"ChannelControl",props:{isJoining:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["createChannel","joinChannel","refreshList"],setup(t){const e=ye(),n=y(()=>e.canJoinChannel&&!e.isPublicChannel),s=y(()=>e.isPendingMember),i=y(()=>e.canCreateChannel);return(a,o)=>{const l=co;return g(),C(ee,null,{default:c(()=>[r(G,{class:"button-wrapper"},{default:c(()=>[r(K,{class:gt(["control-button",{"refresh-btn":t.isLoading}]),onClick:o[0]||(o[0]=m=>a.$emit("refreshList"))},{default:c(()=>[po,r(l,{text:"Refresh list"})]),_:1},8,["class"]),d(i)?(g(),C(K,{key:0,class:"control-button",square:"",onClick:o[1]||(o[1]=m=>a.$emit("createChannel"))},{default:c(()=>[go,r(l,{text:"Create a channel"})]),_:1})):le("",!0),d(n)&&!d(e).isChannelLoading?(g(),C(K,{key:1,class:"control-button",square:"",loading:t.isJoining,disable:d(s),onClick:o[2]||(o[2]=m=>a.$emit("joinChannel"))},{default:c(()=>[fo,r(l,{text:"Join the channel"})]),_:1},8,["loading","disable"])):le("",!0)]),_:1})]),_:1})}}});const bo=V(yo,[["__scopeId","data-v-cc02cbfe"]]),_o={class:"chat-name"},vo={key:0,class:"message-count"},wo=N({__name:"MessengerChannel",props:{pubkey:{type:Object,required:!0},channel:{type:Object,required:!0},isActive:Boolean},emits:["select"],setup(t){const e=t,n=y(()=>e.channel.name.slice(0,2));return(s,i)=>(g(),C(ee,{"active-class":"bg-blue-grey-8 text-white",active:t.isActive},{default:c(()=>[r(G,{class:"chat-item cursor-pointer",onClick:i[0]||(i[0]=a=>s.$emit("select"))},{default:c(()=>[u("div",{class:"chat-badge",style:Dt(d(za)(`${t.pubkey}`))},[u("span",null,P(d(n)),1)],4),u("div",_o,P(t.channel.name),1),+t.channel.messageCount>0?(g(),D("div",vo,P(t.channel.messageCount),1)):le("",!0)]),_:1})]),_:1},8,["active"]))}});const Co=V(wo,[["__scopeId","data-v-51282948"]]),Mo=15;function Ao(){const{createChannel:t}=U(),{isWalletConnected:e,ok:n,error:s}=xe(),i=ae({dialog:!1,name:"",maxMessages:Mo,public:!1,permissionless:!1,loading:!1});async function a(){if(e())try{await t(i.name,{maxMessages:i.maxMessages,public:i.public,permissionless:i.permissionless}),o(),n("Channel was created!")}catch(l){s("Something went wrong"),console.log(l)}}function o(){i.dialog=!1,i.public=!1,i.loading=!1,i.name="",i.maxMessages=15}return{state:i,submit:a,reset:o}}function So(){const t=U(),{info:e,ok:n,error:s}=xe(),i=ae({loading:!1});async function a(){if(!t.state.channelAddr){e("Please select a channel");return}try{i.loading=!0,await t.deleteChannel(t.state.channelAddr),n("Channel was deleted!")}catch(o){console.log("Error",o),s("Something went wrong")}finally{i.loading=!1}}return{state:i,submit:a}}function Vt(){const{authorizeMember:t}=U(),{ok:e,error:n}=xe(),s=ae({loading:!1,dialog:!1});async function i(a){try{s.loading=!0,await t(a),e("Member was authorized")}catch(o){n("Something went wrong"),console.log(o)}finally{s.loading=!1}}return{state:s,submit:i}}function ko(){const{state:t,addMember:e}=U(),{ok:n,info:s,error:i}=xe(),a=ae({dialog:!1,loading:!1});async function o(m){if(console.log(m),a.loading=!0,!t.channelAddr){s("Please select a channel");return}try{return await e(m.wallet,m.key,m.name),n("Member was added"),!0}catch(f){i("Something went wrong"),console.log(f)}finally{a.loading=!1,a.dialog=!1}return!1}function l(){a.loading=!1,a.dialog=!1}return{state:a,submit:o,reset:l}}function Rt(){const{deleteMember:t}=U(),{ok:e,error:n}=xe(),s=ae({loading:!1});async function i(a){try{s.loading=!0,await t(a),e("Member was deleted")}catch(o){n("Something went wrong"),console.log(o)}finally{s.loading=!1}}return{state:s,submit:i}}function xo(){const{state:t,joinChannel:e}=U(),{ok:n,info:s,error:i}=xe(),a=ae({dialog:!1,loading:!1,name:""});async function o(){if(!t.channelAddr){s("Please select a channel");return}a.loading=!0;try{await e(t.channelAddr,a.name),l(),n("Request was sent")}catch(m){console.log("Error",m),i("Something went wrong")}finally{a.loading=!1}}function l(){a.loading=!1,a.dialog=!1,a.name=""}return{state:a,submit:o,reset:l}}function xe(){const t=pe(),{notify:e}=Oe(),n=o=>e({type:"positive",message:o,timeout:2e3}),s=o=>e({type:"info",message:o,timeout:2e3}),i=o=>e({type:"negative",message:o,timeout:2e3});function a(){return t.publicKey.value?!0:(s("Please connect wallet"),!1)}return{ok:n,info:s,error:i,isWalletConnected:a}}const $o=u("div",{class:"text-h5"}," Channels ",-1),Eo={class:"text-weight-medium"},Do={class:"memberlist-info__details"},Po=u("span",null,"Authority:",-1),Ko={class:"memberlist-info__details"},Io=u("span",null,"Key:",-1),zo=N({__name:"PendingUsersDialog",props:{pendingChannels:Object,showDialog:Boolean},emits:["closeDialog"],setup(t,{emit:e}){const{state:n,refreshList:s}=U(),i=Vt(),a=Rt(),o=async(_,w)=>{n.channelAddr=w,await i.submit(_),await s()},l=async(_,w)=>{n.channelAddr=w,await a.submit(_),await s()},m=y(()=>i.state.loading),f=y(()=>a.state.loading);return(_,w)=>(g(),C(re,{modelValue:t.showDialog,"onUpdate:modelValue":w[0]||(w[0]=M=>kn(showDialog)?showDialog.value=M:null)},{default:c(()=>[r(X,{class:"pending-channels",square:"",flat:"",horizontal:""},{default:c(()=>[r(L,null,{default:c(()=>[$o]),_:1}),r(L,null,{default:c(()=>[r(ve,{bordered:""},{default:c(()=>[(g(!0),D(q,null,oe(t.pendingChannels,(M,v)=>(g(),C(Sn,{key:M.name,"expand-separator":"",label:M.channel.data.name,caption:"channel","default-opened":v===0,"header-class":"bg-blue-grey-1"},{default:c(()=>[r(ve,{separator:""},{default:c(()=>[(g(!0),D(q,null,oe(M.pendingMembers,b=>(g(),C(ee,{key:b,class:"row justify-between pending-item"},{default:c(()=>[r(G,{class:"memberlist-info"},{default:c(()=>[r(Ke,{class:"row justify-between"},{default:c(()=>[u("span",Eo,P(d(Pt)(b.data)),1)]),_:2},1024),r(Ke,{caption:"",lines:"2"},{default:c(()=>[u("div",Do,[Po,u("span",null,P(b.data.authority),1)]),u("div",Ko,[Io,u("span",null,P(b.data.key),1)])]),_:2},1024)]),_:2},1024),r(G,{side:"",class:"memberlist-btns"},{default:c(()=>[r(K,{color:"teal",size:"xs",unelevated:"",class:"full-width",loading:d(m),disabled:d(m),onClick:S=>o(b.data.key,M.channel.pubkey)},{default:c(()=>[E(" Authorize ")]),_:2},1032,["loading","disabled","onClick"]),r(K,{color:"negative",size:"xs",unelevated:"",class:"full-width",loading:d(f),disabled:d(f),onClick:S=>l(b.data.key,M.channel.pubkey)},{default:c(()=>[E(" Delete ")]),_:2},1032,["loading","disabled","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["label","default-opened"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});const Bo={class:"bell",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",fill:"none","xmlns:v":"https://vecta.io/nano"},To=["fill"],No=N({__name:"iconBell",props:{color:{type:String,default:"AABEC8"}},setup(t){return(e,n)=>(g(),D("svg",Bo,[u("path",{d:"M5.352 14.359h3.294c0 .821-.59 1.641-1.647 1.641s-1.647-.82-1.647-1.641zm8.434-3.467l-.911-1.515a3.68 3.68 0 0 1-.527-1.897V5.325C12.348 2.389 9.949 0 7 0S1.651 2.389 1.651 5.325v2.155a3.68 3.68 0 0 1-.527 1.897l-.911 1.515c-.278.461-.285 1.018-.018 1.487s.749.749 1.29.749h11.03a1.47 1.47 0 0 0 1.291-.749 1.46 1.46 0 0 0-.021-1.487z",fill:`#${t.color}`},null,8,To)]))}}),Ot=Ie("notifications",()=>{const t=Ue(),{loadMembers:e}=U(),n=ye(),s=ae({showInfo:!1,showDialog:!1,pendingChannels:[]});Ce(()=>n.ownChannels,async(a,o)=>{o.length>0&&await i(o)});async function i(a){try{const o=await Promise.all(a.map(async l=>{var _;const{pubkey:m,data:f}=l;if(f.creator.toBase58()===((_=t.value)==null?void 0:_.publicKey.toBase58())){const w=await e(m);if(w.length===0)return;const M=w.filter(v=>v.data.status.__kind==="Pending");return M.length?{channel:l,pendingMembers:M}:void 0}}));s.pendingChannels=o.filter(l=>l),s.pendingChannels.length>0?(setTimeout(()=>s.showInfo=!0,2e3),setTimeout(()=>s.showInfo=!1,7e3)):s.showDialog=!1}catch(o){console.log(o)}}return{state:s}});function Wo(){const{state:t}=Ot();return{showDialog:y(()=>t.showDialog),showInfo:y(()=>t.showInfo),pendingChannels:y(()=>t.pendingChannels)}}const Lo={class:"panel-notifications__info"},Vo=N({__name:"MessengerNotification",setup(t){const{pendingChannels:e,showDialog:n,showInfo:s}=Wo(),{state:i}=Ot(),a=y(()=>{var f,_;return(_=(f=e.value)==null?void 0:f.length)!=null?_:0}),o=y(()=>a.value>0),l=y(()=>s.value?"width: 100%; padding-right: 14px":"width: 0; padding-right: 0;"),m=()=>{!o.value||(i.showDialog=!i.showDialog)};return(f,_)=>{const w=No,M=zo;return g(),D("div",{class:gt(["panel-notifications",{"has-notifications":d(o)}]),onClick:m},[u("div",Lo,[r(w,{class:"ring",color:d(o)?"FF5C5C":"AABEC8"},null,8,["color"]),u("span",null,P(a.value),1)]),u("div",{ref:"notificationsInfo",class:"panel-notifications__details",style:Dt(d(l))}," channels are awaiting user confirmation ",4),r(M,{"show-dialog":d(n),"pending-channels":d(e),onCloseDialog:_[0]||(_[0]=v=>f.isShow.value=!1)},null,8,["show-dialog","pending-channels"])],2)}}});const Ro={class:"panel-search"},Oo={class:"search-wrapper"},Fo={class:"panel-info"},Uo={class:"chat-info"},jo={class:"chat-members"},Qo={class:"chat-messages"},qo={class:"chat-name"},Jo=N({__name:"MessengerToolbar",emits:["search","showMembers","deleteChannel","addMember","showDeviceKey"],setup(t,{emit:e}){const n=pe(),{state:s}=U(),i=ye(),a=y(()=>!!n.publicKey.value),o=F(""),l=y(()=>s.channel),m=y(()=>{var v,b,S;return((v=l.value)==null?void 0:v.memberCount)===null||((b=l.value)==null?void 0:b.memberCount)===void 0?"":`${(S=l.value)==null?void 0:S.memberCount}\xA0members`}),f=y(()=>{var v,b,S;return((v=l.value)==null?void 0:v.messageCount)===null||((b=l.value)==null?void 0:b.messageCount)===void 0?"":`${(S=l.value)==null?void 0:S.messageCount}\xA0messages`}),_=v=>e("search",v),w=()=>e("showMembers"),M=()=>e("addMember");return Ce(o,v=>{_(String(v))}),(v,b)=>{const S=Vo;return g(),C(ht,{class:"panel-toolbar"},{default:c(()=>{var j;return[r(S),u("div",Ro,[u("div",Oo,[r(ne,{modelValue:o.value,"onUpdate:modelValue":b[0]||(b[0]=R=>o.value=R),class:"search-input no-margin q-pa-none",placeholder:"Search ...",clearable:"",debounce:"300",borderless:"",onClear:b[1]||(b[1]=R=>o.value="")},null,8,["modelValue"])])]),u("div",Fo,[u("div",Uo,[u("div",jo,P(d(m)),1),u("div",Qo,P(d(f)),1)]),r(pt,{class:""}),u("div",qo,P((j=d(l))==null?void 0:j.name),1),u("div",null,[r(K,{class:"chat-menu",flat:"",unelevated:"",disable:!d(a)},{default:c(()=>[r(xn,{name:d($n)},null,8,["name"]),r(En,{anchor:"bottom left",self:"top left"},{default:c(()=>[r(ve,{style:{"min-width":"150px"},bordered:""},{default:c(()=>[De((g(),C(ee,{clickable:"",onClick:b[2]||(b[2]=R=>v.$emit("showDeviceKey"))},{default:c(()=>[r(G,null,{default:c(()=>[E("Device key")]),_:1})]),_:1})),[[Pe]]),De((g(),C(ee,{clickable:"",disable:!d(l),onClick:w},{default:c(()=>[r(G,null,{default:c(()=>[E("Members")]),_:1})]),_:1},8,["disable"])),[[Pe]]),De((g(),C(ee,{clickable:"",disable:!d(i).canAddMember,onClick:M},{default:c(()=>[r(G,null,{default:c(()=>[E("Add member")]),_:1})]),_:1},8,["disable"])),[[Pe]]),De((g(),C(ee,{clickable:"",disable:!d(i).isChannelCreator,onClick:b[3]||(b[3]=R=>v.$emit("deleteChannel"))},{default:c(()=>[r(G,null,{default:c(()=>[E("Delete")]),_:1})]),_:1},8,["disable"])),[[Pe]])]),_:1})]),_:1})]),_:1},8,["disable"])])])]}),_:1})}}});const Go={class:"col col-4"},Ho={class:"col"},Xo={class:"no-margin"},Zo=N({__name:"DebugBtn",setup(t){const{state:e}=U(),{isAuthorizedMember:n,isPendingMember:s,isChannelCreator:i}=ye(),a=F(!1),o=Dn(a);return(l,m)=>(g(),D(q,null,[r(K,{flat:"",class:"text-blue-2",onClick:m[0]||(m[0]=f=>d(o)())},{default:c(()=>[E(" Debug info ")]),_:1}),r(re,{modelValue:a.value,"onUpdate:modelValue":m[1]||(m[1]=f=>a.value=f)},{default:c(()=>[r(X,null,{default:c(()=>[r(L,null,{default:c(()=>[(g(!0),D(q,null,oe([["Authorized",d(n)],["Pending Access",d(s)],["Channel Creator",d(i)],["Channel",d(e).channel],["Membership",d(e).channelMembership],["Members",d(e).channelMembers]],f=>(g(),D("div",{key:f[0],class:"row q-mt-md"},[u("div",Go,P(f[0]),1),u("div",Ho,[u("pre",Xo,P(f[1]),1)])]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),Yo={class:"messenger-wrapper"},el={class:"messenger-main"},tl={key:1,class:"messenger-channels-empty"},nl={key:0,class:"q-my-md q-px-lg"},al=N({__name:"Messenger",setup(t){const e=pe(),{state:n,postMessage:s,loadChannel:i,refreshList:a}=U(),o=ye(),l=Ao(),m=xo(),f=ko(),_=Vt(),w=Rt(),M=So(),v=ae({message:""}),b=y(()=>n.allChannels),S=F([]),j=F("");async function R(I){await s(I.value),v.message=""}async function H(I){await i(I)}const Z=I=>{if(I===""){S.value=[],j.value="";return}S.value=b.value.filter(h=>h.data.name.toLocaleLowerCase().includes(I.toLocaleLowerCase())||h.pubkey.toBase58().toLocaleLowerCase().includes(I.toLocaleLowerCase())),j.value=I},k=y(()=>n.loading),T=F(!1),A=y(()=>S.value.length>0||j.value.length>0?S.value:o.ownChannels),O=I=>f.submit(I);return(I,h)=>{const x=Jo,$=Co,Q=bo,Be=oo,Te=Ji,Ne=Fi,be=Li,$e=Bi,Ft=$s;return g(),D(q,null,[u("div",Yo,[r(x,{onSearch:Z,onShowMembers:h[0]||(h[0]=z=>d(_).state.dialog=!0),onDeleteChannel:h[1]||(h[1]=z=>d(M).submit(d(n).channelAddr)),onAddMember:h[2]||(h[2]=z=>d(f).state.dialog=!0),onShowDeviceKey:h[3]||(h[3]=z=>T.value=!0)}),u("div",el,[r(X,{class:"messenger-channels",square:""},{default:c(()=>[d(A).length>0?(g(),C(ve,{key:0,separator:"",class:"channels-list"},{default:c(()=>[(g(!0),D(q,null,oe(d(A),z=>(g(),C($,{key:z.name,pubkey:z.pubkey,channel:z.data,"is-active":`${d(n).channelAddr}`==`${z.pubkey}`,onSelect:xl=>H(z.pubkey)},null,8,["pubkey","channel","is-active","onSelect"]))),128))]),_:1})):(g(),D("div",tl," No channels ")),r(Q,{"is-joining":d(m).state.loading,"is-loading":d(k),onCreateChannel:h[4]||(h[4]=z=>d(l).state.dialog=!0),onJoinChannel:h[5]||(h[5]=z=>d(m).state.dialog=!0),onRefreshList:d(a)},null,8,["is-joining","is-loading","onRefreshList"])]),_:1}),r(Be,{"post-message-state":v,onSendMessage:R},null,8,["post-message-state"]),r(qe,{showing:d(n).loading,color:"primary"},null,8,["showing"])])]),r(Te,{modelValue:d(l).state.dialog,"onUpdate:modelValue":h[6]||(h[6]=z=>d(l).state.dialog=z),loading:d(l).state.loading,"default-state":d(l).state,onSubmit:d(l).submit,onReset:d(l).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),r(Ne,{modelValue:d(f).state.dialog,"onUpdate:modelValue":h[7]||(h[7]=z=>d(f).state.dialog=z),loading:d(f).state.loading,"default-state":d(f).state,onSubmit:O,onReset:d(f).reset},null,8,["modelValue","loading","default-state","onReset"]),r(be,{modelValue:d(m).state.dialog,"onUpdate:modelValue":h[8]||(h[8]=z=>d(m).state.dialog=z),loading:d(m).state.loading,"default-state":d(m).state,onSubmit:d(m).submit,onReset:d(m).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),r($e,{modelValue:d(_).state.dialog,"onUpdate:modelValue":h[9]||(h[9]=z=>d(_).state.dialog=z),wallet:d(e),"authorize-member-state":d(_).state,"delete-member-state":d(w).state,onSubmit:d(_).submit,onDeleteMember:d(w).submit},null,8,["modelValue","wallet","authorize-member-state","delete-member-state","onSubmit","onDeleteMember"]),r(Ft,{modelValue:T.value,"onUpdate:modelValue":h[10]||(h[10]=z=>T.value=z)},null,8,["modelValue"]),d(n).channel?(g(),D("div",nl,[r(Zo)])):le("",!0)],64)}}});const sl={},il={class:"container"},ol={class:"messenger-container"},ll={class:"container"};function rl(t,e){const n=al,s=Ms;return g(),C(Pn,{class:"page-wrapper"},{default:c(()=>[u("div",il,[u("div",ol,[r(n)])]),u("div",ll,[r(s)])]),_:1})}const cl=V(sl,[["render",rl],["__scopeId","data-v-8f1b09e0"]]),ul=()=>St(()=>import("./_...all_.9fa032fb.js"),["assets/_...all_.9fa032fb.js","assets/vendor.c86cdafd.js","assets/_...all_.73169310.css"]),dl=[{name:"index",path:"/",component:cl,props:!0},{name:"all",path:"/:all(.*)*",component:ul,props:!0,meta:{layout:"empty"}}],ml=hs(dl),hl="/sol-messenger/",pl=Kn({history:In(hl),scrollBehavior:()=>({left:0,top:0}),strict:!0,routes:ml}),gl=({app:t})=>{t.use(pl)},fl=Object.freeze(Object.defineProperty({__proto__:null,install:gl},Symbol.toStringTag,{value:"Module"})),yl=({app:t})=>{t.use(zn,{wallets:[new Bn,new Tn,new Nn,new Wn,new Ln,new Vn,new Rn,new On,new Fn,new Un,new jn,new Qn,new qn,new Jn,new Gn,new Hn,new Xn,new Zn,new Yn,new ea,new ta,new na,new aa,new sa,new ia,new oa,new la,new ra,new ca,new ua],autoConnect:!1})},bl=Object.freeze(Object.defineProperty({__proto__:null,install:yl},Symbol.toStringTag,{value:"Module"})),_l=da();function vl(){return _l}const wl=Symbol("WALLET_CONNECT_EVENT"),Cl=Symbol("WALLET_DISCONNECT_EVENT"),Ml=Symbol("ACCOUNT_CHANGE_EVENT"),ot=5e3;function Al(){const{connection:t}=yt(),{emit:e}=vl(),{notify:n}=Oe(),{wallet:s}=pe();Ce(s,i=>{if(!i)return;const a=()=>{const m=i.adapter.publicKey;t.onAccountChange(m,f=>{e(Ml,f)}),t.onLogs(m,f=>{console.log(f)}),n({message:"Wallet update",caption:`Connected to wallet ${Je(m.toBase58(),7)}`,timeout:ot}),e(wl,i)},o=()=>{n({message:"Wallet update",caption:"Disconnected from wallet",timeout:ot}),e(Cl,i)},l=m=>{!(m!=null&&m.message)||n({type:"negative",message:"Wallet update",caption:m.message,timeout:ot})};i.adapter.once("connect",a),i.adapter.once("disconnect",o),i.adapter.removeAllListeners("error"),i.adapter.on("error",l)},{immediate:!0})}const Sl=N({__name:"App",setup(t){return ma(()=>{Al()}),(e,n)=>{const s=Fe("router-view");return g(),C(s)}}});async function kl(){const t=ha(Sl);Object.values(Object.assign({"./plugins/pinia.ts":ga,"./plugins/quasar.ts":ya,"./plugins/router.ts":fl,"./plugins/wallet.ts":bl})).forEach(e=>{var n;return(n=e.install)==null?void 0:n.call(e,{app:t})}),t.mount("#app")}kl().then();export{V as _};
