var zt=Object.defineProperty;var Tt=(t,e,n)=>e in t?zt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var N=(t,e,n)=>(Tt(t,typeof e!="symbol"?e+"":e,n),n);import{c as Bt,Q as Wt,P as Nt,D as Lt,N as Vt,a as Rt,i as Ot,u as Be,b as ze,d as L,o as g,e as _,w as c,f as d,g as D,h as l,j as at,k as p,l as Ft,r as F,m as b,n as I,p as de,q as Ut,s as jt,S as Qt,t as T,v as B,x as gt,y as z,z as te,A as U,B as ce,C as Jt,E as Y,F as J,G as Gt,H as me,I as X,J as vt,W as ft,K as Ce,L as Ae,M as qt,O as We,R as Ht,T as Xt,U as Ne,V as _e,X as st,Y as ie,Z as Zt,_ as Le,$ as ut,a0 as dt,a1 as Yt,a2 as en,a3 as tn,a4 as wt,a5 as mt,a6 as nn,a7 as ue,a8 as Ye,a9 as Se,aa as ke,ab as an,ac as Mt,ad as sn,ae as rn,af as h,ag as H,ah as Ct,ai as re,aj as oe,ak as xe,al as At,am as ve,an as on,ao as Ve,ap as St,aq as it,ar as ln,as as cn,at as un,au as dn,av as mn,aw as ae,ax as pe,ay as yt,az as be,aA as pn,aB as Re,aC as Oe,aD as ee,aE as Ee,aF as hn,aG as gn,aH as fn,aI as yn,aJ as bn,aK as _n,aL as vn,aM as wn,aN as Mn,aO as Cn,aP as An,aQ as Sn,aR as kn,aS as xn,aT as En,aU as $n,aV as Dn,aW as Kn,aX as Pn,aY as In,aZ as zn,a_ as Tn,a$ as Bn,b0 as Wn,b1 as Nn,b2 as Ln,b3 as Vn,b4 as Rn,b5 as On,b6 as Fn,b7 as Un,b8 as jn,b9 as Qn,ba as Jn,bb as Gn,bc as qn,bd as Hn,be as Xn,bf as Zn,bg as Yn,bh as ea,bi as ta,bj as na}from"./vendor.31612765.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const aa=({app:t})=>{const e=Bt();t.use(e)},sa=Object.freeze(Object.defineProperty({__proto__:null,install:aa},Symbol.toStringTag,{value:"Module"})),ia=({app:t})=>{t.use(Wt,{plugins:{Dark:Nt,Dialog:Lt,Notify:Vt,LocalStorage:Rt},iconSet:Ot})},ra=Object.freeze(Object.defineProperty({__proto__:null,install:ia},Symbol.toStringTag,{value:"Module"}));function oa(){const{dark:t}=Be(),e=ze("theme-mode",t.isActive);return t.set(e.value),{isActive:e,set(n){t.set(n),e.value=t.isActive},toggle(){t.toggle(),e.value=t.isActive}}}const la={class:"container"},ca={class:"row"},ua=d("div",{class:"col-12 col-md-6"},[d("div",{class:"footer-links"},[d("ul",null,[d("li",null,[d("a",{target:"_blank",href:"https://jpool.one"},"JPOOL")]),d("li",null,[d("a",{target:"_blank",href:"https://heartandsol.one"},"GAME")]),d("li",null,[d("a",{href:"https://magiceden.io/marketplace/heartandsol"},"NFT Marketplace")])])]),d("div",{class:"copyright"},[d("span",null,"\xA9 Copyright 2022 jpool.one. All rights reserved. Powered by mFactory GmbH")])],-1),da={class:"col-12 col-md-6 social-col"},ma={class:"social"},pa={class:"theme"},ha=d("div",{class:"social-link social-link-text"},[d("span",null,[D("official"),d("br"),D("channel")])],-1),ga=d("div",{class:"social-link telegram"},null,-1),fa=d("div",{class:"social-link twitter"},null,-1),ya=d("div",{class:"social-link discord"},null,-1),ba=L({__name:"AppFooter",setup(t){const e=oa();return(n,i)=>(g(),_(Ft,null,{default:c(()=>[d("div",la,[d("div",ca,[ua,d("div",da,[d("div",ma,[d("div",pa,[D(" Dark theme "),l(at,{"model-value":p(e).isActive.value,onClick:p(e).toggle},null,8,["model-value","onClick"])]),ha,ga,fa,ya])])])])]),_:1}))}});function _a(){const t=F(va());return{userAgent:t,isMobileOs:b(()=>wa(t.value)),isWebView:b(()=>Ma(t.value))}}let et;function va(){var t,e;return et===void 0&&(et=(e=(t=globalThis.navigator)==null?void 0:t.userAgent)!=null?e:null),et}function wa(t){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)}function Ma(t){return/(WebView|(Phantom|Solflare)|Version\/.+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+)|; wv\).+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+))/i.test(t)}function Fe(t,e=4){return t instanceof I&&(t=t.toBase58()),`${t.slice(0,e)}...${t.slice(-e)}`}const Ca=t=>{if(!t)return{background:"#000"};let e=0;for(let i=0;i<t.length;i++)e=t.charCodeAt(i)+((e<<5)-e),e=e&e;let n="#";for(let i=0;i<3;i++)n+=`00${(e>>i*8&255).toString(16)}`.substr(-2);return{background:n}},Aa="/sol-messenger/assets/clover.968404b0.svg",Sa="/sol-messenger/assets/ledger.40cf6861.svg",ka="/sol-messenger/assets/mathwallet.1d763e81.svg",kt=t=>(Ce("data-v-b79b08f0"),t=t(),Ae(),t),xa=kt(()=>d("div",{class:"text-h6 text-center"}," Your wallet ",-1)),Ea={class:"q-gutter-md row justify-between"},$a=kt(()=>d("div",{class:"text-h6"}," Connect to a wallet ",-1)),Da={class:"text-light-gray text-caption full-width text-no-wrap",style:{"text-overflow":"ellipsis",overflow:"hidden"}},Ka=["src","alt"],Pa=L({__name:"ConnectWallet",setup(t){const e={priority:{solflare:10,phantom:20,sollet:5,nufi:5,blocto:1},icons:{clover:Aa},darkIcons:{ledger:Sa,mathwallet:ka},deepLinks:{phantom:"https://phantom.app/ul/browse/{uri}?ref={ref}",solflare:"https://solflare.com/ul/browse/{uri}?ref={ref}"}},{userAgent:n,isWebView:i,isMobileOs:s}=_a(),a={close:vt},r=M=>[ft.Installed,ft.Loadable].includes(M.readyState);Be();const o=de(),{connected:u,connecting:m}=o;Ut();const v=b(()=>s.value&&!i.value);if(i.value){const M=String(n.value).toLowerCase();M.includes("phantom")?(o.select(jt),o.connect()):M.includes("solflare")&&(o.select(Qt),o.connect())}const $=b(()=>{var M,A;return(A=(M=o.publicKey.value)==null?void 0:M.toBase58())!=null?A:""}),w=b(()=>Fe($.value)),E=b(()=>[...o.wallets.value].map(M=>{var y,ne;const A=M.adapter.name.toLowerCase();return M.adapter.icon=(ne=(y=e.darkIcons[A])!=null?y:e.icons[A])!=null?ne:M.adapter.icon,v.value&&e.deepLinks[A]&&(M.deepLink=e.deepLinks[A].replace("{uri}",location.href).replace("{ref}",location.origin)),M}).sort((M,A)=>{var f,S;const y=(f=e.priority[M.adapter.name.toLowerCase()])!=null?f:1;return((S=e.priority[A.adapter.name.toLowerCase()])!=null?S:1)-y+((r(A)?1:0)-(r(M)?1:0))})),k=b(()=>v.value?E.value.filter(M=>!!M.deepLink):E.value),C=F(!1);async function W(M){await o.select(M.adapter.name),C.value=!1,await o.connect()}function O(){C.value=!1,o.disconnect()}function Q(){C.value=!0}function P(){C.value=!1}return(M,A)=>(g(),T(X,null,[p(u)?(g(),_(z,gt({key:0},M.$attrs,{class:M.$style.btn,ripple:!1,color:"primary-gray","text-color":"white",rounded:"",unelevated:"",onClick:Q}),{default:c(()=>[D(B(p(w)),1)]),_:1},16,["class"])):(g(),_(z,gt({key:1},M.$attrs,{color:"primary-gray","text-color":"white",rounded:"",unelevated:"",ripple:!1,loading:p(m),onClick:Q}),{default:c(()=>[D(" CONNECT WALLET ")]),_:1},16,["loading"])),l(me,{modelValue:C.value,"onUpdate:modelValue":A[0]||(A[0]=y=>C.value=y),"transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:c(()=>[p(u)?(g(),_(te,{key:0},{default:c(()=>[l(U,{class:"relative-position"},{default:c(()=>[xa,l(z,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:P},null,8,["icon"])]),_:1}),l(ce),l(U,null,{default:c(()=>[D(B(p($)),1)]),_:1}),l(ce),l(U,null,{default:c(()=>[d("div",Ea,[l(z,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:O},{default:c(()=>[D(" Disconnect ")]),_:1}),l(z,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:P},{default:c(()=>[D(" Ok ")]),_:1})])]),_:1})]),_:1})):(g(),_(te,{key:1,class:"wallet-connect-card"},{default:c(()=>[l(U,null,{default:c(()=>[$a,l(z,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:P},null,8,["icon"])]),_:1}),l(ce),l(U,{style:{"max-height":"80vh"},class:"scroll"},{default:c(()=>[l(Jt,{grid:"",rows:p(k),"row-key":"name","hide-pagination":"","hide-header":"","rows-per-page-options":[100]},{item:c(({row:y})=>[(g(),T("div",{key:`wallet-${y.adapter.name}`,class:"col-12 col-md-6"},[l(Y,{clickable:"",href:y.deepLink,onClick:ne=>y.deepLink?!0:W(y)},{default:c(()=>[l(J,null,{default:c(()=>[d("b",null,B(y.adapter.name),1),d("div",Da,B(y.adapter.url),1)]),_:2},1024),l(J,{avatar:""},{default:c(()=>[l(Gt,{square:""},{default:c(()=>[d("img",{src:y.adapter.icon,alt:y.adapter.name},null,8,Ka)]),_:2},1024)]),_:2},1024)]),_:2},1032,["href","onClick"])]))]),_:1},8,["rows"])]),_:1})]),_:1}))]),_:1},8,["modelValue"])],64))}});const Ia="_btn_6n1iw_1",za={btn:Ia},R=(t,e)=>{const n=t.__vccOpts||t;for(const[i,s]of e)n[i]=s;return n},Ta={$style:za},Ba=R(Pa,[["__cssModules",Ta],["__scopeId","data-v-b79b08f0"]]),we=[{id:"serum-mainnet",name:"Serum RPC",cluster:"mainnet-beta",url:"https://solana-api.projectserum.com/"},{id:"rpcpool-mainnet",name:"RPCPool RPC",cluster:"mainnet-beta",url:"https://mainnet.rpcpool.com/"},{id:"mainnet",name:"Solana RPC",cluster:"mainnet-beta",url:qt("mainnet-beta")}],xt={id:"devnet",name:"DevNet",cluster:"devnet",url:"https://devnet.rpcpool.com/"};we.push(xt);const Wa={id:"testnet",name:"TestNet",cluster:"testnet",url:"https://testnet.rpcpool.com/"};we.push(Wa);var _t;const Na=(_t=we.find(t=>t.id==={VITE_BASE_PATH:"/sol-messenger/",VITE_USER_NODE_ENV:"production",BASE_URL:"/sol-messenger/",MODE:"staging",DEV:!1,PROD:!0}.VITE_CONNECTION_ENDPOINT))!=null?_t:xt,La="confirmed",Va=12e4,Ra=["94ScvxCuJbVaS2YdaveHGijQ4vtHb6XCzT2ejXhwxiLB","o8vV9bLYBPwoWmS2meSXWyTLdwfhLhEzYsBkopWUNyY"],pt=We({id:"connection",state:()=>({commitment:La,confirmTransactionInitialTimeout:Va,rpc:Ht("rpc","")}),getters:{endpoint(t){var e;return(e=we.find(n=>n.id===t.rpc))!=null?e:Na},connection(t){return console.log("[connection]",this.endpoint.url),new Xt(this.endpoint.url,{confirmTransactionInitialTimeout:t.confirmTransactionInitialTimeout,commitment:t.commitment})},cluster(){return this.endpoint.cluster}},actions:{setRpc(t){this.rpc=t},setCommitment(t){this.commitment=t}}}),Oa=L({__name:"ClusterSelector",setup(t){const e=pt(),{connected:n,connect:i,disconnect:s,autoConnect:a}=de(),r=[we.filter(m=>m.cluster==="mainnet-beta"),we.filter(m=>m.cluster!=="mainnet-beta")],o=b(()=>e.endpoint),u=m=>{n&&e.cluster!==m.cluster&&(s(),a.value&&i()),e.setRpc(m.id)};return(m,v)=>(g(),_(Zt,{label:p(o).name,"model-value":!1,"auto-close":"",color:"secondary","text-color":"#000",rounded:"",unelevated:"",ripple:!1},{default:c(()=>[l(Ne,null,{default:c(()=>[(g(),T(X,null,_e(r,($,w)=>(g(),T(X,{key:`${w}-cluster-group`},[(g(!0),T(X,null,_e($,E=>(g(),_(Y,{key:E.id,clickable:"",onClick:k=>u(E)},{default:c(()=>[(g(),_(J,{key:`${E.id}-item`},{default:c(()=>[l(st,null,{default:c(()=>[d("b",null,B(E.name),1)]),_:2},1024),D(" "+B(E.url),1)]),_:2},1024))]),_:2},1032,["onClick"]))),128)),w!==r.length-1?(g(),_(ce,{key:0})):ie("",!0)],64))),64))]),_:1})]),_:1},8,["label"]))}});const Fa={},Ua={class:"container"},ja={class:"app-header__info"},Qa={class:"app-header__logo"},Ja={class:"logo-wrapper"},Ga=d("div",{class:"app-header__title"},[d("h1",null,[D("BLOCKCHAIN messenger "),d("span",{class:"marked"},"SOLANA")])],-1),qa={class:"app-header__right"},Ha={class:"app-header__buttons"};function Xa(t,e){const n=Le("router-link"),i=Oa,s=Ba;return g(),_(Yt,{class:"app-header"},{default:c(()=>[d("div",Ua,[l(ut,null,{default:c(()=>[d("div",ja,[d("div",Qa,[d("div",Ja,[l(n,{to:"/"})])]),Ga]),l(dt),d("div",qa,[d("div",Ha,[l(i,{class:"app-header__cluster-btn header-btn"}),l(s,{class:"app-header__wallet-btn header-btn"})])])]),_:1})])]),_:1})}const Za=R(Fa,[["render",Xa]]),Ya={};function es(t,e){const n=Za,i=Le("router-view"),s=ba;return g(),_(en,{view:"lfh Lpr lff"},{default:c(()=>[l(n),l(tn,null,{default:c(()=>[l(i)]),_:1}),l(s)]),_:1})}const ts=R(Ya,[["render",es]]),ns={default:ts,empty:()=>wt(()=>import("./empty.be4d22cf.js"),["assets/empty.be4d22cf.js","assets/vendor.31612765.js"])};function as(t){return t.map(e=>{var n;return{path:e.path,component:ns[((n=e.meta)==null?void 0:n.layout)||"default"],children:[{...e,path:""}]}})}const ss="/sol-messenger/assets/solana-logo.3caace62.svg";const is={},Ue=t=>(Ce("data-v-5ffd3a8e"),t=t(),Ae(),t),rs={class:"row info-row"},os=Ue(()=>d("div",{class:"offset-0 offset-md-3"},null,-1)),ls=Ue(()=>d("div",{class:"col-6 col-md-3 flex-center info-col"},[d("div",{class:"info-title"}," How IT WORKS "),d("div",{class:"info-text"},[d("ul",null,[d("li",null,"Connect your wallet"),d("li",null,"Enter the amount of JPLT you want to swap or enter the amount of JPLU you want to get"),d("li",null,"Click SWAP button"),d("li",null,"Confirm the transaction in your wallet"),d("li",null,"Done")])])],-1)),cs={class:"col-6 col-md-5 logo-wrap"},us=Ue(()=>d("img",{src:ss,alt:"solana logo"},null,-1)),ds=Ue(()=>d("div",{class:"offset-0 offset-md-1"},null,-1));function ms(t,e){const n=Le("router-link");return g(),T("div",rs,[os,ls,d("div",cs,[l(n,{to:"/"},{default:c(()=>[us]),_:1})]),ds])}const ps=R(is,[["render",ms],["__scopeId","data-v-5ffd3a8e"]]),Et=We("user",()=>{const t=mt(),e=F();nn(()=>{var r;const a=(r=t.value)==null?void 0:r.publicKey;if(a){const o=ze(a.toString(),()=>Ye.encode(ue.generate().secretKey));n(o.value)}else e.value=void 0});function n(a){e.value=ue.fromSecretKey(Ye.decode(a))}function i(){var o;const a=(o=t.value)==null?void 0:o.publicKey;if(!a)return;const r=ze(a.toString(),"");n(r.value=Ye.encode(ue.generate().secretKey))}function s(a){var u;const r=(u=t.value)==null?void 0:u.publicKey;if(!r)return;const o=ze(r.toString(),"");n(o.value=a)}return{keypair:e,generateKey:i,importKey:s}}),hs=t=>(Ce("data-v-4f30d8b8"),t=t(),Ae(),t),gs=hs(()=>d("div",{class:"text-h6 text-center"}," Device Key ",-1)),fs={class:"q-gutter-md row justify-between"},ys=L({__name:"UserInfoDialog",emits:["regenerate"],setup(t){const e=Et(),n=()=>{var i,s;rn(((s=(i=e.keypair)==null?void 0:i.publicKey)!=null?s:"").toString())};return(i,s)=>(g(),_(me,{class:"dialog-wrapper","transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:c(()=>[l(te,null,{default:c(()=>[l(U,{class:"row items-center"},{default:c(()=>[gs,l(dt),Se(l(z,{flat:"",round:"",dense:"",icon:p(vt)},null,8,["icon"]),[[ke]])]),_:1}),l(ce),l(U,null,{default:c(()=>{var a;return[l(z,{flat:"",round:"",dense:"",icon:p(an),onClick:n},{default:c(()=>[l(Mt,{delay:0,anchor:"bottom middle",self:"top middle","transition-duration":"0"},{default:c(()=>[D(" Copy to clipboard ")]),_:1})]),_:1},8,["icon"]),d("span",null,B((a=p(e).keypair)==null?void 0:a.publicKey),1)]}),_:1}),l(ce),l(sn,{align:"right"},{default:c(()=>[d("div",fs,[l(z,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:p(e).generateKey},{default:c(()=>[D(" Regenerate ")]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1}))}});const bs=R(ys,[["__scopeId","data-v-4f30d8b8"]]),_s="0.0.8",vs="messenger",ws=[{name:"initChannel",accounts:[{name:"channel",isMut:!0,isSigner:!0},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"InitChannelData"}}]},{name:"deleteChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"joinChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"JoinChannelData"}}]},{name:"leaveChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"grantAccessMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"GrantAccessMemberData"}}]},{name:"addMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"invitee",isMut:!1,isSigner:!1},{name:"inviteeMembership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AddMemberData"}}]},{name:"authorizeMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AuthorizeMemberData"}}]},{name:"deleteMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"postMessage",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!1,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"message",type:"string"}]}],Ms=[{name:"Channel",type:{kind:"struct",fields:[{name:"name",docs:["Name of the channel"],type:"string"},{name:"creator",docs:["Channel creator"],type:"publicKey"},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"flags",docs:["Channel flags"],type:"u8"},{name:"memberCount",docs:["Number of members"],type:"u16"},{name:"messageCount",docs:["Message counter"],type:"u32"},{name:"maxMessages",docs:["The maximum number of messages that are stored in [messages]"],type:"u16"},{name:"messages",docs:["List of messages"],type:{vec:{defined:"Message"}}}]}},{name:"ChannelMembership",type:{kind:"struct",fields:[{name:"channel",docs:["Associated [Channel] address"],type:"publicKey"},{name:"authority",docs:["Authority of membership"],type:"publicKey"},{name:"key",docs:["The device key used to encrypt the `CEK`"],type:"publicKey"},{name:"cek",docs:["The content encryption key (CEK) of the channel"],type:{defined:"CEKData"}},{name:"status",docs:["Status of membership"],type:{defined:"ChannelMembershipStatus"}},{name:"name",docs:["Name of the channel member"],type:"string"},{name:"invitedBy",docs:["Inviter address"],type:{option:"publicKey"}},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"flags",docs:["Membership flags"],type:"u8"},{name:"bump",docs:["Bump seed for deriving PDA seeds"],type:"u8"}]}}],Cs=[{name:"AddMemberData",type:{kind:"struct",fields:[{name:"name",docs:["Member name"],type:"string"},{name:"flags",docs:["Membership flags, only `admin` and `owner` can set membership flags"],type:"u8"},{name:"cek",docs:["Content Encryption Key"],type:{defined:"CEKData"}},{name:"key",docs:["Device key"],type:{option:"publicKey"}}]}},{name:"AuthorizeMemberData",type:{kind:"struct",fields:[{name:"cek",type:{defined:"CEKData"}}]}},{name:"GrantAccessMemberData",type:{kind:"struct",fields:[{name:"flags",type:"u8"}]}},{name:"InitChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"maxMessages",type:"u16"},{name:"memberName",type:"string"},{name:"cek",type:{defined:"CEKData"}},{name:"public",type:"bool"},{name:"permissionless",type:"bool"}]}},{name:"JoinChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"authority",type:{option:"publicKey"}}]}},{name:"CEKData",type:{kind:"struct",fields:[{name:"header",docs:["The header information for the CEK"],type:"string"},{name:"encryptedKey",docs:["The CEK itself"],type:"string"}]}},{name:"Message",type:{kind:"struct",fields:[{name:"id",docs:["Uniq message id"],type:"u32"},{name:"sender",docs:["The message sender id"],type:"publicKey"},{name:"createdAt",docs:["The unix timestamp at which the message was received"],type:"i64"},{name:"flags",docs:["Message flags"],type:"u8"},{name:"content",docs:["The (typically encrypted) message content"],type:"string"}]}},{name:"ChannelMembershipStatus",type:{kind:"enum",variants:[{name:"Authorized",fields:[{name:"by",type:{option:"publicKey"}}]},{name:"Pending",fields:[{name:"authority",type:{option:"publicKey"}}]}]}}],As=[{name:"NewChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"NewMessageEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"message",type:{defined:"Message"},index:!1}]},{name:"JoinChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"LeaveChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"authority",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AddMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"AuthorizeMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]}],Ss=[{code:6e3,name:"Unauthorized",msg:"Unauthorized"},{code:6001,name:"InvalidChannel",msg:"Invalid channel"},{code:6002,name:"InvalidMembership",msg:"Invalid membership"},{code:6003,name:"InvalidMessage",msg:"Invalid message"},{code:6004,name:"NameTooLong",msg:"Name too long"},{code:6005,name:"MessageTooLong",msg:"Message too long"}],ks={address:"6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",origin:"anchor",binaryVersion:"0.25.0",libVersion:"0.25.0"},xs={version:_s,name:vs,instructions:ws,accounts:Ms,types:Cs,events:As,errors:Ss,metadata:ks},Es=new h.FixableBeetArgsStruct([["id",h.u32],["sender",H],["createdAt",h.i64],["flags",h.u8],["content",h.utf8String]],"Message"),rt=[49,159,99,106,220,87,219,88];class q{constructor(e,n,i,s,a,r,o,u){this.name=e,this.creator=n,this.createdAt=i,this.flags=s,this.memberCount=a,this.messageCount=r,this.maxMessages=o,this.messages=u}static fromArgs(e){return new q(e.name,e.creator,e.createdAt,e.flags,e.memberCount,e.messageCount,e.maxMessages,e.messages)}static fromAccountInfo(e,n=0){return q.deserialize(e.data,n)}static async fromAccountAddress(e,n,i){const s=await e.getAccountInfo(n,i);if(s==null)throw new Error(`Unable to find Channel account at ${n}`);return q.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return Ct.fromStruct(e,Pe)}static deserialize(e,n=0){return Pe.deserialize(e,n)}serialize(){return Pe.serialize({accountDiscriminator:rt,...this})}static byteSize(e){const n=q.fromArgs(e);return Pe.toFixedFromValue({accountDiscriminator:rt,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,i){return n.getMinimumBalanceForRentExemption(q.byteSize(e),i)}pretty(){return{name:this.name,creator:this.creator.toBase58(),createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,memberCount:this.memberCount,messageCount:this.messageCount,maxMessages:this.maxMessages,messages:this.messages}}}const Pe=new h.FixableBeetStruct([["accountDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["name",h.utf8String],["creator",H],["createdAt",h.i64],["flags",h.u8],["memberCount",h.u16],["messageCount",h.u32],["maxMessages",h.u16],["messages",h.array(Es)]],q.fromArgs,"Channel"),je=new h.FixableBeetArgsStruct([["header",h.utf8String],["encryptedKey",h.utf8String]],"CEKData"),$s=h.dataEnum([["Authorized",new h.FixableBeetArgsStruct([["by",h.coption(H)]],'ChannelMembershipStatusRecord["Authorized"]')],["Pending",new h.FixableBeetArgsStruct([["authority",h.coption(H)]],'ChannelMembershipStatusRecord["Pending"]')]]),Te=[238,149,255,251,116,131,86,170];class j{constructor(e,n,i,s,a,r,o,u,m,v){this.channel=e,this.authority=n,this.key=i,this.cek=s,this.status=a,this.name=r,this.invitedBy=o,this.createdAt=u,this.flags=m,this.bump=v}static fromArgs(e){return new j(e.channel,e.authority,e.key,e.cek,e.status,e.name,e.invitedBy,e.createdAt,e.flags,e.bump)}static fromAccountInfo(e,n=0){return j.deserialize(e.data,n)}static async fromAccountAddress(e,n,i){const s=await e.getAccountInfo(n,i);if(s==null)throw new Error(`Unable to find ChannelMembership account at ${n}`);return j.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return Ct.fromStruct(e,Ie)}static deserialize(e,n=0){return Ie.deserialize(e,n)}serialize(){return Ie.serialize({accountDiscriminator:Te,...this})}static byteSize(e){const n=j.fromArgs(e);return Ie.toFixedFromValue({accountDiscriminator:Te,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,i){return n.getMinimumBalanceForRentExemption(j.byteSize(e),i)}pretty(){return{channel:this.channel.toBase58(),authority:this.authority.toBase58(),key:this.key.toBase58(),cek:this.cek,status:this.status.__kind,name:this.name,invitedBy:this.invitedBy,createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,bump:this.bump}}}const Ie=new h.FixableBeetStruct([["accountDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["channel",H],["authority",H],["key",H],["cek",je],["status",$s],["name",h.utf8String],["invitedBy",h.coption(H)],["createdAt",h.i64],["flags",h.u8],["bump",h.u8]],j.fromArgs,"ChannelMembership"),he=new Map,ge=new Map;class Qe extends Error{constructor(){super("Unauthorized");N(this,"code",6e3);N(this,"name","Unauthorized");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Qe)}}he.set(6e3,()=>new Qe);ge.set("Unauthorized",()=>new Qe);class Je extends Error{constructor(){super("Invalid channel");N(this,"code",6001);N(this,"name","InvalidChannel");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Je)}}he.set(6001,()=>new Je);ge.set("InvalidChannel",()=>new Je);class Ge extends Error{constructor(){super("Invalid membership");N(this,"code",6002);N(this,"name","InvalidMembership");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ge)}}he.set(6002,()=>new Ge);ge.set("InvalidMembership",()=>new Ge);class qe extends Error{constructor(){super("Invalid message");N(this,"code",6003);N(this,"name","InvalidMessage");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,qe)}}he.set(6003,()=>new qe);ge.set("InvalidMessage",()=>new qe);class He extends Error{constructor(){super("Name too long");N(this,"code",6004);N(this,"name","NameTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,He)}}he.set(6004,()=>new He);ge.set("NameTooLong",()=>new He);class Xe extends Error{constructor(){super("Message too long");N(this,"code",6005);N(this,"name","MessageTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Xe)}}he.set(6005,()=>new Xe);ge.set("MessageTooLong",()=>new Xe);function se(t){const e=he.get(t);return e!=null?e():null}function ye(t){const e=ge.get(t);return e!=null?e():null}const Ds=new h.FixableBeetArgsStruct([["name",h.utf8String],["flags",h.u8],["cek",je],["key",h.coption(H)]],"AddMemberData"),Ks=new h.FixableBeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["data",Ds]],"AddMemberInstructionArgs"),Ps=[13,116,123,130,126,198,57,34];function Is(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=Ks.serialize({instructionDiscriminator:Ps,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.invitee,isWritable:!1,isSigner:!1},{pubkey:t.inviteeMembership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(r=t.systemProgram)!=null?r:re.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)s.push(o);return new oe({programId:n,keys:s,data:i})}const zs=new h.FixableBeetArgsStruct([["cek",je]],"AuthorizeMemberData"),Ts=new h.FixableBeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["data",zs]],"AuthorizeMemberInstructionArgs"),Bs=[194,123,189,175,86,225,93,128];function Ws(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=Ts.serialize({instructionDiscriminator:Bs,...e}),s=[{pubkey:t.channel,isWritable:!1,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:(r=t.systemProgram)!=null?r:re.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)s.push(o);return new oe({programId:n,keys:s,data:i})}const Ns=new h.BeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)]],"DeleteChannelInstructionArgs"),Ls=[145,225,187,221,157,142,114,133];function Vs(t,e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=Ns.serialize({instructionDiscriminator:Ls}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:re.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new oe({programId:e,keys:i,data:n})}const Rs=new h.BeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)]],"DeleteMemberInstructionArgs"),Os=[95,14,98,112,252,218,205,173];function Fs(t,e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=Rs.serialize({instructionDiscriminator:Os}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:re.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new oe({programId:e,keys:i,data:n})}const Us=new h.BeetArgsStruct([["flags",h.u8]],"GrantAccessMemberData");new h.BeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["data",Us]],"GrantAccessMemberInstructionArgs");const js=new h.FixableBeetArgsStruct([["name",h.utf8String],["maxMessages",h.u16],["memberName",h.utf8String],["cek",je],["public",h.bool],["permissionless",h.bool]],"InitChannelData"),Qs=new h.FixableBeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["data",js]],"InitChannelInstructionArgs"),Js=[21,200,152,39,19,178,76,47];function Gs(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=Qs.serialize({instructionDiscriminator:Js,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!0},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(r=t.systemProgram)!=null?r:re.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)s.push(o);return new oe({programId:n,keys:s,data:i})}const qs=new h.FixableBeetArgsStruct([["name",h.utf8String],["authority",h.coption(H)]],"JoinChannelData"),Hs=new h.FixableBeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["data",qs]],"JoinChannelInstructionArgs"),Xs=[124,39,115,89,217,26,38,29];function Zs(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=Hs.serialize({instructionDiscriminator:Xs,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(r=t.systemProgram)!=null?r:re.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)s.push(o);return new oe({programId:n,keys:s,data:i})}const Ys=new h.BeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)]],"LeaveChannelInstructionArgs"),ei=[104,0,75,134,95,80,68,186];function ti(t,e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=Ys.serialize({instructionDiscriminator:ei}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:re.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new oe({programId:e,keys:i,data:n})}const ni=new h.FixableBeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["message",h.utf8String]],"PostMessageInstructionArgs"),ai=[214,50,100,209,38,34,7,76];function si(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=ni.serialize({instructionDiscriminator:ai,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:(r=t.systemProgram)!=null?r:re.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)s.push(o);return new oe({programId:n,keys:s,data:i})}const ii="6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",ri=new I(ii);function ot(t,e=new Uint8Array(4)){const n=xe(t.toString(),"base10");return e.set(n,4-n.length),e}const tt=t=>ve([ot(t.length),t]);function $t(t,e,n){if(e!==256)throw new Error(`Unsupported key length: ${e}`);const i=ve([tt(xe(n)),tt(new Uint8Array(0)),tt(new Uint8Array(0)),ot(e)]),s=1;return on.hash(ve([ot(s),t,i]))}const lt=t=>xe(t,"base64pad"),ct=t=>At(t,"base64pad"),oi=t=>xe(t),li=t=>At(t),ci=t=>xe(t,"base58btc"),le=Ve.NONCE_LENGTH,Me=Ve.TAG_LENGTH,Dt=t=>{const e=new Ve.XChaCha20Poly1305(t);return(n,i)=>{const s=St.randomBytes(le),a=e.seal(s,n,i);return{ciphertext:a.subarray(0,a.length-Me),tag:a.subarray(a.length-Me),iv:s}}},Kt=t=>{const e=new Ve.XChaCha20Poly1305(t);return(n,i,s,a)=>e.open(s,ve([n,i]),a)},Pt="ECDH-ES+XC20PKW",It=256,ui=t=>e=>{const n=it.generateKeyPair(),i=it.sharedKey(n.secretKey,t),s=$t(i,It,Pt),a=Dt(s)(e);return{encryptedKey:a.ciphertext,tag:a.tag,iv:a.iv,epPubKey:n.publicKey}},di=t=>(e,n,i,s)=>{const a=it.sharedKey(t,s),r=$t(a,It,Pt);return Kt(r)(e,n,i)},mi=t=>Array.isArray(t)?ue.fromSecretKey(un.Buffer.from(t)):typeof t=="string"?ue.fromSecretKey(ci(t)):ue.fromSecretKey(t),pi=async(t=32)=>{const e=St.randomBytes(t);return Promise.resolve(e)},hi=async(t,e)=>{const n=await ui(ln(e.toBytes()))(t);return{header:ct(ve([n.iv,n.tag,n.epPubKey])),encryptedKey:ct(n.encryptedKey)}},gi=async(t,e)=>{const n=lt(t.header),i=n.subarray(0,le),s=n.subarray(le,le+Me),a=n.subarray(le+Me),r=lt(t.encryptedKey),o=mi(e).secretKey,u=cn(o),m=await di(u)(r,s,i,a);if(m===null)throw new Error("There was a problem decrypting the CEK");return m},fi=async(t,e)=>{const n=await Dt(e)(oi(t));return ct(ve([n.iv,n.ciphertext,n.tag]))},yi=async(t,e)=>{const n=lt(t),i=n.subarray(0,le),s=n.subarray(le,-Me),a=n.subarray(-Me),r=await Kt(e)(s,a,i);if(r===null)throw new Error("There was an error decoding the message!");return li(r)};class bi{constructor(e,n){N(this,"programId",ri);N(this,"_coder");N(this,"_events");N(this,"utils",{channel:{isPublic:e=>(e.flags&1)>0,isPermissionless:e=>(e.flags&2)>0},member:{isOwner:e=>e.flags>=255,isAdmin:e=>(e.flags&7)===7,canAddMember:e=>(e.flags&1)>0,canDeleteMember:e=>(e.flags&2)>0,canAuthorizeMember:e=>(e.flags&4)>0},message:{isEncrypted:e=>(e.flags&1)>0}});this.provider=e,this.keypair=n,this._coder=new dn(xs),this._events=new mn(this.programId,e,this._coder)}get connection(){return this.provider.connection}addEventListener(e,n){return this._events.addEventListener(e,n)}async removeEventListener(e){return await this._events.removeEventListener(e)}setKeypair(e){this.keypair=e}async loadAllChannels(){return(await q.gpaBuilder().addFilter("accountDiscriminator",rt).run(this.provider.connection)).map(n=>({pubkey:n.pubkey,data:q.fromAccountInfo(n.account)[0]}))}async loadChannel(e,n){return q.fromAccountAddress(this.provider.connection,e,n)}async loadMyChannels(){return await this.loadMemberships()}async loadChannelMembers(e){return(await j.gpaBuilder().addFilter("accountDiscriminator",Te).addFilter("channel",e).run(this.provider.connection)).map(i=>({pubkey:i.pubkey,data:j.fromAccountInfo(i.account)[0]}))}async loadMemberships(e){const n=j.gpaBuilder().addFilter("accountDiscriminator",Te).addFilter("authority",this.provider.publicKey);return e&&n.addFilter("key",e),(await n.run(this.provider.connection)).map(s=>({pubkey:s.pubkey,data:j.fromAccountInfo(s.account)}))}async loadMembership(e,n){return j.fromAccountAddress(this.provider.connection,e,n)}async getMembershipPDA(e,n){return n=n!=null?n:this.keypair.publicKey,await I.findProgramAddress([e.toBuffer(),n.toBuffer()],this.programId)}async encryptCEK(e,n){return hi(e,n!=null?n:this.keypair.publicKey)}async decryptCEK(e,n){return gi(e,n!=null?n:this.keypair.secretKey)}async encryptMessage(e,n){return fi(e,n)}async decryptMessage(e,n){return yi(e,n)}async initChannel(e){var m,v,$,w,E;const n=(m=e.channel)!=null?m:ue.generate(),i=await pi(),s=await this.encryptCEK(i),[a]=await this.getMembershipPDA(n.publicKey),r=this.provider.publicKey,o=new ae;o.add(Gs({key:this.keypair.publicKey,channel:n.publicKey,membership:a,authority:r},{data:{name:e.name,public:(v=e.public)!=null?v:!1,permissionless:($=e.permissionless)!=null?$:!1,memberName:(w=e.memberName)!=null?w:"",maxMessages:e.maxMessages,cek:s}}));let u;try{u=await this.provider.sendAndConfirm(o,[n,this.keypair],e.opts)}catch(k){throw(E=se(k.code))!=null?E:k}return{signature:u,channel:n,cek:i,cekEncrypted:s}}async deleteChannel({channel:e,opts:n}){var o;const i=this.provider.publicKey,[s]=await this.getMembershipPDA(e),a=new ae;a.add(Vs({channel:e,authority:i,authorityMembership:s}));let r;try{r=await this.provider.sendAndConfirm(a,void 0,n)}catch(u){throw(o=se(u.code))!=null?o:ye("Unauthorized")}return{signature:r}}async joinChannel(e){var r,o;const[n]=await this.getMembershipPDA(e.channel),i=this.provider.publicKey,s=new ae;s.add(Zs({channel:e.channel,key:this.keypair.publicKey,membership:n,authority:i},{data:{name:e.name,authority:(r=e.authority)!=null?r:null}}));let a;try{a=await this.provider.sendAndConfirm(s,[this.keypair],e.opts)}catch(u){throw(o=se(u.code))!=null?o:u}return{signature:a}}async leaveChannel(e){var r;const[n]=await this.getMembershipPDA(e.channel),i=this.provider.publicKey,s=new ae;s.add(ti({channel:e.channel,membership:n,authority:i}));let a;try{a=await this.provider.sendAndConfirm(s)}catch(o){throw(r=se(o.code))!=null?r:o}return{signature:a}}async addMember(e){var v,$,w,E;const n=(v=e.key)!=null?v:e.invitee,[i]=await this.getMembershipPDA(e.channel),[s]=await this.getMembershipPDA(e.channel,n),a=await this.loadMembership(i);if(!a.cek.encryptedKey)throw ye("Unauthorized");const r=await this.decryptCEK(a.cek),o=await this.encryptCEK(r,n),u=new ae;u.add(Is({channel:e.channel,authority:this.provider.publicKey,invitee:e.invitee,authorityMembership:i,inviteeMembership:s},{data:{name:($=e.name)!=null?$:"",flags:(w=e.flags)!=null?w:0,cek:o,key:n}}));let m;try{m=await this.provider.sendAndConfirm(u)}catch(k){throw(E=se(k.code))!=null?E:ye("Unauthorized")}return{signature:m}}async deleteMember(e){var o;const[n]=e.membership?[e.membership]:await this.getMembershipPDA(e.channel,e.key),[i]=await this.getMembershipPDA(e.channel),s=this.provider.publicKey,a=new ae;a.add(Fs({channel:e.channel,membership:n,authority:s,authorityMembership:i}));let r;try{r=await this.provider.sendAndConfirm(a)}catch(u){throw(o=se(u.code))!=null?o:u}return{signature:r}}async authorizeMember(e){var m;const[n]=await this.getMembershipPDA(e.channel),[i]=await this.getMembershipPDA(e.channel,e.key),s=await this.loadMembership(n);if(!s.cek.encryptedKey)throw ye("Unauthorized");const a=await this.decryptCEK(s.cek),r=await this.encryptCEK(a,e.key),o=new ae;o.add(Ws({channel:e.channel,membership:i,authority:this.provider.publicKey,authorityMembership:n},{data:{cek:r}}));let u;try{u=await this.provider.sendAndConfirm(o)}catch(v){throw(m=se(v.code))!=null?m:ye("Unauthorized")}return{signature:u}}async postMessage(e){var o;const[n]=await this.getMembershipPDA(e.channel);let i,s=0;if(e.encrypt){const u=await this.loadMembership(n);if(!u.cek.header)throw ye("Unauthorized");const m=await this.decryptCEK(u.cek);i=await this.encryptMessage(e.message,m),s|=1}else i=e.message;const a=new ae;a.add(si({channel:e.channel,membership:n,authority:this.provider.publicKey},{message:String.fromCharCode(s)+i}));let r;try{r=await this.provider.sendAndConfirm(a)}catch(u){throw(o=se(u.code))!=null?o:u}return{signature:r}}}const bt="***** *** *** *** *******",G=We("messenger",()=>{const t=pt(),e=Et(),n=mt(),i=b(()=>e.keypair),s={allChannels:[],ownChannels:[],channel:void 0,channelAddr:void 0,channelMembershipAddr:void 0,channelMembership:void 0,channelMembers:[],channelMessages:[],channelLoading:!1,loading:!1,creating:!1,sending:!1},a=pe({...s}),r=b(()=>{var f;return new bi(new yt(t.connection,(f=n.value)!=null?f:{publicKey:I.default},yt.defaultOptions()),e.keypair)});let o=[];be(()=>t.cluster,()=>{v().then()},{immediate:!0}),be(n,f=>{f||($(),v().then())},{immediate:!0}),be([i,()=>a.allChannels],()=>{u().then()},{immediate:!0});async function u(){var x;const S=(await r.value.loadMemberships((x=e.keypair)==null?void 0:x.publicKey)).map(V=>({pubkey:V.data[0].channel.toBase58(),status:V.data[0].status.__kind}));Ra.forEach(V=>{S.find(Z=>Z.pubkey===V)||S.push({pubkey:V,status:"Unauthorized"})}),a.ownChannels=S,console.log("myChannels ====== ",a.ownChannels)}async function m(){console.log("Register events...");for(const f of o)await r.value.removeEventListener(f);o.push(r.value.addEventListener("NewMessageEvent",async f=>{if(console.log("[Event] NewMessageEvent",f),`${f.channel}`!=`${a.channelAddr}`)return;let S=f.message.content;if(r.value.utils.message.isEncrypted(f.message)){const V=await W();V?S=await r.value.decryptMessage(f.message.content,V):S=bt}a.channelMessages.push({...f.message,content:S})})),o.push(r.value.addEventListener("AuthorizeMemberEvent",async f=>{console.log("[Event] AuthorizeMemberEvent",f),!(a.channelAddr&&`${f.channel}`!=`${a.channelAddr}`)&&(`${f.membership}`==`${a.channelMembershipAddr}`?C(a.channelAddr).then():Q().then())})),o.push(r.value.addEventListener("JoinChannelEvent",async f=>{console.log("[Event] JoinChannelEvent",f),`${f.channel}`==`${a.channelAddr}`&&Q().then()})),o.push(r.value.addEventListener("LeaveChannelEvent",async f=>{console.log("[Event] LeaveChannelEvent",f),`${f.channel}`==`${a.channelAddr}`&&Q().then()}))}async function v(){$(),o=[],a.loading=!0;const f=await r.value.loadAllChannels();await m(),a.allChannels=f,a.loading=!1,console.log(a)}function $(){Object.assign(a,s)}async function w(f,S){var x,V;try{a.creating=!0;const{channel:Z}=await r.value.initChannel({name:f,maxMessages:(x=S.maxMessages)!=null?x:15,public:S.public,permissionless:S.permissionless,opts:{commitment:(V=S.commitment)!=null?V:"confirmed"}});await C(Z.publicKey),a.channel&&a.allChannels.push({pubkey:Z.publicKey,data:a.channel})}finally{a.creating=!1}}async function E(f){const S=new I(f);await r.value.deleteChannel({channel:S,opts:{commitment:"confirmed"}}),await v()}async function k(f,S){const x=new I(f);await r.value.joinChannel({channel:x,name:S,opts:{commitment:"confirmed"}}),await C(f)}async function C(f){var S;a.channelLoading=!0,a.channelMessages=[],a.channelMembers=[],a.channelMembershipAddr=void 0,a.channelMembership=void 0,a.channelAddr=new I(f);try{if((S=n.value)!=null&&S.publicKey)try{const[x]=await r.value.getMembershipPDA(a.channelAddr);a.channelMembershipAddr=x,a.channelMembership=await r.value.loadMembership(x)}catch(x){console.log(x),a.channelMembershipAddr=void 0,a.channelMembership=void 0}await Q(),await O()}catch(x){console.log("Error",x)}finally{a.channelLoading=!1}}async function W(){if(!!a.channelMembership)try{return await r.value.decryptCEK(a.channelMembership.cek)}catch(f){console.log(f)}}async function O(){if(!a.channelAddr){console.log("Invalid channel");return}a.channel=await r.value.loadChannel(a.channelAddr);const S=r.value.utils.channel.isPublic(a.channel)?null:await W();a.channelMessages=await Promise.all(a.channel.messages.map(async x=>{var Ke;let Z=r.value.utils.message.isEncrypted(x)?bt:x.content,De=Fe(x.sender);if((Ke=n.value)!=null&&Ke.publicKey){const fe=a.channelMembers.find(({data:K})=>K.name!==""&&(`${K.authority}`==`${x.sender}`||`${K.key}`==`${x.sender}`));fe&&fe.data.name!==""&&(De=fe.data.name)}if(S)try{Z=await r.value.decryptMessage(x.content,S)}catch{console.log(`Failed to decrypt message #${x.id}`)}return{...x,senderDisplayName:De,content:Z}}))}async function Q(){if(!a.channelAddr){console.error("Invalid channel");return}a.channelMembers=await r.value.loadChannelMembers(a.channelAddr)}async function P(f){if(!a.channelAddr){console.log("Please select a channel");return}try{a.sending=!0,await r.value.postMessage({channel:a.channelAddr,message:f}),await O()}finally{a.sending=!1}}async function M(f,S,x,V){if(!a.channelAddr){console.log("Invalid channel");return}await r.value.addMember({channel:a.channelAddr,invitee:new I(f),key:S?new I(S):void 0,name:x,flags:V})}async function A(f){if(!a.channelAddr){console.log("Invalid channel");return}await r.value.deleteMember({channel:a.channelAddr,key:new I(f)})}async function y(f){if(!a.channelAddr){console.log("Invalid channel");return}await r.value.authorizeMember({channel:a.channelAddr,key:new I(f)}),await O()}async function ne(){await v()}return{state:a,client:r.value,loadChannel:C,joinChannel:k,createChannel:w,deleteChannel:E,postMessage:P,addMember:M,deleteMember:A,authorizeMember:y,refreshList:ne}}),Ze=We("channel",()=>{const t=mt(),{state:e,client:n}=G(),i=b(()=>{var P;return!!((P=t.value)!=null&&P.publicKey)}),s=b(()=>!!e.channel&&n.utils.channel.isPublic(e.channel)),a=b(()=>!!e.channel&&n.utils.channel.isPermissionless(e.channel)),r=b(()=>{var P;return((P=e.channelMembership)==null?void 0:P.status.__kind)==="Authorized"}),o=b(()=>{var P;return((P=e.channelMembership)==null?void 0:P.status.__kind)==="Pending"}),u=b(()=>{var P,M,A;return String((P=e.channel)==null?void 0:P.creator)===String((A=(M=t.value)==null?void 0:M.publicKey)!=null?A:"-")}),m=b(()=>!!e.channelMembership&&n.utils.member.canAddMember(e.channelMembership)),v=b(()=>!!e.channelMembership&&n.utils.member.canAuthorizeMember(e.channelMembership)),$=b(()=>!!e.channelMembership&&n.utils.member.canDeleteMember(e.channelMembership)),w=b(()=>!!e.channelMembership&&n.utils.member.isAdmin(e.channelMembership)),E=b(()=>!!e.channelMembership&&n.utils.member.isOwner(e.channelMembership)),k=b(()=>i.value&&!!e.channel&&!e.loading&&!r.value),C=b(()=>i.value),W=b(()=>E.value),O=b(()=>E.value),Q=b(()=>!e.sending&&(s.value||r.value));return{isPublicChannel:s,isPermissionlessChannel:a,isAuthorizedMember:r,isPendingMember:o,isChannelCreator:u,isAdmin:w,isOwner:E,canJoinChannel:k,canAddMember:m,canAuthorizeMember:v,canDeleteMember:$,canCreateChannel:C,canDeleteChannel:W,canGrantAccess:O,canPostMessage:Q}}),_i=L({__name:"MemberListDialog",props:{membersDialog:{type:Boolean,default:!1},authorizeMemberState:{type:Object},deleteMemberState:{type:Object},wallet:{type:Object}},emits:["submit","deleteMember"],setup(t,{emit:e}){const{state:n}=G(),{isAuthorizedMember:i,canDeleteMember:s}=Ze();function a(o){return(o==null?void 0:o.name)&&o.name!==""?o.name:Fe(o.authority)}function r(o){return(o==null?void 0:o.__kind)==="Authorized"?"positive":"grey"}return(o,u)=>(g(),_(me,null,{default:c(()=>[l(te,null,{default:c(()=>[l(U,null,{default:c(()=>[l(Ne,{separator:""},{default:c(()=>[(g(!0),T(X,null,_e(p(n).channelMembers,m=>(g(),_(Y,{key:m.pubkey.toString(),"active-class":"bg-teal-1",active:`${m.pubkey}`==`${p(n).channelMembershipAddr}`},{default:c(()=>[l(J,null,{default:c(()=>[l(st,null,{default:c(()=>[D(B(a(m.data))+" ",1),l(pn,{color:r(m.data.status)},{default:c(()=>[D(B(m.data.status.__kind),1)]),_:2},1032,["color"])]),_:2},1024),l(st,{caption:"",lines:"2"},{default:c(()=>[d("div",null,"Authority: "+B(m.data.authority),1),d("div",null,"Key: "+B(m.data.key),1)]),_:2},1024)]),_:2},1024),l(J,{side:"",class:"q-gutter-sm"},{default:c(()=>[m.data.status.__kind==="Pending"&&p(i)&&(!m.data.status.authority||String(m.data.status.authority)===String(t.wallet.publicKey.value))?(g(),_(z,{key:0,color:"teal",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:t.authorizeMemberState.loading,disabled:t.authorizeMemberState.loading,onClick:v=>o.$emit("submit",m.data.key)},{default:c(()=>[D(" Authorize ")]),_:2},1032,["loading","disabled","onClick"])):ie("",!0),p(s)(m.data)?(g(),_(z,{key:1,color:"negative",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:t.deleteMemberState.loading,disabled:t.deleteMemberState.loading,onClick:v=>o.$emit("deleteMember",m.data.key)},{default:c(()=>[D(" Delete ")]),_:2},1032,["loading","disabled","onClick"])):ie("",!0)]),_:2},1024)]),_:2},1032,["active"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}}),vi=t=>(Ce("data-v-9bcdbebf"),t=t(),Ae(),t),wi=vi(()=>d("br",null,null,-1)),Mi=L({__name:"JoinChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=F(t.defaultState);return(i,s)=>(g(),_(me,{class:"join-channel-dialog",onHide:s[3]||(s[3]=a=>i.$emit("reset"))},{default:c(()=>[l(te,null,{default:c(()=>[l(U,null,{default:c(()=>[l(Re,{class:"join-channel-form",onSubmit:s[2]||(s[2]=Oe(a=>i.$emit("submit",n.value),["prevent"]))},{default:c(()=>[l(ee,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.name=a),placeholder:"Member name *","lazy-rules":"",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),l(ee,{modelValue:n.value.authority,"onUpdate:modelValue":s[1]||(s[1]=a=>n.value.authority=a),placeholder:"Authorize By","lazy-rules":"",rules:[a=>!a||a&&a.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),wi,l(z,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[D(" Join Channel ")]),_:1})]),_:1}),l(Ee,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Ci=R(Mi,[["__scopeId","data-v-9bcdbebf"]]),Ai=t=>(Ce("data-v-a5f1d45d"),t=t(),Ae(),t),Si=Ai(()=>d("br",null,null,-1)),ki=L({__name:"AddMemberDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=F(t.defaultState);return(i,s)=>(g(),_(me,{class:"add-member-dialog",onHide:s[4]||(s[4]=a=>i.$emit("reset"))},{default:c(()=>[l(te,null,{default:c(()=>[l(U,null,{default:c(()=>[l(Re,{class:"add-member-form",onSubmit:s[3]||(s[3]=Oe(a=>i.$emit("submit",n.value),["prevent"]))},{default:c(()=>[l(ee,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.name=a),label:"Member name *",hint:"Min length 3 chars","lazy-rules":"",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),l(ee,{modelValue:n.value.key,"onUpdate:modelValue":s[1]||(s[1]=a=>n.value.key=a),label:"Member Wallet *","lazy-rules":"",rules:[a=>a&&a.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),l(ee,{modelValue:n.value.key,"onUpdate:modelValue":s[2]||(s[2]=a=>n.value.key=a),label:"Member Device Key",hint:"Default: The same as member wallet","lazy-rules":"",rules:[a=>!a||a.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),Si,l(z,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[D(" Add Member ")]),_:1})]),_:1}),l(Ee,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const xi=R(ki,[["__scopeId","data-v-a5f1d45d"]]),Ei={class:"row"},$i={class:"col"},Di={class:"col"},Ki=L({__name:"NewChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=F(t.defaultState);return(i,s)=>(g(),_(me,{class:"new-channel-dialog",onHide:s[5]||(s[5]=a=>i.$emit("reset"))},{default:c(()=>[l(te,null,{default:c(()=>[l(U,null,{default:c(()=>[l(Re,{class:"messenger-new-channel-form",onSubmit:s[4]||(s[4]=Oe(a=>i.$emit("submit",n.value),["prevent"]))},{default:c(()=>[l(ee,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.name=a),label:"Channel name *","lazy-rules":"",maxlength:"32",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),l(ee,{modelValue:n.value.maxMessages,"onUpdate:modelValue":s[1]||(s[1]=a=>n.value.maxMessages=a),label:"Max messages","lazy-rules":"",rules:[a=>+a>0||"Invalid value"]},null,8,["modelValue","rules"]),d("div",Ei,[d("div",$i,[l(at,{modelValue:n.value.public,"onUpdate:modelValue":s[2]||(s[2]=a=>n.value.public=a),label:"Public"},null,8,["modelValue"])]),d("div",Di,[n.value.public?ie("",!0):(g(),_(at,{key:0,modelValue:n.value.permissionless,"onUpdate:modelValue":s[3]||(s[3]=a=>n.value.permissionless=a),label:"Permissionless"},null,8,["modelValue"]))])])]),_:1}),l(Ee,{showing:t.loading},null,8,["showing"])]),_:1}),l(ce),l(U,null,{default:c(()=>[l(z,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[D(" Create Channel ")]),_:1})]),_:1})]),_:1})]),_:1}))}});const Pi=R(Ki,[["__scopeId","data-v-236c1e75"]]),Ii=L({__name:"ChannelForm",props:{message:{type:String,default:""},disabled:{type:Boolean,default:!1},sending:{type:Boolean,default:!1}},emits:["submit"],setup(t,{emit:e}){const i=F(t.message),s=()=>{e("submit",i),i.value=""};return(a,r)=>(g(),_(Re,{class:"channel-form",onSubmit:Oe(s,["prevent"])},{default:c(()=>[l(ut,{class:"row message-control"},{default:c(()=>[l(ee,{ref:"inputFocus",modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=o=>i.value=o),class:"col-grow message-input","bg-color":"white",placeholder:"Type a message",dense:"",borderless:"",autofocus:"",disable:t.disabled},null,8,["modelValue","disable"]),l(z,{class:"send-btn",square:"",flat:"",type:"submit",disable:t.disabled,loading:t.sending},{default:c(()=>[D(" Send ")]),_:1},8,["disable","loading"])]),_:1})]),_:1},8,["onSubmit"]))}});const zi=R(Ii,[["__scopeId","data-v-23f62c62"]]),Ti={key:0,class:"row justify-center channel-wrapper"},Bi={key:1,class:"messenger-empty"},Wi={key:1,class:"messenger-empty"},Ni=L({__name:"ChannelWrapper",props:{postMessageState:{type:Object}},emits:["sendMessage"],setup(t,{emit:e}){const n=de(),{state:i}=G();function s(m){const v=n.publicKey.value;return v?String(v)!==String(m):!0}const a=b(()=>{const m=[];let v=0,$;for(const w of i.channelMessages)$&&`${w.sender}`==`${$}`?m[v-1].text.push(w.content):($=w.sender,m.push({id:w.id,sender:w.sender,senderDisplayName:w.senderDisplayName,text:[w.content],date:w.createdAt}),v++);return m}),r=m=>e("sendMessage",m),o=F(),u=F();return be(u,m=>{m&&(o.value.scrollTop=m.scrollHeight)}),(m,v)=>{const $=zi;return g(),_(te,{class:"messenger-card",square:""},{default:c(()=>[d("div",{ref_key:"chat",ref:o,class:"messenger-content"},[p(i).channel?(g(),T("div",Ti,[p(a).length>0?(g(),T("div",{key:0,ref_key:"mes",ref:u,class:"messenger-messages"},[(g(!0),T(X,null,_e(p(a),w=>(g(),_(hn,{key:w.id,name:w.senderDisplayName,text:w.text,sent:s(w.sender)},null,8,["name","text","sent"]))),128))],512)):(g(),T("div",Bi," No messages "))])):(g(),T("div",Wi," Please select a channel "))],512),l($,{message:t.postMessageState.message,sending:m.loading,disabled:!m.allowSend,onSubmit:r},null,8,["message","sending","disabled"]),l(Ee,{showing:m.channelLoadingState},null,8,["showing"])]),_:1})}}});const Li=R(Ni,[["__scopeId","data-v-3a34712d"]]),Vi=L({props:{text:{type:String,default:""}}});function Ri(t,e,n,i,s,a){return g(),_(Mt,{anchor:"top middle",self:"center middle",class:"bg-grey-9 text-body2"},{default:c(()=>[D(B(t.text),1)]),_:1})}const Oi=R(Vi,[["render",Ri]]),Fi="/sol-messenger/assets/refresh.e0cf4262.svg",Ui="/sol-messenger/assets/add.1481b8ed.svg",ji="/sol-messenger/assets/join.627c8616.svg",ht=t=>(Ce("data-v-d176f9d3"),t=t(),Ae(),t),Qi=ht(()=>d("img",{src:Fi,alt:"refresh"},null,-1)),Ji=ht(()=>d("img",{src:Ui,alt:"create"},null,-1)),Gi=ht(()=>d("img",{src:ji,alt:"join"},null,-1)),qi=L({__name:"ChannelControl",props:{isJoining:{type:Boolean,default:!1}},emits:["createChannel","joinChannel","refreshList"],setup(t){const e=Ze(),n=b(()=>e.canJoinChannel),i=b(()=>e.isPendingMember),s=b(()=>e.canCreateChannel);return(a,r)=>{const o=Oi;return g(),_(Y,null,{default:c(()=>[l(J,{class:"button-wrapper"},{default:c(()=>[l(z,{class:"control-button",square:"",onClick:r[0]||(r[0]=u=>a.$emit("refreshList"))},{default:c(()=>[Qi,l(o,{text:"Refresh list"})]),_:1}),p(s)?(g(),_(z,{key:0,class:"control-button",square:"",onClick:r[1]||(r[1]=u=>a.$emit("createChannel"))},{default:c(()=>[Ji,l(o,{text:"Create a channel"})]),_:1})):ie("",!0),p(n)?(g(),_(z,{key:1,class:"control-button",square:"",loading:t.isJoining,disable:p(i),onClick:r[2]||(r[2]=u=>a.$emit("joinChannel"))},{default:c(()=>[Gi,l(o,{text:"Join the channel"})]),_:1},8,["loading","disable"])):ie("",!0)]),_:1})]),_:1})}}});const Hi=R(qi,[["__scopeId","data-v-d176f9d3"]]),Xi={class:"chat-name"},Zi={key:0,class:"message-count"},Yi=L({__name:"MessengerChannel",props:{pubkey:{type:Object,required:!0},channel:{type:Object,required:!0},isActive:Boolean},emits:["select"],setup(t){const e=t,n=b(()=>e.channel.name.slice(0,2));return(i,s)=>(g(),_(Y,{"active-class":"bg-blue-grey-1 text-grey-8",active:t.isActive},{default:c(()=>[l(J,{class:"chat-item cursor-pointer",onClick:s[0]||(s[0]=a=>i.$emit("select"))},{default:c(()=>[d("div",{class:"chat-badge",style:gn(p(Ca)(`${t.pubkey}`))},[d("span",null,B(p(n)),1)],4),d("div",Xi,B(t.channel.name),1),+t.channel.messageCount>0?(g(),T("div",Zi,B(t.channel.messageCount),1)):ie("",!0)]),_:1})]),_:1},8,["active"]))}});const er=R(Yi,[["__scopeId","data-v-1abda3cf"]]),tr={class:"panel-search"},nr={class:"search-wrapper"},ar={class:"panel-info"},sr={class:"chat-info"},ir={class:"chat-members"},rr={class:"chat-messages"},or={class:"chat-name"},lr=L({__name:"MessengerToolbar",emits:["search","showMembers","deleteChannel","addMember","showDeviceKey"],setup(t,{emit:e}){const n=de(),{state:i}=G(),{canAddMember:s,isChannelCreator:a}=Ze(),r=b(()=>!!n.publicKey.value),o=F(""),u=b(()=>i.channel),m=b(()=>{var k,C,W;return((k=u.value)==null?void 0:k.memberCount)===null||((C=u.value)==null?void 0:C.memberCount)===void 0?"":`${(W=u.value)==null?void 0:W.memberCount}\xA0members`}),v=b(()=>{var k,C,W;return((k=u.value)==null?void 0:k.messageCount)===null||((C=u.value)==null?void 0:C.messageCount)===void 0?"":`${(W=u.value)==null?void 0:W.messageCount}\xA0messages`}),$=k=>e("search",k),w=()=>e("showMembers"),E=()=>e("addMember");return be(o,k=>{$(String(k))}),(k,C)=>(g(),_(ut,{class:"panel-toolbar"},{default:c(()=>{var W;return[d("div",tr,[d("div",nr,[l(ee,{modelValue:o.value,"onUpdate:modelValue":C[0]||(C[0]=O=>o.value=O),class:"search-input no-margin q-pa-none",placeholder:"Search ...",clearable:"",debounce:"300",borderless:"",onClear:C[1]||(C[1]=O=>o.value="")},null,8,["modelValue"])])]),d("div",ar,[d("div",sr,[d("div",ir,B(p(m)),1),d("div",rr,B(p(v)),1)]),l(dt,{class:""}),d("div",or,B((W=p(u))==null?void 0:W.name),1),d("div",null,[l(z,{class:"chat-menu",flat:"",unelevated:"",disable:!p(r)},{default:c(()=>[l(fn,{name:p(yn)},null,8,["name"]),l(bn,{anchor:"bottom left",self:"top left"},{default:c(()=>[l(Ne,{style:{"min-width":"150px"},bordered:""},{default:c(()=>[Se((g(),_(Y,{clickable:"",onClick:C[2]||(C[2]=O=>k.$emit("showDeviceKey"))},{default:c(()=>[l(J,null,{default:c(()=>[D("Device key")]),_:1})]),_:1})),[[ke]]),Se((g(),_(Y,{clickable:"",disable:!p(u),onClick:w},{default:c(()=>[l(J,null,{default:c(()=>[D("Members")]),_:1})]),_:1},8,["disable"])),[[ke]]),Se((g(),_(Y,{clickable:"",disable:!p(s),onClick:E},{default:c(()=>[l(J,null,{default:c(()=>[D("Add member")]),_:1})]),_:1},8,["disable"])),[[ke]]),Se((g(),_(Y,{clickable:"",disable:!p(a),onClick:C[3]||(C[3]=O=>k.$emit("deleteChannel"))},{default:c(()=>[l(J,null,{default:c(()=>[D("Delete")]),_:1})]),_:1},8,["disable"])),[[ke]])]),_:1})]),_:1})]),_:1},8,["disable"])])])]}),_:1}))}});const cr=R(lr,[["__scopeId","data-v-17b15bc6"]]),ur=15;function dr(){const{createChannel:t}=G(),{isWalletConnected:e,ok:n,error:i}=$e(),s=pe({dialog:!1,name:"",maxMessages:ur,public:!1,permissionless:!1,loading:!1});async function a(){if(e())try{await t(s.name,{maxMessages:s.maxMessages,public:s.public,permissionless:s.permissionless}),r(),n("Channel was created!")}catch(o){i("Something went wrong"),console.log(o)}}function r(){s.dialog=!1,s.public=!1,s.loading=!1,s.name="",s.maxMessages=15}return{state:s,submit:a,reset:r}}function mr(){const{authorizeMember:t}=G(),{ok:e,error:n}=$e(),i=pe({loading:!1,dialog:!1});async function s(a){try{i.loading=!0,await t(a),e("Member was authorized")}catch(r){n("Something went wrong"),console.log(r)}finally{i.loading=!1}}return{state:i,submit:s}}function pr(){const{state:t,addMember:e}=G(),{ok:n,info:i,error:s}=$e(),a=pe({dialog:!1,loading:!1});async function r(u){if(a.loading=!0,!t.channelAddr){i("Please select a channel");return}try{return await e(u.authority,u.key,u.name),n("Member was added"),!0}catch(m){s("Something went wrong"),console.log(m)}finally{a.loading=!1}return!1}function o(){a.loading=!1,a.dialog=!1}return{state:a,submit:r,reset:o}}function hr(){const{deleteMember:t}=G(),{ok:e,error:n}=$e(),i=pe({loading:!1});async function s(a){try{i.loading=!0,await t(a),e("Member was deleted")}catch(r){n("Something went wrong"),console.log(r)}finally{i.loading=!1}}return{state:i,submit:s}}function gr(){const{state:t,joinChannel:e}=G(),{ok:n,info:i,error:s}=$e(),a=pe({dialog:!1,loading:!1,name:""});async function r(){if(!t.channelAddr){i("Please select a channel");return}a.loading=!0;try{await e(t.channelAddr,a.name),o(),n("Request was sent")}catch(u){console.log("Error",u),s("Something went wrong")}finally{a.loading=!1}}function o(){a.loading=!1,a.dialog=!1,a.name=""}return{state:a,submit:r,reset:o}}function $e(){const t=de(),{notify:e}=Be(),n=r=>e({type:"positive",message:r,timeout:2e3}),i=r=>e({type:"info",message:r,timeout:2e3}),s=r=>e({type:"negative",message:r,timeout:2e3});function a(){return t.publicKey.value?!0:(i("Please connect wallet"),!1)}return{ok:n,info:i,error:s,isWalletConnected:a}}const fr={class:"col col-4"},yr={class:"col"},br={class:"no-margin"},_r=L({__name:"DebugBtn",setup(t){const{state:e}=G(),{isAuthorizedMember:n,isPendingMember:i,isChannelCreator:s}=Ze(),a=F(!1),r=_n(a);return(o,u)=>(g(),T(X,null,[l(z,{flat:"",class:"text-blue-2",onClick:u[0]||(u[0]=m=>p(r)())},{default:c(()=>[D(" Debug info ")]),_:1}),l(me,{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=m=>a.value=m)},{default:c(()=>[(g(!0),T(X,null,_e([["Authorized",p(n)],["Pending Access",p(i)],["Channel Creator",p(s)],["Channel",p(e).channel],["Membership",p(e).channelMembership],["Members",p(e).channelMembers]],m=>(g(),T("div",{key:m[0],class:"row q-mt-md"},[d("div",fr,B(m[0]),1),d("div",yr,[d("pre",br,B(m[1]),1)])]))),128))]),_:1},8,["modelValue"])],64))}}),vr={class:"messenger-wrapper"},wr={class:"messenger-main"},Mr={key:1,class:"messenger-channels-empty"},Cr={key:0,class:"q-my-md q-px-lg"},Ar=L({__name:"Messenger",setup(t){const e=de(),{state:n,postMessage:i,loadChannel:s,refreshList:a}=G(),r=dr(),o=gr(),u=pr(),m=mr(),v=hr(),$=pe({message:""}),w=b(()=>n.allChannels),E=F([]),k=F(""),C=b(()=>n.allChannels.filter(A=>!!n.ownChannels.find(y=>y.pubkey===A.pubkey.toBase58())));async function W(A){await i(A.value),$.message=""}async function O(A){await s(A)}const Q=A=>{if(A===""){E.value=[],k.value="";return}E.value=w.value.filter(y=>y.data.name.toLocaleLowerCase().includes(A.toLocaleLowerCase())||y.pubkey.toBase58().toLocaleLowerCase().includes(A.toLocaleLowerCase())),k.value=A},P=F(!1),M=b(()=>E.value.length>0||k.value.length>0?E.value:C.value);return(A,y)=>{const ne=cr,f=er,S=Hi,x=Li,V=Pi,Z=xi,De=Ci,Ke=_i,fe=bs;return g(),T(X,null,[d("div",vr,[l(ne,{onSearch:Q,onShowMembers:y[0]||(y[0]=K=>p(m).state.dialog=!0),onDeleteChannel:y[1]||(y[1]=K=>p(v).submit(p(n).channelAddr)),onAddMember:y[2]||(y[2]=K=>p(u).state.dialog=!0),onShowDeviceKey:y[3]||(y[3]=K=>P.value=!0)}),d("div",wr,[l(te,{class:"messenger-channels"},{default:c(()=>[p(M).length>0?(g(),_(Ne,{key:0,separator:"",class:"channels-list"},{default:c(()=>[(g(!0),T(X,null,_e(p(M),K=>(g(),_(f,{key:K.name,pubkey:K.pubkey,channel:K.data,"is-active":`${p(n).channelAddr}`==`${K.pubkey}`,onSelect:qr=>O(K.pubkey)},null,8,["pubkey","channel","is-active","onSelect"]))),128))]),_:1})):(g(),T("div",Mr," No channels ")),l(S,{"is-joining":p(o).state.loading,onCreateChannel:y[4]||(y[4]=K=>p(r).state.dialog=!0),onJoinChannel:y[5]||(y[5]=K=>p(o).state.dialog=!0),onRefreshList:p(a)},null,8,["is-joining","onRefreshList"])]),_:1}),l(x,{"post-message-state":$,onSendMessage:W},null,8,["post-message-state"]),l(Ee,{showing:p(n).loading,color:"primary"},null,8,["showing"])])]),l(V,{modelValue:p(r).state.dialog,"onUpdate:modelValue":y[6]||(y[6]=K=>p(r).state.dialog=K),loading:p(r).state.loading,"default-state":p(r).state,onSubmit:p(r).submit,onReset:p(r).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),l(Z,{modelValue:p(u).state.dialog,"onUpdate:modelValue":y[7]||(y[7]=K=>p(u).state.dialog=K),loading:p(u).state.loading,"default-state":p(u).state,onSubmit:p(u).submit,onReset:p(u).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),l(De,{modelValue:p(o).state.dialog,"onUpdate:modelValue":y[8]||(y[8]=K=>p(o).state.dialog=K),loading:p(o).state.loading,"default-state":p(o).state,onSubmit:p(o).submit,onReset:p(o).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),l(Ke,{modelValue:p(m).state.dialog,"onUpdate:modelValue":y[9]||(y[9]=K=>p(m).state.dialog=K),wallet:p(e),"authorize-member-state":p(m).state,"delete-member-state":p(v).state,onSubmit:p(m).submit,onDeleteMember:p(v).submit},null,8,["modelValue","wallet","authorize-member-state","delete-member-state","onSubmit","onDeleteMember"]),l(fe,{modelValue:P.value,"onUpdate:modelValue":y[10]||(y[10]=K=>P.value=K)},null,8,["modelValue"]),p(n).channel?(g(),T("div",Cr,[l(_r)])):ie("",!0)],64)}}});const Sr=R(Ar,[["__scopeId","data-v-9a7f4a6e"]]);const kr={},xr={class:"container"},Er={class:"messenger-container"},$r={class:"container"};function Dr(t,e){const n=Sr,i=ps;return g(),_(vn,{class:"page-wrapper"},{default:c(()=>[d("div",xr,[d("div",Er,[l(n)])]),d("div",$r,[l(i)])]),_:1})}const Kr=R(kr,[["render",Dr],["__scopeId","data-v-8f1b09e0"]]),Pr=()=>wt(()=>import("./_...all_.bcb117f8.js"),["assets/_...all_.bcb117f8.js","assets/vendor.31612765.js","assets/_...all_.73169310.css"]),Ir=[{name:"index",path:"/",component:Kr,props:!0},{name:"all",path:"/:all(.*)*",component:Pr,props:!0,meta:{layout:"empty"}}],zr=as(Ir),Tr="/sol-messenger/",Br=wn({history:Mn(Tr),scrollBehavior:()=>({left:0,top:0}),strict:!0,routes:zr}),Wr=({app:t})=>{t.use(Br)},Nr=Object.freeze(Object.defineProperty({__proto__:null,install:Wr},Symbol.toStringTag,{value:"Module"})),Lr=({app:t})=>{t.use(Cn,{wallets:[new An,new Sn,new kn,new xn,new En,new $n,new Dn,new Kn,new Pn,new In,new zn,new Tn,new Bn,new Wn,new Nn,new Ln,new Vn,new Rn,new On,new Fn,new Un,new jn,new Qn,new Jn,new Gn,new qn,new Hn,new Xn,new Zn,new Yn],autoConnect:!1})},Vr=Object.freeze(Object.defineProperty({__proto__:null,install:Lr},Symbol.toStringTag,{value:"Module"})),Rr=ea();function Or(){return Rr}const Fr=Symbol("WALLET_CONNECT_EVENT"),Ur=Symbol("WALLET_DISCONNECT_EVENT"),jr=Symbol("ACCOUNT_CHANGE_EVENT"),nt=5e3;function Qr(){const{connection:t}=pt(),{emit:e}=Or(),{notify:n}=Be(),{wallet:i}=de();be(i,s=>{if(!s)return;const a=()=>{const u=s.adapter.publicKey;t.onAccountChange(u,m=>{e(jr,m)}),t.onLogs(u,m=>{console.log(m)}),n({message:"Wallet update",caption:`Connected to wallet ${Fe(u.toBase58(),7)}`,timeout:nt}),e(Fr,s)},r=()=>{n({message:"Wallet update",caption:"Disconnected from wallet",timeout:nt}),e(Ur,s)},o=u=>{!(u!=null&&u.message)||n({type:"negative",message:"Wallet update",caption:u.message,timeout:nt})};s.adapter.once("connect",a),s.adapter.once("disconnect",r),s.adapter.removeAllListeners("error"),s.adapter.on("error",o)},{immediate:!0})}const Jr=L({__name:"App",setup(t){return ta(()=>{Qr()}),(e,n)=>{const i=Le("router-view");return g(),_(i)}}});async function Gr(){const t=na(Jr);Object.values(Object.assign({"./plugins/pinia.ts":sa,"./plugins/quasar.ts":ra,"./plugins/router.ts":Nr,"./plugins/wallet.ts":Vr})).forEach(e=>{var n;return(n=e.install)==null?void 0:n.call(e,{app:t})}),t.mount("#app")}Gr().then();export{R as _};
