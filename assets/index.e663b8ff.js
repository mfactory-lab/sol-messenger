var qt=Object.defineProperty;var Jt=(n,e,t)=>e in n?qt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var T=(n,e,t)=>(Jt(n,typeof e!="symbol"?e+"":e,t),t);import{c as Ht,Q as Xt,P as Zt,D as Yt,N as en,a as tn,i as nn,b as x,d as be,u as Pe,e as De,f as z,r as xe,g as ze,o as g,h as E,j as y,k as C,w as l,l as k,t as K,m as ot,n as P,p as o,q as H,s as O,v as Me,x as v,y as an,z as Ee,A as le,B as sn,C as ge,F as Q,E as rn,W as lt,G as yt,H as gt,I as on,J as Ze,K as ln,L as cn,M as Qe,O as oe,R as fe,S as B,T as un,U as ft,V as dn,X as ct,Y as X,Z as ve,_ as bt,$ as ut,a0 as Ge,a1 as mn,a2 as hn,a3 as pn,a4 as _t,a5 as u,a6 as F,a7 as wt,a8 as Z,a9 as Y,aa as _e,ab as vt,ac as ce,ad as yn,ae as Ie,af as At,ag as je,ah as gn,ai as fn,aj as dt,ak as bn,al as _n,am as j,an as ne,ao as mt,ap as St,aq as wn,ar as ye,as as vn,at as An,au as Ae,av as Se,aw as q,ax as Sn,ay as kn,az as Cn,aA as Mn,aB as xn,aC as En,aD as Kn,aE as Pn,aF as Dn,aG as zn,aH as In,aI as Nn,aJ as Tn,aK as Bn,aL as Wn,aM as Rn,aN as $n,aO as Ln,aP as Vn,aQ as Fn,aR as Un,aS as On,aT as Qn,aU as Gn,aV as jn,aW as qn,aX as Jn,aY as Hn,aZ as Xn,a_ as Zn,a$ as Yn,b0 as ea,b1 as ta,b2 as na,b3 as aa,b4 as sa,b5 as ra}from"./vendor.c11a8fd8.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();const ia=({app:n})=>{const e=Ht();n.use(e)},oa=Object.freeze(Object.defineProperty({__proto__:null,install:ia},Symbol.toStringTag,{value:"Module"})),la=({app:n})=>{n.use(Xt,{plugins:{Dark:Zt,Dialog:Yt,Notify:en,LocalStorage:tn},iconSet:nn})},ca=Object.freeze(Object.defineProperty({__proto__:null,install:la},Symbol.toStringTag,{value:"Module"}));function Ne(n,e=4){return n instanceof x&&(n=n.toBase58()),`${n.slice(0,e)}...${n.slice(-e)}`}const ua="/sol-messenger/assets/ledger.40cf6861.svg",da="/sol-messenger/assets/mathwallet.1d763e81.svg",kt=n=>(yt("data-v-0bdf22f0"),n=n(),gt(),n),ma=kt(()=>v("div",{class:"text-h6 text-center"}," Your wallet ",-1)),ha={class:"q-gutter-md row justify-between"},pa=kt(()=>v("div",{class:"text-h6"}," Connect to a wallet ",-1)),ya={class:"text-light-gray text-caption full-width text-no-wrap",style:{"text-overflow":"ellipsis",overflow:"hidden"}},ga=["src"],fa=be({__name:"ConnectWallet",setup(n){const e={solflare:10,phantom:20,sollet:5,nufi:5,blocto:1},t={ledger:ua,mathwallet:da},a={close:rn},s=w=>[lt.Installed,lt.Loadable].includes(w.readyState);Pe();const r=De(),{connected:c,connecting:m}=r,b=z(()=>{var w,A;return(A=(w=r.publicKey.value)==null?void 0:w.toBase58())!=null?A:""}),_=z(()=>Ne(b.value)),N=z(()=>[...r.wallets.value].map(w=>(w.darkIcon=t[w.name.toLowerCase()],w)).sort((w,A)=>{var f,S;const L=(f=e[w.name.toLowerCase()])!=null?f:1;return((S=e[A.name.toLowerCase()])!=null?S:1)-L+((s(A)?1:0)-(s(w)?1:0))})),M=xe(!1);async function I(w){await r.select(w.name),M.value=!1,await r.connect()}function D(){M.value=!1,r.disconnect()}function $(){M.value=!0}function ee(){M.value=!1}return(w,A)=>{const L=ze("copy-to-clipboard");return g(),E(Q,null,[y(c)?(g(),C(P,ot({key:0},w.$attrs,{class:w.$style.btn,ripple:!1,color:"primary-gray","text-color":"white",rounded:"",unelevated:"",onClick:$}),{default:l(()=>[k(K(y(_)),1)]),_:1},16,["class"])):(g(),C(P,ot({key:1},w.$attrs,{color:"primary-gray","text-color":"white",rounded:"",unelevated:"",ripple:!1,loading:y(m),onClick:$}),{default:l(()=>[k(" CONNECT WALLET ")]),_:1},16,["loading"])),o(ge,{modelValue:M.value,"onUpdate:modelValue":A[0]||(A[0]=d=>M.value=d),"transition-duration":"100","transition-show":"fade","transition-hide":"fade"},{default:l(()=>[y(c)?(g(),C(H,{key:0},{default:l(()=>[o(O,{class:"relative-position"},{default:l(()=>[ma,o(P,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:ee},null,8,["icon"])]),_:1}),o(Me),o(O,null,{default:l(()=>[o(L,{text:y(b)},null,8,["text"]),k(" "+K(y(b)),1)]),_:1}),o(Me),o(O,null,{default:l(()=>[v("div",ha,[o(P,{outline:"",rounded:"",onClick:D},{default:l(()=>[k(" Disconnect ")]),_:1}),o(P,{outline:"",rounded:"",onClick:ee},{default:l(()=>[k(" Ok ")]),_:1})])]),_:1})]),_:1})):(g(),C(H,{key:1,class:"wallet-connect-card"},{default:l(()=>[o(O,null,{default:l(()=>[pa,o(P,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:ee},null,8,["icon"])]),_:1}),o(Me),o(O,{style:{"max-height":"80vh"},class:"scroll"},{default:l(()=>[o(an,{grid:"",rows:y(N),"row-key":"name","hide-pagination":"","hide-header":"","rows-per-page-options":[100]},{item:l(({row:d})=>[(g(),E("div",{key:`wallet-${d.name}`,class:"col-12 col-md-6"},[o(Ee,{clickable:"",disable:!s(d),onClick:f=>I(d)},{default:l(()=>[o(le,null,{default:l(()=>[v("b",null,K(d.name),1),v("div",ya,K(d.url),1)]),_:2},1024),o(le,{avatar:""},{default:l(()=>[o(sn,{square:""},{default:l(()=>{var f;return[v("img",{src:w.$q.dark.isActive?d.icon:(f=d.darkIcon)!=null?f:d.icon,alt:""},null,8,ga)]}),_:2},1024)]),_:2},1024)]),_:2},1032,["disable","onClick"])]))]),_:1},8,["rows"])]),_:1})]),_:1}))]),_:1},8,["modelValue"])],64)}}});const ba="_btn_6n1iw_1",_a={btn:ba},Te=(n,e)=>{const t=n.__vccOpts||n;for(const[a,s]of e)t[a]=s;return t},wa={$style:_a},va=Te(fa,[["__cssModules",wa],["__scopeId","data-v-0bdf22f0"]]),ue=[{id:"serum-mainnet",name:"Serum RPC",cluster:"mainnet-beta",url:"https://solana-api.projectserum.com/"},{id:"rpcpool-mainnet",name:"RPCPool RPC",cluster:"mainnet-beta",url:"https://mainnet.rpcpool.com/"},{id:"mainnet",name:"Solana RPC",cluster:"mainnet-beta",url:on("mainnet-beta")}],Ct={id:"devnet",name:"DevNet",cluster:"devnet",url:"https://devnet.rpcpool.com/"};ue.push(Ct);const Aa={id:"testnet",name:"TestNet",cluster:"testnet",url:"https://testnet.rpcpool.com/"};ue.push(Aa);var pt;const Sa=(pt=ue.find(n=>n.id==={VITE_BASE_PATH:"/sol-messenger/",BASE_URL:"/sol-messenger/",MODE:"staging",DEV:!1,PROD:!0}.VITE_CONNECTION_ENDPOINT))!=null?pt:Ct,ka="confirmed",Ca=12e4,Ye=Ze({id:"connection",state:()=>({commitment:ka,confirmTransactionInitialTimeout:Ca,rpc:ln("rpc","")}),getters:{endpoint(n){var e;return(e=ue.find(t=>t.id===n.rpc))!=null?e:Sa},connection(n){return console.log("[connection]",this.endpoint.url),new cn(this.endpoint.url,{confirmTransactionInitialTimeout:n.confirmTransactionInitialTimeout,commitment:n.commitment})},cluster(){return this.endpoint.cluster}},actions:{setRpc(n){this.rpc=n},setCommitment(n){this.commitment=n}}}),Ma=be({__name:"ClusterSelector",setup(n){const e=Ye(),{connected:t,connect:a,disconnect:s,autoConnect:r}=De(),c=[ue.filter(_=>_.cluster==="mainnet-beta"),ue.filter(_=>_.cluster!=="mainnet-beta")],m=z(()=>e.endpoint),b=_=>{t&&e.cluster!==_.cluster&&(s(),r.value&&a()),e.setRpc(_.id)};return(_,N)=>(g(),C(un,{label:y(m).name,"model-value":!1,"auto-close":"",color:"secondary","text-color":"grey-8",rounded:"",unelevated:"",ripple:!1},{default:l(()=>[o(Qe,null,{default:l(()=>[(g(),E(Q,null,oe(c,(M,I)=>(g(),E(Q,{key:`${I}-cluster-group`},[(g(!0),E(Q,null,oe(M,D=>(g(),C(Ee,{key:D.id,clickable:"",onClick:$=>b(D)},{default:l(()=>[(g(),C(le,{key:`${D.id}-item`},{default:l(()=>[o(fe,null,{default:l(()=>[v("b",null,K(D.name),1)]),_:2},1024),k(" "+K(D.url),1)]),_:2},1024))]),_:2},1032,["onClick"]))),128)),I!==c.length-1?(g(),C(Me,{key:0})):B("",!0)],64))),64))]),_:1})]),_:1},8,["label"]))}}),et=Ze("user",()=>{const n=ft(),e=xe();dn(()=>{var s;const a=(s=n.value)==null?void 0:s.publicKey;if(a){const r=ct(a.toString(),()=>ve.encode(X.generate().secretKey));e.value=X.fromSecretKey(ve.decode(r.value))}else e.value=void 0});function t(){var r;const a=(r=n.value)==null?void 0:r.publicKey;if(!a)return;const s=ct(a.toString(),"");s.value=ve.encode(X.generate().secretKey),e.value=X.fromSecretKey(ve.decode(s.value))}return{keypair:e,generateKey:t}}),xa={class:"container"},Ea={class:"app-header__logo"},Ka=v("div",{class:"app-header__nav"},[v("a",{href:"https://jpool.one",target:"_blank"},"JPOOL"),v("a",{href:"https://dev.svt.one",target:"_blank"},"Validator toolkit")],-1),Pa={key:0,class:"user-device"},Da=v("b",null,"Device Key",-1),za={class:"app-header__right"},Ia={class:"app-header__buttons"},Na=be({__name:"AppHeader",setup(n){const e=et(),{dialog:t}=Pe();function a(){t({title:"Confirm",message:"Are you sure?",cancel:!0,persistent:!0}).onOk(()=>{e.generateKey()})}return(s,r)=>{const c=ze("router-link"),m=Ma,b=va;return g(),C(mn,{class:"app-header"},{default:l(()=>[v("div",xa,[o(bt,null,{default:l(()=>[v("div",Ea,[o(c,{to:"/"},{default:l(()=>[k(" SOM ")]),_:1})]),o(ut),Ka,o(ut),y(e).keypair?(g(),E("div",Pa,[v("div",null,[Da,k(" \xA0 "),o(P,{size:"xs",rounded:"",unelevated:"",onClick:a},{default:l(()=>[k(" regenerate ")]),_:1})]),o(Ge,null,{default:l(()=>{var _;return[k(K((_=y(e).keypair)==null?void 0:_.publicKey),1)]}),_:1})])):B("",!0),v("div",za,[v("div",Ia,[o(m,{class:"app-header__cluster-btn"}),o(b,{class:"app-header__wallet-btn"})])])]),_:1})])]),_:1})}}});const Ta={};function Ba(n,e){const t=Na,a=ze("router-view");return g(),C(hn,{view:"lfh Lpr lff"},{default:l(()=>[o(t),o(pn,null,{default:l(()=>[o(a)]),_:1})]),_:1})}const Wa=Te(Ta,[["render",Ba]]),Ra={default:Wa,empty:()=>_t(()=>import("./empty.a96558f4.js"),["assets/empty.a96558f4.js","assets/vendor.c11a8fd8.js"])};function $a(n){return n.map(e=>{var t;return{path:e.path,component:Ra[((t=e.meta)==null?void 0:t.layout)||"default"],children:[{...e,path:""}]}})}const La="0.0.6",Va="messenger",Fa=[{name:"initChannel",accounts:[{name:"channel",isMut:!0,isSigner:!0},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"InitChannelData"}}]},{name:"deleteChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"joinChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"JoinChannelData"}}]},{name:"leaveChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"addMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"invitee",isMut:!1,isSigner:!1},{name:"inviteeMembership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AddMemberData"}}]},{name:"authorizeMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AuthorizeMemberData"}}]},{name:"deleteMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"postMessage",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!1,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"message",type:"string"}]}],Ua=[{name:"Channel",type:{kind:"struct",fields:[{name:"name",docs:["Name of the channel"],type:"string"},{name:"creator",docs:["Channel creator"],type:"publicKey"},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"memberCount",docs:["Number of members"],type:"u16"},{name:"messageCount",docs:["Message counter"],type:"u32"},{name:"maxMessages",docs:["The maximum number of messages that are stored in [messages]"],type:"u16"},{name:"messages",docs:["List of messages"],type:{vec:{defined:"Message"}}}]}},{name:"ChannelMembership",type:{kind:"struct",fields:[{name:"channel",docs:["Associated [Channel] address"],type:"publicKey"},{name:"authority",docs:["Authority of membership"],type:"publicKey"},{name:"key",docs:["The device key used to encrypt the `CEK`"],type:"publicKey"},{name:"cek",docs:["The content encryption key (CEK) of the channel"],type:{defined:"CEKData"}},{name:"status",docs:["Status of membership"],type:{defined:"ChannelMembershipStatus"}},{name:"name",docs:["Name of the channel member"],type:"string"},{name:"invitedBy",docs:["Inviter address"],type:{option:"publicKey"}},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"bump",docs:["Bump seed for deriving PDA seeds"],type:"u8"}]}}],Oa=[{name:"AddMemberData",type:{kind:"struct",fields:[{name:"name",docs:["Member name"],type:"string"},{name:"cek",docs:["Content Encryption Key"],type:{defined:"CEKData"}},{name:"key",docs:["Device key"],type:{option:"publicKey"}}]}},{name:"AuthorizeMemberData",type:{kind:"struct",fields:[{name:"cek",type:{defined:"CEKData"}}]}},{name:"InitChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"maxMessages",type:"u16"},{name:"memberName",type:"string"},{name:"cek",type:{defined:"CEKData"}}]}},{name:"JoinChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"authority",type:{option:"publicKey"}}]}},{name:"CEKData",type:{kind:"struct",fields:[{name:"header",docs:["The header information for the CEK"],type:"string"},{name:"encryptedKey",docs:["The CEK itself"],type:"string"}]}},{name:"Message",type:{kind:"struct",fields:[{name:"id",docs:["Uniq message id"],type:"u32"},{name:"sender",docs:["The message sender id"],type:"publicKey"},{name:"createdAt",docs:["The unix timestamp at which the message was received"],type:"i64"},{name:"content",docs:["The (typically encrypted) message content"],type:"string"}]}},{name:"ChannelMembershipStatus",type:{kind:"enum",variants:[{name:"Authorized",fields:[{name:"by",type:{option:"publicKey"}}]},{name:"Pending",fields:[{name:"authority",type:{option:"publicKey"}}]}]}}],Qa=[{name:"NewChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"NewMessageEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"message",type:{defined:"Message"},index:!1}]},{name:"JoinChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"LeaveChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"authority",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AddMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AuthorizeMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]}],Ga=[{code:6e3,name:"Unauthorized",msg:"Unauthorized"},{code:6001,name:"NameTooLong",msg:"Name too long"},{code:6002,name:"MessageTooLong",msg:"Message too long"},{code:6003,name:"AlreadyInUse",msg:"Already in use"},{code:6004,name:"UninitializedAccount",msg:"Uninitialized account"}],ja={address:"6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",origin:"anchor",binaryVersion:"0.25.0",libVersion:"0.25.0"},qa={version:La,name:Va,instructions:Fa,accounts:Ua,types:Oa,events:Qa,errors:Ga,metadata:ja},Ja=new u.FixableBeetArgsStruct([["id",u.u32],["sender",F],["createdAt",u.i64],["content",u.utf8String]],"Message"),qe=[49,159,99,106,220,87,219,88];class V{constructor(e,t,a,s,r,c,m){this.name=e,this.creator=t,this.createdAt=a,this.memberCount=s,this.messageCount=r,this.maxMessages=c,this.messages=m}static fromArgs(e){return new V(e.name,e.creator,e.createdAt,e.memberCount,e.messageCount,e.maxMessages,e.messages)}static fromAccountInfo(e,t=0){return V.deserialize(e.data,t)}static async fromAccountAddress(e,t,a){const s=await e.getAccountInfo(t,a);if(s==null)throw new Error(`Unable to find Channel account at ${t}`);return V.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return wt.fromStruct(e,ke)}static deserialize(e,t=0){return ke.deserialize(e,t)}serialize(){return ke.serialize({accountDiscriminator:qe,...this})}static byteSize(e){const t=V.fromArgs(e);return ke.toFixedFromValue({accountDiscriminator:qe,...t}).byteSize}static async getMinimumBalanceForRentExemption(e,t,a){return t.getMinimumBalanceForRentExemption(V.byteSize(e),a)}pretty(){return{name:this.name,creator:this.creator.toBase58(),createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),memberCount:this.memberCount,messageCount:this.messageCount,maxMessages:this.maxMessages,messages:this.messages}}}const ke=new u.FixableBeetStruct([["accountDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["name",u.utf8String],["creator",F],["createdAt",u.i64],["memberCount",u.u16],["messageCount",u.u32],["maxMessages",u.u16],["messages",u.array(Ja)]],V.fromArgs,"Channel"),Be=new u.FixableBeetArgsStruct([["header",u.utf8String],["encryptedKey",u.utf8String]],"CEKData"),Ha=n=>n.__kind==="Pending",Xa=u.dataEnum([["Authorized",new u.FixableBeetArgsStruct([["by",u.coption(F)]],'ChannelMembershipStatusRecord["Authorized"]')],["Pending",new u.FixableBeetArgsStruct([["authority",u.coption(F)]],'ChannelMembershipStatusRecord["Pending"]')]]),Ke=[238,149,255,251,116,131,86,170];class W{constructor(e,t,a,s,r,c,m,b,_){this.channel=e,this.authority=t,this.key=a,this.cek=s,this.status=r,this.name=c,this.invitedBy=m,this.createdAt=b,this.bump=_}static fromArgs(e){return new W(e.channel,e.authority,e.key,e.cek,e.status,e.name,e.invitedBy,e.createdAt,e.bump)}static fromAccountInfo(e,t=0){return W.deserialize(e.data,t)}static async fromAccountAddress(e,t,a){const s=await e.getAccountInfo(t,a);if(s==null)throw new Error(`Unable to find ChannelMembership account at ${t}`);return W.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return wt.fromStruct(e,Ce)}static deserialize(e,t=0){return Ce.deserialize(e,t)}serialize(){return Ce.serialize({accountDiscriminator:Ke,...this})}static byteSize(e){const t=W.fromArgs(e);return Ce.toFixedFromValue({accountDiscriminator:Ke,...t}).byteSize}static async getMinimumBalanceForRentExemption(e,t,a){return t.getMinimumBalanceForRentExemption(W.byteSize(e),a)}pretty(){return{channel:this.channel.toBase58(),authority:this.authority.toBase58(),key:this.key.toBase58(),cek:this.cek,status:this.status.__kind,name:this.name,invitedBy:this.invitedBy,createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),bump:this.bump}}}const Ce=new u.FixableBeetStruct([["accountDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["channel",F],["authority",F],["key",F],["cek",Be],["status",Xa],["name",u.utf8String],["invitedBy",u.coption(F)],["createdAt",u.i64],["bump",u.u8]],W.fromArgs,"ChannelMembership"),me=new Map,he=new Map;class We extends Error{constructor(){super("Unauthorized");T(this,"code",6e3);T(this,"name","Unauthorized");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,We)}}me.set(6e3,()=>new We);he.set("Unauthorized",()=>new We);class Re extends Error{constructor(){super("Name too long");T(this,"code",6001);T(this,"name","NameTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Re)}}me.set(6001,()=>new Re);he.set("NameTooLong",()=>new Re);class $e extends Error{constructor(){super("Message too long");T(this,"code",6002);T(this,"name","MessageTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,$e)}}me.set(6002,()=>new $e);he.set("MessageTooLong",()=>new $e);class Le extends Error{constructor(){super("Already in use");T(this,"code",6003);T(this,"name","AlreadyInUse");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Le)}}me.set(6003,()=>new Le);he.set("AlreadyInUse",()=>new Le);class Ve extends Error{constructor(){super("Uninitialized account");T(this,"code",6004);T(this,"name","UninitializedAccount");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ve)}}me.set(6004,()=>new Ve);he.set("UninitializedAccount",()=>new Ve);function J(n){const e=me.get(n);return e!=null?e():null}function ie(n){const e=he.get(n);return e!=null?e():null}const Za=new u.FixableBeetArgsStruct([["name",u.utf8String],["cek",Be],["key",u.coption(F)]],"AddMemberData"),Ya=new u.FixableBeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["data",Za]],"AddMemberInstructionArgs"),es=[13,116,123,130,126,198,57,34];function ts(n,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[a]=Ya.serialize({instructionDiscriminator:es,...e}),s=[{pubkey:n.channel,isWritable:!0,isSigner:!1},{pubkey:n.invitee,isWritable:!1,isSigner:!1},{pubkey:n.inviteeMembership,isWritable:!0,isSigner:!1},{pubkey:n.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:n.authority,isWritable:!0,isSigner:!0},{pubkey:(c=n.systemProgram)!=null?c:Z.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const m of n.anchorRemainingAccounts)s.push(m);return new Y({programId:t,keys:s,data:a})}const ns=new u.FixableBeetArgsStruct([["cek",Be]],"AuthorizeMemberData"),as=new u.FixableBeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["data",ns]],"AuthorizeMemberInstructionArgs"),ss=[194,123,189,175,86,225,93,128];function rs(n,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[a]=as.serialize({instructionDiscriminator:ss,...e}),s=[{pubkey:n.channel,isWritable:!1,isSigner:!1},{pubkey:n.membership,isWritable:!0,isSigner:!1},{pubkey:n.authority,isWritable:!1,isSigner:!0},{pubkey:n.authorityMembership,isWritable:!1,isSigner:!1},{pubkey:(c=n.systemProgram)!=null?c:Z.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const m of n.anchorRemainingAccounts)s.push(m);return new Y({programId:t,keys:s,data:a})}const is=new u.BeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)]],"DeleteChannelInstructionArgs"),os=[145,225,187,221,157,142,114,133];function ls(n,e=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[t]=is.serialize({instructionDiscriminator:os}),a=[{pubkey:n.channel,isWritable:!0,isSigner:!1},{pubkey:n.authority,isWritable:!0,isSigner:!0},{pubkey:(r=n.systemProgram)!=null?r:Z.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const c of n.anchorRemainingAccounts)a.push(c);return new Y({programId:e,keys:a,data:t})}const cs=new u.BeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)]],"DeleteMemberInstructionArgs"),us=[95,14,98,112,252,218,205,173];function ds(n,e=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[t]=cs.serialize({instructionDiscriminator:us}),a=[{pubkey:n.channel,isWritable:!0,isSigner:!1},{pubkey:n.membership,isWritable:!0,isSigner:!1},{pubkey:n.authority,isWritable:!0,isSigner:!0},{pubkey:(r=n.systemProgram)!=null?r:Z.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const c of n.anchorRemainingAccounts)a.push(c);return new Y({programId:e,keys:a,data:t})}const ms=new u.FixableBeetArgsStruct([["name",u.utf8String],["maxMessages",u.u16],["memberName",u.utf8String],["cek",Be]],"InitChannelData"),hs=new u.FixableBeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["data",ms]],"InitChannelInstructionArgs"),ps=[21,200,152,39,19,178,76,47];function ys(n,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[a]=hs.serialize({instructionDiscriminator:ps,...e}),s=[{pubkey:n.channel,isWritable:!0,isSigner:!0},{pubkey:n.membership,isWritable:!0,isSigner:!1},{pubkey:n.authority,isWritable:!0,isSigner:!0},{pubkey:n.key,isWritable:!1,isSigner:!0},{pubkey:(c=n.systemProgram)!=null?c:Z.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const m of n.anchorRemainingAccounts)s.push(m);return new Y({programId:t,keys:s,data:a})}const gs=new u.FixableBeetArgsStruct([["name",u.utf8String],["authority",u.coption(F)]],"JoinChannelData"),fs=new u.FixableBeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["data",gs]],"JoinChannelInstructionArgs"),bs=[124,39,115,89,217,26,38,29];function _s(n,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[a]=fs.serialize({instructionDiscriminator:bs,...e}),s=[{pubkey:n.channel,isWritable:!0,isSigner:!1},{pubkey:n.membership,isWritable:!0,isSigner:!1},{pubkey:n.authority,isWritable:!0,isSigner:!0},{pubkey:n.key,isWritable:!1,isSigner:!0},{pubkey:(c=n.systemProgram)!=null?c:Z.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const m of n.anchorRemainingAccounts)s.push(m);return new Y({programId:t,keys:s,data:a})}const ws=new u.BeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)]],"LeaveChannelInstructionArgs"),vs=[104,0,75,134,95,80,68,186];function As(n,e=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[t]=ws.serialize({instructionDiscriminator:vs}),a=[{pubkey:n.channel,isWritable:!0,isSigner:!1},{pubkey:n.membership,isWritable:!0,isSigner:!1},{pubkey:n.authority,isWritable:!0,isSigner:!0},{pubkey:(r=n.systemProgram)!=null?r:Z.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const c of n.anchorRemainingAccounts)a.push(c);return new Y({programId:e,keys:a,data:t})}const Ss=new u.FixableBeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["message",u.utf8String]],"PostMessageInstructionArgs"),ks=[214,50,100,209,38,34,7,76];function Cs(n,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[a]=Ss.serialize({instructionDiscriminator:ks,...e}),s=[{pubkey:n.channel,isWritable:!0,isSigner:!1},{pubkey:n.membership,isWritable:!1,isSigner:!1},{pubkey:n.authority,isWritable:!1,isSigner:!0},{pubkey:(c=n.systemProgram)!=null?c:Z.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const m of n.anchorRemainingAccounts)s.push(m);return new Y({programId:t,keys:s,data:a})}const Ms="6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",xs=new x(Ms);function Je(n,e=new Uint8Array(4)){const t=_e(n.toString(),"base10");return e.set(t,4-t.length),e}const Ue=n=>ce([Je(n.length),n]);function Mt(n,e,t){if(e!==256)throw new Error(`Unsupported key length: ${e}`);const a=ce([Ue(_e(t)),Ue(new Uint8Array(0)),Ue(new Uint8Array(0)),Je(e)]),s=1;return yn.hash(ce([Je(s),n,a]))}const He=n=>_e(n,"base64pad"),Xe=n=>vt(n,"base64pad"),Es=n=>_e(n),Ks=n=>vt(n),Ps=n=>_e(n,"base58btc"),ae=Ie.NONCE_LENGTH,de=Ie.TAG_LENGTH,xt=n=>{const e=new Ie.XChaCha20Poly1305(n);return(t,a)=>{const s=At.randomBytes(ae),r=e.seal(s,t,a);return{ciphertext:r.subarray(0,r.length-de),tag:r.subarray(r.length-de),iv:s}}},Et=n=>{const e=new Ie.XChaCha20Poly1305(n);return(t,a,s,r)=>e.open(s,ce([t,a]),r)},Kt="ECDH-ES+XC20PKW",Pt=256,Ds=n=>e=>{const t=je.generateKeyPair(),a=je.sharedKey(t.secretKey,n),s=Mt(a,Pt,Kt),r=xt(s)(e);return{encryptedKey:r.ciphertext,tag:r.tag,iv:r.iv,epPubKey:t.publicKey}},zs=n=>(e,t,a,s)=>{const r=je.sharedKey(n,s),c=Mt(r,Pt,Kt);return Et(c)(e,t,a)},Is=n=>{if(Array.isArray(n))return X.fromSecretKey(dt.Buffer.from(n));if(typeof n=="string")return X.fromSecretKey(Ps(n));if(n instanceof dt.Buffer||n instanceof Uint8Array)return X.fromSecretKey(n);throw new Error("Incompatible private key format")},Ns=async(n=32)=>{const e=At.randomBytes(n);return Promise.resolve(e)},Ts=async(n,e)=>{const t=await Ds(gn(e.toBytes()))(n);return{header:Xe(ce([t.iv,t.tag,t.epPubKey])),encryptedKey:Xe(t.encryptedKey)}},Bs=async(n,e)=>{const t=He(n.header),a=t.subarray(0,ae),s=t.subarray(ae,ae+de),r=t.subarray(ae+de),c=He(n.encryptedKey),m=Is(e).secretKey,b=fn(m),_=await zs(b)(c,s,a,r);if(_===null)throw new Error("There was a problem decrypting the CEK");return _},Ws=async(n,e)=>{const t=await xt(e)(Es(n));return Xe(ce([t.iv,t.ciphertext,t.tag]))},Rs=async(n,e)=>{const t=He(n),a=t.subarray(0,ae),s=t.subarray(ae,-de),r=t.subarray(-de),c=await Et(e)(s,r,a);if(c===null)throw new Error("There was an error decoding the message!");return Ks(c)};class $s{constructor(e,t){T(this,"programId",xs);T(this,"_coder");T(this,"_events");this.provider=e,this.keypair=t,this._coder=new bn(qa),this._events=new _n(this.programId,e,this._coder)}get connection(){return this.provider.connection}addEventListener(e,t){return this._events.addEventListener(e,t)}async removeEventListener(e){return await this._events.removeEventListener(e)}setKeypair(e){this.keypair=e}async loadAllChannels(){return(await V.gpaBuilder().addFilter("accountDiscriminator",qe).run(this.provider.connection)).map(t=>({pubkey:t.pubkey,data:V.fromAccountInfo(t.account)[0]}))}async loadChannel(e,t){return V.fromAccountAddress(this.provider.connection,e,t)}async loadMyChannels(){const e=await this.loadMemberships();return console.log(e),[]}async loadChannelMembers(e){return(await W.gpaBuilder().addFilter("accountDiscriminator",Ke).addFilter("channel",e).run(this.provider.connection)).map(a=>({pubkey:a.pubkey,data:W.fromAccountInfo(a.account)[0]}))}async loadMemberships(e){const t=W.gpaBuilder().addFilter("accountDiscriminator",Ke).addFilter("authority",this.provider.publicKey);return e&&t.addFilter("key",e!=null?e:null),(await t.run(this.provider.connection)).map(s=>({pubkey:s.pubkey,data:W.fromAccountInfo(s.account)}))}async loadMembership(e,t){return W.fromAccountAddress(this.provider.connection,e,t)}async getMembershipPDA(e,t){return t=t!=null?t:this.keypair.publicKey,await x.findProgramAddress([e.toBuffer(),t.toBuffer()],this.programId)}async encryptCEK(e,t){return Ts(e,t!=null?t:this.keypair.publicKey)}async decryptCEK(e,t){return Bs(e,t!=null?t:this.keypair.secretKey)}async encryptMessage(e,t){return Ws(e,t)}async decryptMessage(e,t){return Rs(e,t)}async initChannel(e){var _,N,M;const t=(_=e.channel)!=null?_:X.generate(),a=await Ns(),s=await this.encryptCEK(a),[r]=await this.getMembershipPDA(t.publicKey),c=this.provider.publicKey,m=new j;m.add(ys({key:this.keypair.publicKey,channel:t.publicKey,membership:r,authority:c},{data:{name:e.name,memberName:(N=e.memberName)!=null?N:"",maxMessages:e.maxMessages,cek:s}}));let b;try{b=await this.provider.sendAndConfirm(m,[t,this.keypair],e.opts)}catch(I){throw(M=J(I.code))!=null?M:I}return{signature:b,channel:t,cek:a,cekEncrypted:s}}async deleteChannel({channel:e,opts:t}){var c;const a=new j,s=this.provider.publicKey;a.add(ls({channel:e,authority:s}));let r;try{r=await this.provider.sendAndConfirm(a,void 0,t)}catch(m){throw(c=J(m.code))!=null?c:ie("Unauthorized")}return{signature:r}}async joinChannel(e){var c,m;const[t]=await this.getMembershipPDA(e.channel),a=this.provider.publicKey,s=new j;s.add(_s({channel:e.channel,key:this.keypair.publicKey,membership:t,authority:a},{data:{name:e.name,authority:(c=e.authority)!=null?c:null}}));let r;try{r=await this.provider.sendAndConfirm(s,[this.keypair],e.opts)}catch(b){throw(m=J(b.code))!=null?m:b}return{signature:r}}async leaveChannel(e){var c;const[t]=await this.getMembershipPDA(e.channel),a=this.provider.publicKey,s=new j;s.add(As({channel:e.channel,membership:t,authority:a}));let r;try{r=await this.provider.sendAndConfirm(s,[this.keypair])}catch(m){throw(c=J(m.code))!=null?c:m}return{signature:r}}async addMember(e){var N,M,I;const t=(N=e.key)!=null?N:e.invitee,[a]=await this.getMembershipPDA(e.channel),[s]=await this.getMembershipPDA(e.channel,t),r=await this.loadMembership(a);if(!r.cek.encryptedKey)throw ie("Unauthorized");const c=await this.decryptCEK(r.cek),m=await this.encryptCEK(c,t),b=new j;b.add(ts({channel:e.channel,authority:this.provider.publicKey,invitee:e.invitee,authorityMembership:a,inviteeMembership:s},{data:{name:(M=e.name)!=null?M:"",cek:m,key:t}}));let _;try{_=await this.provider.sendAndConfirm(b)}catch(D){throw(I=J(D.code))!=null?I:ie("Unauthorized")}return{signature:_}}async deleteMember(e){var c;const[t]=e.membership?[e.membership]:await this.getMembershipPDA(e.channel,e.key),a=this.provider.publicKey,s=new j;s.add(ds({channel:e.channel,membership:t,authority:a}));let r;try{r=await this.provider.sendAndConfirm(s)}catch(m){throw(c=J(m.code))!=null?c:m}return{signature:r}}async authorizeMember(e){var _;const[t]=await this.getMembershipPDA(e.channel),[a]=await this.getMembershipPDA(e.channel,e.key),s=await this.loadMembership(t);if(!s.cek.encryptedKey)throw ie("Unauthorized");const r=await this.decryptCEK(s.cek),c=await this.encryptCEK(r,e.key),m=new j;m.add(rs({channel:e.channel,membership:a,authority:this.provider.publicKey,authorityMembership:t},{data:{cek:c}}));let b;try{b=await this.provider.sendAndConfirm(m)}catch(N){throw(_=J(N.code))!=null?_:ie("Unauthorized")}return{signature:b}}async postMessage(e){var b;const[t]=await this.getMembershipPDA(e.channel),a=await this.loadMembership(t);if(!a.cek.header)throw ie("Unauthorized");const s=await this.decryptCEK(a.cek),r=await this.encryptMessage(e.message,s),c=new j;c.add(Cs({channel:e.channel,membership:t,authority:this.provider.publicKey},{message:r}));let m;try{m=await this.provider.sendAndConfirm(c)}catch(_){throw(b=J(_.code))!=null?b:_}return{signature:m}}}const ht="***** *** *** *** *******",Ls=Ze("messenger",()=>{const n=Ye(),e=et(),t=ft(),a=ne({allChannels:[],channel:void 0,channelAddr:void 0,channelMembershipAddr:void 0,channelMembership:void 0,channelMembers:[],channelMessages:[],channelLoading:!1,loading:!1,creating:!1,sending:!1}),s=z(()=>{var d;return new $s(new mt(n.connection,(d=t.value)!=null?d:{publicKey:x.default},mt.defaultOptions()),e.keypair)});m().then(),St(t,()=>{a.channelAddr&&M(a.channelAddr).then()},{immediate:!0});const r=[];async function c(){console.log("Register events...");for(const d of r)await s.value.removeEventListener(d);r.push(s.value.addEventListener("NewMessageEvent",async d=>{if(console.log("[Event] NewMessageEvent",d),`${d.channel}`!=`${a.channelAddr}`)return;let f=ht;const S=await I();S&&(f=await s.value.decryptMessage(d.message.content,S)),a.channelMessages.push({...d.message,content:f})})),r.push(s.value.addEventListener("AuthorizeMemberEvent",async d=>{console.log("[Event] AuthorizeMemberEvent",d),!(a.channelAddr&&`${d.channel}`!=`${a.channelAddr}`)&&(`${d.membership}`==`${a.channelMembershipAddr}`?M(a.channelAddr).then():$().then())})),r.push(s.value.addEventListener("JoinChannelEvent",async d=>{console.log("[Event] JoinChannelEvent",d),`${d.channel}`==`${a.channelAddr}`&&$().then()}))}async function m(){a.loading=!0;const d=await s.value.loadAllChannels();await c(),a.allChannels=d,a.loading=!1}async function b(d,f=15){try{a.creating=!0;const{channel:S}=await s.value.initChannel({name:d,maxMessages:f});await M(S.publicKey),a.channel&&a.allChannels.push({pubkey:S.publicKey,data:a.channel})}finally{a.creating=!1}}async function _(d){const f=new x(d);await s.value.deleteChannel(f),await m()}async function N(d,f){const S=new x(d);await s.value.joinChannel({channel:S,name:f}),await M(d)}async function M(d){var f;a.channelLoading=!0,a.channelMessages=[],a.channelMembers=[],a.channelMembershipAddr=void 0,a.channelMembership=void 0,a.channelAddr=new x(d);try{if((f=t.value)!=null&&f.publicKey)try{const[S]=await s.value.getMembershipPDA(a.channelAddr);a.channelMembershipAddr=S,a.channelMembership=await s.value.loadMembership(S)}catch(S){console.log(S),a.channelMembershipAddr=void 0,a.channelMembership=void 0}await $(),await D()}catch(S){console.log("Error",S)}finally{a.channelLoading=!1}}async function I(){if(!!a.channelMembership)try{return await s.value.decryptCEK(a.channelMembership.cek)}catch(d){console.log(d)}}async function D(){if(!a.channelAddr){console.log("Invalid channel");return}a.channel=await s.value.loadChannel(a.channelAddr);const d=await I();a.channelMessages=await Promise.all(a.channel.messages.map(async f=>{var U;let S=ht,pe=Ne(f.sender);if((U=t.value)!=null&&U.publicKey){const G=a.channelMembers.find(({data:te})=>te.name!==""&&(`${te.authority}`==`${f.sender}`||`${te.key}`==`${f.sender}`));G&&G.data.name!==""&&(pe=G.data.name)}if(d)try{S=await s.value.decryptMessage(f.content,d)}catch{console.log(`Failed to decrypt message #${f.id}`)}return{...f,senderFormatted:pe,content:S}}))}async function $(){if(!a.channelAddr){console.error("Invalid channel");return}a.channelMembers=await s.value.loadChannelMembers(a.channelAddr)}async function ee(d){if(!a.channelAddr){console.log("Please select a channel");return}try{a.sending=!0,await s.value.postMessage({channel:a.channelAddr,message:d}),await D()}finally{a.sending=!1}}async function w(d,f,S){if(!a.channelAddr){console.log("Invalid channel");return}await s.value.addMember({channel:a.channelAddr,invitee:new x(d),key:f?new x(f):void 0,name:S})}async function A(d){if(!a.channelAddr){console.log("Invalid channel");return}await s.value.deleteMember({channel:a.channelAddr,key:new x(d)})}async function L(d){if(!a.channelAddr){console.log("Invalid channel");return}await s.value.authorizeMember({channel:a.channelAddr,key:new x(d)}),await D()}return{state:a,client:s.value,loadChannel:M,joinChannel:N,createChannel:b,deleteChannel:_,postMessage:ee,addMember:w,deleteMember:A,authorizeMember:L}}),Dt=n=>(yt("data-v-d4f17af5"),n=n(),gt(),n),Vs={class:"messenger"},Fs={class:"row q-gutter-md"},Us={class:"col col-3"},Os={class:"messenger-add-channel"},Qs={key:1,class:"messenger-channels-empty"},Gs={class:"col"},js={key:0},qs={class:"row"},Js={class:"col"},Hs={class:"col"},Xs={class:"channel-name"},Zs={key:0,class:"row justify-center"},Ys={key:0,class:"messenger-messages"},er={key:1,class:"messenger-empty"},tr={key:1,class:"messenger-empty"},nr={key:1,class:"q-my-md q-px-lg"},ar={class:"col col-4"},sr={class:"col"},rr={class:"no-margin"},ir=Dt(()=>v("br",null,null,-1)),or=Dt(()=>v("br",null,null,-1)),lr=be({__name:"Messenger",setup(n){const{notify:e}=Pe(),t=De(),{state:a,postMessage:s,addMember:r,deleteMember:c,authorizeMember:m,createChannel:b,loadChannel:_,deleteChannel:N,joinChannel:M}=Ls(),I=et(),D=xe(!1),$=xe(!1),ee=wn($),w=ne({dialog:!1,loading:!1,name:"",authority:""}),A=ne({dialog:!1,loading:!1,name:"",authority:"",key:""}),L=ne({loading:!1}),d=ne({loading:!1}),f=ne({dialog:!1,name:"",maxMessages:15}),S=ne({message:""}),pe=z(()=>!!t.publicKey.value),U=z(()=>{var h;return((h=a.channelMembership)==null?void 0:h.status.__kind)==="Authorized"}),G=z(()=>{var h;return((h=a.channelMembership)==null?void 0:h.status.__kind)==="Pending"}),te=z(()=>{var h,p;return U.value&&((h=a.channel)==null?void 0:h.creator.toString())===String((p=t.publicKey.value)!=null?p:"-")}),tt=z(()=>a.allChannels),nt=z(()=>{const h=[];let p=0,i;for(const R of a.channelMessages)i&&`${R.sender}`==`${i}`?h[p-1].text.push(R.content):(i=R.sender,h.push({id:R.id,sender:R.sender,senderFormatted:R.senderFormatted,text:[R.content],date:R.createdAt}),p++);return h}),at=z(()=>U.value&&!a.sending),zt=z(()=>U.value),It=h=>z(()=>{var p;return te.value&&String(h.key)!==String((p=I.keypair)==null?void 0:p.publicKey)}).value,Nt=z(()=>pe.value&&!a.loading&&!U.value),se=h=>e({type:"positive",message:h,timeout:2e3}),we=h=>e({type:"info",message:h,timeout:2e3}),re=h=>e({type:"negative",message:h,timeout:2e3}),st=z(()=>a.channelMembers.filter(h=>Ha(h.data.status)).length);async function Tt(){Fe()&&(await s(S.message),S.message="")}function Bt(){Fe()&&(f.dialog=!0)}async function Wt(){if(Fe())try{await b(f.name,f.maxMessages),Rt(),se("Channel was created!")}catch(h){re("Something went wrong"),console.log(h)}}function Rt(){f.dialog=!1,f.name="",f.maxMessages=15}async function $t(){if(A.loading=!0,!a.channelAddr){we("Please select a channel");return}try{await r(A.authority,A.key,A.name),rt(),se("Member was added")}catch(h){re("Something went wrong"),console.log(h)}finally{A.loading=!1}}function rt(){A.loading=!1,A.name="",A.authority="",A.key=""}async function Lt(h){try{d.loading=!0,await c(h),se("Member was deleted")}catch(p){re("Something went wrong"),console.log(p)}finally{d.loading=!1}}async function Vt(h){try{L.loading=!0,await m(h),se("Member was authorized")}catch(p){re("Something went wrong"),console.log(p)}finally{L.loading=!1}}async function Ft(){if(!a.channelAddr){we("Please select a channel");return}w.loading=!0;try{await M(a.channelAddr,w.name),it(),se("Request was sent")}catch(h){console.log("Error",h),re("Something went wrong")}finally{w.loading=!1}}function it(){w.loading=!1,w.dialog=!1,w.name=""}async function Ut(){if(!a.channelAddr){we("Please select a channel");return}try{await N(a.channelAddr),se("Channel was deleted!")}catch(h){console.log("Error",h),re("Something went wrong")}finally{w.loading=!1}}async function Ot(h){await _(h)}function Fe(){return t.publicKey.value?!0:(we("Please connect wallet"),!1)}function Qt(h){return(h==null?void 0:h.__kind)==="Authorized"?"positive":"grey"}function Gt(h){return(h==null?void 0:h.name)&&h.name!==""?h.name:Ne(h.authority)}function jt(h){const p=t.publicKey.value;return p?String(p)!==String(h):!0}return(h,p)=>(g(),E(Q,null,[v("div",Vs,[v("div",Fs,[v("div",Us,[v("div",Os,[o(P,{color:"primary",rounded:"",onClick:Bt},{default:l(()=>[k(" Add New Channel ")]),_:1})]),o(H,{class:"messenger-channels"},{default:l(()=>[y(tt).length>0?(g(),C(Qe,{key:0,separator:""},{default:l(()=>[(g(!0),E(Q,null,oe(y(tt),i=>(g(),C(Ee,{key:i.name,"active-class":"bg-blue-grey-1 text-grey-8",active:String(y(a).channelAddr)===String(i.pubkey)},{default:l(()=>[o(le,{class:"cursor-pointer",onClick:R=>Ot(i.pubkey)},{default:l(()=>[o(fe,null,{default:l(()=>[k(K(i.data.name),1)]),_:2},1024),o(fe,{caption:"",lines:"2"},{default:l(()=>[v("div",null,"members: "+K(i.data.memberCount),1),v("div",null,"messages: "+K(i.data.messageCount),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["active"]))),128))]),_:1})):(g(),E("div",Qs," No channels ")),o(ye,{showing:y(a).loading,color:"primary"},null,8,["showing"])]),_:1})]),v("div",Gs,[y(a).channel?(g(),E("div",js,[v("div",qs,[v("div",Js,[o(vn,{rounded:"",unelevated:""},{default:l(()=>[y(zt)?(g(),C(P,{key:0,color:"secondary","text-color":"dark",loading:A.loading,onClick:p[0]||(p[0]=i=>A.dialog=!0)},{default:l(()=>[k(" add\xA0member ")]),_:1},8,["loading"])):B("",!0),y(Nt)?(g(),C(P,{key:1,color:"secondary","text-color":"dark",loading:w.loading,disable:y(G),onClick:p[1]||(p[1]=i=>w.dialog=!0)},{default:l(()=>[k(K(y(G)?"pending\xA0access":"join\xA0channel"),1)]),_:1},8,["loading","disable"])):B("",!0),y(pe)?(g(),C(P,{key:2,color:"blue-grey",onClick:p[2]||(p[2]=i=>D.value=!0)},{default:l(()=>[k(" members "),y(st)>0?(g(),C(Ge,{key:0,color:"info",rounded:"",floating:""},{default:l(()=>[k(K(y(st)),1)]),_:1})):B("",!0)]),_:1})):B("",!0),y(te)?(g(),C(P,{key:3,color:"negative",onClick:Ut},{default:l(()=>[k(" delete ")]),_:1})):B("",!0)]),_:1})]),v("div",Hs,[v("div",Xs,K(y(a).channel.name),1)])])])):B("",!0),o(H,{class:"messenger-card overflow-hidden"},{default:l(()=>[y(a).channel?(g(),E("div",Zs,[y(nt).length>0?(g(),E("div",Ys,[(g(!0),E(Q,null,oe(y(nt),i=>(g(),C(An,{key:i.id,name:i.senderFormatted,text:i.text,sent:jt(i.sender)},null,8,["name","text","sent"]))),128))])):(g(),E("div",er," No messages "))])):(g(),E("div",tr," Please select a channel ")),o(Ae,{class:"channel-form",onSubmit:Se(Tt,["prevent"])},{default:l(()=>[o(bt,{class:"bg-primary text-white row"},{default:l(()=>[o(q,{ref:"inputFocus",modelValue:S.message,"onUpdate:modelValue":p[3]||(p[3]=i=>S.message=i),class:"col-grow q-mr-sm","bg-color":"white",placeholder:"Type a message",dense:"",outlined:"",rounded:"",autofocus:"",disable:!y(at)},null,8,["modelValue","disable"]),o(P,{rounded:"",flat:"",type:"submit",disable:!y(at),loading:y(a).sending},{default:l(()=>[k(" Send ")]),_:1},8,["disable","loading"])]),_:1})]),_:1},8,["onSubmit"]),o(ye,{showing:y(a).channelLoading},null,8,["showing"])]),_:1}),y(a).channel?(g(),E("div",nr,[o(P,{flat:"",class:"text-blue-2",onClick:p[4]||(p[4]=i=>y(ee)())},{default:l(()=>[k(" debug info ")]),_:1}),$.value?(g(!0),E(Q,{key:0},oe([["Authorized",y(U)],["Pending Access",y(G)],["Channel Creator",y(te)],["Channel",y(a).channel],["Membership",y(a).channelMembership],["Members",y(a).channelMembers]],i=>(g(),E("div",{key:i[0],class:"row q-mt-md"},[v("div",ar,K(i[0]),1),v("div",sr,[v("pre",rr,K(i[1]),1)])]))),128)):B("",!0)])):B("",!0)])])]),o(ge,{modelValue:f.dialog,"onUpdate:modelValue":p[7]||(p[7]=i=>f.dialog=i),class:"new-channel-dialog"},{default:l(()=>[o(H,null,{default:l(()=>[o(O,null,{default:l(()=>[o(Ae,{class:"messenger-new-channel-form",onSubmit:Se(Wt,["prevent"])},{default:l(()=>[o(q,{modelValue:f.name,"onUpdate:modelValue":p[5]||(p[5]=i=>f.name=i),label:"Channel name *","lazy-rules":"",rules:[i=>i&&i.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(q,{modelValue:f.maxMessages,"onUpdate:modelValue":p[6]||(p[6]=i=>f.maxMessages=i),label:"Max messages","lazy-rules":"",rules:[i=>+i>0||"Invalid value"]},null,8,["modelValue","rules"]),o(P,{type:"submit",color:"info",ripple:!1,rounded:""},{default:l(()=>[k(" Create Channel ")]),_:1})]),_:1},8,["onSubmit"]),o(ye,{showing:y(a).creating},null,8,["showing"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ge,{modelValue:A.dialog,"onUpdate:modelValue":p[11]||(p[11]=i=>A.dialog=i),class:"add-member-dialog",onHide:rt},{default:l(()=>[o(H,null,{default:l(()=>[o(O,null,{default:l(()=>[o(Ae,{class:"add-member-form",onSubmit:Se($t,["prevent"])},{default:l(()=>[o(q,{modelValue:A.name,"onUpdate:modelValue":p[8]||(p[8]=i=>A.name=i),label:"Member name *",hint:"Min length 3 chars","lazy-rules":"",rules:[i=>i&&i.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(q,{modelValue:A.key,"onUpdate:modelValue":p[9]||(p[9]=i=>A.key=i),label:"Member Wallet *","lazy-rules":"",rules:[i=>i&&i.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),o(q,{modelValue:A.key,"onUpdate:modelValue":p[10]||(p[10]=i=>A.key=i),label:"Member Device Key",hint:"Default: The same as member wallet","lazy-rules":"",rules:[i=>!i||i.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),ir,o(P,{type:"submit",color:"info",ripple:!1,rounded:""},{default:l(()=>[k(" Add Member ")]),_:1})]),_:1},8,["onSubmit"]),o(ye,{showing:A.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ge,{modelValue:w.dialog,"onUpdate:modelValue":p[14]||(p[14]=i=>w.dialog=i),class:"join-channel-dialog",onHide:it},{default:l(()=>[o(H,null,{default:l(()=>[o(O,null,{default:l(()=>[o(Ae,{class:"join-channel-form",onSubmit:Se(Ft,["prevent"])},{default:l(()=>[o(q,{modelValue:w.name,"onUpdate:modelValue":p[12]||(p[12]=i=>w.name=i),placeholder:"Member name *","lazy-rules":"",rules:[i=>i&&i.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(q,{modelValue:w.authority,"onUpdate:modelValue":p[13]||(p[13]=i=>w.authority=i),placeholder:"Authorize By","lazy-rules":"",rules:[i=>!i||i&&i.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),or,o(P,{type:"submit",color:"info",ripple:!1,rounded:""},{default:l(()=>[k(" Join Channel ")]),_:1})]),_:1},8,["onSubmit"]),o(ye,{showing:w.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ge,{modelValue:D.value,"onUpdate:modelValue":p[15]||(p[15]=i=>D.value=i)},{default:l(()=>[o(H,null,{default:l(()=>[o(O,null,{default:l(()=>[o(Qe,{separator:""},{default:l(()=>[(g(!0),E(Q,null,oe(y(a).channelMembers,i=>(g(),C(Ee,{key:i.pubkey.toString(),"active-class":"bg-teal-1",active:`${i.pubkey}`==`${y(a).channelMembershipAddr}`},{default:l(()=>[o(le,null,{default:l(()=>[o(fe,null,{default:l(()=>[k(K(Gt(i.data))+" ",1),o(Ge,{color:Qt(i.data.status)},{default:l(()=>[k(K(i.data.status.__kind),1)]),_:2},1032,["color"])]),_:2},1024),o(fe,{caption:"",lines:"2"},{default:l(()=>[v("div",null,"Authority: "+K(i.data.authority),1),v("div",null,"Key: "+K(i.data.key),1)]),_:2},1024)]),_:2},1024),o(le,{side:"",class:"q-gutter-sm"},{default:l(()=>[i.data.status.__kind==="Pending"&&y(U)&&(!i.data.status.authority||String(i.data.status.authority)===String(y(t).publicKey.value))?(g(),C(P,{key:0,color:"teal",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:L.loading,disabled:L.loading,onClick:R=>Vt(i.data.key)},{default:l(()=>[k(" Authorize ")]),_:2},1032,["loading","disabled","onClick"])):B("",!0),It(i.data)?(g(),C(P,{key:1,color:"negative",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:d.loading,disabled:d.loading,onClick:R=>Lt(i.data.key)},{default:l(()=>[k(" Delete ")]),_:2},1032,["loading","disabled","onClick"])):B("",!0)]),_:2},1024)]),_:2},1032,["active"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});const cr=Te(lr,[["__scopeId","data-v-d4f17af5"]]);const ur={},dr={class:"container"},mr={class:"messenger-container"};function hr(n,e){const t=cr;return g(),C(Sn,null,{default:l(()=>[v("div",dr,[v("div",mr,[o(t)])])]),_:1})}const pr=Te(ur,[["render",hr],["__scopeId","data-v-8856bd2a"]]),yr=()=>_t(()=>import("./_...all_.c45dabea.js"),["assets/_...all_.c45dabea.js","assets/_...all_.73169310.css","assets/vendor.c11a8fd8.js"]),gr=[{name:"index",path:"/",component:pr,props:!0},{name:"all",path:"/:all(.*)*",component:yr,props:!0,meta:{layout:"empty"}}],fr=$a(gr),br="/sol-messenger/",_r=kn({history:Cn(br),scrollBehavior:()=>({left:0,top:0}),strict:!0,routes:fr}),wr=({app:n})=>{n.use(_r)},vr=Object.freeze(Object.defineProperty({__proto__:null,install:wr},Symbol.toStringTag,{value:"Module"})),Ar=({app:n})=>{n.use(Mn,{wallets:[new xn,new En,new Kn,new Pn,new Dn,new zn,new In,new Nn,new Tn,new Bn,new Wn,new Rn,new $n,new Ln,new Vn,new Fn,new Un,new On,new Qn,new Gn,new jn,new qn,new Jn,new Hn,new Xn,new Zn,new Yn,new ea,new ta,new na],autoConnect:!1})},Sr=Object.freeze(Object.defineProperty({__proto__:null,install:Ar},Symbol.toStringTag,{value:"Module"})),kr=aa();function Cr(){return kr}const Mr=Symbol("WALLET_CONNECT_EVENT"),xr=Symbol("WALLET_DISCONNECT_EVENT"),Er=Symbol("ACCOUNT_CHANGE_EVENT"),Oe=5e3;function Kr(){const{connection:n}=Ye(),{emit:e}=Cr(),{notify:t}=Pe(),{wallet:a}=De();St(a,s=>{if(!s)return;const r=()=>{const b=s.publicKey;n.onAccountChange(b,_=>{console.log("ACCOUNT_CHANGE_EVENT",_),e(Er,_)}),n.onLogs(b,_=>{console.log(_)}),t({message:"Wallet update",caption:`Connected to wallet ${Ne(b.toBase58(),7)}`,timeout:Oe}),e(Mr,s)},c=()=>{t({message:"Wallet update",caption:"Disconnected from wallet",timeout:Oe}),e(xr,s)},m=b=>{!(b!=null&&b.message)||t({type:"negative",message:"Wallet update",caption:b.message,timeout:Oe})};s.once("connect",r),s.once("disconnect",c),s.removeAllListeners("error"),s.on("error",m)},{immediate:!0})}const Pr=be({__name:"App",setup(n){return sa(()=>{Kr()}),(e,t)=>{const a=ze("router-view");return g(),C(a)}}});async function Dr(){const n=ra(Pr);Object.values(Object.assign({"./plugins/pinia.ts":oa,"./plugins/quasar.ts":ca,"./plugins/router.ts":vr,"./plugins/wallet.ts":Sr})).forEach(e=>{var t;return(t=e.install)==null?void 0:t.call(e,{app:n})}),n.mount("#app")}Dr().then();export{Te as _};
