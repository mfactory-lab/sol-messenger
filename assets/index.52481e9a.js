var jt=Object.defineProperty;var Qt=(t,e,n)=>e in t?jt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var V=(t,e,n)=>(Qt(t,typeof e!="symbol"?e+"":e,n),n);import{c as Jt,Q as Gt,P as qt,D as Ht,N as Xt,a as Zt,i as Yt,u as Ae,b as st,d as O,o as g,e as b,w as c,f as u,g as $,h as o,j as en,k as d,l as tn,r as U,m as v,n as I,p as de,q as nn,s as an,S as sn,t as N,v as T,x as ft,y as B,z as ne,A as G,B as Ne,C as rn,E as Y,F as q,G as on,H as ke,I as ee,J as wt,W as yt,K as xe,L as Ee,M as ln,O as dt,R as cn,T as un,U as Ve,V as we,X as it,Y as ue,Z as dn,_ as Ct,$ as mn,a0 as re,a1 as Te,a2 as Oe,a3 as mt,a4 as ht,a5 as hn,a6 as pn,a7 as gn,a8 as Mt,a9 as De,aa as Ke,ab as fn,ac as St,ad as yn,ae as bn,af as m,ag as Z,ah as At,ai as oe,aj as le,ak as Pe,al as kt,am as Ce,an as _n,ao as Fe,ap as xt,aq as rt,ar as vn,as as wn,at as Cn,au as Mn,av as Sn,aw as se,ax as me,ay as bt,az as ve,aA as An,aB as Ue,aC as je,aD as te,aE as Ie,aF as kn,aG as xn,aH as En,aI as $n,aJ as Dn,aK as Kn,aL as Pn,aM as In,aN as zn,aO as Bn,aP as Tn,aQ as Wn,aR as Ln,aS as Nn,aT as Rn,aU as Vn,aV as On,aW as Fn,aX as Un,aY as jn,aZ as Qn,a_ as Jn,a$ as Gn,b0 as qn,b1 as Hn,b2 as Xn,b3 as Zn,b4 as Yn,b5 as ea,b6 as ta,b7 as na,b8 as aa,b9 as sa,ba as ia,bb as ra,bc as oa,bd as la,be as ca,bf as ua,bg as da,bh as ma,bi as ha,bj as pa}from"./vendor.28daed3d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const ga=({app:t})=>{const e=Jt();t.use(e)},fa=Object.freeze(Object.defineProperty({__proto__:null,install:ga},Symbol.toStringTag,{value:"Module"})),ya=({app:t})=>{t.use(Gt,{plugins:{Dark:qt,Dialog:Ht,Notify:Xt,LocalStorage:Zt},iconSet:Yt})},ba=Object.freeze(Object.defineProperty({__proto__:null,install:ya},Symbol.toStringTag,{value:"Module"}));function _a(){const{dark:t}=Ae(),e=st("theme-mode",t.isActive);return t.set(e.value),{isActive:e,set(n){t.set(n),e.value=t.isActive},toggle(){t.toggle(),e.value=t.isActive}}}const va={class:"container"},wa={class:"row"},Ca=u("div",{class:"col-12 col-md-6"},[u("div",{class:"footer-links"},[u("ul",null,[u("li",null,[u("a",{target:"_blank",href:"https://jpool.one"},"JPOOL")]),u("li",null,[u("a",{target:"_blank",href:"https://heartandsol.one"},"GAME")]),u("li",null,[u("a",{href:"https://magiceden.io/marketplace/heartandsol"},"NFT Marketplace")])])]),u("div",{class:"copyright"},[u("span",null,"\xA9 Copyright 2022 jpool.one. All rights reserved. Powered by mFactory GmbH")])],-1),Ma={class:"col-12 col-md-6 social-col"},Sa={class:"social"},Aa={class:"theme"},ka=u("div",{class:"social-link social-link-text"},[u("span",null,[$("official"),u("br"),$("channel")])],-1),xa=u("div",{class:"social-link telegram"},null,-1),Ea=u("div",{class:"social-link twitter"},null,-1),$a=u("div",{class:"social-link discord"},null,-1),Da=O({__name:"AppFooter",setup(t){const{toggle:e,isActive:n}=_a();return(i,s)=>(g(),b(tn,null,{default:c(()=>[u("div",va,[u("div",wa,[Ca,u("div",Ma,[u("div",Sa,[u("div",Aa,[$(" Dark theme "),o(en,{"model-value":d(n),onClick:d(e)},null,8,["model-value","onClick"])]),ka,xa,Ea,$a])])])])]),_:1}))}});function Ka(){const t=U(Pa());return{userAgent:t,isMobileOs:v(()=>Ia(t.value)),isWebView:v(()=>za(t.value))}}let tt;function Pa(){var t,e;return tt===void 0&&(tt=(e=(t=globalThis.navigator)==null?void 0:t.userAgent)!=null?e:null),tt}function Ia(t){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)}function za(t){return/(WebView|(Phantom|Solflare)|Version\/.+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+)|; wv\).+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+))/i.test(t)}function Qe(t,e=4){return t instanceof I&&(t=t.toBase58()),`${t.slice(0,e)}...${t.slice(-e)}`}const Ba="/sol-messenger/assets/clover.968404b0.svg",Ta="/sol-messenger/assets/ledger.40cf6861.svg",Wa="/sol-messenger/assets/mathwallet.1d763e81.svg",Et=t=>(xe("data-v-b79b08f0"),t=t(),Ee(),t),La=Et(()=>u("div",{class:"text-h6 text-center"}," Your wallet ",-1)),Na={class:"q-gutter-md row justify-between"},Ra=Et(()=>u("div",{class:"text-h6"}," Connect to a wallet ",-1)),Va={class:"text-light-gray text-caption full-width text-no-wrap",style:{"text-overflow":"ellipsis",overflow:"hidden"}},Oa=["src","alt"],Fa=O({__name:"ConnectWallet",setup(t){const e={priority:{solflare:10,phantom:20,sollet:5,nufi:5,blocto:1},icons:{clover:Ba},darkIcons:{ledger:Ta,mathwallet:Wa},deepLinks:{phantom:"https://phantom.app/ul/browse/{uri}?ref={ref}",solflare:"https://solflare.com/ul/browse/{uri}?ref={ref}"}},{userAgent:n,isWebView:i,isMobileOs:s}=Ka(),a={close:wt},r=C=>[yt.Installed,yt.Loadable].includes(C.readyState);Ae();const l=de(),{connected:h,connecting:p}=l;nn();const S=v(()=>s.value&&!i.value);if(i.value){const C=String(n.value).toLowerCase();C.includes("phantom")?(l.select(an),l.connect()):C.includes("solflare")&&(l.select(sn),l.connect())}const _=v(()=>{var C,R;return(R=(C=l.publicKey.value)==null?void 0:C.toBase58())!=null?R:""}),W=v(()=>Qe(_.value)),K=v(()=>[...l.wallets.value].map(C=>{var P,H;const R=C.adapter.name.toLowerCase();return C.adapter.icon=(H=(P=e.darkIcons[R])!=null?P:e.icons[R])!=null?H:C.adapter.icon,S.value&&e.deepLinks[R]&&(C.deepLink=e.deepLinks[R].replace("{uri}",location.href).replace("{ref}",location.origin)),C}).sort((C,R)=>{var f,x;const P=(f=e.priority[C.adapter.name.toLowerCase()])!=null?f:1;return((x=e.priority[R.adapter.name.toLowerCase()])!=null?x:1)-P+((r(R)?1:0)-(r(C)?1:0))})),E=v(()=>S.value?K.value.filter(C=>!!C.deepLink):K.value),w=U(!1);async function y(C){await l.select(C.adapter.name),w.value=!1,await l.connect()}function M(){w.value=!1,l.disconnect()}function L(){w.value=!0}function z(){w.value=!1}return(C,R)=>(g(),N(ee,null,[d(h)?(g(),b(B,ft({key:0},C.$attrs,{class:C.$style.btn,ripple:!1,color:"primary-gray","text-color":"white",rounded:"",unelevated:"",onClick:L}),{default:c(()=>[$(T(d(W)),1)]),_:1},16,["class"])):(g(),b(B,ft({key:1},C.$attrs,{color:"primary-gray","text-color":"white",rounded:"",unelevated:"",ripple:!1,loading:d(p),onClick:L}),{default:c(()=>[$(" CONNECT WALLET ")]),_:1},16,["loading"])),o(ke,{modelValue:w.value,"onUpdate:modelValue":R[0]||(R[0]=P=>w.value=P),"transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:c(()=>[d(h)?(g(),b(ne,{key:0},{default:c(()=>[o(G,{class:"relative-position"},{default:c(()=>[La,o(B,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:z},null,8,["icon"])]),_:1}),o(Ne),o(G,null,{default:c(()=>[$(T(d(_)),1)]),_:1}),o(Ne),o(G,null,{default:c(()=>[u("div",Na,[o(B,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:M},{default:c(()=>[$(" Disconnect ")]),_:1}),o(B,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:z},{default:c(()=>[$(" Ok ")]),_:1})])]),_:1})]),_:1})):(g(),b(ne,{key:1,class:"wallet-connect-card"},{default:c(()=>[o(G,null,{default:c(()=>[Ra,o(B,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:z},null,8,["icon"])]),_:1}),o(Ne),o(G,{style:{"max-height":"80vh"},class:"scroll"},{default:c(()=>[o(rn,{grid:"",rows:d(E),"row-key":"name","hide-pagination":"","hide-header":"","rows-per-page-options":[100]},{item:c(({row:P})=>[(g(),N("div",{key:`wallet-${P.adapter.name}`,class:"col-12 col-md-6"},[o(Y,{clickable:"",href:P.deepLink,onClick:H=>P.deepLink?!0:y(P)},{default:c(()=>[o(q,null,{default:c(()=>[u("b",null,T(P.adapter.name),1),u("div",Va,T(P.adapter.url),1)]),_:2},1024),o(q,{avatar:""},{default:c(()=>[o(on,{square:""},{default:c(()=>[u("img",{src:P.adapter.icon,alt:P.adapter.name},null,8,Oa)]),_:2},1024)]),_:2},1024)]),_:2},1032,["href","onClick"])]))]),_:1},8,["rows"])]),_:1})]),_:1}))]),_:1},8,["modelValue"])],64))}});const Ua="_btn_6n1iw_1",ja={btn:Ua},F=(t,e)=>{const n=t.__vccOpts||t;for(const[i,s]of e)n[i]=s;return n},Qa={$style:ja},Ja=F(Fa,[["__cssModules",Qa],["__scopeId","data-v-b79b08f0"]]),Me=[{id:"serum-mainnet",name:"Serum RPC",cluster:"mainnet-beta",url:"https://solana-api.projectserum.com/"},{id:"rpcpool-mainnet",name:"RPCPool RPC",cluster:"mainnet-beta",url:"https://mainnet.rpcpool.com/"},{id:"mainnet",name:"Solana RPC",cluster:"mainnet-beta",url:ln("mainnet-beta")}],$t={id:"devnet",name:"DevNet",cluster:"devnet",url:"https://devnet.rpcpool.com/"};Me.push($t);const Ga={id:"testnet",name:"TestNet",cluster:"testnet",url:"https://testnet.rpcpool.com/"};Me.push(Ga);var vt;const qa=(vt=Me.find(t=>t.id==={VITE_BASE_PATH:"/sol-messenger/",VITE_USER_NODE_ENV:"production",BASE_URL:"/sol-messenger/",MODE:"staging",DEV:!1,PROD:!0}.VITE_CONNECTION_ENDPOINT))!=null?vt:$t,Ha="confirmed",Xa=12e4,Za=["94ScvxCuJbVaS2YdaveHGijQ4vtHb6XCzT2ejXhwxiLB","o8vV9bLYBPwoWmS2meSXWyTLdwfhLhEzYsBkopWUNyY"],pt=dt({id:"connection",state:()=>({commitment:Ha,confirmTransactionInitialTimeout:Xa,rpc:cn("rpc","")}),getters:{endpoint(t){var e;return(e=Me.find(n=>n.id===t.rpc))!=null?e:qa},connection(t){return console.log("[connection]",this.endpoint.url),new un(this.endpoint.url,{confirmTransactionInitialTimeout:t.confirmTransactionInitialTimeout,commitment:t.commitment})},cluster(){return this.endpoint.cluster}},actions:{setRpc(t){this.rpc=t},setCommitment(t){this.commitment=t}}}),Ya=O({__name:"ClusterSelector",setup(t){const e=pt(),{connected:n,connect:i,disconnect:s,autoConnect:a}=de(),r=[Me.filter(p=>p.cluster==="mainnet-beta"),Me.filter(p=>p.cluster!=="mainnet-beta")],l=v(()=>e.endpoint),h=p=>{n&&e.cluster!==p.cluster&&(s(),a.value&&i()),e.setRpc(p.id)};return(p,S)=>(g(),b(dn,{label:d(l).name,"model-value":!1,"auto-close":"",color:"secondary","text-color":"#000",rounded:"",unelevated:"",ripple:!1},{default:c(()=>[o(Ve,null,{default:c(()=>[(g(),N(ee,null,we(r,(_,W)=>(g(),N(ee,{key:`${W}-cluster-group`},[(g(!0),N(ee,null,we(_,K=>(g(),b(Y,{key:K.id,clickable:"",onClick:E=>h(K)},{default:c(()=>[(g(),b(q,{key:`${K.id}-item`},{default:c(()=>[o(it,null,{default:c(()=>[u("b",null,T(K.name),1)]),_:2},1024),$(" "+T(K.url),1)]),_:2},1024))]),_:2},1032,["onClick"]))),128)),W!==r.length-1?(g(),b(Ne,{key:0})):ue("",!0)],64))),64))]),_:1})]),_:1},8,["label"]))}}),ze=dt("user",()=>{const t=Ct(),e=U();mn(()=>{var s;const i=(s=t.value)==null?void 0:s.publicKey;if(i){const a=st(i.toString(),()=>Te.encode(re.generate().secretKey));e.value=re.fromSecretKey(Te.decode(a.value))}else e.value=void 0});function n(){var a;const i=(a=t.value)==null?void 0:a.publicKey;if(!i)return;const s=st(i.toString(),"");s.value=Te.encode(re.generate().secretKey),e.value=re.fromSecretKey(Te.decode(s.value))}return{keypair:e,generateKey:n}}),es={class:"container"},ts={class:"app-header__info"},ns={class:"app-header__logo"},as={class:"logo-wrapper"},ss=u("div",{class:"app-header__title"},[u("h1",null,[$("BLOCKCHAIN messenger "),u("span",{class:"marked"},"SOLANA")])],-1),is={class:"app-header__right"},rs={class:"app-header__buttons"},os=O({__name:"AppHeader",setup(t){return ze(),Ae(),(e,n)=>{const i=Oe("router-link"),s=Ya,a=Ja;return g(),b(hn,{class:"app-header"},{default:c(()=>[u("div",es,[o(mt,null,{default:c(()=>[u("div",ts,[u("div",ns,[u("div",as,[o(i,{to:"/"})])]),ss]),o(ht),u("div",is,[u("div",rs,[o(s,{class:"app-header__cluster-btn header-btn"}),o(a,{class:"app-header__wallet-btn header-btn"})])])]),_:1})])]),_:1})}}});const ls={};function cs(t,e){const n=os,i=Oe("router-view"),s=Da;return g(),b(pn,{view:"lfh Lpr lff"},{default:c(()=>[o(n),o(gn,null,{default:c(()=>[o(i)]),_:1}),o(s)]),_:1})}const us=F(ls,[["render",cs]]),ds={default:us,empty:()=>Mt(()=>import("./empty.22fc915e.js"),["assets/empty.22fc915e.js","assets/vendor.28daed3d.js"])};function ms(t){return t.map(e=>{var n;return{path:e.path,component:ds[((n=e.meta)==null?void 0:n.layout)||"default"],children:[{...e,path:""}]}})}const hs="/sol-messenger/assets/solana-logo.3caace62.svg";const ps={},Je=t=>(xe("data-v-5ffd3a8e"),t=t(),Ee(),t),gs={class:"row info-row"},fs=Je(()=>u("div",{class:"offset-0 offset-md-3"},null,-1)),ys=Je(()=>u("div",{class:"col-6 col-md-3 flex-center info-col"},[u("div",{class:"info-title"}," How IT WORKS "),u("div",{class:"info-text"},[u("ul",null,[u("li",null,"Connect your wallet"),u("li",null,"Enter the amount of JPLT you want to swap or enter the amount of JPLU you want to get"),u("li",null,"Click SWAP button"),u("li",null,"Confirm the transaction in your wallet"),u("li",null,"Done")])])],-1)),bs={class:"col-6 col-md-5 logo-wrap"},_s=Je(()=>u("img",{src:hs,alt:"solana logo"},null,-1)),vs=Je(()=>u("div",{class:"offset-0 offset-md-1"},null,-1));function ws(t,e){const n=Oe("router-link");return g(),N("div",gs,[fs,ys,u("div",bs,[o(n,{to:"/"},{default:c(()=>[_s]),_:1})]),vs])}const Cs=F(ps,[["render",ws],["__scopeId","data-v-5ffd3a8e"]]),Ms=t=>(xe("data-v-b5d85bae"),t=t(),Ee(),t),Ss=Ms(()=>u("div",{class:"text-h6"}," Device Key ",-1)),As=O({__name:"UserInfoDialog",emits:["regenerate"],setup(t){const e=ze(),n=()=>{var i,s;bn(((s=(i=e.keypair)==null?void 0:i.publicKey)!=null?s:"").toString())};return(i,s)=>(g(),b(ke,{class:"dialog-wrapper"},{default:c(()=>[o(ne,null,{default:c(()=>[o(G,{class:"row items-center q-pb-none"},{default:c(()=>[Ss,o(ht),De(o(B,{flat:"",round:"",dense:"",icon:d(wt)},null,8,["icon"]),[[Ke]])]),_:1}),o(G,null,{default:c(()=>{var a;return[o(B,{flat:"",round:"",dense:"",icon:d(fn),onClick:n},{default:c(()=>[o(St,{delay:0,anchor:"bottom middle",self:"top middle","transition-duration":"0"},{default:c(()=>[$(" Copy to clipboard ")]),_:1})]),_:1},8,["icon"]),u("span",null,T((a=d(e).keypair)==null?void 0:a.publicKey),1)]}),_:1}),o(yn,{align:"right"},{default:c(()=>[o(B,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:d(e).generateKey},{default:c(()=>[$(" Regenerate ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}))}});const ks=F(As,[["__scopeId","data-v-b5d85bae"]]),xs="0.0.8",Es="messenger",$s=[{name:"initChannel",accounts:[{name:"channel",isMut:!0,isSigner:!0},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"InitChannelData"}}]},{name:"deleteChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"joinChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"JoinChannelData"}}]},{name:"leaveChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"grantAccessMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"GrantAccessMemberData"}}]},{name:"addMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"invitee",isMut:!1,isSigner:!1},{name:"inviteeMembership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AddMemberData"}}]},{name:"authorizeMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AuthorizeMemberData"}}]},{name:"deleteMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"postMessage",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!1,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"message",type:"string"}]}],Ds=[{name:"Channel",type:{kind:"struct",fields:[{name:"name",docs:["Name of the channel"],type:"string"},{name:"creator",docs:["Channel creator"],type:"publicKey"},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"flags",docs:["Channel flags"],type:"u8"},{name:"memberCount",docs:["Number of members"],type:"u16"},{name:"messageCount",docs:["Message counter"],type:"u32"},{name:"maxMessages",docs:["The maximum number of messages that are stored in [messages]"],type:"u16"},{name:"messages",docs:["List of messages"],type:{vec:{defined:"Message"}}}]}},{name:"ChannelMembership",type:{kind:"struct",fields:[{name:"channel",docs:["Associated [Channel] address"],type:"publicKey"},{name:"authority",docs:["Authority of membership"],type:"publicKey"},{name:"key",docs:["The device key used to encrypt the `CEK`"],type:"publicKey"},{name:"cek",docs:["The content encryption key (CEK) of the channel"],type:{defined:"CEKData"}},{name:"status",docs:["Status of membership"],type:{defined:"ChannelMembershipStatus"}},{name:"name",docs:["Name of the channel member"],type:"string"},{name:"invitedBy",docs:["Inviter address"],type:{option:"publicKey"}},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"flags",docs:["Membership flags"],type:"u8"},{name:"bump",docs:["Bump seed for deriving PDA seeds"],type:"u8"}]}}],Ks=[{name:"AddMemberData",type:{kind:"struct",fields:[{name:"name",docs:["Member name"],type:"string"},{name:"flags",docs:["Membership flags, only `admin` and `owner` can set membership flags"],type:"u8"},{name:"cek",docs:["Content Encryption Key"],type:{defined:"CEKData"}},{name:"key",docs:["Device key"],type:{option:"publicKey"}}]}},{name:"AuthorizeMemberData",type:{kind:"struct",fields:[{name:"cek",type:{defined:"CEKData"}}]}},{name:"GrantAccessMemberData",type:{kind:"struct",fields:[{name:"flags",type:"u8"}]}},{name:"InitChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"maxMessages",type:"u16"},{name:"memberName",type:"string"},{name:"cek",type:{defined:"CEKData"}},{name:"public",type:"bool"},{name:"permissionless",type:"bool"}]}},{name:"JoinChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"authority",type:{option:"publicKey"}}]}},{name:"CEKData",type:{kind:"struct",fields:[{name:"header",docs:["The header information for the CEK"],type:"string"},{name:"encryptedKey",docs:["The CEK itself"],type:"string"}]}},{name:"Message",type:{kind:"struct",fields:[{name:"id",docs:["Uniq message id"],type:"u32"},{name:"sender",docs:["The message sender id"],type:"publicKey"},{name:"createdAt",docs:["The unix timestamp at which the message was received"],type:"i64"},{name:"flags",docs:["Message flags"],type:"u8"},{name:"content",docs:["The (typically encrypted) message content"],type:"string"}]}},{name:"ChannelMembershipStatus",type:{kind:"enum",variants:[{name:"Authorized",fields:[{name:"by",type:{option:"publicKey"}}]},{name:"Pending",fields:[{name:"authority",type:{option:"publicKey"}}]}]}}],Ps=[{name:"NewChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"NewMessageEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"message",type:{defined:"Message"},index:!1}]},{name:"JoinChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"LeaveChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"authority",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AddMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"AuthorizeMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]}],Is=[{code:6e3,name:"Unauthorized",msg:"Unauthorized"},{code:6001,name:"InvalidChannel",msg:"Invalid channel"},{code:6002,name:"InvalidMembership",msg:"Invalid membership"},{code:6003,name:"InvalidMessage",msg:"Invalid message"},{code:6004,name:"NameTooLong",msg:"Name too long"},{code:6005,name:"MessageTooLong",msg:"Message too long"}],zs={address:"6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",origin:"anchor",binaryVersion:"0.25.0",libVersion:"0.25.0"},Bs={version:xs,name:Es,instructions:$s,accounts:Ds,types:Ks,events:Ps,errors:Is,metadata:zs},Ts=new m.FixableBeetArgsStruct([["id",m.u32],["sender",Z],["createdAt",m.i64],["flags",m.u8],["content",m.utf8String]],"Message"),ot=[49,159,99,106,220,87,219,88];class X{constructor(e,n,i,s,a,r,l,h){this.name=e,this.creator=n,this.createdAt=i,this.flags=s,this.memberCount=a,this.messageCount=r,this.maxMessages=l,this.messages=h}static fromArgs(e){return new X(e.name,e.creator,e.createdAt,e.flags,e.memberCount,e.messageCount,e.maxMessages,e.messages)}static fromAccountInfo(e,n=0){return X.deserialize(e.data,n)}static async fromAccountAddress(e,n,i){const s=await e.getAccountInfo(n,i);if(s==null)throw new Error(`Unable to find Channel account at ${n}`);return X.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return At.fromStruct(e,We)}static deserialize(e,n=0){return We.deserialize(e,n)}serialize(){return We.serialize({accountDiscriminator:ot,...this})}static byteSize(e){const n=X.fromArgs(e);return We.toFixedFromValue({accountDiscriminator:ot,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,i){return n.getMinimumBalanceForRentExemption(X.byteSize(e),i)}pretty(){return{name:this.name,creator:this.creator.toBase58(),createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,memberCount:this.memberCount,messageCount:this.messageCount,maxMessages:this.maxMessages,messages:this.messages}}}const We=new m.FixableBeetStruct([["accountDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["name",m.utf8String],["creator",Z],["createdAt",m.i64],["flags",m.u8],["memberCount",m.u16],["messageCount",m.u32],["maxMessages",m.u16],["messages",m.array(Ts)]],X.fromArgs,"Channel"),Ge=new m.FixableBeetArgsStruct([["header",m.utf8String],["encryptedKey",m.utf8String]],"CEKData"),Ws=t=>t.__kind==="Pending",Ls=m.dataEnum([["Authorized",new m.FixableBeetArgsStruct([["by",m.coption(Z)]],'ChannelMembershipStatusRecord["Authorized"]')],["Pending",new m.FixableBeetArgsStruct([["authority",m.coption(Z)]],'ChannelMembershipStatusRecord["Pending"]')]]),Re=[238,149,255,251,116,131,86,170];class Q{constructor(e,n,i,s,a,r,l,h,p,S){this.channel=e,this.authority=n,this.key=i,this.cek=s,this.status=a,this.name=r,this.invitedBy=l,this.createdAt=h,this.flags=p,this.bump=S}static fromArgs(e){return new Q(e.channel,e.authority,e.key,e.cek,e.status,e.name,e.invitedBy,e.createdAt,e.flags,e.bump)}static fromAccountInfo(e,n=0){return Q.deserialize(e.data,n)}static async fromAccountAddress(e,n,i){const s=await e.getAccountInfo(n,i);if(s==null)throw new Error(`Unable to find ChannelMembership account at ${n}`);return Q.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return At.fromStruct(e,Le)}static deserialize(e,n=0){return Le.deserialize(e,n)}serialize(){return Le.serialize({accountDiscriminator:Re,...this})}static byteSize(e){const n=Q.fromArgs(e);return Le.toFixedFromValue({accountDiscriminator:Re,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,i){return n.getMinimumBalanceForRentExemption(Q.byteSize(e),i)}pretty(){return{channel:this.channel.toBase58(),authority:this.authority.toBase58(),key:this.key.toBase58(),cek:this.cek,status:this.status.__kind,name:this.name,invitedBy:this.invitedBy,createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,bump:this.bump}}}const Le=new m.FixableBeetStruct([["accountDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["channel",Z],["authority",Z],["key",Z],["cek",Ge],["status",Ls],["name",m.utf8String],["invitedBy",m.coption(Z)],["createdAt",m.i64],["flags",m.u8],["bump",m.u8]],Q.fromArgs,"ChannelMembership"),he=new Map,pe=new Map;class qe extends Error{constructor(){super("Unauthorized");V(this,"code",6e3);V(this,"name","Unauthorized");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,qe)}}he.set(6e3,()=>new qe);pe.set("Unauthorized",()=>new qe);class He extends Error{constructor(){super("Invalid channel");V(this,"code",6001);V(this,"name","InvalidChannel");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,He)}}he.set(6001,()=>new He);pe.set("InvalidChannel",()=>new He);class Xe extends Error{constructor(){super("Invalid membership");V(this,"code",6002);V(this,"name","InvalidMembership");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Xe)}}he.set(6002,()=>new Xe);pe.set("InvalidMembership",()=>new Xe);class Ze extends Error{constructor(){super("Invalid message");V(this,"code",6003);V(this,"name","InvalidMessage");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ze)}}he.set(6003,()=>new Ze);pe.set("InvalidMessage",()=>new Ze);class Ye extends Error{constructor(){super("Name too long");V(this,"code",6004);V(this,"name","NameTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ye)}}he.set(6004,()=>new Ye);pe.set("NameTooLong",()=>new Ye);class et extends Error{constructor(){super("Message too long");V(this,"code",6005);V(this,"name","MessageTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,et)}}he.set(6005,()=>new et);pe.set("MessageTooLong",()=>new et);function ie(t){const e=he.get(t);return e!=null?e():null}function _e(t){const e=pe.get(t);return e!=null?e():null}const Ns=new m.FixableBeetArgsStruct([["name",m.utf8String],["flags",m.u8],["cek",Ge],["key",m.coption(Z)]],"AddMemberData"),Rs=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["data",Ns]],"AddMemberInstructionArgs"),Vs=[13,116,123,130,126,198,57,34];function Os(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=Rs.serialize({instructionDiscriminator:Vs,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.invitee,isWritable:!1,isSigner:!1},{pubkey:t.inviteeMembership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(r=t.systemProgram)!=null?r:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new le({programId:n,keys:s,data:i})}const Fs=new m.FixableBeetArgsStruct([["cek",Ge]],"AuthorizeMemberData"),Us=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["data",Fs]],"AuthorizeMemberInstructionArgs"),js=[194,123,189,175,86,225,93,128];function Qs(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=Us.serialize({instructionDiscriminator:js,...e}),s=[{pubkey:t.channel,isWritable:!1,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:(r=t.systemProgram)!=null?r:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new le({programId:n,keys:s,data:i})}const Js=new m.BeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)]],"DeleteChannelInstructionArgs"),Gs=[145,225,187,221,157,142,114,133];function qs(t,e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=Js.serialize({instructionDiscriminator:Gs}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new le({programId:e,keys:i,data:n})}const Hs=new m.BeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)]],"DeleteMemberInstructionArgs"),Xs=[95,14,98,112,252,218,205,173];function Zs(t,e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=Hs.serialize({instructionDiscriminator:Xs}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new le({programId:e,keys:i,data:n})}const Ys=new m.BeetArgsStruct([["flags",m.u8]],"GrantAccessMemberData");new m.BeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["data",Ys]],"GrantAccessMemberInstructionArgs");const ei=new m.FixableBeetArgsStruct([["name",m.utf8String],["maxMessages",m.u16],["memberName",m.utf8String],["cek",Ge],["public",m.bool],["permissionless",m.bool]],"InitChannelData"),ti=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["data",ei]],"InitChannelInstructionArgs"),ni=[21,200,152,39,19,178,76,47];function ai(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=ti.serialize({instructionDiscriminator:ni,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!0},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(r=t.systemProgram)!=null?r:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new le({programId:n,keys:s,data:i})}const si=new m.FixableBeetArgsStruct([["name",m.utf8String],["authority",m.coption(Z)]],"JoinChannelData"),ii=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["data",si]],"JoinChannelInstructionArgs"),ri=[124,39,115,89,217,26,38,29];function oi(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=ii.serialize({instructionDiscriminator:ri,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(r=t.systemProgram)!=null?r:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new le({programId:n,keys:s,data:i})}const li=new m.BeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)]],"LeaveChannelInstructionArgs"),ci=[104,0,75,134,95,80,68,186];function ui(t,e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=li.serialize({instructionDiscriminator:ci}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new le({programId:e,keys:i,data:n})}const di=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["message",m.utf8String]],"PostMessageInstructionArgs"),mi=[214,50,100,209,38,34,7,76];function hi(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=di.serialize({instructionDiscriminator:mi,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:(r=t.systemProgram)!=null?r:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new le({programId:n,keys:s,data:i})}const pi="6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",gi=new I(pi);function lt(t,e=new Uint8Array(4)){const n=Pe(t.toString(),"base10");return e.set(n,4-n.length),e}const nt=t=>Ce([lt(t.length),t]);function Dt(t,e,n){if(e!==256)throw new Error(`Unsupported key length: ${e}`);const i=Ce([nt(Pe(n)),nt(new Uint8Array(0)),nt(new Uint8Array(0)),lt(e)]),s=1;return _n.hash(Ce([lt(s),t,i]))}const ct=t=>Pe(t,"base64pad"),ut=t=>kt(t,"base64pad"),fi=t=>Pe(t),yi=t=>kt(t),bi=t=>Pe(t,"base58btc"),ce=Fe.NONCE_LENGTH,Se=Fe.TAG_LENGTH,Kt=t=>{const e=new Fe.XChaCha20Poly1305(t);return(n,i)=>{const s=xt.randomBytes(ce),a=e.seal(s,n,i);return{ciphertext:a.subarray(0,a.length-Se),tag:a.subarray(a.length-Se),iv:s}}},Pt=t=>{const e=new Fe.XChaCha20Poly1305(t);return(n,i,s,a)=>e.open(s,Ce([n,i]),a)},It="ECDH-ES+XC20PKW",zt=256,_i=t=>e=>{const n=rt.generateKeyPair(),i=rt.sharedKey(n.secretKey,t),s=Dt(i,zt,It),a=Kt(s)(e);return{encryptedKey:a.ciphertext,tag:a.tag,iv:a.iv,epPubKey:n.publicKey}},vi=t=>(e,n,i,s)=>{const a=rt.sharedKey(t,s),r=Dt(a,zt,It);return Pt(r)(e,n,i)},wi=t=>Array.isArray(t)?re.fromSecretKey(Cn.Buffer.from(t)):typeof t=="string"?re.fromSecretKey(bi(t)):re.fromSecretKey(t),Ci=async(t=32)=>{const e=xt.randomBytes(t);return Promise.resolve(e)},Mi=async(t,e)=>{const n=await _i(vn(e.toBytes()))(t);return{header:ut(Ce([n.iv,n.tag,n.epPubKey])),encryptedKey:ut(n.encryptedKey)}},Si=async(t,e)=>{const n=ct(t.header),i=n.subarray(0,ce),s=n.subarray(ce,ce+Se),a=n.subarray(ce+Se),r=ct(t.encryptedKey),l=wi(e).secretKey,h=wn(l),p=await vi(h)(r,s,i,a);if(p===null)throw new Error("There was a problem decrypting the CEK");return p},Ai=async(t,e)=>{const n=await Kt(e)(fi(t));return ut(Ce([n.iv,n.ciphertext,n.tag]))},ki=async(t,e)=>{const n=ct(t),i=n.subarray(0,ce),s=n.subarray(ce,-Se),a=n.subarray(-Se),r=await Pt(e)(s,a,i);if(r===null)throw new Error("There was an error decoding the message!");return yi(r)};class xi{constructor(e,n){V(this,"programId",gi);V(this,"_coder");V(this,"_events");V(this,"utils",{channel:{isPublic:e=>(e.flags&1)>0,isPermissionless:e=>(e.flags&2)>0},member:{isOwner:e=>e.flags>=255,isAdmin:e=>(e.flags&7)===7,canAddMember:e=>(e.flags&1)>0,canDeleteMember:e=>(e.flags&2)>0,canAuthorizeMember:e=>(e.flags&4)>0},message:{isEncrypted:e=>(e.flags&1)>0}});this.provider=e,this.keypair=n,this._coder=new Mn(Bs),this._events=new Sn(this.programId,e,this._coder)}get connection(){return this.provider.connection}addEventListener(e,n){return this._events.addEventListener(e,n)}async removeEventListener(e){return await this._events.removeEventListener(e)}setKeypair(e){this.keypair=e}async loadAllChannels(){return(await X.gpaBuilder().addFilter("accountDiscriminator",ot).run(this.provider.connection)).map(n=>({pubkey:n.pubkey,data:X.fromAccountInfo(n.account)[0]}))}async loadChannel(e,n){return X.fromAccountAddress(this.provider.connection,e,n)}async loadMyChannels(){return await this.loadMemberships()}async loadChannelMembers(e){return(await Q.gpaBuilder().addFilter("accountDiscriminator",Re).addFilter("channel",e).run(this.provider.connection)).map(i=>({pubkey:i.pubkey,data:Q.fromAccountInfo(i.account)[0]}))}async loadMemberships(e){const n=Q.gpaBuilder().addFilter("accountDiscriminator",Re).addFilter("authority",this.provider.publicKey);return e&&n.addFilter("key",e),(await n.run(this.provider.connection)).map(s=>({pubkey:s.pubkey,data:Q.fromAccountInfo(s.account)}))}async loadMembership(e,n){return Q.fromAccountAddress(this.provider.connection,e,n)}async getMembershipPDA(e,n){return n=n!=null?n:this.keypair.publicKey,await I.findProgramAddress([e.toBuffer(),n.toBuffer()],this.programId)}async encryptCEK(e,n){return Mi(e,n!=null?n:this.keypair.publicKey)}async decryptCEK(e,n){return Si(e,n!=null?n:this.keypair.secretKey)}async encryptMessage(e,n){return Ai(e,n)}async decryptMessage(e,n){return ki(e,n)}async initChannel(e){var p,S,_,W,K;const n=(p=e.channel)!=null?p:re.generate(),i=await Ci(),s=await this.encryptCEK(i),[a]=await this.getMembershipPDA(n.publicKey),r=this.provider.publicKey,l=new se;l.add(ai({key:this.keypair.publicKey,channel:n.publicKey,membership:a,authority:r},{data:{name:e.name,public:(S=e.public)!=null?S:!1,permissionless:(_=e.permissionless)!=null?_:!1,memberName:(W=e.memberName)!=null?W:"",maxMessages:e.maxMessages,cek:s}}));let h;try{h=await this.provider.sendAndConfirm(l,[n,this.keypair],e.opts)}catch(E){throw(K=ie(E.code))!=null?K:E}return{signature:h,channel:n,cek:i,cekEncrypted:s}}async deleteChannel({channel:e,opts:n}){var l;const i=this.provider.publicKey,[s]=await this.getMembershipPDA(e),a=new se;a.add(qs({channel:e,authority:i,authorityMembership:s}));let r;try{r=await this.provider.sendAndConfirm(a,void 0,n)}catch(h){throw(l=ie(h.code))!=null?l:_e("Unauthorized")}return{signature:r}}async joinChannel(e){var r,l;const[n]=await this.getMembershipPDA(e.channel),i=this.provider.publicKey,s=new se;s.add(oi({channel:e.channel,key:this.keypair.publicKey,membership:n,authority:i},{data:{name:e.name,authority:(r=e.authority)!=null?r:null}}));let a;try{a=await this.provider.sendAndConfirm(s,[this.keypair],e.opts)}catch(h){throw(l=ie(h.code))!=null?l:h}return{signature:a}}async leaveChannel(e){var r;const[n]=await this.getMembershipPDA(e.channel),i=this.provider.publicKey,s=new se;s.add(ui({channel:e.channel,membership:n,authority:i}));let a;try{a=await this.provider.sendAndConfirm(s)}catch(l){throw(r=ie(l.code))!=null?r:l}return{signature:a}}async addMember(e){var S,_,W,K;const n=(S=e.key)!=null?S:e.invitee,[i]=await this.getMembershipPDA(e.channel),[s]=await this.getMembershipPDA(e.channel,n),a=await this.loadMembership(i);if(!a.cek.encryptedKey)throw _e("Unauthorized");const r=await this.decryptCEK(a.cek),l=await this.encryptCEK(r,n),h=new se;h.add(Os({channel:e.channel,authority:this.provider.publicKey,invitee:e.invitee,authorityMembership:i,inviteeMembership:s},{data:{name:(_=e.name)!=null?_:"",flags:(W=e.flags)!=null?W:0,cek:l,key:n}}));let p;try{p=await this.provider.sendAndConfirm(h)}catch(E){throw(K=ie(E.code))!=null?K:_e("Unauthorized")}return{signature:p}}async deleteMember(e){var l;const[n]=e.membership?[e.membership]:await this.getMembershipPDA(e.channel,e.key),[i]=await this.getMembershipPDA(e.channel),s=this.provider.publicKey,a=new se;a.add(Zs({channel:e.channel,membership:n,authority:s,authorityMembership:i}));let r;try{r=await this.provider.sendAndConfirm(a)}catch(h){throw(l=ie(h.code))!=null?l:h}return{signature:r}}async authorizeMember(e){var p;const[n]=await this.getMembershipPDA(e.channel),[i]=await this.getMembershipPDA(e.channel,e.key),s=await this.loadMembership(n);if(!s.cek.encryptedKey)throw _e("Unauthorized");const a=await this.decryptCEK(s.cek),r=await this.encryptCEK(a,e.key),l=new se;l.add(Qs({channel:e.channel,membership:i,authority:this.provider.publicKey,authorityMembership:n},{data:{cek:r}}));let h;try{h=await this.provider.sendAndConfirm(l)}catch(S){throw(p=ie(S.code))!=null?p:_e("Unauthorized")}return{signature:h}}async postMessage(e){var l;const[n]=await this.getMembershipPDA(e.channel);let i,s=0;if(e.encrypt){const h=await this.loadMembership(n);if(!h.cek.header)throw _e("Unauthorized");const p=await this.decryptCEK(h.cek);i=await this.encryptMessage(e.message,p),s|=1}else i=e.message;const a=new se;a.add(hi({channel:e.channel,membership:n,authority:this.provider.publicKey},{message:String.fromCharCode(s)+i}));let r;try{r=await this.provider.sendAndConfirm(a)}catch(h){throw(l=ie(h.code))!=null?l:h}return{signature:r}}}const _t="***** *** *** *** *******",ae=dt("messenger",()=>{const t=pt(),e=ze(),n=Ct(),i=v(()=>e.keypair),s={allChannels:[],ownChannels:[],channel:void 0,channelAddr:void 0,channelMembershipAddr:void 0,channelMembership:void 0,channelMembers:[],channelMessages:[],channelLoading:!1,loading:!1,creating:!1,sending:!1},a=me({...s}),r=v(()=>{var f;return new xi(new bt(t.connection,(f=n.value)!=null?f:{publicKey:I.default},bt.defaultOptions()),e.keypair)});let l=[];ve(()=>t.cluster,()=>{S().then()},{immediate:!0}),ve(n,f=>{f||(_(),S().then())},{immediate:!0}),ve([i,()=>a.allChannels],()=>{h().then()},{immediate:!0});async function h(){var A;const x=(await r.value.loadMemberships((A=e.keypair)==null?void 0:A.publicKey)).map(j=>({pubkey:j.data[0].channel.toBase58(),status:j.data[0].status.__kind}));Za.forEach(j=>{x.find(ge=>ge.pubkey===j)||x.push({pubkey:j,status:"Unauthorized"})}),a.ownChannels=x,console.log("myChannels ====== ",a.ownChannels)}async function p(){console.log("Register events...");for(const f of l)await r.value.removeEventListener(f);l.push(r.value.addEventListener("NewMessageEvent",async f=>{if(console.log("[Event] NewMessageEvent",f),`${f.channel}`!=`${a.channelAddr}`)return;let x=f.message.content;if(r.value.utils.message.isEncrypted(f.message)){const j=await y();j?x=await r.value.decryptMessage(f.message.content,j):x=_t}a.channelMessages.push({...f.message,content:x})})),l.push(r.value.addEventListener("AuthorizeMemberEvent",async f=>{console.log("[Event] AuthorizeMemberEvent",f),!(a.channelAddr&&`${f.channel}`!=`${a.channelAddr}`)&&(`${f.membership}`==`${a.channelMembershipAddr}`?w(a.channelAddr).then():L().then())})),l.push(r.value.addEventListener("JoinChannelEvent",async f=>{console.log("[Event] JoinChannelEvent",f),`${f.channel}`==`${a.channelAddr}`&&L().then()})),l.push(r.value.addEventListener("LeaveChannelEvent",async f=>{console.log("[Event] LeaveChannelEvent",f),`${f.channel}`==`${a.channelAddr}`&&L().then()}))}async function S(){_(),l=[],a.loading=!0;const f=await r.value.loadAllChannels();await p(),a.allChannels=f,a.loading=!1,console.log(a)}function _(){Object.assign(a,s)}async function W(f,x=15){try{a.creating=!0;const{channel:A}=await r.value.initChannel({name:f,maxMessages:x,opts:{commitment:"confirmed"}});await w(A.publicKey),a.channel&&a.allChannels.push({pubkey:A.publicKey,data:a.channel})}finally{a.creating=!1}}async function K(f){const x=new I(f);await r.value.deleteChannel({channel:x,opts:{commitment:"confirmed"}}),await S()}async function E(f,x){const A=new I(f);await r.value.joinChannel({channel:A,name:x,opts:{commitment:"confirmed"}}),await w(f)}async function w(f){var x;a.channelLoading=!0,a.channelMessages=[],a.channelMembers=[],a.channelMembershipAddr=void 0,a.channelMembership=void 0,a.channelAddr=new I(f);try{if((x=n.value)!=null&&x.publicKey)try{const[A]=await r.value.getMembershipPDA(a.channelAddr);a.channelMembershipAddr=A,a.channelMembership=await r.value.loadMembership(A)}catch(A){console.log(A),a.channelMembershipAddr=void 0,a.channelMembership=void 0}await L(),await M()}catch(A){console.log("Error",A)}finally{a.channelLoading=!1}}async function y(){if(!!a.channelMembership)try{return await r.value.decryptCEK(a.channelMembership.cek)}catch(f){console.log(f)}}async function M(){if(!a.channelAddr){console.log("Invalid channel");return}a.channel=await r.value.loadChannel(a.channelAddr);const x=r.value.utils.channel.isPublic(a.channel)?null:await y();a.channelMessages=await Promise.all(a.channel.messages.map(async A=>{var $e;let ge=r.value.utils.message.isEncrypted(A)?_t:A.content,fe=Qe(A.sender);if(($e=n.value)!=null&&$e.publicKey){const ye=a.channelMembers.find(({data:be})=>be.name!==""&&(`${be.authority}`==`${A.sender}`||`${be.key}`==`${A.sender}`));ye&&ye.data.name!==""&&(fe=ye.data.name)}if(x)try{ge=await r.value.decryptMessage(A.content,x)}catch{console.log(`Failed to decrypt message #${A.id}`)}return{...A,senderDisplayName:fe,content:ge}}))}async function L(){if(!a.channelAddr){console.error("Invalid channel");return}a.channelMembers=await r.value.loadChannelMembers(a.channelAddr)}async function z(f){if(!a.channelAddr){console.log("Please select a channel");return}try{a.sending=!0,await r.value.postMessage({channel:a.channelAddr,message:f}),await M()}finally{a.sending=!1}}async function C(f,x,A,j){if(!a.channelAddr){console.log("Invalid channel");return}await r.value.addMember({channel:a.channelAddr,invitee:new I(f),key:x?new I(x):void 0,name:A,flags:j})}async function R(f){if(!a.channelAddr){console.log("Invalid channel");return}await r.value.deleteMember({channel:a.channelAddr,key:new I(f)})}async function P(f){if(!a.channelAddr){console.log("Invalid channel");return}await r.value.authorizeMember({channel:a.channelAddr,key:new I(f)}),await M()}async function H(){await S()}return{state:a,client:r.value,loadChannel:w,joinChannel:E,createChannel:W,deleteChannel:K,postMessage:z,addMember:C,deleteMember:R,authorizeMember:P,refreshList:H}}),Ei=O({__name:"MemberListDialog",props:{membersDialog:{type:Boolean,default:!1},isAuthorizedMember:{type:Boolean,default:!1},authorizeMemberState:{type:Object},deleteMemberState:{type:Object},wallet:{type:Object}},emits:["submit","deleteMember"],setup(t,{emit:e}){const{state:n}=ae(),i=ze(),s=v(()=>{var p;return((p=n.channelMembership)==null?void 0:p.status.__kind)==="Authorized"}),a=v(()=>s.value),r=p=>v(()=>{var S;return a.value&&String(p.key)!==String((S=i.keypair)==null?void 0:S.publicKey)}).value;function l(p){return(p==null?void 0:p.name)&&p.name!==""?p.name:Qe(p.authority)}function h(p){return(p==null?void 0:p.__kind)==="Authorized"?"positive":"grey"}return(p,S)=>(g(),b(ke,null,{default:c(()=>[o(ne,null,{default:c(()=>[o(G,null,{default:c(()=>[o(Ve,{separator:""},{default:c(()=>[(g(!0),N(ee,null,we(d(n).channelMembers,_=>(g(),b(Y,{key:_.pubkey.toString(),"active-class":"bg-teal-1",active:`${_.pubkey}`==`${d(n).channelMembershipAddr}`},{default:c(()=>[o(q,null,{default:c(()=>[o(it,null,{default:c(()=>[$(T(l(_.data))+" ",1),o(An,{color:h(_.data.status)},{default:c(()=>[$(T(_.data.status.__kind),1)]),_:2},1032,["color"])]),_:2},1024),o(it,{caption:"",lines:"2"},{default:c(()=>[u("div",null,"Authority: "+T(_.data.authority),1),u("div",null,"Key: "+T(_.data.key),1)]),_:2},1024)]),_:2},1024),o(q,{side:"",class:"q-gutter-sm"},{default:c(()=>[_.data.status.__kind==="Pending"&&d(s)&&(!_.data.status.authority||String(_.data.status.authority)===String(t.wallet.publicKey.value))?(g(),b(B,{key:0,color:"teal",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:t.authorizeMemberState.loading,disabled:t.authorizeMemberState.loading,onClick:W=>p.$emit("submit",_.data.key)},{default:c(()=>[$(" Authorize ")]),_:2},1032,["loading","disabled","onClick"])):ue("",!0),r(_.data)?(g(),b(B,{key:1,color:"negative",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:t.deleteMemberState.loading,disabled:t.deleteMemberState.loading,onClick:W=>p.$emit("deleteMember",_.data.key)},{default:c(()=>[$(" Delete ")]),_:2},1032,["loading","disabled","onClick"])):ue("",!0)]),_:2},1024)]),_:2},1032,["active"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}}),$i=t=>(xe("data-v-058651c4"),t=t(),Ee(),t),Di=$i(()=>u("br",null,null,-1)),Ki=O({__name:"JoinChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t,{emit:e}){const i=U(t.defaultState);return(s,a)=>(g(),b(ke,{class:"join-channel-dialog",onHide:a[3]||(a[3]=r=>s.$emit("reset"))},{default:c(()=>[o(ne,null,{default:c(()=>[o(G,null,{default:c(()=>[o(Ue,{class:"join-channel-form",onSubmit:a[2]||(a[2]=je(r=>s.$emit("submit",i.value),["prevent"]))},{default:c(()=>[o(te,{modelValue:i.value.name,"onUpdate:modelValue":a[0]||(a[0]=r=>i.value.name=r),placeholder:"Member name *","lazy-rules":"",rules:[r=>r&&r.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(te,{modelValue:i.value.authority,"onUpdate:modelValue":a[1]||(a[1]=r=>i.value.authority=r),placeholder:"Authorize By","lazy-rules":"",rules:[r=>!r||r&&r.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),Di,o(B,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[$(" Join Channel ")]),_:1})]),_:1}),o(Ie,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Pi=F(Ki,[["__scopeId","data-v-058651c4"]]),Ii=t=>(xe("data-v-a5f1d45d"),t=t(),Ee(),t),zi=Ii(()=>u("br",null,null,-1)),Bi=O({__name:"AddMemberDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=U(t.defaultState);return(i,s)=>(g(),b(ke,{class:"add-member-dialog",onHide:s[4]||(s[4]=a=>i.$emit("reset"))},{default:c(()=>[o(ne,null,{default:c(()=>[o(G,null,{default:c(()=>[o(Ue,{class:"add-member-form",onSubmit:s[3]||(s[3]=je(a=>i.$emit("submit",n.value),["prevent"]))},{default:c(()=>[o(te,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.name=a),label:"Member name *",hint:"Min length 3 chars","lazy-rules":"",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(te,{modelValue:n.value.key,"onUpdate:modelValue":s[1]||(s[1]=a=>n.value.key=a),label:"Member Wallet *","lazy-rules":"",rules:[a=>a&&a.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),o(te,{modelValue:n.value.key,"onUpdate:modelValue":s[2]||(s[2]=a=>n.value.key=a),label:"Member Device Key",hint:"Default: The same as member wallet","lazy-rules":"",rules:[a=>!a||a.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),zi,o(B,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[$(" Add Member ")]),_:1})]),_:1}),o(Ie,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Ti=F(Bi,[["__scopeId","data-v-a5f1d45d"]]),Wi=O({__name:"NewChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=U(t.defaultState);return(i,s)=>(g(),b(ke,{class:"new-channel-dialog",onHide:s[3]||(s[3]=a=>i.$emit("reset"))},{default:c(()=>[o(ne,null,{default:c(()=>[o(G,null,{default:c(()=>[o(Ue,{class:"messenger-new-channel-form",onSubmit:s[2]||(s[2]=je(a=>i.$emit("submit",n.value),["prevent"]))},{default:c(()=>[o(te,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.name=a),label:"Channel name *","lazy-rules":"",maxlength:"32",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(te,{modelValue:n.value.maxMessages,"onUpdate:modelValue":s[1]||(s[1]=a=>n.value.maxMessages=a),label:"Max messages","lazy-rules":"",rules:[a=>+a>0||"Invalid value"]},null,8,["modelValue","rules"]),o(B,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[$(" Create Channel ")]),_:1})]),_:1}),o(Ie,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Li=F(Wi,[["__scopeId","data-v-d329d80c"]]),Ni=O({__name:"ChannelForm",props:{message:{type:String,default:""},disabled:{type:Boolean,default:!1},sending:{type:Boolean,default:!1}},emits:["submit"],setup(t,{emit:e}){const i=U(t.message),s=()=>{e("submit",i),i.value=""};return(a,r)=>(g(),b(Ue,{class:"channel-form",onSubmit:je(s,["prevent"])},{default:c(()=>[o(mt,{class:"row message-control"},{default:c(()=>[o(te,{ref:"inputFocus",modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=l=>i.value=l),class:"col-grow message-input","bg-color":"white",placeholder:"Type a message",dense:"",borderless:"",autofocus:"",disable:t.disabled},null,8,["modelValue","disable"]),o(B,{class:"send-btn",square:"",flat:"",type:"submit",disable:t.disabled,loading:t.sending},{default:c(()=>[$(" Send ")]),_:1},8,["disable","loading"])]),_:1})]),_:1},8,["onSubmit"]))}});const Ri=F(Ni,[["__scopeId","data-v-23f62c62"]]),Vi={key:0,class:"row justify-center channel-wrapper"},Oi={key:1,class:"messenger-empty"},Fi={key:1,class:"messenger-empty"},Ui=O({__name:"ChannelWrapper",props:{channel:{type:Object},messages:{type:Array},postMessageState:{type:Object},isSomeoneMessage:{type:Function,default:()=>!1},allowSend:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},channelLoadingState:{type:Boolean,default:!1}},emits:["sendMessage"],setup(t,{emit:e}){const n=a=>e("sendMessage",a),i=U(),s=U();return ve(s,a=>{a&&(i.value.scrollTop=a.scrollHeight)}),(a,r)=>{const l=Ri;return g(),b(ne,{class:"messenger-card",square:""},{default:c(()=>[u("div",{ref_key:"chat",ref:i,class:"messenger-content"},[t.channel?(g(),N("div",Vi,[t.messages.length>0?(g(),N("div",{key:0,ref_key:"mes",ref:s,class:"messenger-messages"},[(g(!0),N(ee,null,we(t.messages,h=>(g(),b(kn,{key:h.id,name:h.senderDisplayName,text:h.text,sent:t.isSomeoneMessage(h.sender)},null,8,["name","text","sent"]))),128))],512)):(g(),N("div",Oi," No messages "))])):(g(),N("div",Fi," Please select a channel "))],512),o(l,{message:t.postMessageState.message,sending:t.loading,disabled:!t.allowSend,onSubmit:n},null,8,["message","sending","disabled"]),o(Ie,{showing:t.channelLoadingState},null,8,["showing"])]),_:1})}}});const ji=F(Ui,[["__scopeId","data-v-dd790f52"]]),Qi=O({props:{text:{type:String,default:""}}});function Ji(t,e,n,i,s,a){return g(),b(St,{anchor:"top middle",self:"center middle",class:"bg-grey-9 text-body2"},{default:c(()=>[$(T(t.text),1)]),_:1})}const Gi=F(Qi,[["render",Ji]]),qi="/sol-messenger/assets/refresh.e0cf4262.svg",Hi="/sol-messenger/assets/add.1481b8ed.svg",Xi="/sol-messenger/assets/join.627c8616.svg",gt=t=>(xe("data-v-18f1740e"),t=t(),Ee(),t),Zi=gt(()=>u("img",{src:qi,alt:"refresh",title:"create channel"},null,-1)),Yi=gt(()=>u("img",{src:Hi,alt:"create"},null,-1)),er=gt(()=>u("img",{src:Xi,alt:"join"},null,-1)),tr=O({__name:"ChannelControl",props:{isPendingMember:{type:Boolean,default:!1},canJoinChannel:{type:Boolean,default:!1},isJoining:{type:Boolean,default:!1}},emits:["createChannel","joinChannel","refreshList"],setup(t){return(e,n)=>{const i=Gi;return g(),b(Y,null,{default:c(()=>[o(q,{class:"button-wrapper"},{default:c(()=>[o(B,{class:"control-button",square:"",onClick:n[0]||(n[0]=s=>e.$emit("refreshList"))},{default:c(()=>[Zi,o(i,{text:"Refresh list"})]),_:1}),o(B,{class:"control-button",square:"",onClick:n[1]||(n[1]=s=>e.$emit("createChannel"))},{default:c(()=>[Yi,o(i,{text:"Create a channel"})]),_:1}),t.canJoinChannel?(g(),b(B,{key:0,class:"control-button",square:"",loading:t.isJoining,disable:t.isPendingMember,onClick:n[2]||(n[2]=s=>e.$emit("joinChannel"))},{default:c(()=>[er,o(i,{text:"Join the channel"})]),_:1},8,["loading","disable"])):ue("",!0)]),_:1})]),_:1})}}});const nr=F(tr,[["__scopeId","data-v-18f1740e"]]),ar={class:"chat-name"},sr={key:0,class:"message-count"},ir=O({__name:"MessengerChannel",props:{channel:Object,state:Object},emits:["selectChannel"],setup(t,{emit:e}){const n=()=>e("selectChannel"),i=s=>{if(!s)return{background:"#000"};let a=0;for(let l=0;l<s.length;l++)a=s.charCodeAt(l)+((a<<5)-a),a=a&a;let r="#";for(let l=0;l<3;l++)r+=`00${(a>>l*8&255).toString(16)}`.substr(-2);return{background:r}};return(s,a)=>(g(),b(Y,{"active-class":"bg-blue-grey-1 text-grey-8",active:`${t.state.channelAddr}`==`${t.channel.pubkey}`},{default:c(()=>[o(q,{class:"chat-item cursor-pointer",onClick:n},{default:c(()=>[u("div",{class:"chat-badge",style:xn(i(`${t.channel.pubkey}`))},[u("span",null,T(t.channel.data.name.slice(0,2)),1)],4),u("div",ar,T(t.channel.data.name),1),t.channel.data.messageCount?(g(),N("div",sr,T(t.channel.data.messageCount),1)):ue("",!0)]),_:1})]),_:1},8,["active"]))}});const rr=F(ir,[["__scopeId","data-v-bb6f6044"]]),or=15;function Bt(){const t=de(),{state:e,refreshList:n}=ae(),i=ze(),s=v(()=>!!t.publicKey.value),a=v(()=>{var y;return((y=e.channelMembership)==null?void 0:y.status.__kind)==="Authorized"}),r=v(()=>{var y;return((y=e.channelMembership)==null?void 0:y.status.__kind)==="Pending"}),l=v(()=>{var y,M;return a.value&&((y=e.channel)==null?void 0:y.creator.toString())===String((M=t.publicKey.value)!=null?M:"-")}),h=v(()=>a.value&&!e.sending),p=v(()=>a.value),S=y=>v(()=>{var M;return l.value&&String(y.key)!==String((M=i.keypair)==null?void 0:M.publicKey)}).value,_=v(()=>s.value&&!e.loading&&!a.value),W=v(()=>e.channelMembers.filter(y=>Ws(y.data.status)).length),K=v(()=>{const y=[];let M=0,L;for(const z of e.channelMessages)L&&`${z.sender}`==`${L}`?y[M-1].text.push(z.content):(L=z.sender,y.push({id:z.id,sender:z.sender,senderDisplayName:z.senderDisplayName,text:[z.content],date:z.createdAt}),M++);return y}),E=v(()=>e.allChannels.filter(y=>!!e.ownChannels.find(M=>M.pubkey===y.pubkey.toBase58()))),w=v(()=>e.allChannels);return{isWalletConnected:s,isAuthorizedMember:a,isPendingMember:r,isChannelCreator:l,canJoinChannel:_,canDeleteMember:S,canAddMember:p,allowSend:h,pendingMemberCount:W,ownChannels:E,allChannels:w,messages:K,refreshList:n,loading:v(()=>e.loading)}}function lr(){const{createChannel:t}=ae(),{isWalletConnected:e,ok:n,error:i}=Be(),s=me({dialog:!1,name:"",maxMessages:or,loading:!1});async function a(){if(e())try{await t(s.name,s.maxMessages),r(),n("Channel was created!")}catch(l){i("Something went wrong"),console.log(l)}}function r(){s.dialog=!1,s.loading=!1,s.name="",s.maxMessages=15}return{state:s,submit:a,reset:r}}function cr(){const{authorizeMember:t}=ae(),{ok:e,error:n}=Be(),i=me({loading:!1,dialog:!1});async function s(a){try{i.loading=!0,await t(a),e("Member was authorized")}catch(r){n("Something went wrong"),console.log(r)}finally{i.loading=!1}}return{state:i,submit:s}}function ur(){const{state:t,addMember:e}=ae(),{ok:n,info:i,error:s}=Be(),a=me({dialog:!1,loading:!1});async function r(h){if(a.loading=!0,!t.channelAddr){i("Please select a channel");return}try{return await e(h.authority,h.key,h.name),n("Member was added"),!0}catch(p){s("Something went wrong"),console.log(p)}finally{a.loading=!1}return!1}function l(){a.loading=!1,a.dialog=!1}return{state:a,submit:r,reset:l}}function dr(){const{deleteMember:t}=ae(),{ok:e,error:n}=Be(),i=me({loading:!1});async function s(a){try{i.loading=!0,await t(a),e("Member was deleted")}catch(r){n("Something went wrong"),console.log(r)}finally{i.loading=!1}}return{state:i,submit:s}}function mr(){const{state:t,joinChannel:e}=ae(),{ok:n,info:i,error:s}=Be(),a=me({dialog:!1,loading:!1,name:""});async function r(){if(!t.channelAddr){i("Please select a channel");return}a.loading=!0;try{await e(t.channelAddr,a.name),l(),n("Request was sent")}catch(h){console.log("Error",h),s("Something went wrong")}finally{a.loading=!1}}function l(){a.loading=!1,a.dialog=!1,a.name=""}return{state:a,submit:r,reset:l}}function Be(){const t=de(),{notify:e}=Ae(),n=r=>e({type:"positive",message:r,timeout:2e3}),i=r=>e({type:"info",message:r,timeout:2e3}),s=r=>e({type:"negative",message:r,timeout:2e3});function a(){return t.publicKey.value?!0:(i("Please connect wallet"),!1)}return{ok:n,info:i,error:s,isWalletConnected:a}}const hr={class:"panel-search"},pr={class:"search-wrapper"},gr={class:"panel-info"},fr={class:"chat-info"},yr={class:"chat-members"},br={class:"chat-messages"},_r={class:"chat-name"},vr=O({__name:"MessengerToolbar",emits:["search","showMembers","deleteChannel","addMember","showDeviceKey"],setup(t,{emit:e}){const n=de(),{state:i}=ae(),{canAddMember:s,isChannelCreator:a}=Bt(),r=v(()=>!!n.publicKey.value),l=U(""),h=v(()=>i.channel),p=v(()=>{var E,w,y;return((E=h.value)==null?void 0:E.memberCount)===null||((w=h.value)==null?void 0:w.memberCount)===void 0?"":`${(y=h.value)==null?void 0:y.memberCount}\xA0members`}),S=v(()=>{var E,w,y;return((E=h.value)==null?void 0:E.messageCount)===null||((w=h.value)==null?void 0:w.messageCount)===void 0?"":`${(y=h.value)==null?void 0:y.messageCount}\xA0messages`}),_=E=>e("search",E),W=()=>e("showMembers"),K=()=>e("addMember");return ve(l,E=>{_(String(E))}),(E,w)=>(g(),b(mt,{class:"panel-toolbar"},{default:c(()=>{var y;return[u("div",hr,[u("div",pr,[o(te,{modelValue:l.value,"onUpdate:modelValue":w[0]||(w[0]=M=>l.value=M),class:"search-input no-margin q-pa-none",placeholder:"Search ...",clearable:"",debounce:"300",borderless:"",onClear:w[1]||(w[1]=M=>l.value="")},null,8,["modelValue"])])]),u("div",gr,[u("div",fr,[u("div",yr,T(d(p)),1),u("div",br,T(d(S)),1)]),o(ht,{class:""}),u("div",_r,T((y=d(h))==null?void 0:y.name),1),u("div",null,[o(B,{class:"chat-menu",flat:"",unelevated:"",disable:!d(r)},{default:c(()=>[o(En,{name:d($n)},null,8,["name"]),o(Dn,{anchor:"bottom left",self:"top left"},{default:c(()=>[o(Ve,{style:{"min-width":"150px"},bordered:""},{default:c(()=>[De((g(),b(Y,{clickable:"",onClick:w[2]||(w[2]=M=>E.$emit("showDeviceKey"))},{default:c(()=>[o(q,null,{default:c(()=>[$("Device key")]),_:1})]),_:1})),[[Ke]]),De((g(),b(Y,{clickable:"",disable:!d(h),onClick:W},{default:c(()=>[o(q,null,{default:c(()=>[$("Members")]),_:1})]),_:1},8,["disable"])),[[Ke]]),De((g(),b(Y,{clickable:"",disable:!d(s),onClick:K},{default:c(()=>[o(q,null,{default:c(()=>[$("Add member")]),_:1})]),_:1},8,["disable"])),[[Ke]]),De((g(),b(Y,{clickable:"",disable:!d(a),onClick:w[3]||(w[3]=M=>E.$emit("deleteChannel"))},{default:c(()=>[o(q,null,{default:c(()=>[$("Delete")]),_:1})]),_:1},8,["disable"])),[[Ke]])]),_:1})]),_:1})]),_:1},8,["disable"])])])]}),_:1}))}});const wr=F(vr,[["__scopeId","data-v-37687674"]]),Cr={class:"messenger-wrapper"},Mr={class:"messenger-main"},Sr={key:1,class:"messenger-channels-empty"},Ar={key:0,class:"q-my-md q-px-lg"},kr={class:"col col-4"},xr={class:"col"},Er={class:"no-margin"},$r=O({__name:"Messenger",setup(t){Ae();const e=de(),{state:n,postMessage:i,loadChannel:s}=ae(),{isWalletConnected:a,isAuthorizedMember:r,isPendingMember:l,messages:h,allowSend:p,canJoinChannel:S,isChannelCreator:_,loading:W,refreshList:K,ownChannels:E,allChannels:w}=Bt(),y=lr(),M=mr(),L=ur(),z=cr(),C=dr(),R=me({message:""}),P=U([]),H=U("");async function f(J){await i(J.value),R.message=""}async function x(J){await s(J)}function A(J){const k=e.publicKey.value;return k?String(k)!==String(J):!0}const j=J=>{if(J===""){P.value=[],H.value="";return}P.value=w.value.filter(k=>k.data.name.toLocaleLowerCase().includes(J.toLocaleLowerCase())||k.pubkey.toBase58().toLocaleLowerCase().includes(J.toLocaleLowerCase())),H.value=J},ge=()=>{z.state.dialog=!0},fe=U(!1),$e=U(!1),ye=Kn($e),be=v(()=>P.value.length>0||H.value.length>0?P.value:E.value);return(J,k)=>{const Tt=wr,Wt=rr,Lt=nr,Nt=ji,Rt=Li,Vt=Ti,Ot=Pi,Ft=Ei,Ut=ks;return g(),N(ee,null,[u("div",Cr,[o(Tt,{onSearch:j,onShowMembers:ge,onDeleteChannel:k[0]||(k[0]=D=>d(C).submit(d(n).channelAddr)),onAddMember:k[1]||(k[1]=D=>d(L).state.dialog=!0),onShowDeviceKey:k[2]||(k[2]=D=>fe.value=!0)}),u("div",Mr,[o(ne,{class:"messenger-channels"},{default:c(()=>[d(be).length>0?(g(),b(Ve,{key:0,separator:"",class:"channels-list"},{default:c(()=>[(g(!0),N(ee,null,we(d(be),D=>(g(),b(Wt,{key:D.name,channel:D,state:d(n),onSelectChannel:eo=>x(D.pubkey)},null,8,["channel","state","onSelectChannel"]))),128))]),_:1})):(g(),N("div",Sr," No channels ")),o(Ie,{showing:d(n).loading,color:"primary"},null,8,["showing"]),o(Lt,{"can-join-channel":d(S),"is-authorized-member":d(r),"is-pending-member":d(l),"is-wallet-connected":d(a),onCreateChannel:k[3]||(k[3]=D=>d(y).state.dialog=!0),onJoinChannel:k[4]||(k[4]=D=>d(M).state.dialog=!0),onRefreshList:d(K)},null,8,["can-join-channel","is-authorized-member","is-pending-member","is-wallet-connected","onRefreshList"])]),_:1}),o(Nt,{channel:d(n).channel,"allow-send":d(p),"channel-loading-state":d(n).channelLoading,"is-someone-message":A,messages:d(h),"post-message-state":R,"sending-state":d(n).sending,onSendMessage:f},null,8,["channel","allow-send","channel-loading-state","messages","post-message-state","sending-state"])])]),o(Rt,{modelValue:d(y).state.dialog,"onUpdate:modelValue":k[5]||(k[5]=D=>d(y).state.dialog=D),loading:d(y).state.loading,"default-state":d(y).state,onSubmit:d(y).submit,onReset:d(y).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),o(Vt,{modelValue:d(L).state.dialog,"onUpdate:modelValue":k[6]||(k[6]=D=>d(L).state.dialog=D),loading:d(L).state.loading,"default-state":d(L).state,onSubmit:d(L).submit,onReset:d(L).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),o(Ot,{modelValue:d(M).state.dialog,"onUpdate:modelValue":k[7]||(k[7]=D=>d(M).state.dialog=D),loading:d(M).state.loading,"default-state":d(M).state,onSubmit:d(M).submit,onReset:d(M).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),o(Ft,{modelValue:d(z).state.dialog,"onUpdate:modelValue":k[8]||(k[8]=D=>d(z).state.dialog=D),"is-authorized-member":d(r),wallet:d(e),"authorize-member-state":d(z).state,"delete-member-state":d(C).state,onSubmit:d(z).submit,onDeleteMember:d(C).submit},null,8,["modelValue","is-authorized-member","wallet","authorize-member-state","delete-member-state","onSubmit","onDeleteMember"]),o(Ut,{modelValue:fe.value,"onUpdate:modelValue":k[9]||(k[9]=D=>fe.value=D)},null,8,["modelValue"]),d(n).channel?(g(),N("div",Ar,[o(B,{flat:"",class:"text-blue-2",onClick:k[10]||(k[10]=D=>d(ye)())},{default:c(()=>[$(" debug info ")]),_:1}),$e.value?(g(!0),N(ee,{key:0},we([["Authorized",d(r)],["Pending Access",d(l)],["Channel Creator",d(_)],["Channel",d(n).channel],["Membership",d(n).channelMembership],["Members",d(n).channelMembers]],D=>(g(),N("div",{key:D[0],class:"row q-mt-md"},[u("div",kr,T(D[0]),1),u("div",xr,[u("pre",Er,T(D[1]),1)])]))),128)):ue("",!0)])):ue("",!0)],64)}}});const Dr=F($r,[["__scopeId","data-v-e03ac2a8"]]);const Kr={},Pr={class:"container"},Ir={class:"messenger-container"},zr={class:"container"};function Br(t,e){const n=Dr,i=Cs;return g(),b(Pn,{class:"page-wrapper"},{default:c(()=>[u("div",Pr,[u("div",Ir,[o(n)])]),u("div",zr,[o(i)])]),_:1})}const Tr=F(Kr,[["render",Br],["__scopeId","data-v-8f1b09e0"]]),Wr=()=>Mt(()=>import("./_...all_.d16afdbf.js"),["assets/_...all_.d16afdbf.js","assets/vendor.28daed3d.js","assets/_...all_.73169310.css"]),Lr=[{name:"index",path:"/",component:Tr,props:!0},{name:"all",path:"/:all(.*)*",component:Wr,props:!0,meta:{layout:"empty"}}],Nr=ms(Lr),Rr="/sol-messenger/",Vr=In({history:zn(Rr),scrollBehavior:()=>({left:0,top:0}),strict:!0,routes:Nr}),Or=({app:t})=>{t.use(Vr)},Fr=Object.freeze(Object.defineProperty({__proto__:null,install:Or},Symbol.toStringTag,{value:"Module"})),Ur=({app:t})=>{t.use(Bn,{wallets:[new Tn,new Wn,new Ln,new Nn,new Rn,new Vn,new On,new Fn,new Un,new jn,new Qn,new Jn,new Gn,new qn,new Hn,new Xn,new Zn,new Yn,new ea,new ta,new na,new aa,new sa,new ia,new ra,new oa,new la,new ca,new ua,new da],autoConnect:!1})},jr=Object.freeze(Object.defineProperty({__proto__:null,install:Ur},Symbol.toStringTag,{value:"Module"})),Qr=ma();function Jr(){return Qr}const Gr=Symbol("WALLET_CONNECT_EVENT"),qr=Symbol("WALLET_DISCONNECT_EVENT"),Hr=Symbol("ACCOUNT_CHANGE_EVENT"),at=5e3;function Xr(){const{connection:t}=pt(),{emit:e}=Jr(),{notify:n}=Ae(),{wallet:i}=de();ve(i,s=>{if(!s)return;const a=()=>{const h=s.adapter.publicKey;t.onAccountChange(h,p=>{e(Hr,p)}),t.onLogs(h,p=>{console.log(p)}),n({message:"Wallet update",caption:`Connected to wallet ${Qe(h.toBase58(),7)}`,timeout:at}),e(Gr,s)},r=()=>{n({message:"Wallet update",caption:"Disconnected from wallet",timeout:at}),e(qr,s)},l=h=>{!(h!=null&&h.message)||n({type:"negative",message:"Wallet update",caption:h.message,timeout:at})};s.adapter.once("connect",a),s.adapter.once("disconnect",r),s.adapter.removeAllListeners("error"),s.adapter.on("error",l)},{immediate:!0})}const Zr=O({__name:"App",setup(t){return ha(()=>{Xr()}),(e,n)=>{const i=Oe("router-view");return g(),b(i)}}});async function Yr(){const t=pa(Zr);Object.values(Object.assign({"./plugins/pinia.ts":fa,"./plugins/quasar.ts":ba,"./plugins/router.ts":Fr,"./plugins/wallet.ts":jr})).forEach(e=>{var n;return(n=e.install)==null?void 0:n.call(e,{app:t})}),t.mount("#app")}Yr().then();export{F as _};
