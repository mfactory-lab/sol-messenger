var Gt=Object.defineProperty;var Jt=(n,e,t)=>e in n?Gt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var N=(n,e,t)=>(Jt(n,typeof e!="symbol"?e+"":e,t),t);import{c as qt,Q as Ht,P as Xt,N as Zt,a as Yt,i as en,b as x,d as Ee,u as qe,e as Ke,f as z,r as Se,g as Pe,o as f,h as E,j as y,k as S,w as l,l as M,t as K,m as st,n as P,p as o,q as J,s as O,v as Me,x as A,y as tn,z as Ce,A as ie,B as nn,C as ye,F as Q,D as an,W as rt,E as ht,G as pt,H as sn,I as He,J as rn,K as on,L as Ue,M as re,O as ge,R,S as ln,T as yt,U as it,V as cn,X as un,Y as dn,_ as gt,Z as ft,$ as mn,a0 as hn,a1 as oe,a2 as ot,a3 as d,a4 as U,a5 as bt,a6 as ee,a7 as te,a8 as fe,a9 as _t,aa as le,ab as pn,ac as De,ad as wt,ae as Oe,af as yn,ag as gn,ah as lt,ai as fn,aj as bn,ak as H,al as Z,am as ct,an as At,ao as _n,ap as pe,aq as ut,ar as wn,as as An,at as we,au as Ae,av as G,aw as vn,ax as kn,ay as Mn,az as Sn,aA as Cn,aB as xn,aC as En,aD as Kn,aE as Pn,aF as Dn,aG as zn,aH as In,aI as Nn,aJ as Tn,aK as Bn,aL as Wn,aM as Rn,aN as $n,aO as Ln,aP as Vn,aQ as Fn,aR as Un,aS as On,aT as Qn,aU as jn,aV as Gn,aW as Jn,aX as qn,aY as Hn,aZ as Xn,a_ as Zn,a$ as Yn,b0 as ea,b1 as ta,b2 as na,b3 as aa,b4 as sa}from"./vendor.0ed7373c.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const ra=({app:n})=>{const e=qt();n.use(e)},ia=Object.freeze(Object.defineProperty({__proto__:null,install:ra},Symbol.toStringTag,{value:"Module"})),oa=({app:n})=>{n.use(Ht,{plugins:{Dark:Xt,Notify:Zt,LocalStorage:Yt},iconSet:en})},la=Object.freeze(Object.defineProperty({__proto__:null,install:oa},Symbol.toStringTag,{value:"Module"}));function ze(n,e=4){return n instanceof x&&(n=n.toBase58()),`${n.slice(0,e)}...${n.slice(-e)}`}const ca="/sol-messenger/assets/ledger.40cf6861.svg",ua="/sol-messenger/assets/mathwallet.1d763e81.svg",vt=n=>(ht("data-v-0bdf22f0"),n=n(),pt(),n),da=vt(()=>A("div",{class:"text-h6 text-center"}," Your wallet ",-1)),ma={class:"q-gutter-md row justify-between"},ha=vt(()=>A("div",{class:"text-h6"}," Connect to a wallet ",-1)),pa={class:"text-light-gray text-caption full-width text-no-wrap",style:{"text-overflow":"ellipsis",overflow:"hidden"}},ya=["src"],ga=Ee({__name:"ConnectWallet",setup(n){const e={solflare:10,phantom:20,sollet:5,nufi:5,blocto:1},t={ledger:ca,mathwallet:ua},a={close:an},s=b=>[rt.Installed,rt.Loadable].includes(b.readyState);qe();const i=Ke(),{connected:c,connecting:p}=i,w=z(()=>{var b,v;return(v=(b=i.publicKey.value)==null?void 0:b.toBase58())!=null?v:""}),_=z(()=>ze(w.value)),I=z(()=>[...i.wallets.value].map(b=>(b.darkIcon=t[b.name.toLowerCase()],b)).sort((b,v)=>{var g,k;const L=(g=e[b.name.toLowerCase()])!=null?g:1;return((k=e[v.name.toLowerCase()])!=null?k:1)-L+((s(v)?1:0)-(s(b)?1:0))})),C=Se(!1);async function T(b){await i.select(b.name),C.value=!1,await i.connect()}function D(){C.value=!1,i.disconnect()}function $(){C.value=!0}function q(){C.value=!1}return(b,v)=>{const L=Pe("copy-to-clipboard");return f(),E(Q,null,[y(c)?(f(),S(P,st({key:0},b.$attrs,{class:b.$style.btn,ripple:!1,color:"primary-gray","text-color":"white",rounded:"",unelevated:"",onClick:$}),{default:l(()=>[M(K(y(_)),1)]),_:1},16,["class"])):(f(),S(P,st({key:1},b.$attrs,{color:"primary-gray","text-color":"white",rounded:"",unelevated:"",ripple:!1,loading:y(p),onClick:$}),{default:l(()=>[M(" CONNECT WALLET ")]),_:1},16,["loading"])),o(ye,{modelValue:C.value,"onUpdate:modelValue":v[0]||(v[0]=u=>C.value=u),"transition-duration":"100","transition-show":"fade","transition-hide":"fade"},{default:l(()=>[y(c)?(f(),S(J,{key:0},{default:l(()=>[o(O,{class:"relative-position"},{default:l(()=>[da,o(P,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:q},null,8,["icon"])]),_:1}),o(Me),o(O,null,{default:l(()=>[o(L,{text:y(w)},null,8,["text"]),M(" "+K(y(w)),1)]),_:1}),o(Me),o(O,null,{default:l(()=>[A("div",ma,[o(P,{outline:"",rounded:"",onClick:D},{default:l(()=>[M(" Disconnect ")]),_:1}),o(P,{outline:"",rounded:"",onClick:q},{default:l(()=>[M(" Ok ")]),_:1})])]),_:1})]),_:1})):(f(),S(J,{key:1,class:"wallet-connect-card"},{default:l(()=>[o(O,null,{default:l(()=>[ha,o(P,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:q},null,8,["icon"])]),_:1}),o(Me),o(O,{style:{"max-height":"80vh"},class:"scroll"},{default:l(()=>[o(tn,{grid:"",rows:y(I),"row-key":"name","hide-pagination":"","hide-header":"","rows-per-page-options":[100]},{item:l(({row:u})=>[(f(),E("div",{key:`wallet-${u.name}`,class:"col-12 col-md-6"},[o(Ce,{clickable:"",disable:!s(u),onClick:g=>T(u)},{default:l(()=>[o(ie,null,{default:l(()=>[A("b",null,K(u.name),1),A("div",pa,K(u.url),1)]),_:2},1024),o(ie,{avatar:""},{default:l(()=>[o(nn,{square:""},{default:l(()=>{var g;return[A("img",{src:b.$q.dark.isActive?u.icon:(g=u.darkIcon)!=null?g:u.icon,alt:""},null,8,ya)]}),_:2},1024)]),_:2},1024)]),_:2},1032,["disable","onClick"])]))]),_:1},8,["rows"])]),_:1})]),_:1}))]),_:1},8,["modelValue"])],64)}}});const fa="_btn_6n1iw_1",ba={btn:fa},be=(n,e)=>{const t=n.__vccOpts||n;for(const[a,s]of e)t[a]=s;return t},_a={$style:ba},wa=be(ga,[["__cssModules",_a],["__scopeId","data-v-0bdf22f0"]]),ce=[{id:"jpool-mainnet",name:"Jpool RPC",cluster:"mainnet-beta",url:"https://jpoolone.genesysgo.net/"},{id:"serum-mainnet",name:"Serum RPC",cluster:"mainnet-beta",url:"https://solana-api.projectserum.com/"},{id:"rpcpool-mainnet",name:"RPCPool RPC",cluster:"mainnet-beta",url:"https://mainnet.rpcpool.com/"},{id:"mainnet",name:"Solana RPC",cluster:"mainnet-beta",url:sn("mainnet-beta")}],kt={id:"devnet",name:"DevNet",cluster:"devnet",url:"https://devnet.rpcpool.com/"};ce.push(kt);const Aa={id:"testnet",name:"TestNet",cluster:"testnet",url:"https://testnet.rpcpool.com/"};ce.push(Aa);var mt;const va=(mt=ce.find(n=>n.id==={VITE_BASE_PATH:"/sol-messenger/",BASE_URL:"/sol-messenger/",MODE:"staging",DEV:!1,PROD:!0}.VITE_CONNECTION_ENDPOINT))!=null?mt:kt,ka="confirmed",Ma=12e4,Xe=He({id:"connection",state:()=>({commitment:ka,confirmTransactionInitialTimeout:Ma,rpc:rn("rpc","")}),getters:{endpoint(n){var e;return(e=ce.find(t=>t.id===n.rpc))!=null?e:va},connection(n){return console.log("[connection]",this.endpoint.url),new on(this.endpoint.url,{confirmTransactionInitialTimeout:n.confirmTransactionInitialTimeout,commitment:n.commitment})},cluster(){return this.endpoint.cluster}},actions:{setRpc(n){this.rpc=n},setCommitment(n){this.commitment=n}}}),Sa=Ee({__name:"ClusterSelector",setup(n){const e=Xe(),{connected:t,connect:a,disconnect:s,autoConnect:i}=Ke(),c=[ce.filter(_=>_.cluster==="mainnet-beta"),ce.filter(_=>_.cluster!=="mainnet-beta")],p=z(()=>e.endpoint),w=_=>{t&&e.cluster!==_.cluster&&(s(),i.value&&a()),e.setRpc(_.id)};return(_,I)=>(f(),S(ln,{label:y(p).name,"model-value":!1,"auto-close":"",color:"secondary","text-color":"grey-8",rounded:"",unelevated:"",ripple:!1},{default:l(()=>[o(Ue,null,{default:l(()=>[(f(),E(Q,null,re(c,(C,T)=>(f(),E(Q,{key:`${T}-cluster-group`},[(f(!0),E(Q,null,re(C,D=>(f(),S(Ce,{key:D.id,clickable:"",onClick:$=>w(D)},{default:l(()=>[(f(),S(ie,{key:`${D.id}-item`},{default:l(()=>[o(ge,null,{default:l(()=>[A("b",null,K(D.name),1)]),_:2},1024),M(" "+K(D.url),1)]),_:2},1024))]),_:2},1032,["onClick"]))),128)),T!==c.length-1?(f(),S(Me,{key:0})):R("",!0)],64))),64))]),_:1})]),_:1},8,["label"]))}}),Ca={},xa={class:"container"},Ea={class:"app-header__logo"},Ka=A("div",{class:"app-header__nav"},[A("a",{href:"https://jpool.one",target:"_blank"},"JPOOL"),A("a",{href:"https://dev.svt.one",target:"_blank"},"Validator toolkit")],-1),Pa={class:"app-header__right"},Da={class:"app-header__buttons"};function za(n,e){const t=Pe("router-link"),a=Sa,s=wa;return f(),S(cn,{class:"app-header"},{default:l(()=>[A("div",xa,[o(yt,null,{default:l(()=>[A("div",Ea,[o(t,{to:"/"},{default:l(()=>[M(" SOM ")]),_:1})]),o(it),Ka,o(it),A("div",Pa,[A("div",Da,[o(a,{class:"app-header__cluster-btn"}),o(s,{class:"app-header__wallet-btn"})])])]),_:1})])]),_:1})}const Ia=be(Ca,[["render",za]]),Na={};function Ta(n,e){const t=Ia,a=Pe("router-view");return f(),S(un,{view:"lfh Lpr lff"},{default:l(()=>[o(t),o(dn,null,{default:l(()=>[o(a)]),_:1})]),_:1})}const Ba=be(Na,[["render",Ta]]),Wa={default:Ba,empty:()=>gt(()=>import("./empty.a78378be.js"),["assets/empty.a78378be.js","assets/vendor.0ed7373c.js"])};function Ra(n){return n.map(e=>{var t;return{path:e.path,component:Wa[((t=e.meta)==null?void 0:t.layout)||"default"],children:[{...e,path:""}]}})}const Mt=He("user",()=>{const n=ft(),e=Se();return mn(()=>{var a;const t=(a=n.value)==null?void 0:a.publicKey;if(t){const s=hn(t.toString(),()=>ot.encode(oe.generate().secretKey)).value;e.value=oe.fromSecretKey(ot.decode(s))}}),{keypair:e}}),$a="0.0.5",La="messenger",Va=[{name:"initChannel",accounts:[{name:"channel",isMut:!0,isSigner:!0},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"InitChannelData"}}]},{name:"deleteChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"joinChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"JoinChannelData"}}]},{name:"addMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"invitee",isMut:!1,isSigner:!1},{name:"inviteeMembership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AddMemberData"}}]},{name:"authorizeMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AuthorizeMemberData"}}]},{name:"deleteMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"postMessage",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!1,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"message",type:"string"}]}],Fa=[{name:"Channel",type:{kind:"struct",fields:[{name:"name",docs:["Name of the channel"],type:"string"},{name:"creator",docs:["Channel creator"],type:"publicKey"},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"memberCount",docs:["Number of members"],type:"u16"},{name:"messageCount",docs:["Message counter"],type:"u32"},{name:"maxMessages",docs:["The maximum number of messages that are stored in [messages]"],type:"u16"},{name:"messages",docs:["List of messages"],type:{vec:{defined:"Message"}}}]}},{name:"ChannelMembership",type:{kind:"struct",fields:[{name:"channel",docs:["Associated [Channel] address"],type:"publicKey"},{name:"authority",docs:["Authority of membership"],type:"publicKey"},{name:"key",docs:["The public key used to encrypt the `CEK`"],type:"publicKey"},{name:"cek",docs:["The content encryption key (CEK) of the channel"],type:{defined:"CEKData"}},{name:"status",docs:["Status of membership"],type:{defined:"ChannelMembershipStatus"}},{name:"name",docs:["Name of the channel member"],type:"string"},{name:"invitedBy",docs:["Inviter address"],type:{option:"publicKey"}},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"bump",docs:["Bump seed for deriving PDA seeds"],type:"u8"}]}}],Ua=[{name:"AddMemberData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"cek",type:{defined:"CEKData"}},{name:"key",type:{option:"publicKey"}}]}},{name:"AuthorizeMemberData",type:{kind:"struct",fields:[{name:"cek",type:{defined:"CEKData"}}]}},{name:"InitChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"maxMessages",type:"u16"},{name:"memberName",type:"string"},{name:"cek",type:{defined:"CEKData"}}]}},{name:"JoinChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"authority",type:{option:"publicKey"}}]}},{name:"CEKData",type:{kind:"struct",fields:[{name:"header",docs:["The header information for the CEK"],type:"string"},{name:"encryptedKey",docs:["The CEK itself"],type:"string"}]}},{name:"Message",type:{kind:"struct",fields:[{name:"id",docs:["Uniq message id"],type:"u32"},{name:"sender",docs:["The message sender id"],type:"publicKey"},{name:"createdAt",docs:["The unix timestamp at which the message was received"],type:"i64"},{name:"content",docs:["The (typically encrypted) message content"],type:"string"}]}},{name:"ChannelMembershipStatus",type:{kind:"enum",variants:[{name:"Authorized",fields:[{name:"by",type:{option:"publicKey"}}]},{name:"Pending",fields:[{name:"authority",type:{option:"publicKey"}}]}]}}],Oa=[{name:"NewChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"NewMessageEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"message",type:{defined:"Message"},index:!1}]},{name:"JoinChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AddMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AuthorizeMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]}],Qa=[{code:6e3,name:"Unauthorized",msg:"Unauthorized"},{code:6001,name:"NameTooLong",msg:"Name too long"},{code:6002,name:"MessageTooLong",msg:"Message too long"},{code:6003,name:"AlreadyInUse",msg:"Already in use"},{code:6004,name:"UninitializedAccount",msg:"Uninitialized account"}],ja={address:"6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",origin:"anchor",binaryVersion:"0.25.0",libVersion:"0.25.0"},Ga={version:$a,name:La,instructions:Va,accounts:Fa,types:Ua,events:Oa,errors:Qa,metadata:ja},Ja=new d.FixableBeetArgsStruct([["id",d.u32],["sender",U],["createdAt",d.i64],["content",d.utf8String]],"Message"),Qe=[49,159,99,106,220,87,219,88];class F{constructor(e,t,a,s,i,c,p){this.name=e,this.creator=t,this.createdAt=a,this.memberCount=s,this.messageCount=i,this.maxMessages=c,this.messages=p}static fromArgs(e){return new F(e.name,e.creator,e.createdAt,e.memberCount,e.messageCount,e.maxMessages,e.messages)}static fromAccountInfo(e,t=0){return F.deserialize(e.data,t)}static async fromAccountAddress(e,t,a){const s=await e.getAccountInfo(t,a);if(s==null)throw new Error(`Unable to find Channel account at ${t}`);return F.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return bt.fromStruct(e,ve)}static deserialize(e,t=0){return ve.deserialize(e,t)}serialize(){return ve.serialize({accountDiscriminator:Qe,...this})}static byteSize(e){const t=F.fromArgs(e);return ve.toFixedFromValue({accountDiscriminator:Qe,...t}).byteSize}static async getMinimumBalanceForRentExemption(e,t,a){return t.getMinimumBalanceForRentExemption(F.byteSize(e),a)}pretty(){return{name:this.name,creator:this.creator.toBase58(),createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),memberCount:this.memberCount,messageCount:this.messageCount,maxMessages:this.maxMessages,messages:this.messages}}}const ve=new d.FixableBeetStruct([["accountDiscriminator",d.uniformFixedSizeArray(d.u8,8)],["name",d.utf8String],["creator",U],["createdAt",d.i64],["memberCount",d.u16],["messageCount",d.u32],["maxMessages",d.u16],["messages",d.array(Ja)]],F.fromArgs,"Channel"),Ie=new d.FixableBeetArgsStruct([["header",d.utf8String],["encryptedKey",d.utf8String]],"CEKData"),qa=n=>n.__kind==="Pending",Ha=d.dataEnum([["Authorized",new d.FixableBeetArgsStruct([["by",d.coption(U)]],'ChannelMembershipStatusRecord["Authorized"]')],["Pending",new d.FixableBeetArgsStruct([["authority",d.coption(U)]],'ChannelMembershipStatusRecord["Pending"]')]]),xe=[238,149,255,251,116,131,86,170];class B{constructor(e,t,a,s,i,c,p,w,_){this.channel=e,this.authority=t,this.key=a,this.cek=s,this.status=i,this.name=c,this.invitedBy=p,this.createdAt=w,this.bump=_}static fromArgs(e){return new B(e.channel,e.authority,e.key,e.cek,e.status,e.name,e.invitedBy,e.createdAt,e.bump)}static fromAccountInfo(e,t=0){return B.deserialize(e.data,t)}static async fromAccountAddress(e,t,a){const s=await e.getAccountInfo(t,a);if(s==null)throw new Error(`Unable to find ChannelMembership account at ${t}`);return B.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return bt.fromStruct(e,ke)}static deserialize(e,t=0){return ke.deserialize(e,t)}serialize(){return ke.serialize({accountDiscriminator:xe,...this})}static byteSize(e){const t=B.fromArgs(e);return ke.toFixedFromValue({accountDiscriminator:xe,...t}).byteSize}static async getMinimumBalanceForRentExemption(e,t,a){return t.getMinimumBalanceForRentExemption(B.byteSize(e),a)}pretty(){return{channel:this.channel.toBase58(),authority:this.authority.toBase58(),key:this.key.toBase58(),cek:this.cek,status:this.status.__kind,name:this.name,invitedBy:this.invitedBy,createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),bump:this.bump}}}const ke=new d.FixableBeetStruct([["accountDiscriminator",d.uniformFixedSizeArray(d.u8,8)],["channel",U],["authority",U],["key",U],["cek",Ie],["status",Ha],["name",d.utf8String],["invitedBy",d.coption(U)],["createdAt",d.i64],["bump",d.u8]],B.fromArgs,"ChannelMembership"),de=new Map,me=new Map;class Ne extends Error{constructor(){super("Unauthorized");N(this,"code",6e3);N(this,"name","Unauthorized");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ne)}}de.set(6e3,()=>new Ne);me.set("Unauthorized",()=>new Ne);class Te extends Error{constructor(){super("Name too long");N(this,"code",6001);N(this,"name","NameTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Te)}}de.set(6001,()=>new Te);me.set("NameTooLong",()=>new Te);class Be extends Error{constructor(){super("Message too long");N(this,"code",6002);N(this,"name","MessageTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Be)}}de.set(6002,()=>new Be);me.set("MessageTooLong",()=>new Be);class We extends Error{constructor(){super("Already in use");N(this,"code",6003);N(this,"name","AlreadyInUse");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,We)}}de.set(6003,()=>new We);me.set("AlreadyInUse",()=>new We);class Re extends Error{constructor(){super("Uninitialized account");N(this,"code",6004);N(this,"name","UninitializedAccount");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Re)}}de.set(6004,()=>new Re);me.set("UninitializedAccount",()=>new Re);function X(n){const e=de.get(n);return e!=null?e():null}function se(n){const e=me.get(n);return e!=null?e():null}const Xa=new d.FixableBeetArgsStruct([["name",d.utf8String],["cek",Ie],["key",d.coption(U)]],"AddMemberData"),Za=new d.FixableBeetArgsStruct([["instructionDiscriminator",d.uniformFixedSizeArray(d.u8,8)],["data",Xa]],"AddMemberInstructionArgs"),Ya=[13,116,123,130,126,198,57,34];function es(n,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[a]=Za.serialize({instructionDiscriminator:Ya,...e}),s=[{pubkey:n.channel,isWritable:!0,isSigner:!1},{pubkey:n.invitee,isWritable:!1,isSigner:!1},{pubkey:n.inviteeMembership,isWritable:!0,isSigner:!1},{pubkey:n.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:n.authority,isWritable:!0,isSigner:!0},{pubkey:(c=n.systemProgram)!=null?c:ee.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const p of n.anchorRemainingAccounts)s.push(p);return new te({programId:t,keys:s,data:a})}const ts=new d.FixableBeetArgsStruct([["cek",Ie]],"AuthorizeMemberData"),ns=new d.FixableBeetArgsStruct([["instructionDiscriminator",d.uniformFixedSizeArray(d.u8,8)],["data",ts]],"AuthorizeMemberInstructionArgs"),as=[194,123,189,175,86,225,93,128];function ss(n,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[a]=ns.serialize({instructionDiscriminator:as,...e}),s=[{pubkey:n.channel,isWritable:!1,isSigner:!1},{pubkey:n.membership,isWritable:!0,isSigner:!1},{pubkey:n.authority,isWritable:!1,isSigner:!0},{pubkey:n.authorityMembership,isWritable:!1,isSigner:!1},{pubkey:(c=n.systemProgram)!=null?c:ee.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const p of n.anchorRemainingAccounts)s.push(p);return new te({programId:t,keys:s,data:a})}const rs=new d.BeetArgsStruct([["instructionDiscriminator",d.uniformFixedSizeArray(d.u8,8)]],"DeleteChannelInstructionArgs"),is=[145,225,187,221,157,142,114,133];function os(n,e=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var i;const[t]=rs.serialize({instructionDiscriminator:is}),a=[{pubkey:n.channel,isWritable:!0,isSigner:!1},{pubkey:n.authority,isWritable:!0,isSigner:!0},{pubkey:n.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:(i=n.systemProgram)!=null?i:ee.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const c of n.anchorRemainingAccounts)a.push(c);return new te({programId:e,keys:a,data:t})}const ls=new d.BeetArgsStruct([["instructionDiscriminator",d.uniformFixedSizeArray(d.u8,8)]],"DeleteMemberInstructionArgs"),cs=[95,14,98,112,252,218,205,173];function us(n,e=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var i;const[t]=ls.serialize({instructionDiscriminator:cs}),a=[{pubkey:n.channel,isWritable:!0,isSigner:!1},{pubkey:n.membership,isWritable:!0,isSigner:!1},{pubkey:n.authority,isWritable:!0,isSigner:!0},{pubkey:n.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:(i=n.systemProgram)!=null?i:ee.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const c of n.anchorRemainingAccounts)a.push(c);return new te({programId:e,keys:a,data:t})}const ds=new d.FixableBeetArgsStruct([["name",d.utf8String],["maxMessages",d.u16],["memberName",d.utf8String],["cek",Ie]],"InitChannelData"),ms=new d.FixableBeetArgsStruct([["instructionDiscriminator",d.uniformFixedSizeArray(d.u8,8)],["data",ds]],"InitChannelInstructionArgs"),hs=[21,200,152,39,19,178,76,47];function ps(n,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[a]=ms.serialize({instructionDiscriminator:hs,...e}),s=[{pubkey:n.channel,isWritable:!0,isSigner:!0},{pubkey:n.membership,isWritable:!0,isSigner:!1},{pubkey:n.authority,isWritable:!0,isSigner:!0},{pubkey:n.key,isWritable:!1,isSigner:!0},{pubkey:(c=n.systemProgram)!=null?c:ee.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const p of n.anchorRemainingAccounts)s.push(p);return new te({programId:t,keys:s,data:a})}const ys=new d.FixableBeetArgsStruct([["name",d.utf8String],["authority",d.coption(U)]],"JoinChannelData"),gs=new d.FixableBeetArgsStruct([["instructionDiscriminator",d.uniformFixedSizeArray(d.u8,8)],["data",ys]],"JoinChannelInstructionArgs"),fs=[124,39,115,89,217,26,38,29];function bs(n,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[a]=gs.serialize({instructionDiscriminator:fs,...e}),s=[{pubkey:n.channel,isWritable:!0,isSigner:!1},{pubkey:n.membership,isWritable:!0,isSigner:!1},{pubkey:n.authority,isWritable:!0,isSigner:!0},{pubkey:n.key,isWritable:!1,isSigner:!0},{pubkey:(c=n.systemProgram)!=null?c:ee.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const p of n.anchorRemainingAccounts)s.push(p);return new te({programId:t,keys:s,data:a})}const _s=new d.FixableBeetArgsStruct([["instructionDiscriminator",d.uniformFixedSizeArray(d.u8,8)],["message",d.utf8String]],"PostMessageInstructionArgs"),ws=[214,50,100,209,38,34,7,76];function As(n,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[a]=_s.serialize({instructionDiscriminator:ws,...e}),s=[{pubkey:n.channel,isWritable:!0,isSigner:!1},{pubkey:n.membership,isWritable:!1,isSigner:!1},{pubkey:n.authority,isWritable:!1,isSigner:!0},{pubkey:(c=n.systemProgram)!=null?c:ee.programId,isWritable:!1,isSigner:!1}];if(n.anchorRemainingAccounts!=null)for(const p of n.anchorRemainingAccounts)s.push(p);return new te({programId:t,keys:s,data:a})}const vs="6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",ks=new x(vs);function je(n,e=new Uint8Array(4)){const t=fe(n.toString(),"base10");return e.set(t,4-t.length),e}const Ve=n=>le([je(n.length),n]);function St(n,e,t){if(e!==256)throw new Error(`Unsupported key length: ${e}`);const a=le([Ve(fe(t)),Ve(new Uint8Array(0)),Ve(new Uint8Array(0)),je(e)]),s=1;return pn.hash(le([je(s),n,a]))}const Ge=n=>fe(n,"base64pad"),Je=n=>_t(n,"base64pad"),Ms=n=>fe(n),Ss=n=>_t(n),Cs=n=>fe(n,"base58btc"),Y=De.NONCE_LENGTH,ue=De.TAG_LENGTH,Ct=n=>{const e=new De.XChaCha20Poly1305(n);return(t,a)=>{const s=wt.randomBytes(Y),i=e.seal(s,t,a);return{ciphertext:i.subarray(0,i.length-ue),tag:i.subarray(i.length-ue),iv:s}}},xt=n=>{const e=new De.XChaCha20Poly1305(n);return(t,a,s,i)=>e.open(s,le([t,a]),i)},Et="ECDH-ES+XC20PKW",Kt=256,xs=n=>e=>{const t=Oe.generateKeyPair(),a=Oe.sharedKey(t.secretKey,n),s=St(a,Kt,Et),i=Ct(s)(e);return{encryptedKey:i.ciphertext,tag:i.tag,iv:i.iv,epPubKey:t.publicKey}},Es=n=>(e,t,a,s)=>{const i=Oe.sharedKey(n,s),c=St(i,Kt,Et);return xt(c)(e,t,a)},Ks=n=>{if(Array.isArray(n))return oe.fromSecretKey(lt.Buffer.from(n));if(typeof n=="string")return oe.fromSecretKey(Cs(n));if(n instanceof lt.Buffer||n instanceof Uint8Array)return oe.fromSecretKey(n);throw new Error("Incompatible private key format")},Ps=async(n=32)=>{const e=wt.randomBytes(n);return Promise.resolve(e)},Ds=async(n,e)=>{const t=await xs(yn(e.toBytes()))(n);return{header:Je(le([t.iv,t.tag,t.epPubKey])),encryptedKey:Je(t.encryptedKey)}},zs=async(n,e)=>{const t=Ge(n.header),a=t.subarray(0,Y),s=t.subarray(Y,Y+ue),i=t.subarray(Y+ue),c=Ge(n.encryptedKey),p=Ks(e).secretKey,w=gn(p),_=await Es(w)(c,s,a,i);if(_===null)throw new Error("There was a problem decrypting the CEK");return _},Is=async(n,e)=>{const t=await Ct(e)(Ms(n));return Je(le([t.iv,t.ciphertext,t.tag]))},Ns=async(n,e)=>{const t=Ge(n),a=t.subarray(0,Y),s=t.subarray(Y,-ue),i=t.subarray(-ue),c=await xt(e)(s,i,a);if(c===null)throw new Error("There was an error decoding the message!");return Ss(c)};class Ts{constructor(e,t){N(this,"programId",ks);N(this,"_coder");N(this,"_events");this.provider=e,this.keypair=t,this._coder=new fn(Ga),this._events=new bn(this.programId,e,this._coder)}get connection(){return this.provider.connection}addEventListener(e,t){return this._events.addEventListener(e,t)}async removeEventListener(e){return await this._events.removeEventListener(e)}setKeypair(e){this.keypair=e}async loadAllChannels(){return(await F.gpaBuilder().addFilter("accountDiscriminator",Qe).run(this.provider.connection)).map(t=>({pubkey:t.pubkey,data:F.fromAccountInfo(t.account)[0]}))}async loadChannel(e,t){return F.fromAccountAddress(this.provider.connection,e,t)}async loadMyChannels(){const e=await this.loadMemberships();return console.log(e),[]}async loadChannelMembers(e){return(await B.gpaBuilder().addFilter("accountDiscriminator",xe).addFilter("channel",e).run(this.provider.connection)).map(a=>({pubkey:a.pubkey,data:B.fromAccountInfo(a.account)[0]}))}async loadMemberships(e){return(await B.gpaBuilder().addFilter("accountDiscriminator",xe).addFilter("authority",this.provider.publicKey).addFilter("key",e).run(this.provider.connection)).map(a=>({pubkey:a.pubkey,data:B.fromAccountInfo(a.account)}))}async loadMembership(e,t){return B.fromAccountAddress(this.provider.connection,e,t)}async getMembershipPDA(e,t){return t=t!=null?t:this.keypair.publicKey,await x.findProgramAddress([e.toBuffer(),t.toBuffer()],this.programId)}async encryptCEK(e,t){return Ds(e,t!=null?t:this.keypair.publicKey)}async decryptCEK(e,t){return zs(e,t!=null?t:this.keypair.secretKey)}async encryptMessage(e,t){return Is(e,t)}async decryptMessage(e,t){return Ns(e,t)}async initChannel(e){var w,_,I;const t=(w=e.channel)!=null?w:oe.generate(),a=await Ps(),s=await this.encryptCEK(a),[i]=await this.getMembershipPDA(t.publicKey),c=new H;c.add(ps({channel:t.publicKey,membership:i,authority:this.provider.publicKey,key:this.keypair.publicKey},{data:{name:e.name,memberName:(_=e.memberName)!=null?_:"",maxMessages:e.maxMessages,cek:s}}));let p;try{p=await this.provider.sendAndConfirm(c,[t,this.keypair])}catch(C){throw(I=X(C.code))!=null?I:C}return{signature:p,channel:t,cek:a,cekEncrypted:s}}async deleteChannel(e,t){var c;const[a]=await this.getMembershipPDA(e),s=new H;s.add(os({channel:e,authority:this.provider.publicKey,authorityMembership:t!=null?t:a}));let i;try{i=await this.provider.sendAndConfirm(s)}catch(p){throw(c=X(p.code))!=null?c:se("Unauthorized")}return{signature:i}}async joinChannel(e){var i;const[t]=await this.getMembershipPDA(e.channel),a=new H;a.add(bs({channel:e.channel,authority:this.provider.publicKey,key:this.keypair.publicKey,membership:t},{data:{name:e.name,authority:e.authority}}));let s;try{s=await this.provider.sendAndConfirm(a,[this.keypair])}catch(c){throw(i=X(c.code))!=null?i:c}return{signature:s}}async addMember(e){var I,C,T;const t=(I=e.key)!=null?I:e.invitee,[a]=await this.getMembershipPDA(e.channel),[s]=await this.getMembershipPDA(e.channel,t),i=await this.loadMembership(a);if(!i.cek.encryptedKey)throw se("Unauthorized");const c=await this.decryptCEK(i.cek),p=await this.encryptCEK(c,t),w=new H;w.add(es({channel:e.channel,authority:this.provider.publicKey,invitee:e.invitee,authorityMembership:a,inviteeMembership:s},{data:{name:(C=e.name)!=null?C:"",cek:p,key:t}}));let _;try{_=await this.provider.sendAndConfirm(w)}catch(D){throw(T=X(D.code))!=null?T:se("Unauthorized")}return{signature:_}}async deleteMember(e){var c;const[t]=await this.getMembershipPDA(e.channel),[a]=await this.getMembershipPDA(e.channel,e.key),s=new H;s.add(us({channel:e.channel,authority:this.provider.publicKey,authorityMembership:t,membership:a}));let i;try{i=await this.provider.sendAndConfirm(s)}catch(p){throw(c=X(p.code))!=null?c:p}return{signature:i}}async authorizeMember(e){var _;const[t]=await this.getMembershipPDA(e.channel),[a]=await this.getMembershipPDA(e.channel,e.key),s=await this.loadMembership(t);if(!s.cek.encryptedKey)throw se("Unauthorized");const i=await this.decryptCEK(s.cek),c=await this.encryptCEK(i,e.key),p=new H;p.add(ss({channel:e.channel,membership:a,authority:this.provider.publicKey,authorityMembership:t},{data:{cek:c}}));let w;try{w=await this.provider.sendAndConfirm(p)}catch(I){throw(_=X(I.code))!=null?_:se("Unauthorized")}return{signature:w}}async postMessage(e){var w;const[t]=await this.getMembershipPDA(e.channel),a=await this.loadMembership(t);if(!a.cek.header)throw se("Unauthorized");const s=await this.decryptCEK(a.cek),i=await this.encryptMessage(e.message,s),c=new H;c.add(As({channel:e.channel,membership:t,authority:this.provider.publicKey},{message:i}));let p;try{p=await this.provider.sendAndConfirm(c)}catch(_){throw(w=X(_.code))!=null?w:_}return{signature:p}}}const dt="***** *** *** *** *******",Bs=He("messenger",()=>{const n=Xe(),e=Mt(),t=ft(),a=Z({allChannels:[],channel:void 0,channelAddr:void 0,channelMembershipAddr:void 0,channelMembership:void 0,channelMembers:[],channelMessages:[],channelLoading:!1,loading:!1,creating:!1,sending:!1}),s=z(()=>{var u;return new Ts(new ct(n.connection,(u=t.value)!=null?u:{publicKey:x.default},ct.defaultOptions()),e.keypair)});p().then(),At(t,u=>{(u==null?void 0:u.publicKey)&&a.channelAddr&&C(a.channelAddr).then()},{immediate:!0});const i=[];async function c(){console.log("Register events...");for(const u of i)await s.value.removeEventListener(u);i.push(s.value.addEventListener("NewMessageEvent",async u=>{if(console.log("[Event] NewMessageEvent",u),`${u.channel}`!=`${a.channelAddr}`)return;let g=dt;const k=await T();k&&(g=await s.value.decryptMessage(u.message.content,k)),a.channelMessages.push({...u.message,content:g})})),i.push(s.value.addEventListener("AuthorizeMemberEvent",async u=>{console.log("[Event] AuthorizeMemberEvent",u),!(a.channelAddr&&`${u.channel}`!=`${a.channelAddr}`)&&(`${u.membership}`==`${a.channelMembershipAddr}`?C(a.channelAddr).then():$().then())})),i.push(s.value.addEventListener("JoinChannelEvent",async u=>{console.log("[Event] JoinChannelEvent",u),`${u.channel}`==`${a.channelAddr}`&&$().then()}))}async function p(){a.loading=!0;const u=await s.value.loadAllChannels();await c(),a.allChannels=u,a.loading=!1}async function w(u,g=15){try{a.creating=!0;const{channel:k}=await s.value.initChannel({name:u,maxMessages:g});await C(k.publicKey),a.channel&&a.allChannels.push({pubkey:k.publicKey,data:a.channel})}finally{a.creating=!1}}async function _(u){const g=new x(u);await s.value.deleteChannel(g),await p()}async function I(u,g){const k=new x(u);await s.value.joinChannel({channel:k,name:g}),await C(u)}async function C(u){var g;a.channelLoading=!0,a.channelAddr=new x(u);try{if((g=t.value)!=null&&g.publicKey)try{const[k]=await s.value.getMembershipPDA(a.channelAddr);a.channelMembershipAddr=k,a.channelMembership=await s.value.loadMembership(k)}catch(k){console.log(k),a.channelMembershipAddr=void 0,a.channelMembership=void 0}await Promise.all([D(),$()])}catch(k){console.log("Error",k)}finally{a.channelLoading=!1}}async function T(){if(!!a.channelMembership)try{return await s.value.decryptCEK(a.channelMembership.cek)}catch(u){console.log(u)}}async function D(){if(!a.channelAddr){console.log("Invalid channel");return}a.channel=await s.value.loadChannel(a.channelAddr);const u=await T();a.channelMessages=await Promise.all(a.channel.messages.map(async g=>{let k=dt,he=ze(g.sender);const V=a.channelMembers.find(({data:j})=>j.name!==""&&(`${j.authority}`==`${g.sender}`||`${j.key}`==`${g.sender}`));if(V&&V.data.name!==""&&(he=V.data.name),u)try{k=await s.value.decryptMessage(g.content,u)}catch{console.log(`Failed to decrypt message #${g.id}`)}return{...g,senderFormatted:he,content:k}}))}async function $(){if(!a.channelAddr){console.error("Invalid channel");return}a.channelMembers=await s.value.loadChannelMembers(a.channelAddr)}async function q(u){if(!a.channelAddr){console.log("Please select a channel");return}try{a.sending=!0,await s.value.postMessage({channel:a.channelAddr,message:u}),await D()}finally{a.sending=!1}}async function b(u,g,k){if(!a.channelAddr){console.log("Invalid channel");return}await s.value.addMember({channel:a.channelAddr,invitee:new x(u),key:g?new x(g):void 0,name:k})}async function v(u){if(!a.channelAddr){console.log("Invalid channel");return}await s.value.deleteMember({channel:a.channelAddr,key:new x(u)})}async function L(u){if(!a.channelAddr){console.log("Invalid channel");return}await s.value.authorizeMember({channel:a.channelAddr,key:new x(u)}),await D()}return{state:a,client:s.value,loadChannel:C,joinChannel:I,createChannel:w,deleteChannel:_,postMessage:q,addMember:b,deleteMember:v,authorizeMember:L}}),Pt=n=>(ht("data-v-a8ea9423"),n=n(),pt(),n),Ws={class:"messenger"},Rs={class:"row q-gutter-md"},$s={class:"col col-3"},Ls={class:"messenger-add-channel"},Vs={key:1,class:"messenger-channels-empty"},Fs={class:"col"},Us={key:0},Os={class:"row"},Qs={class:"col"},js={class:"col"},Gs={class:"channel-name"},Js={key:0,class:"row justify-center"},qs={key:0,class:"messenger-messages"},Hs={key:1,class:"messenger-empty"},Xs={key:1,class:"messenger-empty"},Zs={key:1,class:"q-my-md q-px-lg"},Ys={class:"col col-4"},er={class:"col"},tr={class:"no-margin"},nr=Pt(()=>A("br",null,null,-1)),ar=Pt(()=>A("br",null,null,-1)),sr=Ee({__name:"Messenger",setup(n){const{notify:e}=qe(),t=Ke(),{state:a,postMessage:s,addMember:i,deleteMember:c,authorizeMember:p,createChannel:w,loadChannel:_,deleteChannel:I,joinChannel:C}=Bs(),T=Mt(),D=Se(!1),$=Se(!1),q=_n($),b=Z({dialog:!1,loading:!1,name:"",authority:""}),v=Z({dialog:!1,loading:!1,name:"",authority:"",key:""}),L=Z({loading:!1}),u=Z({loading:!1}),g=Z({dialog:!1,name:"",maxMessages:15}),k=Z({message:""}),he=z(()=>!!t.publicKey.value),V=z(()=>{var m;return((m=a.channelMembership)==null?void 0:m.status.__kind)==="Authorized"}),j=z(()=>{var m;return((m=a.channelMembership)==null?void 0:m.status.__kind)==="Pending"}),$e=z(()=>{var m,h;return V.value&&((m=a.channel)==null?void 0:m.creator.toString())===String((h=t.publicKey.value)!=null?h:"-")}),Ze=z(()=>a.allChannels),Ye=z(()=>{const m=[];let h=0,r;for(const W of a.channelMessages)r&&`${W.sender}`==`${r}`?m[h-1].text.push(W.content):(r=W.sender,m.push({id:W.id,sender:W.sender,senderFormatted:W.senderFormatted,text:[W.content],date:W.createdAt}),h++);return m}),et=z(()=>V.value&&!a.sending),Dt=z(()=>V.value),zt=m=>z(()=>{var h;return $e.value&&String(m.key)!==String((h=T.keypair)==null?void 0:h.publicKey)}).value,It=z(()=>he.value&&!V.value),ne=m=>e({type:"positive",message:m,timeout:2e3}),_e=m=>e({type:"info",message:m,timeout:2e3}),ae=m=>e({type:"negative",message:m,timeout:2e3}),tt=z(()=>a.channelMembers.filter(m=>qa(m.data.status)).length);async function Nt(){Le()&&(await s(k.message),k.message="")}function Tt(){Le()&&(g.dialog=!0)}async function Bt(){if(Le())try{await w(g.name,g.maxMessages),Wt(),ne("Channel was created!")}catch(m){ae("Something went wrong"),console.log(m)}}function Wt(){g.dialog=!1,g.name="",g.maxMessages=15}async function Rt(){if(v.loading=!0,!a.channelAddr){_e("Please select a channel");return}try{await i(v.authority,v.key,v.name),nt(),ne("Member was added")}catch(m){ae("Something went wrong"),console.log(m)}finally{v.loading=!1}}function nt(){v.loading=!1,v.name="",v.authority="",v.key=""}async function $t(m){try{u.loading=!0,await c(m),ne("Member was deleted")}catch(h){ae("Something went wrong"),console.log(h)}finally{u.loading=!1}}async function Lt(m){try{L.loading=!0,await p(m),ne("Member was authorized")}catch(h){ae("Something went wrong"),console.log(h)}finally{L.loading=!1}}async function Vt(){if(!a.channelAddr){_e("Please select a channel");return}b.loading=!0;try{await C(a.channelAddr,b.name),at(),ne("Request was sent")}catch(m){console.log("Error",m),ae("Something went wrong")}finally{b.loading=!1}}function at(){b.loading=!1,b.dialog=!1,b.name=""}async function Ft(){if(!a.channelAddr){_e("Please select a channel");return}await I(a.channelAddr);try{await I(a.channelAddr),ne("Channel was deleted!")}catch(m){console.log("Error",m),ae("Something went wrong")}finally{b.loading=!1}}async function Ut(m){await _(m)}function Le(){return t.publicKey.value?!0:(_e("Please connect wallet"),!1)}function Ot(m){return(m==null?void 0:m.__kind)==="Authorized"?"positive":"grey"}function Qt(m){return(m==null?void 0:m.name)&&m.name!==""?m.name:ze(m.authority)}function jt(m){const h=t.publicKey.value;return h?String(h)!==String(m):!0}return(m,h)=>(f(),E(Q,null,[A("div",Ws,[A("div",Rs,[A("div",$s,[A("div",Ls,[o(P,{color:"primary",rounded:"",onClick:Tt},{default:l(()=>[M(" Add New Channel ")]),_:1})]),o(J,{class:"messenger-channels"},{default:l(()=>[y(Ze).length>0?(f(),S(Ue,{key:0,separator:""},{default:l(()=>[(f(!0),E(Q,null,re(y(Ze),r=>(f(),S(Ce,{key:r.name,"active-class":"bg-blue-grey-1 text-grey-8",active:String(y(a).channelAddr)===String(r.pubkey)},{default:l(()=>[o(ie,{class:"cursor-pointer",onClick:W=>Ut(r.pubkey)},{default:l(()=>[o(ge,null,{default:l(()=>[M(K(r.data.name),1)]),_:2},1024),o(ge,{caption:"",lines:"2"},{default:l(()=>[A("div",null,"members: "+K(r.data.memberCount),1),A("div",null,"messages: "+K(r.data.messageCount),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["active"]))),128))]),_:1})):(f(),E("div",Vs," No channels ")),o(pe,{showing:y(a).loading,color:"primary"},null,8,["showing"])]),_:1})]),A("div",Fs,[y(a).channel?(f(),E("div",Us,[A("div",Os,[A("div",Qs,[o(wn,{rounded:"",unelevated:""},{default:l(()=>[y(Dt)?(f(),S(P,{key:0,color:"secondary","text-color":"dark",loading:v.loading,onClick:h[0]||(h[0]=r=>v.dialog=!0)},{default:l(()=>[M(" add\xA0member ")]),_:1},8,["loading"])):R("",!0),y(It)?(f(),S(P,{key:1,color:"secondary","text-color":"dark",loading:b.loading,disable:y(j),onClick:h[1]||(h[1]=r=>b.dialog=!0)},{default:l(()=>[M(K(y(j)?"pending\xA0access":"join\xA0channel"),1)]),_:1},8,["loading","disable"])):R("",!0),y(he)?(f(),S(P,{key:2,color:"blue-grey",onClick:h[2]||(h[2]=r=>D.value=!0)},{default:l(()=>[M(" members "),y(tt)>0?(f(),S(ut,{key:0,color:"info",rounded:"",floating:""},{default:l(()=>[M(K(y(tt)),1)]),_:1})):R("",!0)]),_:1})):R("",!0),y($e)?(f(),S(P,{key:3,color:"negative",onClick:Ft},{default:l(()=>[M(" delete ")]),_:1})):R("",!0)]),_:1})]),A("div",js,[A("div",Gs,K(y(a).channel.name),1)])])])):R("",!0),o(J,{class:"messenger-card overflow-hidden"},{default:l(()=>[y(a).channel?(f(),E("div",Js,[y(Ye).length>0?(f(),E("div",qs,[(f(!0),E(Q,null,re(y(Ye),r=>(f(),S(An,{key:r.id,name:r.senderFormatted,text:r.text,sent:jt(r.sender)},null,8,["name","text","sent"]))),128))])):(f(),E("div",Hs," No messages "))])):(f(),E("div",Xs," Please select a channel ")),o(we,{class:"channel-form",onSubmit:Ae(Nt,["prevent"])},{default:l(()=>[o(yt,{class:"bg-primary text-white row"},{default:l(()=>[o(G,{ref:"inputFocus",modelValue:k.message,"onUpdate:modelValue":h[3]||(h[3]=r=>k.message=r),class:"col-grow q-mr-sm","bg-color":"white",placeholder:"Type a message",dense:"",outlined:"",rounded:"",autofocus:"",disable:!y(et)},null,8,["modelValue","disable"]),o(P,{rounded:"",flat:"",type:"submit",disable:!y(et),loading:y(a).sending},{default:l(()=>[M(" Send ")]),_:1},8,["disable","loading"])]),_:1})]),_:1},8,["onSubmit"]),o(pe,{showing:y(a).channelLoading},null,8,["showing"])]),_:1}),y(a).channel?(f(),E("div",Zs,[o(P,{flat:"",class:"text-blue-2",onClick:h[4]||(h[4]=r=>y(q)())},{default:l(()=>[M(" debug info ")]),_:1}),$.value?(f(!0),E(Q,{key:0},re([["Authorized",y(V)],["Pending Access",y(j)],["Channel Creator",y($e)],["Channel",y(a).channel],["Membership",y(a).channelMembership],["Members",y(a).channelMembers]],r=>(f(),E("div",{key:r[0],class:"row q-mt-md"},[A("div",Ys,K(r[0]),1),A("div",er,[A("pre",tr,K(r[1]),1)])]))),128)):R("",!0)])):R("",!0)])])]),o(ye,{modelValue:g.dialog,"onUpdate:modelValue":h[7]||(h[7]=r=>g.dialog=r),class:"new-channel-dialog"},{default:l(()=>[o(J,null,{default:l(()=>[o(O,null,{default:l(()=>[o(we,{class:"messenger-new-channel-form",onSubmit:Ae(Bt,["prevent"])},{default:l(()=>[o(G,{modelValue:g.name,"onUpdate:modelValue":h[5]||(h[5]=r=>g.name=r),label:"Channel name *","lazy-rules":"",rules:[r=>r&&r.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(G,{modelValue:g.maxMessages,"onUpdate:modelValue":h[6]||(h[6]=r=>g.maxMessages=r),label:"Max messages","lazy-rules":"",rules:[r=>+r>0||"Invalid value"]},null,8,["modelValue","rules"]),o(P,{type:"submit",color:"info",ripple:!1,rounded:""},{default:l(()=>[M(" Create Channel ")]),_:1})]),_:1},8,["onSubmit"]),o(pe,{showing:y(a).creating},null,8,["showing"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ye,{modelValue:v.dialog,"onUpdate:modelValue":h[11]||(h[11]=r=>v.dialog=r),class:"add-member-dialog",onHide:nt},{default:l(()=>[o(J,null,{default:l(()=>[o(O,null,{default:l(()=>[o(we,{class:"add-member-form",onSubmit:Ae(Rt,["prevent"])},{default:l(()=>[o(G,{modelValue:v.name,"onUpdate:modelValue":h[8]||(h[8]=r=>v.name=r),label:"Member name *",hint:"Min length 3 chars","lazy-rules":"",rules:[r=>r&&r.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(G,{modelValue:v.key,"onUpdate:modelValue":h[9]||(h[9]=r=>v.key=r),label:"Member Wallet *","lazy-rules":"",rules:[r=>r&&r.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),o(G,{modelValue:v.key,"onUpdate:modelValue":h[10]||(h[10]=r=>v.key=r),label:"Member Device Key",hint:"Default: The same as member wallet","lazy-rules":"",rules:[r=>!r||r.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),nr,o(P,{type:"submit",color:"info",ripple:!1,rounded:""},{default:l(()=>[M(" Add Member ")]),_:1})]),_:1},8,["onSubmit"]),o(pe,{showing:v.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ye,{modelValue:b.dialog,"onUpdate:modelValue":h[14]||(h[14]=r=>b.dialog=r),class:"join-channel-dialog",onHide:at},{default:l(()=>[o(J,null,{default:l(()=>[o(O,null,{default:l(()=>[o(we,{class:"join-channel-form",onSubmit:Ae(Vt,["prevent"])},{default:l(()=>[o(G,{modelValue:b.name,"onUpdate:modelValue":h[12]||(h[12]=r=>b.name=r),placeholder:"Member name *","lazy-rules":"",rules:[r=>r&&r.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(G,{modelValue:b.authority,"onUpdate:modelValue":h[13]||(h[13]=r=>b.authority=r),placeholder:"Authorize By","lazy-rules":"",rules:[r=>!r||r&&r.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),ar,o(P,{type:"submit",color:"info",ripple:!1,rounded:""},{default:l(()=>[M(" Join Channel ")]),_:1})]),_:1},8,["onSubmit"]),o(pe,{showing:b.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ye,{modelValue:D.value,"onUpdate:modelValue":h[15]||(h[15]=r=>D.value=r)},{default:l(()=>[o(J,null,{default:l(()=>[o(O,null,{default:l(()=>[o(Ue,{separator:""},{default:l(()=>[(f(!0),E(Q,null,re(y(a).channelMembers,r=>(f(),S(Ce,{key:r.pubkey.toString(),"active-class":"bg-teal-1",active:`${r.pubkey}`==`${y(a).channelMembershipAddr}`},{default:l(()=>[o(ie,null,{default:l(()=>[o(ge,null,{default:l(()=>[M(K(Qt(r.data))+" ",1),o(ut,{color:Ot(r.data.status)},{default:l(()=>[M(K(r.data.status.__kind),1)]),_:2},1032,["color"])]),_:2},1024),o(ge,{caption:"",lines:"2"},{default:l(()=>[A("div",null,"Authority: "+K(r.data.authority),1),A("div",null,"Key: "+K(r.data.key),1)]),_:2},1024)]),_:2},1024),o(ie,{side:"",class:"q-gutter-sm"},{default:l(()=>[r.data.status.__kind==="Pending"&&y(V)&&(!r.data.status.authority||String(r.data.status.authority)===String(y(t).publicKey.value))?(f(),S(P,{key:0,color:"teal",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:L.loading,disabled:L.loading,onClick:W=>Lt(r.data.key)},{default:l(()=>[M(" Authorize ")]),_:2},1032,["loading","disabled","onClick"])):R("",!0),zt(r.data)?(f(),S(P,{key:1,color:"negative",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:u.loading,disabled:u.loading,onClick:W=>$t(r.data.key)},{default:l(()=>[M(" Delete ")]),_:2},1032,["loading","disabled","onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["active"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});const rr=be(sr,[["__scopeId","data-v-a8ea9423"]]);const ir={},or={class:"container"},lr={class:"messenger-container"};function cr(n,e){const t=rr;return f(),S(vn,null,{default:l(()=>[A("div",or,[A("div",lr,[o(t)])])]),_:1})}const ur=be(ir,[["render",cr],["__scopeId","data-v-8856bd2a"]]),dr=()=>gt(()=>import("./_...all_.7e54b7db.js"),["assets/_...all_.7e54b7db.js","assets/_...all_.73169310.css","assets/vendor.0ed7373c.js"]),mr=[{name:"index",path:"/",component:ur,props:!0},{name:"all",path:"/:all(.*)*",component:dr,props:!0,meta:{layout:"empty"}}],hr=Ra(mr),pr="/sol-messenger/",yr=kn({history:Mn(pr),scrollBehavior:()=>({left:0,top:0}),strict:!0,routes:hr}),gr=({app:n})=>{n.use(yr)},fr=Object.freeze(Object.defineProperty({__proto__:null,install:gr},Symbol.toStringTag,{value:"Module"})),br=({app:n})=>{n.use(Sn,{wallets:[new Cn,new xn,new En,new Kn,new Pn,new Dn,new zn,new In,new Nn,new Tn,new Bn,new Wn,new Rn,new $n,new Ln,new Vn,new Fn,new Un,new On,new Qn,new jn,new Gn,new Jn,new qn,new Hn,new Xn,new Zn,new Yn,new ea,new ta],autoConnect:!1})},_r=Object.freeze(Object.defineProperty({__proto__:null,install:br},Symbol.toStringTag,{value:"Module"})),wr=na();function Ar(){return wr}const vr=Symbol("WALLET_CONNECT_EVENT"),kr=Symbol("WALLET_DISCONNECT_EVENT"),Mr=Symbol("ACCOUNT_CHANGE_EVENT"),Fe=5e3;function Sr(){const{connection:n}=Xe(),{emit:e}=Ar(),{notify:t}=qe(),{wallet:a}=Ke();At(a,s=>{if(!s)return;const i=()=>{const w=s.publicKey;n.onAccountChange(w,_=>{console.log("ACCOUNT_CHANGE_EVENT",_),e(Mr,_)}),n.onLogs(w,_=>{console.log(_)}),t({message:"Wallet update",caption:`Connected to wallet ${ze(w.toBase58(),7)}`,timeout:Fe}),e(vr,s)},c=()=>{t({message:"Wallet update",caption:"Disconnected from wallet",timeout:Fe}),e(kr,s)},p=w=>{!(w!=null&&w.message)||t({type:"negative",message:"Wallet update",caption:w.message,timeout:Fe})};s.once("connect",i),s.once("disconnect",c),s.removeAllListeners("error"),s.on("error",p)},{immediate:!0})}const Cr=Ee({__name:"App",setup(n){return aa(()=>{Sr()}),(e,t)=>{const a=Pe("router-view");return f(),S(a)}}});async function xr(){const n=sa(Cr);Object.values(Object.assign({"./plugins/pinia.ts":ia,"./plugins/quasar.ts":la,"./plugins/router.ts":fr,"./plugins/wallet.ts":_r})).forEach(e=>{var t;return(t=e.install)==null?void 0:t.call(e,{app:n})}),n.mount("#app")}xr().then();export{be as _};
