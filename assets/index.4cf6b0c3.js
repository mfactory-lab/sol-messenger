var Ut=Object.defineProperty;var jt=(t,e,n)=>e in t?Ut(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var W=(t,e,n)=>(jt(t,typeof e!="symbol"?e+"":e,n),n);import{c as Qt,Q as qt,P as Jt,D as Gt,N as Ht,a as Xt,i as Zt,u as Oe,b as Ve,d as N,o as f,e as C,w as c,f as u,g as E,h as r,j as lt,k as d,l as Yt,r as V,m as b,n as B,p as pe,q as en,s as tn,S as nn,t as D,v as P,x as _t,y as K,z as X,A as L,B as me,C as an,E as ee,F as G,G as sn,H as re,I as q,J as At,W as vt,K as Se,L as ke,M as on,O as Ie,R as ln,T as rn,U as ve,V as oe,X as Ke,Y as le,Z as cn,_ as Fe,$ as ht,a0 as pt,a1 as un,a2 as dn,a3 as mn,a4 as St,a5 as Ue,a6 as hn,a7 as he,a8 as at,a9 as De,aa as Pe,ab as pn,ac as kt,ad as gn,ae as fn,af as p,ag as te,ah as xt,ai as ce,aj as ue,ak as ze,al as $t,am as we,an as yn,ao as je,ap as Et,aq as rt,ar as bn,as as _n,at as vn,au as wn,av as Cn,aw as se,ax as ae,ay as wt,az as Ce,aA as Mn,aB as gt,aC as Qe,aD as ft,aE as ne,aF as qe,aG as Ee,aH as An,aI as Dt,aJ as Sn,aK as kn,aL as xn,aM as $n,aN as En,aO as Dn,aP as Pn,aQ as Kn,aR as In,aS as zn,aT as Bn,aU as Tn,aV as Nn,aW as Wn,aX as Ln,aY as Vn,aZ as Rn,a_ as On,a$ as Fn,b0 as Un,b1 as jn,b2 as Qn,b3 as qn,b4 as Jn,b5 as Gn,b6 as Hn,b7 as Xn,b8 as Zn,b9 as Yn,ba as ea,bb as ta,bc as na,bd as aa,be as sa,bf as ia,bg as oa,bh as la,bi as ra,bj as ca,bk as ua,bl as da,bm as ma}from"./vendor.130d1de7.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const ha=({app:t})=>{const e=Qt();t.use(e)},pa=Object.freeze(Object.defineProperty({__proto__:null,install:ha},Symbol.toStringTag,{value:"Module"})),ga=({app:t})=>{t.use(qt,{plugins:{Dark:Jt,Dialog:Gt,Notify:Ht,LocalStorage:Xt},iconSet:Zt})},fa=Object.freeze(Object.defineProperty({__proto__:null,install:ga},Symbol.toStringTag,{value:"Module"}));function ya(){const{dark:t}=Oe(),e=Ve("theme-mode",t.isActive);return t.set(e.value),{isActive:e,set(n){t.set(n),e.value=t.isActive},toggle(){t.toggle(),e.value=t.isActive}}}const ba={class:"container"},_a={class:"row"},va=u("div",{class:"col-12 col-md-6"},[u("div",{class:"footer-links"},[u("ul",null,[u("li",null,[u("a",{target:"_blank",href:"https://jpool.one"},"JPOOL")]),u("li",null,[u("a",{target:"_blank",href:"https://heartandsol.one"},"GAME")]),u("li",null,[u("a",{href:"https://magiceden.io/marketplace/heartandsol"},"NFT Marketplace")])])]),u("div",{class:"copyright"},[u("span",null,"\xA9 Copyright 2022 jpool.one. All rights reserved. Powered by mFactory GmbH")])],-1),wa={class:"col-12 col-md-6 social-col"},Ca={class:"social"},Ma={class:"theme"},Aa=u("div",{class:"social-link social-link-text"},[u("span",null,[E("official"),u("br"),E("channel")])],-1),Sa=u("div",{class:"social-link telegram"},null,-1),ka=u("div",{class:"social-link twitter"},null,-1),xa=u("div",{class:"social-link discord"},null,-1),$a=N({__name:"AppFooter",setup(t){const e=ya();return(n,i)=>(f(),C(Yt,null,{default:c(()=>[u("div",ba,[u("div",_a,[va,u("div",wa,[u("div",Ca,[u("div",Ma,[E(" Dark theme "),r(lt,{"model-value":d(e).isActive.value,onClick:d(e).toggle},null,8,["model-value","onClick"])]),Aa,Sa,ka,xa])])])])]),_:1}))}});function Ea(){const t=V(Da());return{userAgent:t,isMobileOs:b(()=>Pa(t.value)),isWebView:b(()=>Ka(t.value))}}let st;function Da(){var t,e;return st===void 0&&(st=(e=(t=globalThis.navigator)==null?void 0:t.userAgent)!=null?e:null),st}function Pa(t){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)}function Ka(t){return/(WebView|(Phantom|Solflare)|Version\/.+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+)|; wv\).+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+))/i.test(t)}function Je(t,e=4){return t instanceof B&&(t=t.toBase58()),`${t.slice(0,e)}...${t.slice(-e)}`}function Pt(t){return(t==null?void 0:t.name)&&t.name!==""?t.name:Je(t.authority)}const Ia=t=>{if(!t)return{background:"#000"};let e=0;for(let i=0;i<t.length;i++)e=t.charCodeAt(i)+((e<<5)-e),e=e&e;let n="#";for(let i=0;i<3;i++)n+=`00${(e>>i*8&255).toString(16)}`.substr(-2);return{background:n}},za="/sol-messenger/assets/clover.968404b0.svg",Ba="/sol-messenger/assets/ledger.40cf6861.svg",Ta="/sol-messenger/assets/mathwallet.1d763e81.svg",Kt=t=>(Se("data-v-b79b08f0"),t=t(),ke(),t),Na=Kt(()=>u("div",{class:"text-h6 text-center"}," Your wallet ",-1)),Wa={class:"q-gutter-md row justify-between"},La=Kt(()=>u("div",{class:"text-h6"}," Connect to a wallet ",-1)),Va={class:"text-light-gray text-caption full-width text-no-wrap",style:{"text-overflow":"ellipsis",overflow:"hidden"}},Ra=["src","alt"],Oa=N({__name:"ConnectWallet",setup(t){const e={priority:{solflare:10,phantom:20,sollet:5,nufi:5,blocto:1},icons:{clover:za},darkIcons:{ledger:Ba,mathwallet:Ta},deepLinks:{phantom:"https://phantom.app/ul/browse/{uri}?ref={ref}",solflare:"https://solflare.com/ul/browse/{uri}?ref={ref}"}},{userAgent:n,isWebView:i,isMobileOs:s}=Ea(),a={close:At},o=k=>[vt.Installed,vt.Loadable].includes(k.readyState);Oe();const l=pe(),{connected:m,connecting:g}=l;en();const _=b(()=>s.value&&!i.value);if(i.value){const k=String(n.value).toLowerCase();k.includes("phantom")?(l.select(tn),l.connect()):k.includes("solflare")&&(l.select(nn),l.connect())}const v=b(()=>{var k,T;return(T=(k=l.publicKey.value)==null?void 0:k.toBase58())!=null?T:""}),A=b(()=>Je(v.value)),y=b(()=>[...l.wallets.value].map(k=>{var M,F;const T=k.adapter.name.toLowerCase();return k.adapter.icon=(F=(M=e.darkIcons[T])!=null?M:e.icons[T])!=null?F:k.adapter.icon,_.value&&e.deepLinks[T]&&(k.deepLink=e.deepLinks[T].replace("{uri}",location.href).replace("{ref}",location.origin)),k}).sort((k,T)=>{var I,h;const M=(I=e.priority[k.adapter.name.toLowerCase()])!=null?I:1;return((h=e.priority[T.adapter.name.toLowerCase()])!=null?h:1)-M+((o(T)?1:0)-(o(k)?1:0))})),w=b(()=>_.value?y.value.filter(k=>!!k.deepLink):y.value),S=V(!1);async function j(k){await l.select(k.adapter.name),S.value=!1,await l.connect()}function O(){S.value=!1,l.disconnect()}function H(){S.value=!0}function Z(){S.value=!1}return(k,T)=>(f(),D(q,null,[d(m)?(f(),C(K,_t({key:0},k.$attrs,{class:k.$style.btn,ripple:!1,color:"primary-gray","text-color":"white",rounded:"",unelevated:"",onClick:H}),{default:c(()=>[E(P(d(A)),1)]),_:1},16,["class"])):(f(),C(K,_t({key:1},k.$attrs,{color:"primary-gray","text-color":"white",rounded:"",unelevated:"",ripple:!1,loading:d(g),onClick:H}),{default:c(()=>[E(" CONNECT WALLET ")]),_:1},16,["loading"])),r(re,{modelValue:S.value,"onUpdate:modelValue":T[0]||(T[0]=M=>S.value=M),"transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:c(()=>[d(m)?(f(),C(X,{key:0},{default:c(()=>[r(L,{class:"relative-position"},{default:c(()=>[Na,r(K,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:Z},null,8,["icon"])]),_:1}),r(me),r(L,null,{default:c(()=>[E(P(d(v)),1)]),_:1}),r(me),r(L,null,{default:c(()=>[u("div",Wa,[r(K,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:O},{default:c(()=>[E(" Disconnect ")]),_:1}),r(K,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:Z},{default:c(()=>[E(" Ok ")]),_:1})])]),_:1})]),_:1})):(f(),C(X,{key:1,class:"wallet-connect-card"},{default:c(()=>[r(L,null,{default:c(()=>[La,r(K,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:Z},null,8,["icon"])]),_:1}),r(me),r(L,{style:{"max-height":"80vh"},class:"scroll"},{default:c(()=>[r(an,{grid:"",rows:d(w),"row-key":"name","hide-pagination":"","hide-header":"","rows-per-page-options":[100]},{item:c(({row:M})=>[(f(),D("div",{key:`wallet-${M.adapter.name}`,class:"col-12 col-md-6"},[r(ee,{clickable:"",href:M.deepLink,onClick:F=>M.deepLink?!0:j(M)},{default:c(()=>[r(G,null,{default:c(()=>[u("b",null,P(M.adapter.name),1),u("div",Va,P(M.adapter.url),1)]),_:2},1024),r(G,{avatar:""},{default:c(()=>[r(sn,{square:""},{default:c(()=>[u("img",{src:M.adapter.icon,alt:M.adapter.name},null,8,Ra)]),_:2},1024)]),_:2},1024)]),_:2},1032,["href","onClick"])]))]),_:1},8,["rows"])]),_:1})]),_:1}))]),_:1},8,["modelValue"])],64))}});const Fa="_btn_6n1iw_1",Ua={btn:Fa},R=(t,e)=>{const n=t.__vccOpts||t;for(const[i,s]of e)n[i]=s;return n},ja={$style:Ua},Qa=R(Oa,[["__cssModules",ja],["__scopeId","data-v-b79b08f0"]]),Me=[{id:"serum-mainnet",name:"Serum RPC",cluster:"mainnet-beta",url:"https://solana-api.projectserum.com/"},{id:"rpcpool-mainnet",name:"RPCPool RPC",cluster:"mainnet-beta",url:"https://mainnet.rpcpool.com/"},{id:"mainnet",name:"Solana RPC",cluster:"mainnet-beta",url:on("mainnet-beta")}],It={id:"devnet",name:"DevNet",cluster:"devnet",url:"https://devnet.rpcpool.com/"};Me.push(It);const qa={id:"testnet",name:"TestNet",cluster:"testnet",url:"https://testnet.rpcpool.com/"};Me.push(qa);var Mt;const Ja=(Mt=Me.find(t=>t.id==={VITE_BASE_PATH:"/sol-messenger/",VITE_USER_NODE_ENV:"production",BASE_URL:"/sol-messenger/",MODE:"staging",DEV:!1,PROD:!0}.VITE_CONNECTION_ENDPOINT))!=null?Mt:It,Ga="confirmed",Ha=12e4,yt=Ie({id:"connection",state:()=>({commitment:Ga,confirmTransactionInitialTimeout:Ha,rpc:ln("rpc","")}),getters:{endpoint(t){var e;return(e=Me.find(n=>n.id===t.rpc))!=null?e:Ja},connection(t){return console.log("[connection]",this.endpoint.url),new rn(this.endpoint.url,{confirmTransactionInitialTimeout:t.confirmTransactionInitialTimeout,commitment:t.commitment})},cluster(){return this.endpoint.cluster}},actions:{setRpc(t){this.rpc=t},setCommitment(t){this.commitment=t}}}),Xa=N({__name:"ClusterSelector",setup(t){const e=yt(),{connected:n,connect:i,disconnect:s,autoConnect:a}=pe(),o=[Me.filter(g=>g.cluster==="mainnet-beta"),Me.filter(g=>g.cluster!=="mainnet-beta")],l=b(()=>e.endpoint),m=g=>{n&&e.cluster!==g.cluster&&(s(),a.value&&i()),e.setRpc(g.id)};return(g,_)=>(f(),C(cn,{label:d(l).name,"model-value":!1,"auto-close":"",color:"secondary","text-color":"#000",rounded:"",unelevated:"",ripple:!1},{default:c(()=>[r(ve,null,{default:c(()=>[(f(),D(q,null,oe(o,(v,A)=>(f(),D(q,{key:`${A}-cluster-group`},[(f(!0),D(q,null,oe(v,y=>(f(),C(ee,{key:y.id,clickable:"",onClick:w=>m(y)},{default:c(()=>[(f(),C(G,{key:`${y.id}-item`},{default:c(()=>[r(Ke,null,{default:c(()=>[u("b",null,P(y.name),1)]),_:2},1024),E(" "+P(y.url),1)]),_:2},1024))]),_:2},1032,["onClick"]))),128)),A!==o.length-1?(f(),C(me,{key:0})):le("",!0)],64))),64))]),_:1})]),_:1},8,["label"]))}});const Za={},Ya={class:"container"},es={class:"app-header__info"},ts={class:"app-header__logo"},ns={class:"logo-wrapper"},as=u("div",{class:"app-header__title"},[u("h1",null,[E("BLOCKCHAIN messenger "),u("span",{class:"marked"},"SOLANA")])],-1),ss={class:"app-header__right"},is={class:"app-header__buttons"};function os(t,e){const n=Fe("router-link"),i=Xa,s=Qa;return f(),C(un,{class:"app-header"},{default:c(()=>[u("div",Ya,[r(ht,null,{default:c(()=>[u("div",es,[u("div",ts,[u("div",ns,[r(n,{to:"/"})])]),as]),r(pt),u("div",ss,[u("div",is,[r(i,{class:"app-header__cluster-btn header-btn"}),r(s,{class:"app-header__wallet-btn header-btn"})])])]),_:1})])]),_:1})}const ls=R(Za,[["render",os]]),rs={};function cs(t,e){const n=ls,i=Fe("router-view"),s=$a;return f(),C(dn,{view:"lfh Lpr lff"},{default:c(()=>[r(n),r(mn,null,{default:c(()=>[r(i)]),_:1}),r(s)]),_:1})}const us=R(rs,[["render",cs]]),ds={default:us,empty:()=>St(()=>import("./empty.085cd03a.js"),["assets/empty.085cd03a.js","assets/vendor.130d1de7.js"])};function ms(t){return t.map(e=>{var n;return{path:e.path,component:ds[((n=e.meta)==null?void 0:n.layout)||"default"],children:[{...e,path:""}]}})}const hs="/sol-messenger/assets/solana-logo.3caace62.svg";const ps={},Ge=t=>(Se("data-v-5ffd3a8e"),t=t(),ke(),t),gs={class:"row info-row"},fs=Ge(()=>u("div",{class:"offset-0 offset-md-3"},null,-1)),ys=Ge(()=>u("div",{class:"col-6 col-md-3 flex-center info-col"},[u("div",{class:"info-title"}," How IT WORKS "),u("div",{class:"info-text"},[u("ul",null,[u("li",null,"Connect your wallet"),u("li",null,"Enter the amount of JPLT you want to swap or enter the amount of JPLU you want to get"),u("li",null,"Click SWAP button"),u("li",null,"Confirm the transaction in your wallet"),u("li",null,"Done")])])],-1)),bs={class:"col-6 col-md-5 logo-wrap"},_s=Ge(()=>u("img",{src:hs,alt:"solana logo"},null,-1)),vs=Ge(()=>u("div",{class:"offset-0 offset-md-1"},null,-1));function ws(t,e){const n=Fe("router-link");return f(),D("div",gs,[fs,ys,u("div",bs,[r(n,{to:"/"},{default:c(()=>[_s]),_:1})]),vs])}const Cs=R(ps,[["render",ws],["__scopeId","data-v-5ffd3a8e"]]),zt=Ie("user",()=>{const t=Ue(),e=V();hn(()=>{var o;const a=(o=t.value)==null?void 0:o.publicKey;if(a){const l=Ve(a.toString(),()=>at.encode(he.generate().secretKey));n(l.value)}else e.value=void 0});function n(a){e.value=he.fromSecretKey(at.decode(a))}function i(){var l;const a=(l=t.value)==null?void 0:l.publicKey;if(!a)return;const o=Ve(a.toString(),"");n(o.value=at.encode(he.generate().secretKey))}function s(a){var m;const o=(m=t.value)==null?void 0:m.publicKey;if(!o)return;const l=Ve(o.toString(),"");n(l.value=a)}return{keypair:e,generateKey:i,importKey:s}}),Ms=t=>(Se("data-v-4f30d8b8"),t=t(),ke(),t),As=Ms(()=>u("div",{class:"text-h6 text-center"}," Device Key ",-1)),Ss={class:"q-gutter-md row justify-between"},ks=N({__name:"UserInfoDialog",emits:["regenerate"],setup(t){const e=zt(),n=()=>{var i,s;fn(((s=(i=e.keypair)==null?void 0:i.publicKey)!=null?s:"").toString())};return(i,s)=>(f(),C(re,{class:"dialog-wrapper","transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:c(()=>[r(X,null,{default:c(()=>[r(L,{class:"row items-center"},{default:c(()=>[As,r(pt),De(r(K,{flat:"",round:"",dense:"",icon:d(At)},null,8,["icon"]),[[Pe]])]),_:1}),r(me),r(L,null,{default:c(()=>{var a;return[r(K,{flat:"",round:"",dense:"",icon:d(pn),onClick:n},{default:c(()=>[r(kt,{delay:0,anchor:"bottom middle",self:"top middle","transition-duration":"0"},{default:c(()=>[E(" Copy to clipboard ")]),_:1})]),_:1},8,["icon"]),u("span",null,P((a=d(e).keypair)==null?void 0:a.publicKey),1)]}),_:1}),r(me),r(gn,{align:"right"},{default:c(()=>[u("div",Ss,[r(K,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:d(e).generateKey},{default:c(()=>[E(" Regenerate ")]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1}))}});const xs=R(ks,[["__scopeId","data-v-4f30d8b8"]]),$s="0.0.8",Es="messenger",Ds=[{name:"initChannel",accounts:[{name:"channel",isMut:!0,isSigner:!0},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"InitChannelData"}}]},{name:"deleteChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"joinChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"JoinChannelData"}}]},{name:"leaveChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"grantAccessMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"GrantAccessMemberData"}}]},{name:"addMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"invitee",isMut:!1,isSigner:!1},{name:"inviteeMembership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AddMemberData"}}]},{name:"authorizeMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AuthorizeMemberData"}}]},{name:"deleteMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"postMessage",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!1,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"message",type:"string"}]}],Ps=[{name:"Channel",type:{kind:"struct",fields:[{name:"name",docs:["Name of the channel"],type:"string"},{name:"creator",docs:["Channel creator"],type:"publicKey"},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"flags",docs:["Channel flags"],type:"u8"},{name:"memberCount",docs:["Number of members"],type:"u16"},{name:"messageCount",docs:["Message counter"],type:"u32"},{name:"maxMessages",docs:["The maximum number of messages that are stored in [messages]"],type:"u16"},{name:"messages",docs:["List of messages"],type:{vec:{defined:"Message"}}}]}},{name:"ChannelMembership",type:{kind:"struct",fields:[{name:"channel",docs:["Associated [Channel] address"],type:"publicKey"},{name:"authority",docs:["Authority of membership"],type:"publicKey"},{name:"key",docs:["The device key used to encrypt the `CEK`"],type:"publicKey"},{name:"cek",docs:["The content encryption key (CEK) of the channel"],type:{defined:"CEKData"}},{name:"status",docs:["Status of membership"],type:{defined:"ChannelMembershipStatus"}},{name:"name",docs:["Name of the channel member"],type:"string"},{name:"invitedBy",docs:["Inviter address"],type:{option:"publicKey"}},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"flags",docs:["Membership flags"],type:"u8"},{name:"bump",docs:["Bump seed for deriving PDA seeds"],type:"u8"}]}}],Ks=[{name:"AddMemberData",type:{kind:"struct",fields:[{name:"name",docs:["Member name"],type:"string"},{name:"flags",docs:["Membership flags, only `admin` and `owner` can set membership flags"],type:"u8"},{name:"cek",docs:["Content Encryption Key"],type:{defined:"CEKData"}},{name:"key",docs:["Device key"],type:{option:"publicKey"}}]}},{name:"AuthorizeMemberData",type:{kind:"struct",fields:[{name:"cek",type:{defined:"CEKData"}}]}},{name:"GrantAccessMemberData",type:{kind:"struct",fields:[{name:"flags",type:"u8"}]}},{name:"InitChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"maxMessages",type:"u16"},{name:"memberName",type:"string"},{name:"cek",type:{defined:"CEKData"}},{name:"public",type:"bool"},{name:"permissionless",type:"bool"}]}},{name:"JoinChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"authority",type:{option:"publicKey"}}]}},{name:"CEKData",type:{kind:"struct",fields:[{name:"header",docs:["The header information for the CEK"],type:"string"},{name:"encryptedKey",docs:["The CEK itself"],type:"string"}]}},{name:"Message",type:{kind:"struct",fields:[{name:"id",docs:["Uniq message id"],type:"u32"},{name:"sender",docs:["The message sender id"],type:"publicKey"},{name:"createdAt",docs:["The unix timestamp at which the message was received"],type:"i64"},{name:"flags",docs:["Message flags"],type:"u8"},{name:"content",docs:["The (typically encrypted) message content"],type:"string"}]}},{name:"ChannelMembershipStatus",type:{kind:"enum",variants:[{name:"Authorized",fields:[{name:"by",type:{option:"publicKey"}}]},{name:"Pending",fields:[{name:"authority",type:{option:"publicKey"}}]}]}}],Is=[{name:"NewChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"NewMessageEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"message",type:{defined:"Message"},index:!1}]},{name:"JoinChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"LeaveChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"authority",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AddMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"AuthorizeMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]}],zs=[{code:6e3,name:"Unauthorized",msg:"Unauthorized"},{code:6001,name:"InvalidChannel",msg:"Invalid channel"},{code:6002,name:"InvalidMembership",msg:"Invalid membership"},{code:6003,name:"InvalidMessage",msg:"Invalid message"},{code:6004,name:"NameTooLong",msg:"Name too long"},{code:6005,name:"MessageTooLong",msg:"Message too long"}],Bs={address:"6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",origin:"anchor",binaryVersion:"0.25.0",libVersion:"0.25.0"},Ts={version:$s,name:Es,instructions:Ds,accounts:Ps,types:Ks,events:Is,errors:zs,metadata:Bs},Ns=new p.FixableBeetArgsStruct([["id",p.u32],["sender",te],["createdAt",p.i64],["flags",p.u8],["content",p.utf8String]],"Message"),ct=[49,159,99,106,220,87,219,88];class Y{constructor(e,n,i,s,a,o,l,m){this.name=e,this.creator=n,this.createdAt=i,this.flags=s,this.memberCount=a,this.messageCount=o,this.maxMessages=l,this.messages=m}static fromArgs(e){return new Y(e.name,e.creator,e.createdAt,e.flags,e.memberCount,e.messageCount,e.maxMessages,e.messages)}static fromAccountInfo(e,n=0){return Y.deserialize(e.data,n)}static async fromAccountAddress(e,n,i){const s=await e.getAccountInfo(n,i);if(s==null)throw new Error(`Unable to find Channel account at ${n}`);return Y.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return xt.fromStruct(e,We)}static deserialize(e,n=0){return We.deserialize(e,n)}serialize(){return We.serialize({accountDiscriminator:ct,...this})}static byteSize(e){const n=Y.fromArgs(e);return We.toFixedFromValue({accountDiscriminator:ct,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,i){return n.getMinimumBalanceForRentExemption(Y.byteSize(e),i)}pretty(){return{name:this.name,creator:this.creator.toBase58(),createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,memberCount:this.memberCount,messageCount:this.messageCount,maxMessages:this.maxMessages,messages:this.messages}}}const We=new p.FixableBeetStruct([["accountDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["name",p.utf8String],["creator",te],["createdAt",p.i64],["flags",p.u8],["memberCount",p.u16],["messageCount",p.u32],["maxMessages",p.u16],["messages",p.array(Ns)]],Y.fromArgs,"Channel"),He=new p.FixableBeetArgsStruct([["header",p.utf8String],["encryptedKey",p.utf8String]],"CEKData"),Ws=p.dataEnum([["Authorized",new p.FixableBeetArgsStruct([["by",p.coption(te)]],'ChannelMembershipStatusRecord["Authorized"]')],["Pending",new p.FixableBeetArgsStruct([["authority",p.coption(te)]],'ChannelMembershipStatusRecord["Pending"]')]]),Re=[238,149,255,251,116,131,86,170];class J{constructor(e,n,i,s,a,o,l,m,g,_){this.channel=e,this.authority=n,this.key=i,this.cek=s,this.status=a,this.name=o,this.invitedBy=l,this.createdAt=m,this.flags=g,this.bump=_}static fromArgs(e){return new J(e.channel,e.authority,e.key,e.cek,e.status,e.name,e.invitedBy,e.createdAt,e.flags,e.bump)}static fromAccountInfo(e,n=0){return J.deserialize(e.data,n)}static async fromAccountAddress(e,n,i){const s=await e.getAccountInfo(n,i);if(s==null)throw new Error(`Unable to find ChannelMembership account at ${n}`);return J.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return xt.fromStruct(e,Le)}static deserialize(e,n=0){return Le.deserialize(e,n)}serialize(){return Le.serialize({accountDiscriminator:Re,...this})}static byteSize(e){const n=J.fromArgs(e);return Le.toFixedFromValue({accountDiscriminator:Re,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,i){return n.getMinimumBalanceForRentExemption(J.byteSize(e),i)}pretty(){return{channel:this.channel.toBase58(),authority:this.authority.toBase58(),key:this.key.toBase58(),cek:this.cek,status:this.status.__kind,name:this.name,invitedBy:this.invitedBy,createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,bump:this.bump}}}const Le=new p.FixableBeetStruct([["accountDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["channel",te],["authority",te],["key",te],["cek",He],["status",Ws],["name",p.utf8String],["invitedBy",p.coption(te)],["createdAt",p.i64],["flags",p.u8],["bump",p.u8]],J.fromArgs,"ChannelMembership"),ge=new Map,fe=new Map;class Xe extends Error{constructor(){super("Unauthorized");W(this,"code",6e3);W(this,"name","Unauthorized");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Xe)}}ge.set(6e3,()=>new Xe);fe.set("Unauthorized",()=>new Xe);class Ze extends Error{constructor(){super("Invalid channel");W(this,"code",6001);W(this,"name","InvalidChannel");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ze)}}ge.set(6001,()=>new Ze);fe.set("InvalidChannel",()=>new Ze);class Ye extends Error{constructor(){super("Invalid membership");W(this,"code",6002);W(this,"name","InvalidMembership");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ye)}}ge.set(6002,()=>new Ye);fe.set("InvalidMembership",()=>new Ye);class et extends Error{constructor(){super("Invalid message");W(this,"code",6003);W(this,"name","InvalidMessage");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,et)}}ge.set(6003,()=>new et);fe.set("InvalidMessage",()=>new et);class tt extends Error{constructor(){super("Name too long");W(this,"code",6004);W(this,"name","NameTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,tt)}}ge.set(6004,()=>new tt);fe.set("NameTooLong",()=>new tt);class nt extends Error{constructor(){super("Message too long");W(this,"code",6005);W(this,"name","MessageTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,nt)}}ge.set(6005,()=>new nt);fe.set("MessageTooLong",()=>new nt);function ie(t){const e=ge.get(t);return e!=null?e():null}function _e(t){const e=fe.get(t);return e!=null?e():null}const Ls=new p.FixableBeetArgsStruct([["name",p.utf8String],["flags",p.u8],["cek",He],["key",p.coption(te)]],"AddMemberData"),Vs=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",Ls]],"AddMemberInstructionArgs"),Rs=[13,116,123,130,126,198,57,34];function Os(t,e,n=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var o;const[i]=Vs.serialize({instructionDiscriminator:Rs,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.invitee,isWritable:!1,isSigner:!1},{pubkey:t.inviteeMembership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new ue({programId:n,keys:s,data:i})}const Fs=new p.FixableBeetArgsStruct([["cek",He]],"AuthorizeMemberData"),Us=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",Fs]],"AuthorizeMemberInstructionArgs"),js=[194,123,189,175,86,225,93,128];function Qs(t,e,n=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var o;const[i]=Us.serialize({instructionDiscriminator:js,...e}),s=[{pubkey:t.channel,isWritable:!1,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:(o=t.systemProgram)!=null?o:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new ue({programId:n,keys:s,data:i})}const qs=new p.BeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)]],"DeleteChannelInstructionArgs"),Js=[145,225,187,221,157,142,114,133];function Gs(t,e=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=qs.serialize({instructionDiscriminator:Js}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)i.push(o);return new ue({programId:e,keys:i,data:n})}const Hs=new p.BeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)]],"DeleteMemberInstructionArgs"),Xs=[95,14,98,112,252,218,205,173];function Zs(t,e=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=Hs.serialize({instructionDiscriminator:Xs}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)i.push(o);return new ue({programId:e,keys:i,data:n})}const Ys=new p.BeetArgsStruct([["flags",p.u8]],"GrantAccessMemberData");new p.BeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",Ys]],"GrantAccessMemberInstructionArgs");const ei=new p.FixableBeetArgsStruct([["name",p.utf8String],["maxMessages",p.u16],["memberName",p.utf8String],["cek",He],["public",p.bool],["permissionless",p.bool]],"InitChannelData"),ti=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",ei]],"InitChannelInstructionArgs"),ni=[21,200,152,39,19,178,76,47];function ai(t,e,n=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var o;const[i]=ti.serialize({instructionDiscriminator:ni,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!0},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new ue({programId:n,keys:s,data:i})}const si=new p.FixableBeetArgsStruct([["name",p.utf8String],["authority",p.coption(te)]],"JoinChannelData"),ii=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",si]],"JoinChannelInstructionArgs"),oi=[124,39,115,89,217,26,38,29];function li(t,e,n=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var o;const[i]=ii.serialize({instructionDiscriminator:oi,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new ue({programId:n,keys:s,data:i})}const ri=new p.BeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)]],"LeaveChannelInstructionArgs"),ci=[104,0,75,134,95,80,68,186];function ui(t,e=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=ri.serialize({instructionDiscriminator:ci}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const o of t.anchorRemainingAccounts)i.push(o);return new ue({programId:e,keys:i,data:n})}const di=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["message",p.utf8String]],"PostMessageInstructionArgs"),mi=[214,50,100,209,38,34,7,76];function hi(t,e,n=new B("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var o;const[i]=di.serialize({instructionDiscriminator:mi,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:(o=t.systemProgram)!=null?o:ce.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new ue({programId:n,keys:s,data:i})}const pi="6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",gi=new B(pi);function ut(t,e=new Uint8Array(4)){const n=ze(t.toString(),"base10");return e.set(n,4-n.length),e}const it=t=>we([ut(t.length),t]);function Bt(t,e,n){if(e!==256)throw new Error(`Unsupported key length: ${e}`);const i=we([it(ze(n)),it(new Uint8Array(0)),it(new Uint8Array(0)),ut(e)]),s=1;return yn.hash(we([ut(s),t,i]))}const dt=t=>ze(t,"base64pad"),mt=t=>$t(t,"base64pad"),fi=t=>ze(t),yi=t=>$t(t),bi=t=>ze(t,"base58btc"),de=je.NONCE_LENGTH,Ae=je.TAG_LENGTH,Tt=t=>{const e=new je.XChaCha20Poly1305(t);return(n,i)=>{const s=Et.randomBytes(de),a=e.seal(s,n,i);return{ciphertext:a.subarray(0,a.length-Ae),tag:a.subarray(a.length-Ae),iv:s}}},Nt=t=>{const e=new je.XChaCha20Poly1305(t);return(n,i,s,a)=>e.open(s,we([n,i]),a)},Wt="ECDH-ES+XC20PKW",Lt=256,_i=t=>e=>{const n=rt.generateKeyPair(),i=rt.sharedKey(n.secretKey,t),s=Bt(i,Lt,Wt),a=Tt(s)(e);return{encryptedKey:a.ciphertext,tag:a.tag,iv:a.iv,epPubKey:n.publicKey}},vi=t=>(e,n,i,s)=>{const a=rt.sharedKey(t,s),o=Bt(a,Lt,Wt);return Nt(o)(e,n,i)},wi=t=>Array.isArray(t)?he.fromSecretKey(vn.Buffer.from(t)):typeof t=="string"?he.fromSecretKey(bi(t)):he.fromSecretKey(t),Ci=async(t=32)=>{const e=Et.randomBytes(t);return Promise.resolve(e)},Mi=async(t,e)=>{const n=await _i(bn(e.toBytes()))(t);return{header:mt(we([n.iv,n.tag,n.epPubKey])),encryptedKey:mt(n.encryptedKey)}},Ai=async(t,e)=>{const n=dt(t.header),i=n.subarray(0,de),s=n.subarray(de,de+Ae),a=n.subarray(de+Ae),o=dt(t.encryptedKey),l=wi(e).secretKey,m=_n(l),g=await vi(m)(o,s,i,a);if(g===null)throw new Error("There was a problem decrypting the CEK");return g},Si=async(t,e)=>{const n=await Tt(e)(fi(t));return mt(we([n.iv,n.ciphertext,n.tag]))},ki=async(t,e)=>{const n=dt(t),i=n.subarray(0,de),s=n.subarray(de,-Ae),a=n.subarray(-Ae),o=await Nt(e)(s,a,i);if(o===null)throw new Error("There was an error decoding the message!");return yi(o)};class xi{constructor(e,n){W(this,"programId",gi);W(this,"_coder");W(this,"_events");W(this,"utils",{channel:{isPublic:e=>(e.flags&1)>0,isPermissionless:e=>(e.flags&2)>0},member:{isOwner:e=>e.flags>=255,isAdmin:e=>(e.flags&7)===7,canAddMember:e=>(e.flags&1)>0,canDeleteMember:e=>(e.flags&2)>0,canAuthorizeMember:e=>(e.flags&4)>0},message:{isEncrypted:e=>(e.flags&1)>0}});this.provider=e,this.keypair=n,this._coder=new wn(Ts),this._events=new Cn(this.programId,e,this._coder)}get connection(){return this.provider.connection}addEventListener(e,n){return this._events.addEventListener(e,n)}async removeEventListener(e){return await this._events.removeEventListener(e)}setKeypair(e){this.keypair=e}async loadAllChannels(){return(await Y.gpaBuilder().addFilter("accountDiscriminator",ct).run(this.provider.connection)).map(n=>({pubkey:n.pubkey,data:Y.fromAccountInfo(n.account)[0]}))}async loadChannel(e,n){return Y.fromAccountAddress(this.provider.connection,e,n)}async loadMyChannels(){return await this.loadMemberships()}async loadChannelMembers(e){return(await J.gpaBuilder().addFilter("accountDiscriminator",Re).addFilter("channel",e).run(this.provider.connection)).map(i=>({pubkey:i.pubkey,data:J.fromAccountInfo(i.account)[0]}))}async loadMemberships(e){const n=J.gpaBuilder().addFilter("accountDiscriminator",Re).addFilter("authority",this.provider.publicKey);return e&&n.addFilter("key",e),(await n.run(this.provider.connection)).map(s=>({pubkey:s.pubkey,data:J.fromAccountInfo(s.account)}))}async loadMembership(e,n){return J.fromAccountAddress(this.provider.connection,e,n)}async getMembershipPDA(e,n){return n=n!=null?n:this.keypair.publicKey,await B.findProgramAddress([e.toBuffer(),n.toBuffer()],this.programId)}async encryptCEK(e,n){return Mi(e,n!=null?n:this.keypair.publicKey)}async decryptCEK(e,n){return Ai(e,n!=null?n:this.keypair.secretKey)}async encryptMessage(e,n){return Si(e,n)}async decryptMessage(e,n){return ki(e,n)}async initChannel(e){var g,_,v,A,y;const n=(g=e.channel)!=null?g:he.generate(),i=await Ci(),s=await this.encryptCEK(i),[a]=await this.getMembershipPDA(n.publicKey),o=this.provider.publicKey,l=new se;l.add(ai({key:this.keypair.publicKey,channel:n.publicKey,membership:a,authority:o},{data:{name:e.name,public:(_=e.public)!=null?_:!1,permissionless:(v=e.permissionless)!=null?v:!1,memberName:(A=e.memberName)!=null?A:"",maxMessages:e.maxMessages,cek:s}}));let m;try{m=await this.provider.sendAndConfirm(l,[n,this.keypair],e.opts)}catch(w){throw(y=ie(w.code))!=null?y:w}return{signature:m,channel:n,cek:i,cekEncrypted:s}}async deleteChannel({channel:e,opts:n}){var l;const i=this.provider.publicKey,[s]=await this.getMembershipPDA(e),a=new se;a.add(Gs({channel:e,authority:i,authorityMembership:s}));let o;try{o=await this.provider.sendAndConfirm(a,void 0,n)}catch(m){throw(l=ie(m.code))!=null?l:_e("Unauthorized")}return{signature:o}}async joinChannel(e){var o,l;const[n]=await this.getMembershipPDA(e.channel),i=this.provider.publicKey,s=new se;s.add(li({channel:e.channel,key:this.keypair.publicKey,membership:n,authority:i},{data:{name:e.name,authority:(o=e.authority)!=null?o:null}}));let a;try{a=await this.provider.sendAndConfirm(s,[this.keypair],e.opts)}catch(m){throw(l=ie(m.code))!=null?l:m}return{signature:a}}async leaveChannel(e){var o;const[n]=await this.getMembershipPDA(e.channel),i=this.provider.publicKey,s=new se;s.add(ui({channel:e.channel,membership:n,authority:i}));let a;try{a=await this.provider.sendAndConfirm(s)}catch(l){throw(o=ie(l.code))!=null?o:l}return{signature:a}}async addMember(e){var _,v,A,y;const n=(_=e.key)!=null?_:e.invitee,[i]=await this.getMembershipPDA(e.channel),[s]=await this.getMembershipPDA(e.channel,n),a=await this.loadMembership(i);if(!a.cek.encryptedKey)throw _e("Unauthorized");const o=await this.decryptCEK(a.cek),l=await this.encryptCEK(o,n),m=new se;m.add(Os({channel:e.channel,authority:this.provider.publicKey,invitee:e.invitee,authorityMembership:i,inviteeMembership:s},{data:{name:(v=e.name)!=null?v:"",flags:(A=e.flags)!=null?A:0,cek:l,key:n}}));let g;try{g=await this.provider.sendAndConfirm(m)}catch(w){throw(y=ie(w.code))!=null?y:_e("Unauthorized")}return{signature:g}}async deleteMember(e){var l;const[n]=e.membership?[e.membership]:await this.getMembershipPDA(e.channel,e.key),[i]=await this.getMembershipPDA(e.channel),s=this.provider.publicKey,a=new se;a.add(Zs({channel:e.channel,membership:n,authority:s,authorityMembership:i}));let o;try{o=await this.provider.sendAndConfirm(a)}catch(m){throw(l=ie(m.code))!=null?l:m}return{signature:o}}async authorizeMember(e){var g;const[n]=await this.getMembershipPDA(e.channel),[i]=await this.getMembershipPDA(e.channel,e.key),s=await this.loadMembership(n);if(!s.cek.encryptedKey)throw _e("Unauthorized");const a=await this.decryptCEK(s.cek),o=await this.encryptCEK(a,e.key),l=new se;l.add(Qs({channel:e.channel,membership:i,authority:this.provider.publicKey,authorityMembership:n},{data:{cek:o}}));let m;try{m=await this.provider.sendAndConfirm(l)}catch(_){throw(g=ie(_.code))!=null?g:_e("Unauthorized")}return{signature:m}}async postMessage(e){var l;const[n]=await this.getMembershipPDA(e.channel);let i,s=0;if(e.encrypt){const m=await this.loadMembership(n);if(!m.cek.header)throw _e("Unauthorized");const g=await this.decryptCEK(m.cek);i=await this.encryptMessage(e.message,g),s|=1}else i=e.message;const a=new se;a.add(hi({channel:e.channel,membership:n,authority:this.provider.publicKey},{message:String.fromCharCode(s)+i}));let o;try{o=await this.provider.sendAndConfirm(a)}catch(m){throw(l=ie(m.code))!=null?l:m}return{signature:o}}}const Ct="***** *** *** *** *******",U=Ie("messenger",()=>{const t=yt(),e=zt(),n=Ue(),i=b(()=>e.keypair),s={allChannels:[],ownChannels:[],channel:void 0,channelAddr:void 0,channelMembershipAddr:void 0,channelMembership:void 0,channelMembers:[],channelMessages:[],channelLoading:!1,loading:!1,creating:!1,sending:!1},a=ae({...s}),o=b(()=>{var h;return new xi(new wt(t.connection,(h=n.value)!=null?h:{publicKey:B.default},wt.defaultOptions()),e.keypair)});let l=[];Ce(n,h=>{h?_().then():v()},{immediate:!0}),Ce([i,()=>a.allChannels],()=>{m().then()},{immediate:!0});async function m(){var $;const x=(await o.value.loadMemberships(($=e.keypair)==null?void 0:$.publicKey)).map(Q=>({pubkey:Q.data[0].channel.toBase58(),status:Q.data[0].status.__kind}));a.ownChannels=x,console.log("myChannels ====== ",a.ownChannels)}async function g(){console.log("Register events...");for(const h of l)await o.value.removeEventListener(h);l.push(o.value.addEventListener("NewMessageEvent",async h=>{if(console.log("[Event] NewMessageEvent",h),`${h.channel}`!=`${a.channelAddr}`)return;let x=h.message.content;if(o.value.utils.message.isEncrypted(h.message)){const Q=await j();Q?x=await o.value.decryptMessage(h.message.content,Q):x=Ct}a.channelMessages.push({...h.message,content:x})})),l.push(o.value.addEventListener("AuthorizeMemberEvent",async h=>{console.log("[Event] AuthorizeMemberEvent",h),!(a.channelAddr&&`${h.channel}`!=`${a.channelAddr}`)&&(`${h.membership}`==`${a.channelMembershipAddr}`?S(a.channelAddr).then():H().then())})),l.push(o.value.addEventListener("JoinChannelEvent",async h=>{console.log("[Event] JoinChannelEvent",h),`${h.channel}`==`${a.channelAddr}`&&H().then()})),l.push(o.value.addEventListener("LeaveChannelEvent",async h=>{console.log("[Event] LeaveChannelEvent",h),`${h.channel}`==`${a.channelAddr}`&&H().then()}))}async function _(){v(),l=[],a.loading=!0;const h=await o.value.loadAllChannels();await g(),a.allChannels=h,a.loading=!1,console.log(a)}function v(){Object.assign(a,s)}async function A(h,x){var $,Q;try{a.creating=!0,await o.value.initChannel({name:h,maxMessages:($=x.maxMessages)!=null?$:15,public:x.public,permissionless:x.permissionless,opts:{commitment:(Q=x.commitment)!=null?Q:"confirmed"}}),await _()}finally{a.creating=!1}}async function y(h){const x=new B(h);await o.value.deleteChannel({channel:x,opts:{commitment:"confirmed"}}),await _()}async function w(h,x){const $=new B(h);await o.value.joinChannel({channel:$,name:x,opts:{commitment:"confirmed"}}),await S(h)}async function S(h){var x;a.channelLoading=!0,a.channelMessages=[],a.channelMembers=[],a.channelMembershipAddr=void 0,a.channelMembership=void 0,a.channelAddr=new B(h);try{if((x=n.value)!=null&&x.publicKey)try{const[$]=await o.value.getMembershipPDA(a.channelAddr);a.channelMembershipAddr=$,a.channelMembership=await o.value.loadMembership($)}catch($){console.log($),a.channelMembershipAddr=void 0,a.channelMembership=void 0}await H(),await O()}catch($){console.log("Error",$)}finally{a.channelLoading=!1}}async function j(){if(!!a.channelMembership)try{return await o.value.decryptCEK(a.channelMembership.cek)}catch(h){console.log(h)}}async function O(){if(!a.channelAddr){console.log("Invalid channel");return}a.channel=await o.value.loadChannel(a.channelAddr);const x=o.value.utils.channel.isPublic(a.channel)?null:await j();a.channelMessages=await Promise.all(a.channel.messages.map(async $=>{var Ne;let Be=o.value.utils.message.isEncrypted($)?Ct:$.content,Te=Je($.sender);if((Ne=n.value)!=null&&Ne.publicKey){const be=a.channelMembers.find(({data:$e})=>$e.name!==""&&(`${$e.authority}`==`${$.sender}`||`${$e.key}`==`${$.sender}`));be&&be.data.name!==""&&(Te=be.data.name)}if(x)try{Be=await o.value.decryptMessage($.content,x)}catch{console.log(`Failed to decrypt message #${$.id}`)}return{...$,senderDisplayName:Te,content:Be}}))}async function H(){if(!a.channelAddr){console.error("Invalid channel");return}a.channelMembers=await Z()}async function Z(h=a.channelAddr){return await o.value.loadChannelMembers(h)}async function k(h){if(!a.channelAddr){console.log("Please select a channel");return}try{a.sending=!0;let x;a.channel&&(x=o.value.utils.channel.isPublic(a.channel)),await o.value.postMessage({channel:a.channelAddr,message:h,encrypt:!x}),await O()}finally{a.sending=!1}}async function T(h,x,$,Q){if(!a.channelAddr){console.log("Invalid channel");return}await o.value.addMember({channel:a.channelAddr,invitee:new B(h),key:x?new B(x):void 0,name:$,flags:Q})}async function M(h){if(!a.channelAddr){console.log("Invalid channel");return}await o.value.deleteMember({channel:a.channelAddr,key:new B(h)})}async function F(h){if(!a.channelAddr){console.log("Invalid channel");return}await o.value.authorizeMember({channel:a.channelAddr,key:new B(h)}),await O()}async function I(){await _()}return{state:a,client:o.value,loadChannel:S,joinChannel:w,createChannel:A,deleteChannel:y,postMessage:k,addMember:T,deleteMember:M,authorizeMember:F,refreshList:I,loadMembers:Z}}),ye=Ie("channel",()=>{const t=Ue(),{state:e,client:n}=U(),i=b(()=>e.channelLoading),s=b(()=>e.sending),a=b(()=>{var M;return!!((M=t.value)!=null&&M.publicKey)}),o=b(()=>!!e.channel&&n.utils.channel.isPublic(e.channel)),l=b(()=>!!e.channel&&n.utils.channel.isPermissionless(e.channel)),m=b(()=>{var M;return((M=e.channelMembership)==null?void 0:M.status.__kind)==="Authorized"}),g=b(()=>{var M;return((M=e.channelMembership)==null?void 0:M.status.__kind)==="Pending"}),_=b(()=>{var M,F,I;return String((M=e.channel)==null?void 0:M.creator)===String((I=(F=t.value)==null?void 0:F.publicKey)!=null?I:"-")}),v=b(()=>!!e.channelMembership&&n.utils.member.canAddMember(e.channelMembership)),A=b(()=>!!e.channelMembership&&n.utils.member.canAuthorizeMember(e.channelMembership)),y=b(()=>!!e.channelMembership&&n.utils.member.canDeleteMember(e.channelMembership)),w=b(()=>!!e.channelMembership&&n.utils.member.isAdmin(e.channelMembership)),S=b(()=>!!e.channelMembership&&n.utils.member.isOwner(e.channelMembership)),j=b(()=>a.value&&!!e.channel&&!e.loading&&!m.value),O=b(()=>a.value),H=b(()=>S.value),Z=b(()=>S.value),k=b(()=>!e.sending&&(o.value||m.value));return{ownChannels:b(()=>e.allChannels.filter(M=>{var F;return!!e.ownChannels.find(I=>I.pubkey===M.pubkey.toBase58())||M.data.flags===1||M.data.creator.toBase58()===String((F=t.value)==null?void 0:F.publicKey)})),isChannelLoading:i,isSendMessage:s,isPublicChannel:o,isPermissionlessChannel:l,isAuthorizedMember:m,isPendingMember:g,isChannelCreator:_,isAdmin:w,isOwner:S,canJoinChannel:j,canAddMember:v,canAuthorizeMember:A,canDeleteMember:y,canCreateChannel:O,canDeleteChannel:H,canGrantAccess:Z,canPostMessage:k}}),$i={class:"text-weight-medium"},Ei={class:"memberlist-info__details"},Di=u("span",null,"Authority:",-1),Pi={class:"memberlist-info__details"},Ki=u("span",null,"Key:",-1),Ii={class:"memberlist-btns"},zi=N({__name:"MemberListDialog",props:{membersDialog:{type:Boolean,default:!1},authorizeMemberState:{type:Object},deleteMemberState:{type:Object},wallet:{type:Object}},emits:["submit","deleteMember"],setup(t,{emit:e}){const{state:n}=U(),i=ye();function s(a){return String(a).toLowerCase()}return(a,o)=>(f(),C(re,{class:"memberlist"},{default:c(()=>[r(X,{square:"",flat:"",horizontal:""},{default:c(()=>[r(L,{class:"q-px-lg"},{default:c(()=>[E(" MEMBERS ")]),_:1}),r(L,{class:"memberlist-card"},{default:c(()=>[r(ve,{separator:""},{default:c(()=>[(f(!0),D(q,null,oe(d(n).channelMembers,l=>(f(),C(ee,{key:l.pubkey.toString(),"active-class":"bg-teal-1",active:`${l.pubkey}`==`${d(n).channelMembershipAddr}`,class:"memberlist-item"},{default:c(()=>[r(G,{class:"memberlist-info"},{default:c(()=>[r(Ke,{class:"row justify-between"},{default:c(()=>[u("span",$i,P(d(Pt)(l.data)),1),r(Mn,{class:gt([s(l.data.status.__kind),"memberlist-status q-px-xs"])},{default:c(()=>[E(P(l.data.status.__kind),1)]),_:2},1032,["class"])]),_:2},1024),r(Ke,{caption:"",lines:"2"},{default:c(()=>[u("div",Ei,[Di,u("span",null,P(l.data.authority),1)]),u("div",Pi,[Ki,u("span",null,P(l.data.key),1)])]),_:2},1024)]),_:2},1024),u("div",Ii,[l.data.status.__kind==="Pending"?(f(),C(K,{key:0,color:"teal",size:"xs",unelevated:"",class:"full-width",loading:t.authorizeMemberState.loading,disabled:t.authorizeMemberState.loading,onClick:m=>a.$emit("submit",l.data.key)},{default:c(()=>[E(" Authorize ")]),_:2},1032,["loading","disabled","onClick"])):le("",!0),d(i).canDeleteMember?(f(),C(K,{key:1,color:"negative",size:"xs",unelevated:"",class:"full-width",loading:t.deleteMemberState.loading,disabled:t.deleteMemberState.loading,onClick:m=>a.$emit("deleteMember",l.data.key)},{default:c(()=>[E(" Delete ")]),_:2},1032,["loading","disabled","onClick"])):le("",!0)])]),_:2},1032,["active"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}}),Bi=t=>(Se("data-v-65f173ca"),t=t(),ke(),t),Ti=Bi(()=>u("br",null,null,-1)),Ni=N({__name:"JoinChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=V(t.defaultState);return(i,s)=>(f(),C(re,{class:"join-channel-dialog",onHide:s[3]||(s[3]=a=>i.$emit("reset"))},{default:c(()=>[r(X,null,{default:c(()=>[r(L,null,{default:c(()=>[r(Qe,{class:"join-channel-form",onSubmit:s[2]||(s[2]=ft(a=>i.$emit("submit",n.value),["prevent"]))},{default:c(()=>[r(ne,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.name=a),label:"Member name *","lazy-rules":"",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),r(ne,{modelValue:n.value.authority,"onUpdate:modelValue":s[1]||(s[1]=a=>n.value.authority=a),label:"Authorize By","lazy-rules":"",rules:[a=>!a||a&&a.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),Ti,r(K,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[E(" Join Channel ")]),_:1})]),_:1}),r(qe,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Wi=R(Ni,[["__scopeId","data-v-65f173ca"]]),Li=t=>(Se("data-v-fe97e637"),t=t(),ke(),t),Vi=Li(()=>u("br",null,null,-1)),Ri=N({__name:"AddMemberDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t,{emit:e}){const i=V(t.defaultState),s=()=>e("submit",i.value);return(a,o)=>(f(),C(re,{class:"add-member-dialog",onHide:o[3]||(o[3]=l=>a.$emit("reset"))},{default:c(()=>[r(X,null,{default:c(()=>[r(L,null,{default:c(()=>[r(Qe,{class:"add-member-form",onSubmit:ft(s,["prevent"])},{default:c(()=>[r(ne,{modelValue:i.value.name,"onUpdate:modelValue":o[0]||(o[0]=l=>i.value.name=l),label:"Member name *",hint:"Min length 3 chars","lazy-rules":"",rules:[l=>l&&l.length>2||"Please type something"]},null,8,["modelValue","rules"]),r(ne,{modelValue:i.value.wallet,"onUpdate:modelValue":o[1]||(o[1]=l=>i.value.wallet=l),label:"Member Wallet *","lazy-rules":"",rules:[l=>l&&l.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),r(ne,{modelValue:i.value.key,"onUpdate:modelValue":o[2]||(o[2]=l=>i.value.key=l),label:"Member Device Key",hint:"Default: The same as member wallet","lazy-rules":"",rules:[l=>!l||l.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),Vi,r(K,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[E(" Add Member ")]),_:1})]),_:1},8,["onSubmit"]),r(qe,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Oi=R(Ri,[["__scopeId","data-v-fe97e637"]]),Fi={class:"row"},Ui={class:"col"},ji={class:"col"},Qi=N({__name:"NewChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t,{emit:e}){const i=V(t.defaultState),s=()=>e("submit",i);return(a,o)=>(f(),C(re,{class:"new-channel-dialog",onHide:o[4]||(o[4]=l=>a.$emit("reset"))},{default:c(()=>[r(X,null,{default:c(()=>[r(L,null,{default:c(()=>[r(Qe,{class:"messenger-new-channel-form"},{default:c(()=>[r(ne,{modelValue:i.value.name,"onUpdate:modelValue":o[0]||(o[0]=l=>i.value.name=l),label:"Channel name *","lazy-rules":"",maxlength:"32",rules:[l=>l&&l.length>2||"Please type something"]},null,8,["modelValue","rules"]),r(ne,{modelValue:i.value.maxMessages,"onUpdate:modelValue":o[1]||(o[1]=l=>i.value.maxMessages=l),label:"Max messages","lazy-rules":"",rules:[l=>+l>0||"Invalid value"]},null,8,["modelValue","rules"]),u("div",Fi,[u("div",Ui,[r(lt,{modelValue:i.value.public,"onUpdate:modelValue":o[2]||(o[2]=l=>i.value.public=l),label:"Public"},null,8,["modelValue"])]),u("div",ji,[i.value.public?le("",!0):(f(),C(lt,{key:0,modelValue:i.value.permissionless,"onUpdate:modelValue":o[3]||(o[3]=l=>i.value.permissionless=l),label:"Permissionless"},null,8,["modelValue"]))])])]),_:1}),r(qe,{showing:t.loading},null,8,["showing"])]),_:1}),r(me),r(L,null,{default:c(()=>[r(K,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:"",onClick:s},{default:c(()=>[E(" Create Channel ")]),_:1})]),_:1})]),_:1})]),_:1}))}});const qi=R(Qi,[["__scopeId","data-v-96ab7f96"]]),Ji=N({__name:"ChannelForm",props:{message:{type:String,default:""},disabled:{type:Boolean,default:!1},sending:{type:Boolean,default:!1}},emits:["submit"],setup(t,{emit:e}){const n=t,i=V(n.message),s=()=>{e("submit",i),i.value=""};return console.log(n),(a,o)=>(f(),C(Qe,{class:"channel-form",onSubmit:ft(s,["prevent"])},{default:c(()=>[r(ht,{class:"row message-control"},{default:c(()=>[r(ne,{ref:"inputFocus",modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=l=>i.value=l),class:"col-grow message-input","bg-color":"white",placeholder:"Type a message",dense:"",borderless:"",autofocus:"",disable:t.disabled},null,8,["modelValue","disable"]),r(K,{class:"send-btn",square:"",flat:"",type:"submit",disable:t.disabled,loading:t.sending},{default:c(()=>[E(" Send ")]),_:1},8,["disable","loading"])]),_:1})]),_:1},8,["onSubmit"]))}});const Gi=R(Ji,[["__scopeId","data-v-6a48a63e"]]),Hi={},Xi={class:"column q-ma-md"},Zi={class:"column items-end q-ma-md"};function Yi(t,e){return f(),D(q,null,[u("div",Xi,[r(Ee,{class:"q-my-xs",width:"250px",height:"47px"}),r(Ee,{class:"q-my-xs",width:"250px",height:"47px"})]),u("div",Zi,[r(Ee,{class:"q-my-xs",width:"250px",height:"47px"}),r(Ee,{class:"q-my-xs",width:"250px",height:"47px"}),r(Ee,{class:"q-my-xs",width:"250px",height:"47px"})])],64)}const eo=R(Hi,[["render",Yi]]),to={key:1,class:"row justify-center channel-wrapper"},no={key:1,class:"messenger-empty"},ao={key:2,class:"messenger-empty"},so=N({__name:"ChannelWrapper",props:{postMessageState:{type:Object}},emits:["sendMessage"],setup(t,{emit:e}){const n=pe(),{state:i}=U(),s=ye();function a(v){const A=n.publicKey.value;return A?String(A)!==String(v):!0}const o=b(()=>{const v=[];let A=0,y;for(const w of i.channelMessages)y&&`${w.sender}`==`${y}`?v[A-1].text.push(w.content):(y=w.sender,v.push({id:w.id,sender:w.sender,senderDisplayName:w.senderDisplayName,text:[w.content],date:w.createdAt}),A++);return v}),l=b(()=>s.canPostMessage),m=v=>e("sendMessage",v),g=V(),_=V();return Ce(_,v=>{v&&(g.value.scrollTop=v.scrollHeight)}),(v,A)=>{const y=eo,w=Gi;return f(),C(X,{class:"messenger-card",square:""},{default:c(()=>[u("div",{ref_key:"chat",ref:g,class:"messenger-content"},[d(s).isChannelLoading?(f(),C(y,{key:0})):d(i).channel?(f(),D("div",to,[d(o).length>0?(f(),D("div",{key:0,ref_key:"mes",ref:_,class:"messenger-messages"},[(f(!0),D(q,null,oe(d(o),S=>(f(),C(An,{key:S.id,name:S.senderDisplayName,text:S.text,sent:a(S.sender)},null,8,["name","text","sent"]))),128))],512)):(f(),D("div",no," No messages "))])):(f(),D("div",ao," Please select a channel "))],512),r(w,{message:t.postMessageState.message,sending:d(s).isSendMessage,disabled:!d(l),onSubmit:m},null,8,["message","sending","disabled"])]),_:1})}}});const io=R(so,[["__scopeId","data-v-7ebf5d4f"]]),oo=N({props:{text:{type:String,default:""}}});function lo(t,e,n,i,s,a){return f(),C(kt,{anchor:"top middle",self:"center middle",class:"bg-grey-9 text-body2"},{default:c(()=>[E(P(t.text),1)]),_:1})}const ro=R(oo,[["render",lo]]),co="/sol-messenger/assets/refresh.e0cf4262.svg",uo="/sol-messenger/assets/add.1481b8ed.svg",mo="/sol-messenger/assets/join.627c8616.svg",bt=t=>(Se("data-v-cc02cbfe"),t=t(),ke(),t),ho=bt(()=>u("img",{src:co,alt:"refresh"},null,-1)),po=bt(()=>u("img",{src:uo,alt:"create"},null,-1)),go=bt(()=>u("img",{src:mo,alt:"join"},null,-1)),fo=N({__name:"ChannelControl",props:{isJoining:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["createChannel","joinChannel","refreshList"],setup(t){const e=ye(),n=b(()=>e.canJoinChannel&&!e.isPublicChannel),i=b(()=>e.isPendingMember),s=b(()=>e.canCreateChannel);return(a,o)=>{const l=ro;return f(),C(ee,null,{default:c(()=>[r(G,{class:"button-wrapper"},{default:c(()=>[r(K,{class:gt(["control-button",{"refresh-btn":t.isLoading}]),onClick:o[0]||(o[0]=m=>a.$emit("refreshList"))},{default:c(()=>[ho,r(l,{text:"Refresh list"})]),_:1},8,["class"]),d(s)?(f(),C(K,{key:0,class:"control-button",square:"",onClick:o[1]||(o[1]=m=>a.$emit("createChannel"))},{default:c(()=>[po,r(l,{text:"Create a channel"})]),_:1})):le("",!0),d(n)&&!d(e).isChannelLoading?(f(),C(K,{key:1,class:"control-button",square:"",loading:t.isJoining,disable:d(i),onClick:o[2]||(o[2]=m=>a.$emit("joinChannel"))},{default:c(()=>[go,r(l,{text:"Join the channel"})]),_:1},8,["loading","disable"])):le("",!0)]),_:1})]),_:1})}}});const yo=R(fo,[["__scopeId","data-v-cc02cbfe"]]),bo={class:"chat-name"},_o={key:0,class:"message-count"},vo=N({__name:"MessengerChannel",props:{pubkey:{type:Object,required:!0},channel:{type:Object,required:!0},isActive:Boolean},emits:["select"],setup(t){const e=t,n=b(()=>e.channel.name.slice(0,2));return(i,s)=>(f(),C(ee,{"active-class":"bg-blue-grey-8 text-white",active:t.isActive},{default:c(()=>[r(G,{class:"chat-item cursor-pointer",onClick:s[0]||(s[0]=a=>i.$emit("select"))},{default:c(()=>[u("div",{class:"chat-badge",style:Dt(d(Ia)(`${t.pubkey}`))},[u("span",null,P(d(n)),1)],4),u("div",bo,P(t.channel.name),1),+t.channel.messageCount>0?(f(),D("div",_o,P(t.channel.messageCount),1)):le("",!0)]),_:1})]),_:1},8,["active"]))}});const wo=R(vo,[["__scopeId","data-v-51282948"]]),Co=15;function Mo(){const{createChannel:t}=U(),{isWalletConnected:e,ok:n,error:i}=xe(),s=ae({dialog:!1,name:"",maxMessages:Co,public:!1,permissionless:!1,loading:!1});async function a(){if(e())try{await t(s.name,{maxMessages:s.maxMessages,public:s.public,permissionless:s.permissionless}),o(),n("Channel was created!")}catch(l){i("Something went wrong"),console.log(l)}}function o(){s.dialog=!1,s.public=!1,s.loading=!1,s.name="",s.maxMessages=15}return{state:s,submit:a,reset:o}}function Ao(){const t=U(),{info:e,ok:n,error:i}=xe(),s=ae({loading:!1});async function a(){if(!t.state.channelAddr){e("Please select a channel");return}try{s.loading=!0,await t.deleteChannel(t.state.channelAddr),n("Channel was deleted!")}catch(o){console.log("Error",o),i("Something went wrong")}finally{s.loading=!1}}return{state:s,submit:a}}function Vt(){const{authorizeMember:t}=U(),{ok:e,error:n}=xe(),i=ae({loading:!1,dialog:!1});async function s(a){try{i.loading=!0,await t(a),e("Member was authorized")}catch(o){n("Something went wrong"),console.log(o)}finally{i.loading=!1}}return{state:i,submit:s}}function So(){const{state:t,addMember:e}=U(),{ok:n,info:i,error:s}=xe(),a=ae({dialog:!1,loading:!1});async function o(m){if(console.log(m),a.loading=!0,!t.channelAddr){i("Please select a channel");return}try{return await e(m.wallet,m.key,m.name),n("Member was added"),!0}catch(g){s("Something went wrong"),console.log(g)}finally{a.loading=!1,a.dialog=!1}return!1}function l(){a.loading=!1,a.dialog=!1}return{state:a,submit:o,reset:l}}function Rt(){const{deleteMember:t}=U(),{ok:e,error:n}=xe(),i=ae({loading:!1});async function s(a){try{i.loading=!0,await t(a),e("Member was deleted")}catch(o){n("Something went wrong"),console.log(o)}finally{i.loading=!1}}return{state:i,submit:s}}function ko(){const{state:t,joinChannel:e}=U(),{ok:n,info:i,error:s}=xe(),a=ae({dialog:!1,loading:!1,name:""});async function o(){if(!t.channelAddr){i("Please select a channel");return}a.loading=!0;try{await e(t.channelAddr,a.name),l(),n("Request was sent")}catch(m){console.log("Error",m),s("Something went wrong")}finally{a.loading=!1}}function l(){a.loading=!1,a.dialog=!1,a.name=""}return{state:a,submit:o,reset:l}}function xe(){const t=pe(),{notify:e}=Oe(),n=o=>e({type:"positive",message:o,timeout:2e3}),i=o=>e({type:"info",message:o,timeout:2e3}),s=o=>e({type:"negative",message:o,timeout:2e3});function a(){return t.publicKey.value?!0:(i("Please connect wallet"),!1)}return{ok:n,info:i,error:s,isWalletConnected:a}}const xo=u("div",{class:"text-h5"}," Channels ",-1),$o={class:"text-weight-medium"},Eo={class:"memberlist-info__details"},Do=u("span",null,"Authority:",-1),Po={class:"memberlist-info__details"},Ko=u("span",null,"Key:",-1),Io=N({__name:"PendingUsersDialog",props:{pendingChannels:Object},setup(t){V(!1);const{state:e,refreshList:n}=U(),i=Vt(),s=Rt(),a=async(g,_)=>{e.channelAddr=_,await i.submit(g),await n()},o=async(g,_)=>{e.channelAddr=_,await s.submit(g),await n()},l=b(()=>i.state.loading),m=b(()=>s.state.loading);return(g,_)=>(f(),C(re,null,{default:c(()=>[r(X,{class:"pending-channels",square:"",flat:"",horizontal:""},{default:c(()=>[r(L,null,{default:c(()=>[xo]),_:1}),r(L,null,{default:c(()=>[r(ve,{bordered:""},{default:c(()=>[(f(!0),D(q,null,oe(t.pendingChannels,(v,A)=>(f(),C(Sn,{key:v.name,"expand-separator":"",label:v.channel.data.name,caption:"channel","default-opened":A===0,"header-class":"bg-blue-grey-1"},{default:c(()=>[r(ve,{separator:""},{default:c(()=>[(f(!0),D(q,null,oe(v.pendingMembers,y=>(f(),C(ee,{key:y,class:"row justify-between pending-item"},{default:c(()=>[r(G,{class:"memberlist-info"},{default:c(()=>[r(Ke,{class:"row justify-between"},{default:c(()=>[u("span",$o,P(d(Pt)(y.data)),1)]),_:2},1024),r(Ke,{caption:"",lines:"2"},{default:c(()=>[u("div",Eo,[Do,u("span",null,P(y.data.authority),1)]),u("div",Po,[Ko,u("span",null,P(y.data.key),1)])]),_:2},1024)]),_:2},1024),r(G,{side:"",class:"memberlist-btns"},{default:c(()=>[r(K,{color:"teal",size:"xs",unelevated:"",class:"full-width",loading:d(l),disabled:d(l),onClick:w=>a(y.data.key,v.channel.pubkey)},{default:c(()=>[E(" Authorize ")]),_:2},1032,["loading","disabled","onClick"]),r(K,{color:"negative",size:"xs",unelevated:"",class:"full-width",loading:d(m),disabled:d(m),onClick:w=>o(y.data.key,v.channel.pubkey)},{default:c(()=>[E(" Delete ")]),_:2},1032,["loading","disabled","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["label","default-opened"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}});const zo={class:"bell",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",fill:"none","xmlns:v":"https://vecta.io/nano"},Bo=["fill"],To=N({__name:"iconBell",props:{color:{type:String,default:"AABEC8"}},setup(t){return(e,n)=>(f(),D("svg",zo,[u("path",{d:"M5.352 14.359h3.294c0 .821-.59 1.641-1.647 1.641s-1.647-.82-1.647-1.641zm8.434-3.467l-.911-1.515a3.68 3.68 0 0 1-.527-1.897V5.325C12.348 2.389 9.949 0 7 0S1.651 2.389 1.651 5.325v2.155a3.68 3.68 0 0 1-.527 1.897l-.911 1.515c-.278.461-.285 1.018-.018 1.487s.749.749 1.29.749h11.03a1.47 1.47 0 0 0 1.291-.749 1.46 1.46 0 0 0-.021-1.487z",fill:`#${t.color}`},null,8,Bo)]))}}),Ot=Ie("notifications",()=>{const t=Ue(),{loadMembers:e}=U(),n=ye(),i=ae({showInfo:!1,showDialog:!1,pendingChannels:[]});Ce(()=>n.ownChannels,async(a,o)=>{o.length>0&&await s(o)});async function s(a){try{const o=await Promise.all(a.map(async l=>{var _;const{pubkey:m,data:g}=l;if(g.creator.toBase58()===((_=t.value)==null?void 0:_.publicKey.toBase58())){const v=await e(m);if(v.length===0)return;const A=v.filter(y=>y.data.status.__kind==="Pending");return A.length?{channel:l,pendingMembers:A}:void 0}}));i.pendingChannels=o.filter(l=>l),i.pendingChannels.length>0?(setTimeout(()=>i.showInfo=!0,2e3),setTimeout(()=>i.showInfo=!1,7e3)):i.showDialog=!1}catch(o){console.log(o)}}return{state:i}});function No(){const{state:t}=Ot();return{showDialog:b(()=>t.showDialog),showInfo:b(()=>t.showInfo),pendingChannels:b(()=>t.pendingChannels)}}const Wo={class:"panel-notifications__info"},Lo=N({__name:"MessengerNotification",setup(t){const{pendingChannels:e,showInfo:n,showDialog:i}=No(),{state:s}=Ot(),a=b(()=>{var g,_;return(_=(g=e.value)==null?void 0:g.length)!=null?_:0}),o=b(()=>a.value>0),l=b(()=>n.value?"width: 100%; padding-right: 14px":"width: 0; padding-right: 0;"),m=()=>{!o.value||(s.showDialog=!s.showDialog)};return(g,_)=>{const v=To,A=Io;return f(),D("div",{class:gt(["panel-notifications",{"has-notifications":d(o)}]),onClick:m},[u("div",Wo,[r(v,{class:"ring",color:d(o)?"FF5C5C":"AABEC8"},null,8,["color"]),u("span",null,P(a.value),1)]),u("div",{ref:"notificationsInfo",class:"panel-notifications__details",style:Dt(d(l))}," channels are awaiting user confirmation ",4),r(A,{modelValue:d(s).showDialog,"onUpdate:modelValue":_[0]||(_[0]=y=>d(s).showDialog=y),"pending-channels":d(e),onCloseDialog:_[1]||(_[1]=y=>g.isShow.value=!1)},null,8,["modelValue","pending-channels"])],2)}}});const Vo={class:"panel-search"},Ro={class:"search-wrapper"},Oo={class:"panel-info"},Fo={class:"chat-info"},Uo={class:"chat-members"},jo={class:"chat-messages"},Qo={class:"chat-name"},qo=N({__name:"MessengerToolbar",emits:["search","showMembers","deleteChannel","addMember","showDeviceKey"],setup(t,{emit:e}){const n=pe(),{state:i}=U(),s=ye(),a=b(()=>!!n.publicKey.value),o=V(""),l=b(()=>i.channel),m=b(()=>{var y,w,S;return((y=l.value)==null?void 0:y.memberCount)===null||((w=l.value)==null?void 0:w.memberCount)===void 0?"":`${(S=l.value)==null?void 0:S.memberCount}\xA0members`}),g=b(()=>{var y,w,S;return((y=l.value)==null?void 0:y.messageCount)===null||((w=l.value)==null?void 0:w.messageCount)===void 0?"":`${(S=l.value)==null?void 0:S.messageCount}\xA0messages`}),_=y=>e("search",y),v=()=>e("showMembers"),A=()=>e("addMember");return Ce(o,y=>{_(String(y))}),(y,w)=>{const S=Lo;return f(),C(ht,{class:"panel-toolbar"},{default:c(()=>{var j;return[r(S),u("div",Vo,[u("div",Ro,[r(ne,{modelValue:o.value,"onUpdate:modelValue":w[0]||(w[0]=O=>o.value=O),class:"search-input no-margin q-pa-none",placeholder:"Search ...",clearable:"",debounce:"300",borderless:"",onClear:w[1]||(w[1]=O=>o.value="")},null,8,["modelValue"])])]),u("div",Oo,[u("div",Fo,[u("div",Uo,P(d(m)),1),u("div",jo,P(d(g)),1)]),r(pt,{class:""}),u("div",Qo,P((j=d(l))==null?void 0:j.name),1),u("div",null,[r(K,{class:"chat-menu",flat:"",unelevated:"",disable:!d(a)},{default:c(()=>[r(kn,{name:d(xn)},null,8,["name"]),r($n,{anchor:"bottom left",self:"top left"},{default:c(()=>[r(ve,{style:{"min-width":"150px"},bordered:""},{default:c(()=>[De((f(),C(ee,{clickable:"",onClick:w[2]||(w[2]=O=>y.$emit("showDeviceKey"))},{default:c(()=>[r(G,null,{default:c(()=>[E("Device key")]),_:1})]),_:1})),[[Pe]]),De((f(),C(ee,{clickable:"",disable:!d(l),onClick:v},{default:c(()=>[r(G,null,{default:c(()=>[E("Members")]),_:1})]),_:1},8,["disable"])),[[Pe]]),De((f(),C(ee,{clickable:"",disable:!d(s).canAddMember,onClick:A},{default:c(()=>[r(G,null,{default:c(()=>[E("Add member")]),_:1})]),_:1},8,["disable"])),[[Pe]]),De((f(),C(ee,{clickable:"",disable:!d(s).isChannelCreator,onClick:w[3]||(w[3]=O=>y.$emit("deleteChannel"))},{default:c(()=>[r(G,null,{default:c(()=>[E("Delete")]),_:1})]),_:1},8,["disable"])),[[Pe]])]),_:1})]),_:1})]),_:1},8,["disable"])])])]}),_:1})}}});const Jo={class:"col col-4"},Go={class:"col"},Ho={class:"no-margin"},Xo=N({__name:"DebugBtn",setup(t){const{state:e}=U(),{isAuthorizedMember:n,isPendingMember:i,isChannelCreator:s}=ye(),a=V(!1),o=En(a);return(l,m)=>(f(),D(q,null,[r(K,{flat:"",class:"text-blue-2",onClick:m[0]||(m[0]=g=>d(o)())},{default:c(()=>[E(" Debug info ")]),_:1}),r(re,{modelValue:a.value,"onUpdate:modelValue":m[1]||(m[1]=g=>a.value=g)},{default:c(()=>[r(X,null,{default:c(()=>[r(L,null,{default:c(()=>[(f(!0),D(q,null,oe([["Authorized",d(n)],["Pending Access",d(i)],["Channel Creator",d(s)],["Channel",d(e).channel],["Membership",d(e).channelMembership],["Members",d(e).channelMembers]],g=>(f(),D("div",{key:g[0],class:"row q-mt-md"},[u("div",Jo,P(g[0]),1),u("div",Go,[u("pre",Ho,P(g[1]),1)])]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),Zo={class:"messenger-wrapper"},Yo={class:"messenger-main"},el={key:1,class:"messenger-channels-empty"},tl={key:0,class:"q-my-md q-px-lg"},nl=N({__name:"Messenger",setup(t){const e=pe(),{state:n,postMessage:i,loadChannel:s,refreshList:a}=U(),o=ye(),l=Mo(),m=ko(),g=So(),_=Vt(),v=Rt(),A=Ao(),y=ae({message:""}),w=b(()=>n.allChannels),S=V([]),j=V("");async function O(I){await i(I.value),y.message=""}async function H(I){await s(I)}const Z=I=>{if(I===""){S.value=[],j.value="";return}S.value=w.value.filter(h=>h.data.name.toLocaleLowerCase().includes(I.toLocaleLowerCase())||h.pubkey.toBase58().toLocaleLowerCase().includes(I.toLocaleLowerCase())),j.value=I},k=b(()=>n.loading),T=V(!1),M=b(()=>S.value.length>0||j.value.length>0?S.value:o.ownChannels),F=I=>g.submit(I);return(I,h)=>{const x=qo,$=wo,Q=yo,Be=io,Te=qi,Ne=Oi,be=Wi,$e=zi,Ft=xs;return f(),D(q,null,[u("div",Zo,[r(x,{onSearch:Z,onShowMembers:h[0]||(h[0]=z=>d(_).state.dialog=!0),onDeleteChannel:h[1]||(h[1]=z=>d(A).submit(d(n).channelAddr)),onAddMember:h[2]||(h[2]=z=>d(g).state.dialog=!0),onShowDeviceKey:h[3]||(h[3]=z=>T.value=!0)}),u("div",Yo,[r(X,{class:"messenger-channels",square:""},{default:c(()=>[d(M).length>0?(f(),C(ve,{key:0,separator:"",class:"channels-list"},{default:c(()=>[(f(!0),D(q,null,oe(d(M),z=>(f(),C($,{key:z.name,pubkey:z.pubkey,channel:z.data,"is-active":`${d(n).channelAddr}`==`${z.pubkey}`,onSelect:kl=>H(z.pubkey)},null,8,["pubkey","channel","is-active","onSelect"]))),128))]),_:1})):(f(),D("div",el," No channels ")),r(Q,{"is-joining":d(m).state.loading,"is-loading":d(k),onCreateChannel:h[4]||(h[4]=z=>d(l).state.dialog=!0),onJoinChannel:h[5]||(h[5]=z=>d(m).state.dialog=!0),onRefreshList:d(a)},null,8,["is-joining","is-loading","onRefreshList"])]),_:1}),r(Be,{"post-message-state":y,onSendMessage:O},null,8,["post-message-state"]),r(qe,{showing:d(n).loading,color:"primary"},null,8,["showing"])])]),r(Te,{modelValue:d(l).state.dialog,"onUpdate:modelValue":h[6]||(h[6]=z=>d(l).state.dialog=z),loading:d(l).state.loading,"default-state":d(l).state,onSubmit:d(l).submit,onReset:d(l).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),r(Ne,{modelValue:d(g).state.dialog,"onUpdate:modelValue":h[7]||(h[7]=z=>d(g).state.dialog=z),loading:d(g).state.loading,"default-state":d(g).state,onSubmit:F,onReset:d(g).reset},null,8,["modelValue","loading","default-state","onReset"]),r(be,{modelValue:d(m).state.dialog,"onUpdate:modelValue":h[8]||(h[8]=z=>d(m).state.dialog=z),loading:d(m).state.loading,"default-state":d(m).state,onSubmit:d(m).submit,onReset:d(m).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),r($e,{modelValue:d(_).state.dialog,"onUpdate:modelValue":h[9]||(h[9]=z=>d(_).state.dialog=z),wallet:d(e),"authorize-member-state":d(_).state,"delete-member-state":d(v).state,onSubmit:d(_).submit,onDeleteMember:d(v).submit},null,8,["modelValue","wallet","authorize-member-state","delete-member-state","onSubmit","onDeleteMember"]),r(Ft,{modelValue:T.value,"onUpdate:modelValue":h[10]||(h[10]=z=>T.value=z)},null,8,["modelValue"]),d(n).channel?(f(),D("div",tl,[r(Xo)])):le("",!0)],64)}}});const al={},sl={class:"container"},il={class:"messenger-container"},ol={class:"container"};function ll(t,e){const n=nl,i=Cs;return f(),C(Dn,{class:"page-wrapper"},{default:c(()=>[u("div",sl,[u("div",il,[r(n)])]),u("div",ol,[r(i)])]),_:1})}const rl=R(al,[["render",ll],["__scopeId","data-v-8f1b09e0"]]),cl=()=>St(()=>import("./_...all_.53b8a975.js"),["assets/_...all_.53b8a975.js","assets/vendor.130d1de7.js","assets/_...all_.73169310.css"]),ul=[{name:"index",path:"/",component:rl,props:!0},{name:"all",path:"/:all(.*)*",component:cl,props:!0,meta:{layout:"empty"}}],dl=ms(ul),ml="/sol-messenger/",hl=Pn({history:Kn(ml),scrollBehavior:()=>({left:0,top:0}),strict:!0,routes:dl}),pl=({app:t})=>{t.use(hl)},gl=Object.freeze(Object.defineProperty({__proto__:null,install:pl},Symbol.toStringTag,{value:"Module"})),fl=({app:t})=>{t.use(In,{wallets:[new zn,new Bn,new Tn,new Nn,new Wn,new Ln,new Vn,new Rn,new On,new Fn,new Un,new jn,new Qn,new qn,new Jn,new Gn,new Hn,new Xn,new Zn,new Yn,new ea,new ta,new na,new aa,new sa,new ia,new oa,new la,new ra,new ca],autoConnect:!1})},yl=Object.freeze(Object.defineProperty({__proto__:null,install:fl},Symbol.toStringTag,{value:"Module"})),bl=ua();function _l(){return bl}const vl=Symbol("WALLET_CONNECT_EVENT"),wl=Symbol("WALLET_DISCONNECT_EVENT"),Cl=Symbol("ACCOUNT_CHANGE_EVENT"),ot=5e3;function Ml(){const{connection:t}=yt(),{emit:e}=_l(),{notify:n}=Oe(),{wallet:i}=pe();Ce(i,s=>{if(!s)return;const a=()=>{const m=s.adapter.publicKey;t.onAccountChange(m,g=>{e(Cl,g)}),t.onLogs(m,g=>{console.log(g)}),n({message:"Wallet update",caption:`Connected to wallet ${Je(m.toBase58(),7)}`,timeout:ot}),e(vl,s)},o=()=>{n({message:"Wallet update",caption:"Disconnected from wallet",timeout:ot}),e(wl,s)},l=m=>{!(m!=null&&m.message)||n({type:"negative",message:"Wallet update",caption:m.message,timeout:ot})};s.adapter.once("connect",a),s.adapter.once("disconnect",o),s.adapter.removeAllListeners("error"),s.adapter.on("error",l)},{immediate:!0})}const Al=N({__name:"App",setup(t){return da(()=>{Ml()}),(e,n)=>{const i=Fe("router-view");return f(),C(i)}}});async function Sl(){const t=ma(Al);Object.values(Object.assign({"./plugins/pinia.ts":pa,"./plugins/quasar.ts":fa,"./plugins/router.ts":gl,"./plugins/wallet.ts":yl})).forEach(e=>{var n;return(n=e.install)==null?void 0:n.call(e,{app:t})}),t.mount("#app")}Sl().then();export{R as _};
