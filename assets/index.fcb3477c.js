var Vt=Object.defineProperty;var Rt=(t,e,n)=>e in t?Vt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var N=(t,e,n)=>(Rt(t,typeof e!="symbol"?e+"":e,n),n);import{c as Ot,Q as Ft,P as Ut,D as jt,N as Qt,a as qt,i as Jt,u as Le,b as We,d as W,o as g,e as M,w as c,f as u,g as $,h as l,j as ot,k as m,l as Gt,r as R,m as y,n as I,p as me,q as Ht,s as Xt,S as Zt,t as D,v as B,x as _t,y as T,z as ee,A as U,B as ue,C as Yt,E as te,F as G,G as en,H as he,I as H,J as At,W as vt,K as Ae,L as Se,M as tn,O as Ve,R as nn,T as an,U as Re,V as _e,X as rt,Y as ie,Z as sn,_ as Oe,$ as ht,a0 as pt,a1 as on,a2 as rn,a3 as ln,a4 as St,a5 as Fe,a6 as cn,a7 as de,a8 as nt,a9 as $e,aa as De,ab as un,ac as kt,ad as dn,ae as mn,af as p,ag as Y,ah as xt,ai as oe,aj as re,ak as Pe,al as Et,am as ve,an as hn,ao as Ue,ap as $t,aq as lt,ar as pn,as as fn,at as gn,au as yn,av as bn,aw as ae,ax as le,ay as wt,az as we,aA as _n,aB as ft,aC as je,aD as gt,aE as ne,aF as Qe,aG as Ee,aH as vn,aI as Dt,aJ as wn,aK as Mn,aL as Cn,aM as An,aN as Sn,aO as kn,aP as xn,aQ as En,aR as $n,aS as Dn,aT as Pn,aU as Kn,aV as In,aW as Bn,aX as zn,aY as Tn,aZ as Wn,a_ as Nn,a$ as Ln,b0 as Vn,b1 as Rn,b2 as On,b3 as Fn,b4 as Un,b5 as jn,b6 as Qn,b7 as qn,b8 as Jn,b9 as Gn,ba as Hn,bb as Xn,bc as Zn,bd as Yn,be as ea,bf as ta,bg as na,bh as aa,bi as sa,bj as ia,bk as oa,bl as ra}from"./vendor.50fd2400.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();const la=({app:t})=>{const e=Ot();t.use(e)},ca=Object.freeze(Object.defineProperty({__proto__:null,install:la},Symbol.toStringTag,{value:"Module"})),ua=({app:t})=>{t.use(Ft,{plugins:{Dark:Ut,Dialog:jt,Notify:Qt,LocalStorage:qt},iconSet:Jt})},da=Object.freeze(Object.defineProperty({__proto__:null,install:ua},Symbol.toStringTag,{value:"Module"}));function ma(){const{dark:t}=Le(),e=We("theme-mode",t.isActive);return t.set(e.value),{isActive:e,set(n){t.set(n),e.value=t.isActive},toggle(){t.toggle(),e.value=t.isActive}}}const ha={class:"container"},pa={class:"row"},fa=u("div",{class:"col-12 col-md-6"},[u("div",{class:"footer-links"},[u("ul",null,[u("li",null,[u("a",{target:"_blank",href:"https://jpool.one"},"JPOOL")]),u("li",null,[u("a",{target:"_blank",href:"https://heartandsol.one"},"GAME")]),u("li",null,[u("a",{href:"https://magiceden.io/marketplace/heartandsol"},"NFT Marketplace")])])]),u("div",{class:"copyright"},[u("span",null,"\xA9 Copyright 2022 jpool.one. All rights reserved. Powered by mFactory GmbH")])],-1),ga={class:"col-12 col-md-6 social-col"},ya={class:"social"},ba={class:"theme"},_a=u("div",{class:"social-link social-link-text"},[u("span",null,[$("official"),u("br"),$("channel")])],-1),va=u("div",{class:"social-link telegram"},null,-1),wa=u("div",{class:"social-link twitter"},null,-1),Ma=u("div",{class:"social-link discord"},null,-1),Ca=W({__name:"AppFooter",setup(t){const e=ma();return(n,o)=>(g(),M(Gt,null,{default:c(()=>[u("div",ha,[u("div",pa,[fa,u("div",ga,[u("div",ya,[u("div",ba,[$(" Dark theme "),l(ot,{"model-value":m(e).isActive.value,onClick:m(e).toggle},null,8,["model-value","onClick"])]),_a,va,wa,Ma])])])])]),_:1}))}});function Aa(){const t=R(Sa());return{userAgent:t,isMobileOs:y(()=>ka(t.value)),isWebView:y(()=>xa(t.value))}}let at;function Sa(){var t,e;return at===void 0&&(at=(e=(t=globalThis.navigator)==null?void 0:t.userAgent)!=null?e:null),at}function ka(t){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)}function xa(t){return/(WebView|(Phantom|Solflare)|Version\/.+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+)|; wv\).+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+))/i.test(t)}function qe(t,e=4){return t instanceof I&&(t=t.toBase58()),`${t.slice(0,e)}...${t.slice(-e)}`}const Ea=t=>{if(!t)return{background:"#000"};let e=0;for(let o=0;o<t.length;o++)e=t.charCodeAt(o)+((e<<5)-e),e=e&e;let n="#";for(let o=0;o<3;o++)n+=`00${(e>>o*8&255).toString(16)}`.substr(-2);return{background:n}},$a="/sol-messenger/assets/clover.968404b0.svg",Da="/sol-messenger/assets/ledger.40cf6861.svg",Pa="/sol-messenger/assets/mathwallet.1d763e81.svg",Pt=t=>(Ae("data-v-b79b08f0"),t=t(),Se(),t),Ka=Pt(()=>u("div",{class:"text-h6 text-center"}," Your wallet ",-1)),Ia={class:"q-gutter-md row justify-between"},Ba=Pt(()=>u("div",{class:"text-h6"}," Connect to a wallet ",-1)),za={class:"text-light-gray text-caption full-width text-no-wrap",style:{"text-overflow":"ellipsis",overflow:"hidden"}},Ta=["src","alt"],Wa=W({__name:"ConnectWallet",setup(t){const e={priority:{solflare:10,phantom:20,sollet:5,nufi:5,blocto:1},icons:{clover:$a},darkIcons:{ledger:Da,mathwallet:Pa},deepLinks:{phantom:"https://phantom.app/ul/browse/{uri}?ref={ref}",solflare:"https://solflare.com/ul/browse/{uri}?ref={ref}"}},{userAgent:n,isWebView:o,isMobileOs:i}=Aa(),a={close:At},s=k=>[vt.Installed,vt.Loadable].includes(k.readyState);Le();const r=me(),{connected:d,connecting:f}=r;Ht();const v=y(()=>i.value&&!o.value);if(o.value){const k=String(n.value).toLowerCase();k.includes("phantom")?(r.select(Xt),r.connect()):k.includes("solflare")&&(r.select(Zt),r.connect())}const w=y(()=>{var k,z;return(z=(k=r.publicKey.value)==null?void 0:k.toBase58())!=null?z:""}),S=y(()=>qe(w.value)),b=y(()=>[...r.wallets.value].map(k=>{var C,F;const z=k.adapter.name.toLowerCase();return k.adapter.icon=(F=(C=e.darkIcons[z])!=null?C:e.icons[z])!=null?F:k.adapter.icon,v.value&&e.deepLinks[z]&&(k.deepLink=e.deepLinks[z].replace("{uri}",location.href).replace("{ref}",location.origin)),k}).sort((k,z)=>{var P,h;const C=(P=e.priority[k.adapter.name.toLowerCase()])!=null?P:1;return((h=e.priority[z.adapter.name.toLowerCase()])!=null?h:1)-C+((s(z)?1:0)-(s(k)?1:0))})),_=y(()=>v.value?b.value.filter(k=>!!k.deepLink):b.value),A=R(!1);async function L(k){await r.select(k.adapter.name),A.value=!1,await r.connect()}function V(){A.value=!1,r.disconnect()}function J(){A.value=!0}function X(){A.value=!1}return(k,z)=>(g(),D(H,null,[m(d)?(g(),M(T,_t({key:0},k.$attrs,{class:k.$style.btn,ripple:!1,color:"primary-gray","text-color":"white",rounded:"",unelevated:"",onClick:J}),{default:c(()=>[$(B(m(S)),1)]),_:1},16,["class"])):(g(),M(T,_t({key:1},k.$attrs,{color:"primary-gray","text-color":"white",rounded:"",unelevated:"",ripple:!1,loading:m(f),onClick:J}),{default:c(()=>[$(" CONNECT WALLET ")]),_:1},16,["loading"])),l(he,{modelValue:A.value,"onUpdate:modelValue":z[0]||(z[0]=C=>A.value=C),"transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:c(()=>[m(d)?(g(),M(ee,{key:0},{default:c(()=>[l(U,{class:"relative-position"},{default:c(()=>[Ka,l(T,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:X},null,8,["icon"])]),_:1}),l(ue),l(U,null,{default:c(()=>[$(B(m(w)),1)]),_:1}),l(ue),l(U,null,{default:c(()=>[u("div",Ia,[l(T,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:V},{default:c(()=>[$(" Disconnect ")]),_:1}),l(T,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:X},{default:c(()=>[$(" Ok ")]),_:1})])]),_:1})]),_:1})):(g(),M(ee,{key:1,class:"wallet-connect-card"},{default:c(()=>[l(U,null,{default:c(()=>[Ba,l(T,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:X},null,8,["icon"])]),_:1}),l(ue),l(U,{style:{"max-height":"80vh"},class:"scroll"},{default:c(()=>[l(Yt,{grid:"",rows:m(_),"row-key":"name","hide-pagination":"","hide-header":"","rows-per-page-options":[100]},{item:c(({row:C})=>[(g(),D("div",{key:`wallet-${C.adapter.name}`,class:"col-12 col-md-6"},[l(te,{clickable:"",href:C.deepLink,onClick:F=>C.deepLink?!0:L(C)},{default:c(()=>[l(G,null,{default:c(()=>[u("b",null,B(C.adapter.name),1),u("div",za,B(C.adapter.url),1)]),_:2},1024),l(G,{avatar:""},{default:c(()=>[l(en,{square:""},{default:c(()=>[u("img",{src:C.adapter.icon,alt:C.adapter.name},null,8,Ta)]),_:2},1024)]),_:2},1024)]),_:2},1032,["href","onClick"])]))]),_:1},8,["rows"])]),_:1})]),_:1}))]),_:1},8,["modelValue"])],64))}});const Na="_btn_6n1iw_1",La={btn:Na},O=(t,e)=>{const n=t.__vccOpts||t;for(const[o,i]of e)n[o]=i;return n},Va={$style:La},Ra=O(Wa,[["__cssModules",Va],["__scopeId","data-v-b79b08f0"]]),Me=[{id:"serum-mainnet",name:"Serum RPC",cluster:"mainnet-beta",url:"https://solana-api.projectserum.com/"},{id:"rpcpool-mainnet",name:"RPCPool RPC",cluster:"mainnet-beta",url:"https://mainnet.rpcpool.com/"},{id:"mainnet",name:"Solana RPC",cluster:"mainnet-beta",url:tn("mainnet-beta")}],Kt={id:"devnet",name:"DevNet",cluster:"devnet",url:"https://devnet.rpcpool.com/"};Me.push(Kt);const Oa={id:"testnet",name:"TestNet",cluster:"testnet",url:"https://testnet.rpcpool.com/"};Me.push(Oa);var Ct;const Fa=(Ct=Me.find(t=>t.id==={VITE_BASE_PATH:"/sol-messenger/",VITE_USER_NODE_ENV:"production",BASE_URL:"/sol-messenger/",MODE:"staging",DEV:!1,PROD:!0}.VITE_CONNECTION_ENDPOINT))!=null?Ct:Kt,Ua="confirmed",ja=12e4,yt=Ve({id:"connection",state:()=>({commitment:Ua,confirmTransactionInitialTimeout:ja,rpc:nn("rpc","")}),getters:{endpoint(t){var e;return(e=Me.find(n=>n.id===t.rpc))!=null?e:Fa},connection(t){return console.log("[connection]",this.endpoint.url),new an(this.endpoint.url,{confirmTransactionInitialTimeout:t.confirmTransactionInitialTimeout,commitment:t.commitment})},cluster(){return this.endpoint.cluster}},actions:{setRpc(t){this.rpc=t},setCommitment(t){this.commitment=t}}}),Qa=W({__name:"ClusterSelector",setup(t){const e=yt(),{connected:n,connect:o,disconnect:i,autoConnect:a}=me(),s=[Me.filter(f=>f.cluster==="mainnet-beta"),Me.filter(f=>f.cluster!=="mainnet-beta")],r=y(()=>e.endpoint),d=f=>{n&&e.cluster!==f.cluster&&(i(),a.value&&o()),e.setRpc(f.id)};return(f,v)=>(g(),M(sn,{label:m(r).name,"model-value":!1,"auto-close":"",color:"secondary","text-color":"#000",rounded:"",unelevated:"",ripple:!1},{default:c(()=>[l(Re,null,{default:c(()=>[(g(),D(H,null,_e(s,(w,S)=>(g(),D(H,{key:`${S}-cluster-group`},[(g(!0),D(H,null,_e(w,b=>(g(),M(te,{key:b.id,clickable:"",onClick:_=>d(b)},{default:c(()=>[(g(),M(G,{key:`${b.id}-item`},{default:c(()=>[l(rt,null,{default:c(()=>[u("b",null,B(b.name),1)]),_:2},1024),$(" "+B(b.url),1)]),_:2},1024))]),_:2},1032,["onClick"]))),128)),S!==s.length-1?(g(),M(ue,{key:0})):ie("",!0)],64))),64))]),_:1})]),_:1},8,["label"]))}});const qa={},Ja={class:"container"},Ga={class:"app-header__info"},Ha={class:"app-header__logo"},Xa={class:"logo-wrapper"},Za=u("div",{class:"app-header__title"},[u("h1",null,[$("BLOCKCHAIN messenger "),u("span",{class:"marked"},"SOLANA")])],-1),Ya={class:"app-header__right"},es={class:"app-header__buttons"};function ts(t,e){const n=Oe("router-link"),o=Qa,i=Ra;return g(),M(on,{class:"app-header"},{default:c(()=>[u("div",Ja,[l(ht,null,{default:c(()=>[u("div",Ga,[u("div",Ha,[u("div",Xa,[l(n,{to:"/"})])]),Za]),l(pt),u("div",Ya,[u("div",es,[l(o,{class:"app-header__cluster-btn header-btn"}),l(i,{class:"app-header__wallet-btn header-btn"})])])]),_:1})])]),_:1})}const ns=O(qa,[["render",ts]]),as={};function ss(t,e){const n=ns,o=Oe("router-view"),i=Ca;return g(),M(rn,{view:"lfh Lpr lff"},{default:c(()=>[l(n),l(ln,null,{default:c(()=>[l(o)]),_:1}),l(i)]),_:1})}const is=O(as,[["render",ss]]),os={default:is,empty:()=>St(()=>import("./empty.f28ce111.js"),["assets/empty.f28ce111.js","assets/vendor.50fd2400.js"])};function rs(t){return t.map(e=>{var n;return{path:e.path,component:os[((n=e.meta)==null?void 0:n.layout)||"default"],children:[{...e,path:""}]}})}const ls="/sol-messenger/assets/solana-logo.3caace62.svg";const cs={},Je=t=>(Ae("data-v-5ffd3a8e"),t=t(),Se(),t),us={class:"row info-row"},ds=Je(()=>u("div",{class:"offset-0 offset-md-3"},null,-1)),ms=Je(()=>u("div",{class:"col-6 col-md-3 flex-center info-col"},[u("div",{class:"info-title"}," How IT WORKS "),u("div",{class:"info-text"},[u("ul",null,[u("li",null,"Connect your wallet"),u("li",null,"Enter the amount of JPLT you want to swap or enter the amount of JPLU you want to get"),u("li",null,"Click SWAP button"),u("li",null,"Confirm the transaction in your wallet"),u("li",null,"Done")])])],-1)),hs={class:"col-6 col-md-5 logo-wrap"},ps=Je(()=>u("img",{src:ls,alt:"solana logo"},null,-1)),fs=Je(()=>u("div",{class:"offset-0 offset-md-1"},null,-1));function gs(t,e){const n=Oe("router-link");return g(),D("div",us,[ds,ms,u("div",hs,[l(n,{to:"/"},{default:c(()=>[ps]),_:1})]),fs])}const ys=O(cs,[["render",gs],["__scopeId","data-v-5ffd3a8e"]]),It=Ve("user",()=>{const t=Fe(),e=R();cn(()=>{var s;const a=(s=t.value)==null?void 0:s.publicKey;if(a){const r=We(a.toString(),()=>nt.encode(de.generate().secretKey));n(r.value)}else e.value=void 0});function n(a){e.value=de.fromSecretKey(nt.decode(a))}function o(){var r;const a=(r=t.value)==null?void 0:r.publicKey;if(!a)return;const s=We(a.toString(),"");n(s.value=nt.encode(de.generate().secretKey))}function i(a){var d;const s=(d=t.value)==null?void 0:d.publicKey;if(!s)return;const r=We(s.toString(),"");n(r.value=a)}return{keypair:e,generateKey:o,importKey:i}}),bs=t=>(Ae("data-v-4f30d8b8"),t=t(),Se(),t),_s=bs(()=>u("div",{class:"text-h6 text-center"}," Device Key ",-1)),vs={class:"q-gutter-md row justify-between"},ws=W({__name:"UserInfoDialog",emits:["regenerate"],setup(t){const e=It(),n=()=>{var o,i;mn(((i=(o=e.keypair)==null?void 0:o.publicKey)!=null?i:"").toString())};return(o,i)=>(g(),M(he,{class:"dialog-wrapper","transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:c(()=>[l(ee,null,{default:c(()=>[l(U,{class:"row items-center"},{default:c(()=>[_s,l(pt),$e(l(T,{flat:"",round:"",dense:"",icon:m(At)},null,8,["icon"]),[[De]])]),_:1}),l(ue),l(U,null,{default:c(()=>{var a;return[l(T,{flat:"",round:"",dense:"",icon:m(un),onClick:n},{default:c(()=>[l(kt,{delay:0,anchor:"bottom middle",self:"top middle","transition-duration":"0"},{default:c(()=>[$(" Copy to clipboard ")]),_:1})]),_:1},8,["icon"]),u("span",null,B((a=m(e).keypair)==null?void 0:a.publicKey),1)]}),_:1}),l(ue),l(dn,{align:"right"},{default:c(()=>[u("div",vs,[l(T,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:m(e).generateKey},{default:c(()=>[$(" Regenerate ")]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1}))}});const Ms=O(ws,[["__scopeId","data-v-4f30d8b8"]]),Cs="0.0.8",As="messenger",Ss=[{name:"initChannel",accounts:[{name:"channel",isMut:!0,isSigner:!0},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"InitChannelData"}}]},{name:"deleteChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"joinChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"JoinChannelData"}}]},{name:"leaveChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"grantAccessMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"GrantAccessMemberData"}}]},{name:"addMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"invitee",isMut:!1,isSigner:!1},{name:"inviteeMembership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AddMemberData"}}]},{name:"authorizeMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AuthorizeMemberData"}}]},{name:"deleteMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"postMessage",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!1,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"message",type:"string"}]}],ks=[{name:"Channel",type:{kind:"struct",fields:[{name:"name",docs:["Name of the channel"],type:"string"},{name:"creator",docs:["Channel creator"],type:"publicKey"},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"flags",docs:["Channel flags"],type:"u8"},{name:"memberCount",docs:["Number of members"],type:"u16"},{name:"messageCount",docs:["Message counter"],type:"u32"},{name:"maxMessages",docs:["The maximum number of messages that are stored in [messages]"],type:"u16"},{name:"messages",docs:["List of messages"],type:{vec:{defined:"Message"}}}]}},{name:"ChannelMembership",type:{kind:"struct",fields:[{name:"channel",docs:["Associated [Channel] address"],type:"publicKey"},{name:"authority",docs:["Authority of membership"],type:"publicKey"},{name:"key",docs:["The device key used to encrypt the `CEK`"],type:"publicKey"},{name:"cek",docs:["The content encryption key (CEK) of the channel"],type:{defined:"CEKData"}},{name:"status",docs:["Status of membership"],type:{defined:"ChannelMembershipStatus"}},{name:"name",docs:["Name of the channel member"],type:"string"},{name:"invitedBy",docs:["Inviter address"],type:{option:"publicKey"}},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"flags",docs:["Membership flags"],type:"u8"},{name:"bump",docs:["Bump seed for deriving PDA seeds"],type:"u8"}]}}],xs=[{name:"AddMemberData",type:{kind:"struct",fields:[{name:"name",docs:["Member name"],type:"string"},{name:"flags",docs:["Membership flags, only `admin` and `owner` can set membership flags"],type:"u8"},{name:"cek",docs:["Content Encryption Key"],type:{defined:"CEKData"}},{name:"key",docs:["Device key"],type:{option:"publicKey"}}]}},{name:"AuthorizeMemberData",type:{kind:"struct",fields:[{name:"cek",type:{defined:"CEKData"}}]}},{name:"GrantAccessMemberData",type:{kind:"struct",fields:[{name:"flags",type:"u8"}]}},{name:"InitChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"maxMessages",type:"u16"},{name:"memberName",type:"string"},{name:"cek",type:{defined:"CEKData"}},{name:"public",type:"bool"},{name:"permissionless",type:"bool"}]}},{name:"JoinChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"authority",type:{option:"publicKey"}}]}},{name:"CEKData",type:{kind:"struct",fields:[{name:"header",docs:["The header information for the CEK"],type:"string"},{name:"encryptedKey",docs:["The CEK itself"],type:"string"}]}},{name:"Message",type:{kind:"struct",fields:[{name:"id",docs:["Uniq message id"],type:"u32"},{name:"sender",docs:["The message sender id"],type:"publicKey"},{name:"createdAt",docs:["The unix timestamp at which the message was received"],type:"i64"},{name:"flags",docs:["Message flags"],type:"u8"},{name:"content",docs:["The (typically encrypted) message content"],type:"string"}]}},{name:"ChannelMembershipStatus",type:{kind:"enum",variants:[{name:"Authorized",fields:[{name:"by",type:{option:"publicKey"}}]},{name:"Pending",fields:[{name:"authority",type:{option:"publicKey"}}]}]}}],Es=[{name:"NewChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"NewMessageEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"message",type:{defined:"Message"},index:!1}]},{name:"JoinChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"LeaveChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"authority",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AddMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"AuthorizeMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]}],$s=[{code:6e3,name:"Unauthorized",msg:"Unauthorized"},{code:6001,name:"InvalidChannel",msg:"Invalid channel"},{code:6002,name:"InvalidMembership",msg:"Invalid membership"},{code:6003,name:"InvalidMessage",msg:"Invalid message"},{code:6004,name:"NameTooLong",msg:"Name too long"},{code:6005,name:"MessageTooLong",msg:"Message too long"}],Ds={address:"6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",origin:"anchor",binaryVersion:"0.25.0",libVersion:"0.25.0"},Ps={version:Cs,name:As,instructions:Ss,accounts:ks,types:xs,events:Es,errors:$s,metadata:Ds},Ks=new p.FixableBeetArgsStruct([["id",p.u32],["sender",Y],["createdAt",p.i64],["flags",p.u8],["content",p.utf8String]],"Message"),ct=[49,159,99,106,220,87,219,88];class Z{constructor(e,n,o,i,a,s,r,d){this.name=e,this.creator=n,this.createdAt=o,this.flags=i,this.memberCount=a,this.messageCount=s,this.maxMessages=r,this.messages=d}static fromArgs(e){return new Z(e.name,e.creator,e.createdAt,e.flags,e.memberCount,e.messageCount,e.maxMessages,e.messages)}static fromAccountInfo(e,n=0){return Z.deserialize(e.data,n)}static async fromAccountAddress(e,n,o){const i=await e.getAccountInfo(n,o);if(i==null)throw new Error(`Unable to find Channel account at ${n}`);return Z.fromAccountInfo(i,0)[0]}static gpaBuilder(e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return xt.fromStruct(e,ze)}static deserialize(e,n=0){return ze.deserialize(e,n)}serialize(){return ze.serialize({accountDiscriminator:ct,...this})}static byteSize(e){const n=Z.fromArgs(e);return ze.toFixedFromValue({accountDiscriminator:ct,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,o){return n.getMinimumBalanceForRentExemption(Z.byteSize(e),o)}pretty(){return{name:this.name,creator:this.creator.toBase58(),createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,memberCount:this.memberCount,messageCount:this.messageCount,maxMessages:this.maxMessages,messages:this.messages}}}const ze=new p.FixableBeetStruct([["accountDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["name",p.utf8String],["creator",Y],["createdAt",p.i64],["flags",p.u8],["memberCount",p.u16],["messageCount",p.u32],["maxMessages",p.u16],["messages",p.array(Ks)]],Z.fromArgs,"Channel"),Ge=new p.FixableBeetArgsStruct([["header",p.utf8String],["encryptedKey",p.utf8String]],"CEKData"),Is=p.dataEnum([["Authorized",new p.FixableBeetArgsStruct([["by",p.coption(Y)]],'ChannelMembershipStatusRecord["Authorized"]')],["Pending",new p.FixableBeetArgsStruct([["authority",p.coption(Y)]],'ChannelMembershipStatusRecord["Pending"]')]]),Ne=[238,149,255,251,116,131,86,170];class q{constructor(e,n,o,i,a,s,r,d,f,v){this.channel=e,this.authority=n,this.key=o,this.cek=i,this.status=a,this.name=s,this.invitedBy=r,this.createdAt=d,this.flags=f,this.bump=v}static fromArgs(e){return new q(e.channel,e.authority,e.key,e.cek,e.status,e.name,e.invitedBy,e.createdAt,e.flags,e.bump)}static fromAccountInfo(e,n=0){return q.deserialize(e.data,n)}static async fromAccountAddress(e,n,o){const i=await e.getAccountInfo(n,o);if(i==null)throw new Error(`Unable to find ChannelMembership account at ${n}`);return q.fromAccountInfo(i,0)[0]}static gpaBuilder(e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return xt.fromStruct(e,Te)}static deserialize(e,n=0){return Te.deserialize(e,n)}serialize(){return Te.serialize({accountDiscriminator:Ne,...this})}static byteSize(e){const n=q.fromArgs(e);return Te.toFixedFromValue({accountDiscriminator:Ne,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,o){return n.getMinimumBalanceForRentExemption(q.byteSize(e),o)}pretty(){return{channel:this.channel.toBase58(),authority:this.authority.toBase58(),key:this.key.toBase58(),cek:this.cek,status:this.status.__kind,name:this.name,invitedBy:this.invitedBy,createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,bump:this.bump}}}const Te=new p.FixableBeetStruct([["accountDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["channel",Y],["authority",Y],["key",Y],["cek",Ge],["status",Is],["name",p.utf8String],["invitedBy",p.coption(Y)],["createdAt",p.i64],["flags",p.u8],["bump",p.u8]],q.fromArgs,"ChannelMembership"),pe=new Map,fe=new Map;class He extends Error{constructor(){super("Unauthorized");N(this,"code",6e3);N(this,"name","Unauthorized");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,He)}}pe.set(6e3,()=>new He);fe.set("Unauthorized",()=>new He);class Xe extends Error{constructor(){super("Invalid channel");N(this,"code",6001);N(this,"name","InvalidChannel");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Xe)}}pe.set(6001,()=>new Xe);fe.set("InvalidChannel",()=>new Xe);class Ze extends Error{constructor(){super("Invalid membership");N(this,"code",6002);N(this,"name","InvalidMembership");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ze)}}pe.set(6002,()=>new Ze);fe.set("InvalidMembership",()=>new Ze);class Ye extends Error{constructor(){super("Invalid message");N(this,"code",6003);N(this,"name","InvalidMessage");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ye)}}pe.set(6003,()=>new Ye);fe.set("InvalidMessage",()=>new Ye);class et extends Error{constructor(){super("Name too long");N(this,"code",6004);N(this,"name","NameTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,et)}}pe.set(6004,()=>new et);fe.set("NameTooLong",()=>new et);class tt extends Error{constructor(){super("Message too long");N(this,"code",6005);N(this,"name","MessageTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,tt)}}pe.set(6005,()=>new tt);fe.set("MessageTooLong",()=>new tt);function se(t){const e=pe.get(t);return e!=null?e():null}function be(t){const e=fe.get(t);return e!=null?e():null}const Bs=new p.FixableBeetArgsStruct([["name",p.utf8String],["flags",p.u8],["cek",Ge],["key",p.coption(Y)]],"AddMemberData"),zs=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",Bs]],"AddMemberInstructionArgs"),Ts=[13,116,123,130,126,198,57,34];function Ws(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var s;const[o]=zs.serialize({instructionDiscriminator:Ts,...e}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.invitee,isWritable:!1,isSigner:!1},{pubkey:t.inviteeMembership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(s=t.systemProgram)!=null?s:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new re({programId:n,keys:i,data:o})}const Ns=new p.FixableBeetArgsStruct([["cek",Ge]],"AuthorizeMemberData"),Ls=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",Ns]],"AuthorizeMemberInstructionArgs"),Vs=[194,123,189,175,86,225,93,128];function Rs(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var s;const[o]=Ls.serialize({instructionDiscriminator:Vs,...e}),i=[{pubkey:t.channel,isWritable:!1,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:(s=t.systemProgram)!=null?s:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new re({programId:n,keys:i,data:o})}const Os=new p.BeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)]],"DeleteChannelInstructionArgs"),Fs=[145,225,187,221,157,142,114,133];function Us(t,e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=Os.serialize({instructionDiscriminator:Fs}),o=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const s of t.anchorRemainingAccounts)o.push(s);return new re({programId:e,keys:o,data:n})}const js=new p.BeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)]],"DeleteMemberInstructionArgs"),Qs=[95,14,98,112,252,218,205,173];function qs(t,e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=js.serialize({instructionDiscriminator:Qs}),o=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const s of t.anchorRemainingAccounts)o.push(s);return new re({programId:e,keys:o,data:n})}const Js=new p.BeetArgsStruct([["flags",p.u8]],"GrantAccessMemberData");new p.BeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",Js]],"GrantAccessMemberInstructionArgs");const Gs=new p.FixableBeetArgsStruct([["name",p.utf8String],["maxMessages",p.u16],["memberName",p.utf8String],["cek",Ge],["public",p.bool],["permissionless",p.bool]],"InitChannelData"),Hs=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",Gs]],"InitChannelInstructionArgs"),Xs=[21,200,152,39,19,178,76,47];function Zs(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var s;const[o]=Hs.serialize({instructionDiscriminator:Xs,...e}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!0},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(s=t.systemProgram)!=null?s:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new re({programId:n,keys:i,data:o})}const Ys=new p.FixableBeetArgsStruct([["name",p.utf8String],["authority",p.coption(Y)]],"JoinChannelData"),ei=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["data",Ys]],"JoinChannelInstructionArgs"),ti=[124,39,115,89,217,26,38,29];function ni(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var s;const[o]=ei.serialize({instructionDiscriminator:ti,...e}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(s=t.systemProgram)!=null?s:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new re({programId:n,keys:i,data:o})}const ai=new p.BeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)]],"LeaveChannelInstructionArgs"),si=[104,0,75,134,95,80,68,186];function ii(t,e=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=ai.serialize({instructionDiscriminator:si}),o=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const s of t.anchorRemainingAccounts)o.push(s);return new re({programId:e,keys:o,data:n})}const oi=new p.FixableBeetArgsStruct([["instructionDiscriminator",p.uniformFixedSizeArray(p.u8,8)],["message",p.utf8String]],"PostMessageInstructionArgs"),ri=[214,50,100,209,38,34,7,76];function li(t,e,n=new I("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var s;const[o]=oi.serialize({instructionDiscriminator:ri,...e}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:(s=t.systemProgram)!=null?s:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new re({programId:n,keys:i,data:o})}const ci="6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",ui=new I(ci);function ut(t,e=new Uint8Array(4)){const n=Pe(t.toString(),"base10");return e.set(n,4-n.length),e}const st=t=>ve([ut(t.length),t]);function Bt(t,e,n){if(e!==256)throw new Error(`Unsupported key length: ${e}`);const o=ve([st(Pe(n)),st(new Uint8Array(0)),st(new Uint8Array(0)),ut(e)]),i=1;return hn.hash(ve([ut(i),t,o]))}const dt=t=>Pe(t,"base64pad"),mt=t=>Et(t,"base64pad"),di=t=>Pe(t),mi=t=>Et(t),hi=t=>Pe(t,"base58btc"),ce=Ue.NONCE_LENGTH,Ce=Ue.TAG_LENGTH,zt=t=>{const e=new Ue.XChaCha20Poly1305(t);return(n,o)=>{const i=$t.randomBytes(ce),a=e.seal(i,n,o);return{ciphertext:a.subarray(0,a.length-Ce),tag:a.subarray(a.length-Ce),iv:i}}},Tt=t=>{const e=new Ue.XChaCha20Poly1305(t);return(n,o,i,a)=>e.open(i,ve([n,o]),a)},Wt="ECDH-ES+XC20PKW",Nt=256,pi=t=>e=>{const n=lt.generateKeyPair(),o=lt.sharedKey(n.secretKey,t),i=Bt(o,Nt,Wt),a=zt(i)(e);return{encryptedKey:a.ciphertext,tag:a.tag,iv:a.iv,epPubKey:n.publicKey}},fi=t=>(e,n,o,i)=>{const a=lt.sharedKey(t,i),s=Bt(a,Nt,Wt);return Tt(s)(e,n,o)},gi=t=>Array.isArray(t)?de.fromSecretKey(gn.Buffer.from(t)):typeof t=="string"?de.fromSecretKey(hi(t)):de.fromSecretKey(t),yi=async(t=32)=>{const e=$t.randomBytes(t);return Promise.resolve(e)},bi=async(t,e)=>{const n=await pi(pn(e.toBytes()))(t);return{header:mt(ve([n.iv,n.tag,n.epPubKey])),encryptedKey:mt(n.encryptedKey)}},_i=async(t,e)=>{const n=dt(t.header),o=n.subarray(0,ce),i=n.subarray(ce,ce+Ce),a=n.subarray(ce+Ce),s=dt(t.encryptedKey),r=gi(e).secretKey,d=fn(r),f=await fi(d)(s,i,o,a);if(f===null)throw new Error("There was a problem decrypting the CEK");return f},vi=async(t,e)=>{const n=await zt(e)(di(t));return mt(ve([n.iv,n.ciphertext,n.tag]))},wi=async(t,e)=>{const n=dt(t),o=n.subarray(0,ce),i=n.subarray(ce,-Ce),a=n.subarray(-Ce),s=await Tt(e)(i,a,o);if(s===null)throw new Error("There was an error decoding the message!");return mi(s)};class Mi{constructor(e,n){N(this,"programId",ui);N(this,"_coder");N(this,"_events");N(this,"utils",{channel:{isPublic:e=>(e.flags&1)>0,isPermissionless:e=>(e.flags&2)>0},member:{isOwner:e=>e.flags>=255,isAdmin:e=>(e.flags&7)===7,canAddMember:e=>(e.flags&1)>0,canDeleteMember:e=>(e.flags&2)>0,canAuthorizeMember:e=>(e.flags&4)>0},message:{isEncrypted:e=>(e.flags&1)>0}});this.provider=e,this.keypair=n,this._coder=new yn(Ps),this._events=new bn(this.programId,e,this._coder)}get connection(){return this.provider.connection}addEventListener(e,n){return this._events.addEventListener(e,n)}async removeEventListener(e){return await this._events.removeEventListener(e)}setKeypair(e){this.keypair=e}async loadAllChannels(){return(await Z.gpaBuilder().addFilter("accountDiscriminator",ct).run(this.provider.connection)).map(n=>({pubkey:n.pubkey,data:Z.fromAccountInfo(n.account)[0]}))}async loadChannel(e,n){return Z.fromAccountAddress(this.provider.connection,e,n)}async loadMyChannels(){return await this.loadMemberships()}async loadChannelMembers(e){return(await q.gpaBuilder().addFilter("accountDiscriminator",Ne).addFilter("channel",e).run(this.provider.connection)).map(o=>({pubkey:o.pubkey,data:q.fromAccountInfo(o.account)[0]}))}async loadMemberships(e){const n=q.gpaBuilder().addFilter("accountDiscriminator",Ne).addFilter("authority",this.provider.publicKey);return e&&n.addFilter("key",e),(await n.run(this.provider.connection)).map(i=>({pubkey:i.pubkey,data:q.fromAccountInfo(i.account)}))}async loadMembership(e,n){return q.fromAccountAddress(this.provider.connection,e,n)}async getMembershipPDA(e,n){return n=n!=null?n:this.keypair.publicKey,await I.findProgramAddress([e.toBuffer(),n.toBuffer()],this.programId)}async encryptCEK(e,n){return bi(e,n!=null?n:this.keypair.publicKey)}async decryptCEK(e,n){return _i(e,n!=null?n:this.keypair.secretKey)}async encryptMessage(e,n){return vi(e,n)}async decryptMessage(e,n){return wi(e,n)}async initChannel(e){var f,v,w,S,b;const n=(f=e.channel)!=null?f:de.generate(),o=await yi(),i=await this.encryptCEK(o),[a]=await this.getMembershipPDA(n.publicKey),s=this.provider.publicKey,r=new ae;r.add(Zs({key:this.keypair.publicKey,channel:n.publicKey,membership:a,authority:s},{data:{name:e.name,public:(v=e.public)!=null?v:!1,permissionless:(w=e.permissionless)!=null?w:!1,memberName:(S=e.memberName)!=null?S:"",maxMessages:e.maxMessages,cek:i}}));let d;try{d=await this.provider.sendAndConfirm(r,[n,this.keypair],e.opts)}catch(_){throw(b=se(_.code))!=null?b:_}return{signature:d,channel:n,cek:o,cekEncrypted:i}}async deleteChannel({channel:e,opts:n}){var r;const o=this.provider.publicKey,[i]=await this.getMembershipPDA(e),a=new ae;a.add(Us({channel:e,authority:o,authorityMembership:i}));let s;try{s=await this.provider.sendAndConfirm(a,void 0,n)}catch(d){throw(r=se(d.code))!=null?r:be("Unauthorized")}return{signature:s}}async joinChannel(e){var s,r;const[n]=await this.getMembershipPDA(e.channel),o=this.provider.publicKey,i=new ae;i.add(ni({channel:e.channel,key:this.keypair.publicKey,membership:n,authority:o},{data:{name:e.name,authority:(s=e.authority)!=null?s:null}}));let a;try{a=await this.provider.sendAndConfirm(i,[this.keypair],e.opts)}catch(d){throw(r=se(d.code))!=null?r:d}return{signature:a}}async leaveChannel(e){var s;const[n]=await this.getMembershipPDA(e.channel),o=this.provider.publicKey,i=new ae;i.add(ii({channel:e.channel,membership:n,authority:o}));let a;try{a=await this.provider.sendAndConfirm(i)}catch(r){throw(s=se(r.code))!=null?s:r}return{signature:a}}async addMember(e){var v,w,S,b;const n=(v=e.key)!=null?v:e.invitee,[o]=await this.getMembershipPDA(e.channel),[i]=await this.getMembershipPDA(e.channel,n),a=await this.loadMembership(o);if(!a.cek.encryptedKey)throw be("Unauthorized");const s=await this.decryptCEK(a.cek),r=await this.encryptCEK(s,n),d=new ae;d.add(Ws({channel:e.channel,authority:this.provider.publicKey,invitee:e.invitee,authorityMembership:o,inviteeMembership:i},{data:{name:(w=e.name)!=null?w:"",flags:(S=e.flags)!=null?S:0,cek:r,key:n}}));let f;try{f=await this.provider.sendAndConfirm(d)}catch(_){throw(b=se(_.code))!=null?b:be("Unauthorized")}return{signature:f}}async deleteMember(e){var r;const[n]=e.membership?[e.membership]:await this.getMembershipPDA(e.channel,e.key),[o]=await this.getMembershipPDA(e.channel),i=this.provider.publicKey,a=new ae;a.add(qs({channel:e.channel,membership:n,authority:i,authorityMembership:o}));let s;try{s=await this.provider.sendAndConfirm(a)}catch(d){throw(r=se(d.code))!=null?r:d}return{signature:s}}async authorizeMember(e){var f;const[n]=await this.getMembershipPDA(e.channel),[o]=await this.getMembershipPDA(e.channel,e.key),i=await this.loadMembership(n);if(!i.cek.encryptedKey)throw be("Unauthorized");const a=await this.decryptCEK(i.cek),s=await this.encryptCEK(a,e.key),r=new ae;r.add(Rs({channel:e.channel,membership:o,authority:this.provider.publicKey,authorityMembership:n},{data:{cek:s}}));let d;try{d=await this.provider.sendAndConfirm(r)}catch(v){throw(f=se(v.code))!=null?f:be("Unauthorized")}return{signature:d}}async postMessage(e){var r;const[n]=await this.getMembershipPDA(e.channel);let o,i=0;if(e.encrypt){const d=await this.loadMembership(n);if(!d.cek.header)throw be("Unauthorized");const f=await this.decryptCEK(d.cek);o=await this.encryptMessage(e.message,f),i|=1}else o=e.message;const a=new ae;a.add(li({channel:e.channel,membership:n,authority:this.provider.publicKey},{message:String.fromCharCode(i)+o}));let s;try{s=await this.provider.sendAndConfirm(a)}catch(d){throw(r=se(d.code))!=null?r:d}return{signature:s}}}const Mt="***** *** *** *** *******",Q=Ve("messenger",()=>{const t=yt(),e=It(),n=Fe(),o=y(()=>e.keypair),i={allChannels:[],ownChannels:[],channel:void 0,channelAddr:void 0,channelMembershipAddr:void 0,channelMembership:void 0,channelMembers:[],channelMessages:[],channelLoading:!1,loading:!1,creating:!1,sending:!1},a=le({...i}),s=y(()=>{var h;return new Mi(new wt(t.connection,(h=n.value)!=null?h:{publicKey:I.default},wt.defaultOptions()),e.keypair)});let r=[];we(n,h=>{h?v().then():w()},{immediate:!0}),we([o,()=>a.allChannels],()=>{d().then()},{immediate:!0});async function d(){var E;const x=(await s.value.loadMemberships((E=e.keypair)==null?void 0:E.publicKey)).map(j=>({pubkey:j.data[0].channel.toBase58(),status:j.data[0].status.__kind}));a.ownChannels=x,console.log("myChannels ====== ",a.ownChannels)}async function f(){console.log("Register events...");for(const h of r)await s.value.removeEventListener(h);r.push(s.value.addEventListener("NewMessageEvent",async h=>{if(console.log("[Event] NewMessageEvent",h),`${h.channel}`!=`${a.channelAddr}`)return;let x=h.message.content;if(s.value.utils.message.isEncrypted(h.message)){const j=await L();j?x=await s.value.decryptMessage(h.message.content,j):x=Mt}a.channelMessages.push({...h.message,content:x})})),r.push(s.value.addEventListener("AuthorizeMemberEvent",async h=>{console.log("[Event] AuthorizeMemberEvent",h),!(a.channelAddr&&`${h.channel}`!=`${a.channelAddr}`)&&(`${h.membership}`==`${a.channelMembershipAddr}`?A(a.channelAddr).then():J().then())})),r.push(s.value.addEventListener("JoinChannelEvent",async h=>{console.log("[Event] JoinChannelEvent",h),`${h.channel}`==`${a.channelAddr}`&&J().then()})),r.push(s.value.addEventListener("LeaveChannelEvent",async h=>{console.log("[Event] LeaveChannelEvent",h),`${h.channel}`==`${a.channelAddr}`&&J().then()}))}async function v(){w(),r=[],a.loading=!0;const h=await s.value.loadAllChannels();await f(),a.allChannels=h,a.loading=!1,console.log(a)}function w(){Object.assign(a,i)}async function S(h,x){var E,j;try{a.creating=!0,await s.value.initChannel({name:h,maxMessages:(E=x.maxMessages)!=null?E:15,public:x.public,permissionless:x.permissionless,opts:{commitment:(j=x.commitment)!=null?j:"confirmed"}}),await v()}finally{a.creating=!1}}async function b(h){const x=new I(h);await s.value.deleteChannel({channel:x,opts:{commitment:"confirmed"}}),await v()}async function _(h,x){const E=new I(h);await s.value.joinChannel({channel:E,name:x,opts:{commitment:"confirmed"}}),await A(h)}async function A(h){var x;a.channelLoading=!0,a.channelMessages=[],a.channelMembers=[],a.channelMembershipAddr=void 0,a.channelMembership=void 0,a.channelAddr=new I(h);try{if((x=n.value)!=null&&x.publicKey)try{const[E]=await s.value.getMembershipPDA(a.channelAddr);a.channelMembershipAddr=E,a.channelMembership=await s.value.loadMembership(E)}catch(E){console.log(E),a.channelMembershipAddr=void 0,a.channelMembership=void 0}await J(),await V()}catch(E){console.log("Error",E)}finally{a.channelLoading=!1}}async function L(){if(!!a.channelMembership)try{return await s.value.decryptCEK(a.channelMembership.cek)}catch(h){console.log(h)}}async function V(){if(!a.channelAddr){console.log("Invalid channel");return}a.channel=await s.value.loadChannel(a.channelAddr);const x=s.value.utils.channel.isPublic(a.channel)?null:await L();a.channelMessages=await Promise.all(a.channel.messages.map(async E=>{var Be;let Ke=s.value.utils.message.isEncrypted(E)?Mt:E.content,Ie=qe(E.sender);if((Be=n.value)!=null&&Be.publicKey){const ye=a.channelMembers.find(({data:xe})=>xe.name!==""&&(`${xe.authority}`==`${E.sender}`||`${xe.key}`==`${E.sender}`));ye&&ye.data.name!==""&&(Ie=ye.data.name)}if(x)try{Ke=await s.value.decryptMessage(E.content,x)}catch{console.log(`Failed to decrypt message #${E.id}`)}return{...E,senderDisplayName:Ie,content:Ke}}))}async function J(){if(!a.channelAddr){console.error("Invalid channel");return}a.channelMembers=await X()}async function X(h=a.channelAddr){return await s.value.loadChannelMembers(h)}async function k(h){if(!a.channelAddr){console.log("Please select a channel");return}try{a.sending=!0;let x;a.channel&&(x=s.value.utils.channel.isPublic(a.channel)),await s.value.postMessage({channel:a.channelAddr,message:h,encrypt:!x}),await V()}finally{a.sending=!1}}async function z(h,x,E,j){if(!a.channelAddr){console.log("Invalid channel");return}await s.value.addMember({channel:a.channelAddr,invitee:new I(h),key:x?new I(x):void 0,name:E,flags:j})}async function C(h){if(!a.channelAddr){console.log("Invalid channel");return}await s.value.deleteMember({channel:a.channelAddr,key:new I(h)})}async function F(h){if(!a.channelAddr){console.log("Invalid channel");return}await s.value.authorizeMember({channel:a.channelAddr,key:new I(h)}),await V()}async function P(){await v()}return{state:a,client:s.value,loadChannel:A,joinChannel:_,createChannel:S,deleteChannel:b,postMessage:k,addMember:z,deleteMember:C,authorizeMember:F,refreshList:P,loadMembers:X}}),ge=Ve("channel",()=>{const t=Fe(),{state:e,client:n}=Q(),o=y(()=>e.channelLoading),i=y(()=>e.sending),a=y(()=>{var C;return!!((C=t.value)!=null&&C.publicKey)}),s=y(()=>!!e.channel&&n.utils.channel.isPublic(e.channel)),r=y(()=>!!e.channel&&n.utils.channel.isPermissionless(e.channel)),d=y(()=>{var C;return((C=e.channelMembership)==null?void 0:C.status.__kind)==="Authorized"}),f=y(()=>{var C;return((C=e.channelMembership)==null?void 0:C.status.__kind)==="Pending"}),v=y(()=>{var C,F,P;return String((C=e.channel)==null?void 0:C.creator)===String((P=(F=t.value)==null?void 0:F.publicKey)!=null?P:"-")}),w=y(()=>!!e.channelMembership&&n.utils.member.canAddMember(e.channelMembership)),S=y(()=>!!e.channelMembership&&n.utils.member.canAuthorizeMember(e.channelMembership)),b=y(()=>!!e.channelMembership&&n.utils.member.canDeleteMember(e.channelMembership)),_=y(()=>!!e.channelMembership&&n.utils.member.isAdmin(e.channelMembership)),A=y(()=>!!e.channelMembership&&n.utils.member.isOwner(e.channelMembership)),L=y(()=>a.value&&!!e.channel&&!e.loading&&!d.value),V=y(()=>a.value),J=y(()=>A.value),X=y(()=>A.value),k=y(()=>!e.sending&&(s.value||d.value));return{ownChannels:y(()=>e.allChannels.filter(C=>{var F;return!!e.ownChannels.find(P=>P.pubkey===C.pubkey.toBase58())||C.data.flags===1||C.data.creator.toBase58()===String((F=t.value)==null?void 0:F.publicKey)})),isChannelLoading:o,isSendMessage:i,isPublicChannel:s,isPermissionlessChannel:r,isAuthorizedMember:d,isPendingMember:f,isChannelCreator:v,isAdmin:_,isOwner:A,canJoinChannel:L,canAddMember:w,canAuthorizeMember:S,canDeleteMember:b,canCreateChannel:V,canDeleteChannel:J,canGrantAccess:X,canPostMessage:k}}),Ci={class:"text-weight-medium"},Ai={class:"memberlist-info__details"},Si=u("span",null,"Authority:",-1),ki={class:"memberlist-info__details"},xi=u("span",null,"Key:",-1),Ei=W({__name:"MemberListDialog",props:{membersDialog:{type:Boolean,default:!1},authorizeMemberState:{type:Object},deleteMemberState:{type:Object},wallet:{type:Object}},emits:["submit","deleteMember"],setup(t,{emit:e}){const{state:n}=Q(),o=ge();function i(s){return(s==null?void 0:s.name)&&s.name!==""?s.name:qe(s.authority)}function a(s){return String(s).toLowerCase()}return(s,r)=>(g(),M(he,{class:"memberlist"},{default:c(()=>[l(ee,{square:"",flat:"",horizontal:""},{default:c(()=>[l(U,{class:"q-px-lg"},{default:c(()=>[$(" MEMBERS ")]),_:1}),l(U,{class:"memberlist-card"},{default:c(()=>[l(Re,{separator:""},{default:c(()=>[(g(!0),D(H,null,_e(m(n).channelMembers,d=>(g(),M(te,{key:d.pubkey.toString(),"active-class":"bg-teal-1",active:`${d.pubkey}`==`${m(n).channelMembershipAddr}`,class:"row justify-between memberlist-item"},{default:c(()=>[l(G,{class:"memberlist-info"},{default:c(()=>[l(rt,{class:"row justify-between"},{default:c(()=>[u("span",Ci,B(i(d.data)),1),l(_n,{class:ft([a(d.data.status.__kind),"memberlist-status q-px-xs"])},{default:c(()=>[$(B(d.data.status.__kind),1)]),_:2},1032,["class"])]),_:2},1024),l(rt,{caption:"",lines:"2"},{default:c(()=>[u("div",Ai,[Si,u("span",null,B(d.data.authority),1)]),u("div",ki,[xi,u("span",null,B(d.data.key),1)])]),_:2},1024)]),_:2},1024),l(G,{side:"",class:"q-gutter-sm memberlist-btns"},{default:c(()=>[d.data.status.__kind==="Pending"?(g(),M(T,{key:0,color:"teal",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:t.authorizeMemberState.loading,disabled:t.authorizeMemberState.loading,onClick:f=>s.$emit("submit",d.data.key)},{default:c(()=>[$(" Authorize ")]),_:2},1032,["loading","disabled","onClick"])):ie("",!0),m(o).canDeleteMember?(g(),M(T,{key:1,color:"negative",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:t.deleteMemberState.loading,disabled:t.deleteMemberState.loading,onClick:f=>s.$emit("deleteMember",d.data.key)},{default:c(()=>[$(" Delete ")]),_:2},1032,["loading","disabled","onClick"])):ie("",!0)]),_:2},1024)]),_:2},1032,["active"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}}),$i=t=>(Ae("data-v-9bcdbebf"),t=t(),Se(),t),Di=$i(()=>u("br",null,null,-1)),Pi=W({__name:"JoinChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=R(t.defaultState);return(o,i)=>(g(),M(he,{class:"join-channel-dialog",onHide:i[3]||(i[3]=a=>o.$emit("reset"))},{default:c(()=>[l(ee,null,{default:c(()=>[l(U,null,{default:c(()=>[l(je,{class:"join-channel-form",onSubmit:i[2]||(i[2]=gt(a=>o.$emit("submit",n.value),["prevent"]))},{default:c(()=>[l(ne,{modelValue:n.value.name,"onUpdate:modelValue":i[0]||(i[0]=a=>n.value.name=a),placeholder:"Member name *","lazy-rules":"",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),l(ne,{modelValue:n.value.authority,"onUpdate:modelValue":i[1]||(i[1]=a=>n.value.authority=a),placeholder:"Authorize By","lazy-rules":"",rules:[a=>!a||a&&a.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),Di,l(T,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[$(" Join Channel ")]),_:1})]),_:1}),l(Qe,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Ki=O(Pi,[["__scopeId","data-v-9bcdbebf"]]),Ii=t=>(Ae("data-v-fe97e637"),t=t(),Se(),t),Bi=Ii(()=>u("br",null,null,-1)),zi=W({__name:"AddMemberDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t,{emit:e}){const o=R(t.defaultState),i=()=>e("submit",o.value);return(a,s)=>(g(),M(he,{class:"add-member-dialog",onHide:s[3]||(s[3]=r=>a.$emit("reset"))},{default:c(()=>[l(ee,null,{default:c(()=>[l(U,null,{default:c(()=>[l(je,{class:"add-member-form",onSubmit:gt(i,["prevent"])},{default:c(()=>[l(ne,{modelValue:o.value.name,"onUpdate:modelValue":s[0]||(s[0]=r=>o.value.name=r),label:"Member name *",hint:"Min length 3 chars","lazy-rules":"",rules:[r=>r&&r.length>2||"Please type something"]},null,8,["modelValue","rules"]),l(ne,{modelValue:o.value.wallet,"onUpdate:modelValue":s[1]||(s[1]=r=>o.value.wallet=r),label:"Member Wallet *","lazy-rules":"",rules:[r=>r&&r.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),l(ne,{modelValue:o.value.key,"onUpdate:modelValue":s[2]||(s[2]=r=>o.value.key=r),label:"Member Device Key",hint:"Default: The same as member wallet","lazy-rules":"",rules:[r=>!r||r.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),Bi,l(T,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[$(" Add Member ")]),_:1})]),_:1},8,["onSubmit"]),l(Qe,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Ti=O(zi,[["__scopeId","data-v-fe97e637"]]),Wi={class:"row"},Ni={class:"col"},Li={class:"col"},Vi=W({__name:"NewChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t,{emit:e}){const o=R(t.defaultState),i=()=>e("submit",o);return(a,s)=>(g(),M(he,{class:"new-channel-dialog",onHide:s[4]||(s[4]=r=>a.$emit("reset"))},{default:c(()=>[l(ee,null,{default:c(()=>[l(U,null,{default:c(()=>[l(je,{class:"messenger-new-channel-form"},{default:c(()=>[l(ne,{modelValue:o.value.name,"onUpdate:modelValue":s[0]||(s[0]=r=>o.value.name=r),label:"Channel name *","lazy-rules":"",maxlength:"32",rules:[r=>r&&r.length>2||"Please type something"]},null,8,["modelValue","rules"]),l(ne,{modelValue:o.value.maxMessages,"onUpdate:modelValue":s[1]||(s[1]=r=>o.value.maxMessages=r),label:"Max messages","lazy-rules":"",rules:[r=>+r>0||"Invalid value"]},null,8,["modelValue","rules"]),u("div",Wi,[u("div",Ni,[l(ot,{modelValue:o.value.public,"onUpdate:modelValue":s[2]||(s[2]=r=>o.value.public=r),label:"Public"},null,8,["modelValue"])]),u("div",Li,[o.value.public?ie("",!0):(g(),M(ot,{key:0,modelValue:o.value.permissionless,"onUpdate:modelValue":s[3]||(s[3]=r=>o.value.permissionless=r),label:"Permissionless"},null,8,["modelValue"]))])])]),_:1}),l(Qe,{showing:t.loading},null,8,["showing"])]),_:1}),l(ue),l(U,null,{default:c(()=>[l(T,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:"",onClick:i},{default:c(()=>[$(" Create Channel ")]),_:1})]),_:1})]),_:1})]),_:1}))}});const Ri=O(Vi,[["__scopeId","data-v-96ab7f96"]]),Oi=W({__name:"ChannelForm",props:{message:{type:String,default:""},disabled:{type:Boolean,default:!1},sending:{type:Boolean,default:!1}},emits:["submit"],setup(t,{emit:e}){const n=t,o=R(n.message),i=()=>{e("submit",o),o.value=""};return console.log(n),(a,s)=>(g(),M(je,{class:"channel-form",onSubmit:gt(i,["prevent"])},{default:c(()=>[l(ht,{class:"row message-control"},{default:c(()=>[l(ne,{ref:"inputFocus",modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=r=>o.value=r),class:"col-grow message-input","bg-color":"white",placeholder:"Type a message",dense:"",borderless:"",autofocus:"",disable:t.disabled},null,8,["modelValue","disable"]),l(T,{class:"send-btn",square:"",flat:"",type:"submit",disable:t.disabled,loading:t.sending},{default:c(()=>[$(" Send ")]),_:1},8,["disable","loading"])]),_:1})]),_:1},8,["onSubmit"]))}});const Fi=O(Oi,[["__scopeId","data-v-6a48a63e"]]),Ui={},ji={class:"column q-ma-md"},Qi={class:"column items-end q-ma-md"};function qi(t,e){return g(),D(H,null,[u("div",ji,[l(Ee,{class:"q-my-xs",width:"250px",height:"47px"}),l(Ee,{class:"q-my-xs",width:"250px",height:"47px"})]),u("div",Qi,[l(Ee,{class:"q-my-xs",width:"250px",height:"47px"}),l(Ee,{class:"q-my-xs",width:"250px",height:"47px"}),l(Ee,{class:"q-my-xs",width:"250px",height:"47px"})])],64)}const Ji=O(Ui,[["render",qi]]),Gi={key:1,class:"row justify-center channel-wrapper"},Hi={key:1,class:"messenger-empty"},Xi={key:2,class:"messenger-empty"},Zi=W({__name:"ChannelWrapper",props:{postMessageState:{type:Object}},emits:["sendMessage"],setup(t,{emit:e}){const n=me(),{state:o}=Q(),i=ge();function a(w){const S=n.publicKey.value;return S?String(S)!==String(w):!0}const s=y(()=>{const w=[];let S=0,b;for(const _ of o.channelMessages)b&&`${_.sender}`==`${b}`?w[S-1].text.push(_.content):(b=_.sender,w.push({id:_.id,sender:_.sender,senderDisplayName:_.senderDisplayName,text:[_.content],date:_.createdAt}),S++);return w}),r=y(()=>i.canPostMessage),d=w=>e("sendMessage",w),f=R(),v=R();return we(v,w=>{w&&(f.value.scrollTop=w.scrollHeight)}),(w,S)=>{const b=Ji,_=Fi;return g(),M(ee,{class:"messenger-card",square:""},{default:c(()=>[u("div",{ref_key:"chat",ref:f,class:"messenger-content"},[m(i).isChannelLoading?(g(),M(b,{key:0})):m(o).channel?(g(),D("div",Gi,[m(s).length>0?(g(),D("div",{key:0,ref_key:"mes",ref:v,class:"messenger-messages"},[(g(!0),D(H,null,_e(m(s),A=>(g(),M(vn,{key:A.id,name:A.senderDisplayName,text:A.text,sent:a(A.sender)},null,8,["name","text","sent"]))),128))],512)):(g(),D("div",Hi," No messages "))])):(g(),D("div",Xi," Please select a channel "))],512),l(_,{message:t.postMessageState.message,sending:m(i).isSendMessage,disabled:!m(r),onSubmit:d},null,8,["message","sending","disabled"])]),_:1})}}});const Yi=O(Zi,[["__scopeId","data-v-7ebf5d4f"]]),eo=W({props:{text:{type:String,default:""}}});function to(t,e,n,o,i,a){return g(),M(kt,{anchor:"top middle",self:"center middle",class:"bg-grey-9 text-body2"},{default:c(()=>[$(B(t.text),1)]),_:1})}const no=O(eo,[["render",to]]),ao="/sol-messenger/assets/refresh.e0cf4262.svg",so="/sol-messenger/assets/add.1481b8ed.svg",io="/sol-messenger/assets/join.627c8616.svg",bt=t=>(Ae("data-v-cc02cbfe"),t=t(),Se(),t),oo=bt(()=>u("img",{src:ao,alt:"refresh"},null,-1)),ro=bt(()=>u("img",{src:so,alt:"create"},null,-1)),lo=bt(()=>u("img",{src:io,alt:"join"},null,-1)),co=W({__name:"ChannelControl",props:{isJoining:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["createChannel","joinChannel","refreshList"],setup(t){const e=ge(),n=y(()=>e.canJoinChannel&&!e.isPublicChannel),o=y(()=>e.isPendingMember),i=y(()=>e.canCreateChannel);return(a,s)=>{const r=no;return g(),M(te,null,{default:c(()=>[l(G,{class:"button-wrapper"},{default:c(()=>[l(T,{class:ft(["control-button",{"refresh-btn":t.isLoading}]),onClick:s[0]||(s[0]=d=>a.$emit("refreshList"))},{default:c(()=>[oo,l(r,{text:"Refresh list"})]),_:1},8,["class"]),m(i)?(g(),M(T,{key:0,class:"control-button",square:"",onClick:s[1]||(s[1]=d=>a.$emit("createChannel"))},{default:c(()=>[ro,l(r,{text:"Create a channel"})]),_:1})):ie("",!0),m(n)&&!m(e).isChannelLoading?(g(),M(T,{key:1,class:"control-button",square:"",loading:t.isJoining,disable:m(o),onClick:s[2]||(s[2]=d=>a.$emit("joinChannel"))},{default:c(()=>[lo,l(r,{text:"Join the channel"})]),_:1},8,["loading","disable"])):ie("",!0)]),_:1})]),_:1})}}});const uo=O(co,[["__scopeId","data-v-cc02cbfe"]]),mo={class:"chat-name"},ho={key:0,class:"message-count"},po=W({__name:"MessengerChannel",props:{pubkey:{type:Object,required:!0},channel:{type:Object,required:!0},isActive:Boolean},emits:["select"],setup(t){const e=t,n=y(()=>e.channel.name.slice(0,2));return(o,i)=>(g(),M(te,{"active-class":"bg-blue-grey-8 text-white",active:t.isActive},{default:c(()=>[l(G,{class:"chat-item cursor-pointer",onClick:i[0]||(i[0]=a=>o.$emit("select"))},{default:c(()=>[u("div",{class:"chat-badge",style:Dt(m(Ea)(`${t.pubkey}`))},[u("span",null,B(m(n)),1)],4),u("div",mo,B(t.channel.name),1),+t.channel.messageCount>0?(g(),D("div",ho,B(t.channel.messageCount),1)):ie("",!0)]),_:1})]),_:1},8,["active"]))}});const fo=O(po,[["__scopeId","data-v-51282948"]]),go={xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",fill:"none","xmlns:v":"https://vecta.io/nano"},yo=["fill"],bo=W({__name:"iconBell",props:{color:{type:String,default:"AABEC8"}},setup(t){return(e,n)=>(g(),D("svg",go,[u("path",{d:"M5.352 14.359h3.294c0 .821-.59 1.641-1.647 1.641s-1.647-.82-1.647-1.641zm8.434-3.467l-.911-1.515a3.68 3.68 0 0 1-.527-1.897V5.325C12.348 2.389 9.949 0 7 0S1.651 2.389 1.651 5.325v2.155a3.68 3.68 0 0 1-.527 1.897l-.911 1.515c-.278.461-.285 1.018-.018 1.487s.749.749 1.29.749h11.03a1.47 1.47 0 0 0 1.291-.749 1.46 1.46 0 0 0-.021-1.487z",fill:`#${t.color}`},null,8,yo)]))}}),_o={class:"panel-notifications__info"},vo=W({__name:"MessengerNotification",setup(t){const{loadMembers:e}=Q(),n=ge(),o=Fe(),i=R(),a=y(()=>{var f,v;return(v=(f=i.value)==null?void 0:f.length)!=null?v:0}),s=y(()=>a.value>0),r=R(!1),d=y(()=>r.value?"width: 100%; padding-right: 14px":"width: 0; padding-right: 0;");return we(()=>n.ownChannels,async(f,v)=>{if(v.length>0)try{const w=await Promise.all(v.map(async S=>{var A;const{pubkey:b,data:_}=S;if(_.creator.toBase58()===((A=o.value)==null?void 0:A.publicKey.toBase58())){const L=await e(b);return L.length===0?void 0:L.find(V=>V.data.status.__kind==="Pending")?S:void 0}}));i.value=w.filter(S=>S),i.value.length>0&&(setTimeout(()=>r.value=!0,2e3),setTimeout(()=>r.value=!1,7e3))}catch(w){console.log(w)}}),(f,v)=>{const w=bo;return g(),D("div",{class:ft(["panel-notifications",{"has-notifications":m(s)}])},[u("div",_o,[l(w,{class:"ring",color:m(s)?"FF5C5C":"AABEC8"},null,8,["color"]),u("span",null,B(a.value),1)]),u("div",{ref:"notificationsInfo",class:"panel-notifications__details",style:Dt(m(d))}," channels are awaiting user confirmation ",4)],2)}}});const wo={class:"panel-search"},Mo={class:"search-wrapper"},Co={class:"panel-info"},Ao={class:"chat-info"},So={class:"chat-members"},ko={class:"chat-messages"},xo={class:"chat-name"},Eo=W({__name:"MessengerToolbar",emits:["search","showMembers","deleteChannel","addMember","showDeviceKey"],setup(t,{emit:e}){const n=me(),{state:o}=Q(),i=ge(),a=y(()=>!!n.publicKey.value),s=R(""),r=y(()=>o.channel),d=y(()=>{var b,_,A;return((b=r.value)==null?void 0:b.memberCount)===null||((_=r.value)==null?void 0:_.memberCount)===void 0?"":`${(A=r.value)==null?void 0:A.memberCount}\xA0members`}),f=y(()=>{var b,_,A;return((b=r.value)==null?void 0:b.messageCount)===null||((_=r.value)==null?void 0:_.messageCount)===void 0?"":`${(A=r.value)==null?void 0:A.messageCount}\xA0messages`}),v=b=>e("search",b),w=()=>e("showMembers"),S=()=>e("addMember");return we(s,b=>{v(String(b))}),(b,_)=>{const A=vo;return g(),M(ht,{class:"panel-toolbar"},{default:c(()=>{var L;return[l(A),u("div",wo,[u("div",Mo,[l(ne,{modelValue:s.value,"onUpdate:modelValue":_[0]||(_[0]=V=>s.value=V),class:"search-input no-margin q-pa-none",placeholder:"Search ...",clearable:"",debounce:"300",borderless:"",onClear:_[1]||(_[1]=V=>s.value="")},null,8,["modelValue"])])]),u("div",Co,[u("div",Ao,[u("div",So,B(m(d)),1),u("div",ko,B(m(f)),1)]),l(pt,{class:""}),u("div",xo,B((L=m(r))==null?void 0:L.name),1),u("div",null,[l(T,{class:"chat-menu",flat:"",unelevated:"",disable:!m(a)},{default:c(()=>[l(wn,{name:m(Mn)},null,8,["name"]),l(Cn,{anchor:"bottom left",self:"top left"},{default:c(()=>[l(Re,{style:{"min-width":"150px"},bordered:""},{default:c(()=>[$e((g(),M(te,{clickable:"",onClick:_[2]||(_[2]=V=>b.$emit("showDeviceKey"))},{default:c(()=>[l(G,null,{default:c(()=>[$("Device key")]),_:1})]),_:1})),[[De]]),$e((g(),M(te,{clickable:"",disable:!m(r),onClick:w},{default:c(()=>[l(G,null,{default:c(()=>[$("Members")]),_:1})]),_:1},8,["disable"])),[[De]]),$e((g(),M(te,{clickable:"",disable:!m(i).canAddMember,onClick:S},{default:c(()=>[l(G,null,{default:c(()=>[$("Add member")]),_:1})]),_:1},8,["disable"])),[[De]]),$e((g(),M(te,{clickable:"",disable:!m(i).isChannelCreator,onClick:_[3]||(_[3]=V=>b.$emit("deleteChannel"))},{default:c(()=>[l(G,null,{default:c(()=>[$("Delete")]),_:1})]),_:1},8,["disable"])),[[De]])]),_:1})]),_:1})]),_:1},8,["disable"])])])]}),_:1})}}});const $o=15;function Do(){const{createChannel:t}=Q(),{isWalletConnected:e,ok:n,error:o}=ke(),i=le({dialog:!1,name:"",maxMessages:$o,public:!1,permissionless:!1,loading:!1});async function a(){if(e())try{await t(i.name,{maxMessages:i.maxMessages,public:i.public,permissionless:i.permissionless}),s(),n("Channel was created!")}catch(r){o("Something went wrong"),console.log(r)}}function s(){i.dialog=!1,i.public=!1,i.loading=!1,i.name="",i.maxMessages=15}return{state:i,submit:a,reset:s}}function Po(){const t=Q(),{info:e,ok:n,error:o}=ke(),i=le({loading:!1});async function a(){if(!t.state.channelAddr){e("Please select a channel");return}try{i.loading=!0,await t.deleteChannel(t.state.channelAddr),n("Channel was deleted!")}catch(s){console.log("Error",s),o("Something went wrong")}finally{i.loading=!1}}return{state:i,submit:a}}function Ko(){const{authorizeMember:t}=Q(),{ok:e,error:n}=ke(),o=le({loading:!1,dialog:!1});async function i(a){try{o.loading=!0,await t(a),e("Member was authorized")}catch(s){n("Something went wrong"),console.log(s)}finally{o.loading=!1}}return{state:o,submit:i}}function Io(){const{state:t,addMember:e}=Q(),{ok:n,info:o,error:i}=ke(),a=le({dialog:!1,loading:!1});async function s(d){if(console.log(d),a.loading=!0,!t.channelAddr){o("Please select a channel");return}try{return await e(d.wallet,d.key,d.name),n("Member was added"),!0}catch(f){i("Something went wrong"),console.log(f)}finally{a.loading=!1,a.dialog=!1}return!1}function r(){a.loading=!1,a.dialog=!1}return{state:a,submit:s,reset:r}}function Bo(){const{deleteMember:t}=Q(),{ok:e,error:n}=ke(),o=le({loading:!1});async function i(a){try{o.loading=!0,await t(a),e("Member was deleted")}catch(s){n("Something went wrong"),console.log(s)}finally{o.loading=!1}}return{state:o,submit:i}}function zo(){const{state:t,joinChannel:e}=Q(),{ok:n,info:o,error:i}=ke(),a=le({dialog:!1,loading:!1,name:""});async function s(){if(!t.channelAddr){o("Please select a channel");return}a.loading=!0;try{await e(t.channelAddr,a.name),r(),n("Request was sent")}catch(d){console.log("Error",d),i("Something went wrong")}finally{a.loading=!1}}function r(){a.loading=!1,a.dialog=!1,a.name=""}return{state:a,submit:s,reset:r}}function ke(){const t=me(),{notify:e}=Le(),n=s=>e({type:"positive",message:s,timeout:2e3}),o=s=>e({type:"info",message:s,timeout:2e3}),i=s=>e({type:"negative",message:s,timeout:2e3});function a(){return t.publicKey.value?!0:(o("Please connect wallet"),!1)}return{ok:n,info:o,error:i,isWalletConnected:a}}const To={class:"col col-4"},Wo={class:"col"},No={class:"no-margin"},Lo=W({__name:"DebugBtn",setup(t){const{state:e}=Q(),{isAuthorizedMember:n,isPendingMember:o,isChannelCreator:i}=ge(),a=R(!1),s=An(a);return(r,d)=>(g(),D(H,null,[l(T,{flat:"",class:"text-blue-2",onClick:d[0]||(d[0]=f=>m(s)())},{default:c(()=>[$(" Debug info ")]),_:1}),l(he,{modelValue:a.value,"onUpdate:modelValue":d[1]||(d[1]=f=>a.value=f)},{default:c(()=>[l(ee,null,{default:c(()=>[l(U,null,{default:c(()=>[(g(!0),D(H,null,_e([["Authorized",m(n)],["Pending Access",m(o)],["Channel Creator",m(i)],["Channel",m(e).channel],["Membership",m(e).channelMembership],["Members",m(e).channelMembers]],f=>(g(),D("div",{key:f[0],class:"row q-mt-md"},[u("div",To,B(f[0]),1),u("div",Wo,[u("pre",No,B(f[1]),1)])]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),Vo={class:"messenger-wrapper"},Ro={class:"messenger-main"},Oo={key:1,class:"messenger-channels-empty"},Fo={key:0,class:"q-my-md q-px-lg"},Uo=W({__name:"Messenger",setup(t){const e=me(),{state:n,postMessage:o,loadChannel:i,refreshList:a}=Q(),s=ge(),r=Do(),d=zo(),f=Io(),v=Ko(),w=Bo(),S=Po(),b=le({message:""}),_=y(()=>n.allChannels),A=R([]),L=R("");async function V(P){await o(P.value),b.message=""}async function J(P){await i(P)}const X=P=>{if(P===""){A.value=[],L.value="";return}A.value=_.value.filter(h=>h.data.name.toLocaleLowerCase().includes(P.toLocaleLowerCase())||h.pubkey.toBase58().toLocaleLowerCase().includes(P.toLocaleLowerCase())),L.value=P},k=y(()=>n.loading),z=R(!1),C=y(()=>A.value.length>0||L.value.length>0?A.value:s.ownChannels),F=P=>f.submit(P);return(P,h)=>{const x=Eo,E=fo,j=uo,Ke=Yi,Ie=Ri,Be=Ti,ye=Ki,xe=Ei,Lt=Ms;return g(),D(H,null,[u("div",Vo,[l(x,{onSearch:X,onShowMembers:h[0]||(h[0]=K=>m(v).state.dialog=!0),onDeleteChannel:h[1]||(h[1]=K=>m(S).submit(m(n).channelAddr)),onAddMember:h[2]||(h[2]=K=>m(f).state.dialog=!0),onShowDeviceKey:h[3]||(h[3]=K=>z.value=!0)}),u("div",Ro,[l(ee,{class:"messenger-channels",square:""},{default:c(()=>[m(C).length>0?(g(),M(Re,{key:0,separator:"",class:"channels-list"},{default:c(()=>[(g(!0),D(H,null,_e(m(C),K=>(g(),M(E,{key:K.name,pubkey:K.pubkey,channel:K.data,"is-active":`${m(n).channelAddr}`==`${K.pubkey}`,onSelect:pr=>J(K.pubkey)},null,8,["pubkey","channel","is-active","onSelect"]))),128))]),_:1})):(g(),D("div",Oo," No channels ")),l(j,{"is-joining":m(d).state.loading,"is-loading":m(k),onCreateChannel:h[4]||(h[4]=K=>m(r).state.dialog=!0),onJoinChannel:h[5]||(h[5]=K=>m(d).state.dialog=!0),onRefreshList:m(a)},null,8,["is-joining","is-loading","onRefreshList"])]),_:1}),l(Ke,{"post-message-state":b,onSendMessage:V},null,8,["post-message-state"]),l(Qe,{showing:m(n).loading,color:"primary"},null,8,["showing"])])]),l(Ie,{modelValue:m(r).state.dialog,"onUpdate:modelValue":h[6]||(h[6]=K=>m(r).state.dialog=K),loading:m(r).state.loading,"default-state":m(r).state,onSubmit:m(r).submit,onReset:m(r).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),l(Be,{modelValue:m(f).state.dialog,"onUpdate:modelValue":h[7]||(h[7]=K=>m(f).state.dialog=K),loading:m(f).state.loading,"default-state":m(f).state,onSubmit:F,onReset:m(f).reset},null,8,["modelValue","loading","default-state","onReset"]),l(ye,{modelValue:m(d).state.dialog,"onUpdate:modelValue":h[8]||(h[8]=K=>m(d).state.dialog=K),loading:m(d).state.loading,"default-state":m(d).state,onSubmit:m(d).submit,onReset:m(d).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),l(xe,{modelValue:m(v).state.dialog,"onUpdate:modelValue":h[9]||(h[9]=K=>m(v).state.dialog=K),wallet:m(e),"authorize-member-state":m(v).state,"delete-member-state":m(w).state,onSubmit:m(v).submit,onDeleteMember:m(w).submit},null,8,["modelValue","wallet","authorize-member-state","delete-member-state","onSubmit","onDeleteMember"]),l(Lt,{modelValue:z.value,"onUpdate:modelValue":h[10]||(h[10]=K=>z.value=K)},null,8,["modelValue"]),m(n).channel?(g(),D("div",Fo,[l(Lo)])):ie("",!0)],64)}}});const jo={},Qo={class:"container"},qo={class:"messenger-container"},Jo={class:"container"};function Go(t,e){const n=Uo,o=ys;return g(),M(Sn,{class:"page-wrapper"},{default:c(()=>[u("div",Qo,[u("div",qo,[l(n)])]),u("div",Jo,[l(o)])]),_:1})}const Ho=O(jo,[["render",Go],["__scopeId","data-v-8f1b09e0"]]),Xo=()=>St(()=>import("./_...all_.ca0aca44.js"),["assets/_...all_.ca0aca44.js","assets/vendor.50fd2400.js","assets/_...all_.73169310.css"]),Zo=[{name:"index",path:"/",component:Ho,props:!0},{name:"all",path:"/:all(.*)*",component:Xo,props:!0,meta:{layout:"empty"}}],Yo=rs(Zo),er="/sol-messenger/",tr=kn({history:xn(er),scrollBehavior:()=>({left:0,top:0}),strict:!0,routes:Yo}),nr=({app:t})=>{t.use(tr)},ar=Object.freeze(Object.defineProperty({__proto__:null,install:nr},Symbol.toStringTag,{value:"Module"})),sr=({app:t})=>{t.use(En,{wallets:[new $n,new Dn,new Pn,new Kn,new In,new Bn,new zn,new Tn,new Wn,new Nn,new Ln,new Vn,new Rn,new On,new Fn,new Un,new jn,new Qn,new qn,new Jn,new Gn,new Hn,new Xn,new Zn,new Yn,new ea,new ta,new na,new aa,new sa],autoConnect:!1})},ir=Object.freeze(Object.defineProperty({__proto__:null,install:sr},Symbol.toStringTag,{value:"Module"})),or=ia();function rr(){return or}const lr=Symbol("WALLET_CONNECT_EVENT"),cr=Symbol("WALLET_DISCONNECT_EVENT"),ur=Symbol("ACCOUNT_CHANGE_EVENT"),it=5e3;function dr(){const{connection:t}=yt(),{emit:e}=rr(),{notify:n}=Le(),{wallet:o}=me();we(o,i=>{if(!i)return;const a=()=>{const d=i.adapter.publicKey;t.onAccountChange(d,f=>{e(ur,f)}),t.onLogs(d,f=>{console.log(f)}),n({message:"Wallet update",caption:`Connected to wallet ${qe(d.toBase58(),7)}`,timeout:it}),e(lr,i)},s=()=>{n({message:"Wallet update",caption:"Disconnected from wallet",timeout:it}),e(cr,i)},r=d=>{!(d!=null&&d.message)||n({type:"negative",message:"Wallet update",caption:d.message,timeout:it})};i.adapter.once("connect",a),i.adapter.once("disconnect",s),i.adapter.removeAllListeners("error"),i.adapter.on("error",r)},{immediate:!0})}const mr=W({__name:"App",setup(t){return oa(()=>{dr()}),(e,n)=>{const o=Oe("router-view");return g(),M(o)}}});async function hr(){const t=ra(mr);Object.values(Object.assign({"./plugins/pinia.ts":ca,"./plugins/quasar.ts":da,"./plugins/router.ts":ar,"./plugins/wallet.ts":ir})).forEach(e=>{var n;return(n=e.install)==null?void 0:n.call(e,{app:t})}),t.mount("#app")}hr().then();export{O as _};
