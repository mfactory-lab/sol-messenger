var jt=Object.defineProperty;var Qt=(t,e,n)=>e in t?jt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var O=(t,e,n)=>(Qt(t,typeof e!="symbol"?e+"":e,n),n);import{c as Jt,Q as qt,P as Gt,D as Ht,N as Xt,a as Zt,i as Yt,u as Ce,b as tt,d as V,o as g,e as b,w as l,f as u,g as x,h as r,j as en,k as d,l as tn,r as U,m as v,n as P,p as me,q as nn,s as an,S as sn,t as W,v as B,x as pt,y as z,z as ne,A as J,B as We,C as on,E as Y,F as q,G as rn,H as Ae,I as ee,J as vt,W as gt,K as Se,L as Me,M as ln,O as lt,R as cn,T as un,U as Ne,V as be,X as nt,Y as de,Z as dn,_ as wt,$ as mn,a0 as re,a1 as ze,a2 as Re,a3 as ct,a4 as ut,a5 as hn,a6 as pn,a7 as gn,a8 as Ct,a9 as Ee,aa as $e,ab as fn,ac as At,ad as yn,ae as bn,af as m,ag as Z,ah as St,ai as le,aj as ce,ak as Ke,al as Mt,am as _e,an as _n,ao as Ve,ap as kt,aq as at,ar as vn,as as wn,at as ft,au as Cn,av as An,aw as oe,ax as he,ay as yt,az as ye,aA as Sn,aB as Fe,aC as Oe,aD as te,aE as De,aF as Mn,aG as kn,aH as xn,aI as En,aJ as $n,aK as Kn,aL as Dn,aM as Pn,aN as In,aO as zn,aP as Bn,aQ as Tn,aR as Wn,aS as Ln,aT as Nn,aU as Rn,aV as Vn,aW as Fn,aX as On,aY as Un,aZ as jn,a_ as Qn,a$ as Jn,b0 as qn,b1 as Gn,b2 as Hn,b3 as Xn,b4 as Zn,b5 as Yn,b6 as ea,b7 as ta,b8 as na,b9 as aa,ba as sa,bb as oa,bc as ia,bd as ra,be as la,bf as ca,bg as ua,bh as da,bi as ma,bj as ha}from"./vendor.748b087f.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const pa=({app:t})=>{const e=Jt();t.use(e)},ga=Object.freeze(Object.defineProperty({__proto__:null,install:pa},Symbol.toStringTag,{value:"Module"})),fa=({app:t})=>{t.use(qt,{plugins:{Dark:Gt,Dialog:Ht,Notify:Xt,LocalStorage:Zt},iconSet:Yt})},ya=Object.freeze(Object.defineProperty({__proto__:null,install:fa},Symbol.toStringTag,{value:"Module"}));function ba(){const{dark:t}=Ce(),e=tt("theme-mode",t.isActive);return t.set(e.value),{isActive:e,set(n){t.set(n),e.value=t.isActive},toggle(){t.toggle(),e.value=t.isActive}}}const _a={class:"container"},va={class:"row"},wa=u("div",{class:"col-12 col-md-6"},[u("div",{class:"footer-links"},[u("ul",null,[u("li",null,[u("a",{target:"_blank",href:"https://jpool.one"},"JPOOL")]),u("li",null,[u("a",{target:"_blank",href:"https://heartandsol.one"},"GAME")]),u("li",null,[u("a",{href:"https://magiceden.io/marketplace/heartandsol"},"NFT Marketplace")])])]),u("div",{class:"copyright"},[u("span",null,"\xA9 Copyright 2022 jpool.one. All rights reserved. Powered by mFactory GmbH")])],-1),Ca={class:"col-12 col-md-6 social-col"},Aa={class:"social"},Sa={class:"theme"},Ma=u("div",{class:"social-link social-link-text"},[u("span",null,[x("official"),u("br"),x("channel")])],-1),ka=u("div",{class:"social-link telegram"},null,-1),xa=u("div",{class:"social-link twitter"},null,-1),Ea=u("div",{class:"social-link discord"},null,-1),$a=V({__name:"AppFooter",setup(t){const{toggle:e,isActive:n}=ba();return(o,s)=>(g(),b(tn,null,{default:l(()=>[u("div",_a,[u("div",va,[wa,u("div",Ca,[u("div",Aa,[u("div",Sa,[x(" Dark theme "),r(en,{"model-value":d(n),onClick:d(e)},null,8,["model-value","onClick"])]),Ma,ka,xa,Ea])])])])]),_:1}))}});function Ka(){const t=U(Da());return{userAgent:t,isMobileOs:v(()=>Pa(t.value)),isWebView:v(()=>Ia(t.value))}}let Ze;function Da(){var t,e;return Ze===void 0&&(Ze=(e=(t=globalThis.navigator)==null?void 0:t.userAgent)!=null?e:null),Ze}function Pa(t){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)}function Ia(t){return/(WebView|(Phantom|Solflare)|Version\/.+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+)|; wv\).+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+))/i.test(t)}function Ue(t,e=4){return t instanceof P&&(t=t.toBase58()),`${t.slice(0,e)}...${t.slice(-e)}`}const za="/sol-messenger/assets/clover.968404b0.svg",Ba="/sol-messenger/assets/ledger.40cf6861.svg",Ta="/sol-messenger/assets/mathwallet.1d763e81.svg",xt=t=>(Se("data-v-b79b08f0"),t=t(),Me(),t),Wa=xt(()=>u("div",{class:"text-h6 text-center"}," Your wallet ",-1)),La={class:"q-gutter-md row justify-between"},Na=xt(()=>u("div",{class:"text-h6"}," Connect to a wallet ",-1)),Ra={class:"text-light-gray text-caption full-width text-no-wrap",style:{"text-overflow":"ellipsis",overflow:"hidden"}},Va=["src","alt"],Fa=V({__name:"ConnectWallet",setup(t){const e={priority:{solflare:10,phantom:20,sollet:5,nufi:5,blocto:1},icons:{clover:za},darkIcons:{ledger:Ba,mathwallet:Ta},deepLinks:{phantom:"https://phantom.app/ul/browse/{uri}?ref={ref}",solflare:"https://solflare.com/ul/browse/{uri}?ref={ref}"}},{userAgent:n,isWebView:o,isMobileOs:s}=Ka(),a={close:vt},i=C=>[gt.Installed,gt.Loadable].includes(C.readyState);Ce();const c=me(),{connected:h,connecting:p}=c;nn();const k=v(()=>s.value&&!o.value);if(o.value){const C=String(n.value).toLowerCase();C.includes("phantom")?(c.select(an),c.connect()):C.includes("solflare")&&(c.select(sn),c.connect())}const _=v(()=>{var C,R;return(R=(C=c.publicKey.value)==null?void 0:C.toBase58())!=null?R:""}),T=v(()=>Ue(_.value)),L=v(()=>[...c.wallets.value].map(C=>{var K,G;const R=C.adapter.name.toLowerCase();return C.adapter.icon=(G=(K=e.darkIcons[R])!=null?K:e.icons[R])!=null?G:C.adapter.icon,k.value&&e.deepLinks[R]&&(C.deepLink=e.deepLinks[R].replace("{uri}",location.href).replace("{ref}",location.origin)),C}).sort((C,R)=>{var f,A;const K=(f=e.priority[C.adapter.name.toLowerCase()])!=null?f:1;return((A=e.priority[R.adapter.name.toLowerCase()])!=null?A:1)-K+((i(R)?1:0)-(i(C)?1:0))})),D=v(()=>k.value?L.value.filter(C=>!!C.deepLink):L.value),w=U(!1);async function y(C){await c.select(C.adapter.name),w.value=!1,await c.connect()}function S(){w.value=!1,c.disconnect()}function N(){w.value=!0}function I(){w.value=!1}return(C,R)=>(g(),W(ee,null,[d(h)?(g(),b(z,pt({key:0},C.$attrs,{class:C.$style.btn,ripple:!1,color:"primary-gray","text-color":"white",rounded:"",unelevated:"",onClick:N}),{default:l(()=>[x(B(d(T)),1)]),_:1},16,["class"])):(g(),b(z,pt({key:1},C.$attrs,{color:"primary-gray","text-color":"white",rounded:"",unelevated:"",ripple:!1,loading:d(p),onClick:N}),{default:l(()=>[x(" CONNECT WALLET ")]),_:1},16,["loading"])),r(Ae,{modelValue:w.value,"onUpdate:modelValue":R[0]||(R[0]=K=>w.value=K),"transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:l(()=>[d(h)?(g(),b(ne,{key:0},{default:l(()=>[r(J,{class:"relative-position"},{default:l(()=>[Wa,r(z,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:I},null,8,["icon"])]),_:1}),r(We),r(J,null,{default:l(()=>[x(B(d(_)),1)]),_:1}),r(We),r(J,null,{default:l(()=>[u("div",La,[r(z,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:S},{default:l(()=>[x(" Disconnect ")]),_:1}),r(z,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:I},{default:l(()=>[x(" Ok ")]),_:1})])]),_:1})]),_:1})):(g(),b(ne,{key:1,class:"wallet-connect-card"},{default:l(()=>[r(J,null,{default:l(()=>[Na,r(z,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:I},null,8,["icon"])]),_:1}),r(We),r(J,{style:{"max-height":"80vh"},class:"scroll"},{default:l(()=>[r(on,{grid:"",rows:d(D),"row-key":"name","hide-pagination":"","hide-header":"","rows-per-page-options":[100]},{item:l(({row:K})=>[(g(),W("div",{key:`wallet-${K.adapter.name}`,class:"col-12 col-md-6"},[r(Y,{clickable:"",href:K.deepLink,onClick:G=>K.deepLink?!0:y(K)},{default:l(()=>[r(q,null,{default:l(()=>[u("b",null,B(K.adapter.name),1),u("div",Ra,B(K.adapter.url),1)]),_:2},1024),r(q,{avatar:""},{default:l(()=>[r(rn,{square:""},{default:l(()=>[u("img",{src:K.adapter.icon,alt:K.adapter.name},null,8,Va)]),_:2},1024)]),_:2},1024)]),_:2},1032,["href","onClick"])]))]),_:1},8,["rows"])]),_:1})]),_:1}))]),_:1},8,["modelValue"])],64))}});const Oa="_btn_6n1iw_1",Ua={btn:Oa},F=(t,e)=>{const n=t.__vccOpts||t;for(const[o,s]of e)n[o]=s;return n},ja={$style:Ua},Qa=F(Fa,[["__cssModules",ja],["__scopeId","data-v-b79b08f0"]]),ve=[{id:"serum-mainnet",name:"Serum RPC",cluster:"mainnet-beta",url:"https://solana-api.projectserum.com/"},{id:"rpcpool-mainnet",name:"RPCPool RPC",cluster:"mainnet-beta",url:"https://mainnet.rpcpool.com/"},{id:"mainnet",name:"Solana RPC",cluster:"mainnet-beta",url:ln("mainnet-beta")}],Et={id:"devnet",name:"DevNet",cluster:"devnet",url:"https://devnet.rpcpool.com/"};ve.push(Et);const Ja={id:"testnet",name:"TestNet",cluster:"testnet",url:"https://testnet.rpcpool.com/"};ve.push(Ja);var _t;const qa=(_t=ve.find(t=>t.id==={VITE_BASE_PATH:"/sol-messenger/",VITE_USER_NODE_ENV:"production",BASE_URL:"/sol-messenger/",MODE:"staging",DEV:!1,PROD:!0}.VITE_CONNECTION_ENDPOINT))!=null?_t:Et,Ga="confirmed",Ha=12e4,Xa=["94ScvxCuJbVaS2YdaveHGijQ4vtHb6XCzT2ejXhwxiLB","o8vV9bLYBPwoWmS2meSXWyTLdwfhLhEzYsBkopWUNyY"],dt=lt({id:"connection",state:()=>({commitment:Ga,confirmTransactionInitialTimeout:Ha,rpc:cn("rpc","")}),getters:{endpoint(t){var e;return(e=ve.find(n=>n.id===t.rpc))!=null?e:qa},connection(t){return console.log("[connection]",this.endpoint.url),new un(this.endpoint.url,{confirmTransactionInitialTimeout:t.confirmTransactionInitialTimeout,commitment:t.commitment})},cluster(){return this.endpoint.cluster}},actions:{setRpc(t){this.rpc=t},setCommitment(t){this.commitment=t}}}),Za=V({__name:"ClusterSelector",setup(t){const e=dt(),{connected:n,connect:o,disconnect:s,autoConnect:a}=me(),i=[ve.filter(p=>p.cluster==="mainnet-beta"),ve.filter(p=>p.cluster!=="mainnet-beta")],c=v(()=>e.endpoint),h=p=>{n&&e.cluster!==p.cluster&&(s(),a.value&&o()),e.setRpc(p.id)};return(p,k)=>(g(),b(dn,{label:d(c).name,"model-value":!1,"auto-close":"",color:"secondary","text-color":"#000",rounded:"",unelevated:"",ripple:!1},{default:l(()=>[r(Ne,null,{default:l(()=>[(g(),W(ee,null,be(i,(_,T)=>(g(),W(ee,{key:`${T}-cluster-group`},[(g(!0),W(ee,null,be(_,L=>(g(),b(Y,{key:L.id,clickable:"",onClick:D=>h(L)},{default:l(()=>[(g(),b(q,{key:`${L.id}-item`},{default:l(()=>[r(nt,null,{default:l(()=>[u("b",null,B(L.name),1)]),_:2},1024),x(" "+B(L.url),1)]),_:2},1024))]),_:2},1032,["onClick"]))),128)),T!==i.length-1?(g(),b(We,{key:0})):de("",!0)],64))),64))]),_:1})]),_:1},8,["label"]))}}),Pe=lt("user",()=>{const t=wt(),e=U();mn(()=>{var s;const o=(s=t.value)==null?void 0:s.publicKey;if(o){const a=tt(o.toString(),()=>ze.encode(re.generate().secretKey));e.value=re.fromSecretKey(ze.decode(a.value))}else e.value=void 0});function n(){var a;const o=(a=t.value)==null?void 0:a.publicKey;if(!o)return;const s=tt(o.toString(),"");s.value=ze.encode(re.generate().secretKey),e.value=re.fromSecretKey(ze.decode(s.value))}return{keypair:e,generateKey:n}}),Ya={class:"container"},es={class:"app-header__info"},ts={class:"app-header__logo"},ns={class:"logo-wrapper"},as=u("div",{class:"app-header__title"},[u("h1",null,[x("BLOCKCHAIN messenger "),u("span",{class:"marked"},"SOLANA")])],-1),ss={class:"app-header__right"},os={class:"app-header__buttons"},is=V({__name:"AppHeader",setup(t){return Pe(),Ce(),(e,n)=>{const o=Re("router-link"),s=Za,a=Qa;return g(),b(hn,{class:"app-header"},{default:l(()=>[u("div",Ya,[r(ct,null,{default:l(()=>[u("div",es,[u("div",ts,[u("div",ns,[r(o,{to:"/"})])]),as]),r(ut),u("div",ss,[u("div",os,[r(s,{class:"app-header__cluster-btn header-btn"}),r(a,{class:"app-header__wallet-btn header-btn"})])])]),_:1})])]),_:1})}}});const rs={};function ls(t,e){const n=is,o=Re("router-view"),s=$a;return g(),b(pn,{view:"lfh Lpr lff"},{default:l(()=>[r(n),r(gn,null,{default:l(()=>[r(o)]),_:1}),r(s)]),_:1})}const cs=F(rs,[["render",ls]]),us={default:cs,empty:()=>Ct(()=>import("./empty.c5f82034.js"),["assets/empty.c5f82034.js","assets/vendor.748b087f.js"])};function ds(t){return t.map(e=>{var n;return{path:e.path,component:us[((n=e.meta)==null?void 0:n.layout)||"default"],children:[{...e,path:""}]}})}const ms="/sol-messenger/assets/solana-logo.3caace62.svg";const hs={},je=t=>(Se("data-v-5ffd3a8e"),t=t(),Me(),t),ps={class:"row info-row"},gs=je(()=>u("div",{class:"offset-0 offset-md-3"},null,-1)),fs=je(()=>u("div",{class:"col-6 col-md-3 flex-center info-col"},[u("div",{class:"info-title"}," How IT WORKS "),u("div",{class:"info-text"},[u("ul",null,[u("li",null,"Connect your wallet"),u("li",null,"Enter the amount of JPLT you want to swap or enter the amount of JPLU you want to get"),u("li",null,"Click SWAP button"),u("li",null,"Confirm the transaction in your wallet"),u("li",null,"Done")])])],-1)),ys={class:"col-6 col-md-5 logo-wrap"},bs=je(()=>u("img",{src:ms,alt:"solana logo"},null,-1)),_s=je(()=>u("div",{class:"offset-0 offset-md-1"},null,-1));function vs(t,e){const n=Re("router-link");return g(),W("div",ps,[gs,fs,u("div",ys,[r(n,{to:"/"},{default:l(()=>[bs]),_:1})]),_s])}const ws=F(hs,[["render",vs],["__scopeId","data-v-5ffd3a8e"]]),Cs=t=>(Se("data-v-b5d85bae"),t=t(),Me(),t),As=Cs(()=>u("div",{class:"text-h6"}," Device Key ",-1)),Ss=V({__name:"UserInfoDialog",emits:["regenerate"],setup(t){const e=Pe(),n=()=>{var o,s;bn(((s=(o=e.keypair)==null?void 0:o.publicKey)!=null?s:"").toString())};return(o,s)=>(g(),b(Ae,{class:"dialog-wrapper"},{default:l(()=>[r(ne,null,{default:l(()=>[r(J,{class:"row items-center q-pb-none"},{default:l(()=>[As,r(ut),Ee(r(z,{flat:"",round:"",dense:"",icon:d(vt)},null,8,["icon"]),[[$e]])]),_:1}),r(J,null,{default:l(()=>{var a;return[r(z,{flat:"",round:"",dense:"",icon:d(fn),onClick:n},{default:l(()=>[r(At,{delay:0,anchor:"bottom middle",self:"top middle","transition-duration":"0"},{default:l(()=>[x(" Copy to clipboard ")]),_:1})]),_:1},8,["icon"]),u("span",null,B((a=d(e).keypair)==null?void 0:a.publicKey),1)]}),_:1}),r(yn,{align:"right"},{default:l(()=>[r(z,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:d(e).generateKey},{default:l(()=>[x(" Regenerate ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}))}});const Ms=F(Ss,[["__scopeId","data-v-b5d85bae"]]),ks="0.0.6",xs="messenger",Es=[{name:"initChannel",accounts:[{name:"channel",isMut:!0,isSigner:!0},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"InitChannelData"}}]},{name:"deleteChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"joinChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"JoinChannelData"}}]},{name:"leaveChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"addMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"invitee",isMut:!1,isSigner:!1},{name:"inviteeMembership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AddMemberData"}}]},{name:"authorizeMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AuthorizeMemberData"}}]},{name:"deleteMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"postMessage",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!1,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"message",type:"string"}]}],$s=[{name:"Channel",type:{kind:"struct",fields:[{name:"name",docs:["Name of the channel"],type:"string"},{name:"creator",docs:["Channel creator"],type:"publicKey"},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"memberCount",docs:["Number of members"],type:"u16"},{name:"messageCount",docs:["Message counter"],type:"u32"},{name:"maxMessages",docs:["The maximum number of messages that are stored in [messages]"],type:"u16"},{name:"messages",docs:["List of messages"],type:{vec:{defined:"Message"}}}]}},{name:"ChannelMembership",type:{kind:"struct",fields:[{name:"channel",docs:["Associated [Channel] address"],type:"publicKey"},{name:"authority",docs:["Authority of membership"],type:"publicKey"},{name:"key",docs:["The device key used to encrypt the `CEK`"],type:"publicKey"},{name:"cek",docs:["The content encryption key (CEK) of the channel"],type:{defined:"CEKData"}},{name:"status",docs:["Status of membership"],type:{defined:"ChannelMembershipStatus"}},{name:"name",docs:["Name of the channel member"],type:"string"},{name:"invitedBy",docs:["Inviter address"],type:{option:"publicKey"}},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"bump",docs:["Bump seed for deriving PDA seeds"],type:"u8"}]}}],Ks=[{name:"AddMemberData",type:{kind:"struct",fields:[{name:"name",docs:["Member name"],type:"string"},{name:"cek",docs:["Content Encryption Key"],type:{defined:"CEKData"}},{name:"key",docs:["Device key"],type:{option:"publicKey"}}]}},{name:"AuthorizeMemberData",type:{kind:"struct",fields:[{name:"cek",type:{defined:"CEKData"}}]}},{name:"InitChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"maxMessages",type:"u16"},{name:"memberName",type:"string"},{name:"cek",type:{defined:"CEKData"}}]}},{name:"JoinChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"authority",type:{option:"publicKey"}}]}},{name:"CEKData",type:{kind:"struct",fields:[{name:"header",docs:["The header information for the CEK"],type:"string"},{name:"encryptedKey",docs:["The CEK itself"],type:"string"}]}},{name:"Message",type:{kind:"struct",fields:[{name:"id",docs:["Uniq message id"],type:"u32"},{name:"sender",docs:["The message sender id"],type:"publicKey"},{name:"createdAt",docs:["The unix timestamp at which the message was received"],type:"i64"},{name:"content",docs:["The (typically encrypted) message content"],type:"string"}]}},{name:"ChannelMembershipStatus",type:{kind:"enum",variants:[{name:"Authorized",fields:[{name:"by",type:{option:"publicKey"}}]},{name:"Pending",fields:[{name:"authority",type:{option:"publicKey"}}]}]}}],Ds=[{name:"NewChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"NewMessageEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"message",type:{defined:"Message"},index:!1}]},{name:"JoinChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"LeaveChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"authority",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AddMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AuthorizeMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]}],Ps=[{code:6e3,name:"Unauthorized",msg:"Unauthorized"},{code:6001,name:"NameTooLong",msg:"Name too long"},{code:6002,name:"MessageTooLong",msg:"Message too long"},{code:6003,name:"AlreadyInUse",msg:"Already in use"},{code:6004,name:"UninitializedAccount",msg:"Uninitialized account"}],Is={address:"6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",origin:"anchor",binaryVersion:"0.25.0",libVersion:"0.25.0"},zs={version:ks,name:xs,instructions:Es,accounts:$s,types:Ks,events:Ds,errors:Ps,metadata:Is},Bs=new m.FixableBeetArgsStruct([["id",m.u32],["sender",Z],["createdAt",m.i64],["content",m.utf8String]],"Message"),st=[49,159,99,106,220,87,219,88];class X{constructor(e,n,o,s,a,i,c){this.name=e,this.creator=n,this.createdAt=o,this.memberCount=s,this.messageCount=a,this.maxMessages=i,this.messages=c}static fromArgs(e){return new X(e.name,e.creator,e.createdAt,e.memberCount,e.messageCount,e.maxMessages,e.messages)}static fromAccountInfo(e,n=0){return X.deserialize(e.data,n)}static async fromAccountAddress(e,n,o){const s=await e.getAccountInfo(n,o);if(s==null)throw new Error(`Unable to find Channel account at ${n}`);return X.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return St.fromStruct(e,Be)}static deserialize(e,n=0){return Be.deserialize(e,n)}serialize(){return Be.serialize({accountDiscriminator:st,...this})}static byteSize(e){const n=X.fromArgs(e);return Be.toFixedFromValue({accountDiscriminator:st,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,o){return n.getMinimumBalanceForRentExemption(X.byteSize(e),o)}pretty(){return{name:this.name,creator:this.creator.toBase58(),createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),memberCount:this.memberCount,messageCount:this.messageCount,maxMessages:this.maxMessages,messages:this.messages}}}const Be=new m.FixableBeetStruct([["accountDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["name",m.utf8String],["creator",Z],["createdAt",m.i64],["memberCount",m.u16],["messageCount",m.u32],["maxMessages",m.u16],["messages",m.array(Bs)]],X.fromArgs,"Channel"),Qe=new m.FixableBeetArgsStruct([["header",m.utf8String],["encryptedKey",m.utf8String]],"CEKData"),Ts=t=>t.__kind==="Pending",Ws=m.dataEnum([["Authorized",new m.FixableBeetArgsStruct([["by",m.coption(Z)]],'ChannelMembershipStatusRecord["Authorized"]')],["Pending",new m.FixableBeetArgsStruct([["authority",m.coption(Z)]],'ChannelMembershipStatusRecord["Pending"]')]]),Le=[238,149,255,251,116,131,86,170];class j{constructor(e,n,o,s,a,i,c,h,p){this.channel=e,this.authority=n,this.key=o,this.cek=s,this.status=a,this.name=i,this.invitedBy=c,this.createdAt=h,this.bump=p}static fromArgs(e){return new j(e.channel,e.authority,e.key,e.cek,e.status,e.name,e.invitedBy,e.createdAt,e.bump)}static fromAccountInfo(e,n=0){return j.deserialize(e.data,n)}static async fromAccountAddress(e,n,o){const s=await e.getAccountInfo(n,o);if(s==null)throw new Error(`Unable to find ChannelMembership account at ${n}`);return j.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return St.fromStruct(e,Te)}static deserialize(e,n=0){return Te.deserialize(e,n)}serialize(){return Te.serialize({accountDiscriminator:Le,...this})}static byteSize(e){const n=j.fromArgs(e);return Te.toFixedFromValue({accountDiscriminator:Le,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,o){return n.getMinimumBalanceForRentExemption(j.byteSize(e),o)}pretty(){return{channel:this.channel.toBase58(),authority:this.authority.toBase58(),key:this.key.toBase58(),cek:this.cek,status:this.status.__kind,name:this.name,invitedBy:this.invitedBy,createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),bump:this.bump}}}const Te=new m.FixableBeetStruct([["accountDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["channel",Z],["authority",Z],["key",Z],["cek",Qe],["status",Ws],["name",m.utf8String],["invitedBy",m.coption(Z)],["createdAt",m.i64],["bump",m.u8]],j.fromArgs,"ChannelMembership"),ke=new Map,xe=new Map;class Je extends Error{constructor(){super("Unauthorized");O(this,"code",6e3);O(this,"name","Unauthorized");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Je)}}ke.set(6e3,()=>new Je);xe.set("Unauthorized",()=>new Je);class qe extends Error{constructor(){super("Name too long");O(this,"code",6001);O(this,"name","NameTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,qe)}}ke.set(6001,()=>new qe);xe.set("NameTooLong",()=>new qe);class Ge extends Error{constructor(){super("Message too long");O(this,"code",6002);O(this,"name","MessageTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ge)}}ke.set(6002,()=>new Ge);xe.set("MessageTooLong",()=>new Ge);class He extends Error{constructor(){super("Already in use");O(this,"code",6003);O(this,"name","AlreadyInUse");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,He)}}ke.set(6003,()=>new He);xe.set("AlreadyInUse",()=>new He);class Xe extends Error{constructor(){super("Uninitialized account");O(this,"code",6004);O(this,"name","UninitializedAccount");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Xe)}}ke.set(6004,()=>new Xe);xe.set("UninitializedAccount",()=>new Xe);function ie(t){const e=ke.get(t);return e!=null?e():null}function fe(t){const e=xe.get(t);return e!=null?e():null}const Ls=new m.FixableBeetArgsStruct([["name",m.utf8String],["cek",Qe],["key",m.coption(Z)]],"AddMemberData"),Ns=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["data",Ls]],"AddMemberInstructionArgs"),Rs=[13,116,123,130,126,198,57,34];function Vs(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var i;const[o]=Ns.serialize({instructionDiscriminator:Rs,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.invitee,isWritable:!1,isSigner:!1},{pubkey:t.inviteeMembership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(i=t.systemProgram)!=null?i:le.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const c of t.anchorRemainingAccounts)s.push(c);return new ce({programId:n,keys:s,data:o})}const Fs=new m.FixableBeetArgsStruct([["cek",Qe]],"AuthorizeMemberData"),Os=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["data",Fs]],"AuthorizeMemberInstructionArgs"),Us=[194,123,189,175,86,225,93,128];function js(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var i;const[o]=Os.serialize({instructionDiscriminator:Us,...e}),s=[{pubkey:t.channel,isWritable:!1,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:t.authorityMembership,isWritable:!1,isSigner:!1},{pubkey:(i=t.systemProgram)!=null?i:le.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const c of t.anchorRemainingAccounts)s.push(c);return new ce({programId:n,keys:s,data:o})}const Qs=new m.BeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)]],"DeleteChannelInstructionArgs"),Js=[145,225,187,221,157,142,114,133];function qs(t,e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=Qs.serialize({instructionDiscriminator:Js}),o=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:le.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const i of t.anchorRemainingAccounts)o.push(i);return new ce({programId:e,keys:o,data:n})}const Gs=new m.BeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)]],"DeleteMemberInstructionArgs"),Hs=[95,14,98,112,252,218,205,173];function Xs(t,e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=Gs.serialize({instructionDiscriminator:Hs}),o=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:le.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const i of t.anchorRemainingAccounts)o.push(i);return new ce({programId:e,keys:o,data:n})}const Zs=new m.FixableBeetArgsStruct([["name",m.utf8String],["maxMessages",m.u16],["memberName",m.utf8String],["cek",Qe]],"InitChannelData"),Ys=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["data",Zs]],"InitChannelInstructionArgs"),eo=[21,200,152,39,19,178,76,47];function to(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var i;const[o]=Ys.serialize({instructionDiscriminator:eo,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!0},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(i=t.systemProgram)!=null?i:le.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const c of t.anchorRemainingAccounts)s.push(c);return new ce({programId:n,keys:s,data:o})}const no=new m.FixableBeetArgsStruct([["name",m.utf8String],["authority",m.coption(Z)]],"JoinChannelData"),ao=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["data",no]],"JoinChannelInstructionArgs"),so=[124,39,115,89,217,26,38,29];function oo(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var i;const[o]=ao.serialize({instructionDiscriminator:so,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(i=t.systemProgram)!=null?i:le.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const c of t.anchorRemainingAccounts)s.push(c);return new ce({programId:n,keys:s,data:o})}const io=new m.BeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)]],"LeaveChannelInstructionArgs"),ro=[104,0,75,134,95,80,68,186];function lo(t,e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=io.serialize({instructionDiscriminator:ro}),o=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:le.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const i of t.anchorRemainingAccounts)o.push(i);return new ce({programId:e,keys:o,data:n})}const co=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["message",m.utf8String]],"PostMessageInstructionArgs"),uo=[214,50,100,209,38,34,7,76];function mo(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var i;const[o]=co.serialize({instructionDiscriminator:uo,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:(i=t.systemProgram)!=null?i:le.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const c of t.anchorRemainingAccounts)s.push(c);return new ce({programId:n,keys:s,data:o})}const ho="6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",po=new P(ho);function ot(t,e=new Uint8Array(4)){const n=Ke(t.toString(),"base10");return e.set(n,4-n.length),e}const Ye=t=>_e([ot(t.length),t]);function $t(t,e,n){if(e!==256)throw new Error(`Unsupported key length: ${e}`);const o=_e([Ye(Ke(n)),Ye(new Uint8Array(0)),Ye(new Uint8Array(0)),ot(e)]),s=1;return _n.hash(_e([ot(s),t,o]))}const it=t=>Ke(t,"base64pad"),rt=t=>Mt(t,"base64pad"),go=t=>Ke(t),fo=t=>Mt(t),yo=t=>Ke(t,"base58btc"),ue=Ve.NONCE_LENGTH,we=Ve.TAG_LENGTH,Kt=t=>{const e=new Ve.XChaCha20Poly1305(t);return(n,o)=>{const s=kt.randomBytes(ue),a=e.seal(s,n,o);return{ciphertext:a.subarray(0,a.length-we),tag:a.subarray(a.length-we),iv:s}}},Dt=t=>{const e=new Ve.XChaCha20Poly1305(t);return(n,o,s,a)=>e.open(s,_e([n,o]),a)},Pt="ECDH-ES+XC20PKW",It=256,bo=t=>e=>{const n=at.generateKeyPair(),o=at.sharedKey(n.secretKey,t),s=$t(o,It,Pt),a=Kt(s)(e);return{encryptedKey:a.ciphertext,tag:a.tag,iv:a.iv,epPubKey:n.publicKey}},_o=t=>(e,n,o,s)=>{const a=at.sharedKey(t,s),i=$t(a,It,Pt);return Dt(i)(e,n,o)},vo=t=>{if(Array.isArray(t))return re.fromSecretKey(ft.Buffer.from(t));if(typeof t=="string")return re.fromSecretKey(yo(t));if(t instanceof ft.Buffer||t instanceof Uint8Array)return re.fromSecretKey(t);throw new Error("Incompatible private key format")},wo=async(t=32)=>{const e=kt.randomBytes(t);return Promise.resolve(e)},Co=async(t,e)=>{const n=await bo(vn(e.toBytes()))(t);return{header:rt(_e([n.iv,n.tag,n.epPubKey])),encryptedKey:rt(n.encryptedKey)}},Ao=async(t,e)=>{const n=it(t.header),o=n.subarray(0,ue),s=n.subarray(ue,ue+we),a=n.subarray(ue+we),i=it(t.encryptedKey),c=vo(e).secretKey,h=wn(c),p=await _o(h)(i,s,o,a);if(p===null)throw new Error("There was a problem decrypting the CEK");return p},So=async(t,e)=>{const n=await Kt(e)(go(t));return rt(_e([n.iv,n.ciphertext,n.tag]))},Mo=async(t,e)=>{const n=it(t),o=n.subarray(0,ue),s=n.subarray(ue,-we),a=n.subarray(-we),i=await Dt(e)(s,a,o);if(i===null)throw new Error("There was an error decoding the message!");return fo(i)};class ko{constructor(e,n){O(this,"programId",po);O(this,"_coder");O(this,"_events");this.provider=e,this.keypair=n,this._coder=new Cn(zs),this._events=new An(this.programId,e,this._coder)}get connection(){return this.provider.connection}addEventListener(e,n){return this._events.addEventListener(e,n)}async removeEventListener(e){return await this._events.removeEventListener(e)}setKeypair(e){this.keypair=e}async loadAllChannels(){return(await X.gpaBuilder().addFilter("accountDiscriminator",st).run(this.provider.connection)).map(n=>({pubkey:n.pubkey,data:X.fromAccountInfo(n.account)[0]}))}async loadChannel(e,n){return X.fromAccountAddress(this.provider.connection,e,n)}async loadMyChannels(){const e=await this.loadMemberships();return console.log(e),[]}async loadChannelMembers(e){return(await j.gpaBuilder().addFilter("accountDiscriminator",Le).addFilter("channel",e).run(this.provider.connection)).map(o=>({pubkey:o.pubkey,data:j.fromAccountInfo(o.account)[0]}))}async loadMemberships(e){const n=j.gpaBuilder().addFilter("accountDiscriminator",Le).addFilter("authority",this.provider.publicKey);return e&&n.addFilter("key",e!=null?e:null),(await n.run(this.provider.connection)).map(s=>({pubkey:s.pubkey,data:j.fromAccountInfo(s.account)}))}async loadMembership(e,n){return j.fromAccountAddress(this.provider.connection,e,n)}async getMembershipPDA(e,n){return n=n!=null?n:this.keypair.publicKey,await P.findProgramAddress([e.toBuffer(),n.toBuffer()],this.programId)}async encryptCEK(e,n){return Co(e,n!=null?n:this.keypair.publicKey)}async decryptCEK(e,n){return Ao(e,n!=null?n:this.keypair.secretKey)}async encryptMessage(e,n){return So(e,n)}async decryptMessage(e,n){return Mo(e,n)}async initChannel(e){var p,k,_;const n=(p=e.channel)!=null?p:re.generate(),o=await wo(),s=await this.encryptCEK(o),[a]=await this.getMembershipPDA(n.publicKey),i=this.provider.publicKey,c=new oe;c.add(to({key:this.keypair.publicKey,channel:n.publicKey,membership:a,authority:i},{data:{name:e.name,memberName:(k=e.memberName)!=null?k:"",maxMessages:e.maxMessages,cek:s}}));let h;try{h=await this.provider.sendAndConfirm(c,[n,this.keypair],e.opts)}catch(T){throw(_=ie(T.code))!=null?_:T}return{signature:h,channel:n,cek:o,cekEncrypted:s}}async deleteChannel({channel:e,opts:n}){var i;const o=new oe,s=this.provider.publicKey;o.add(qs({channel:e,authority:s}));let a;try{a=await this.provider.sendAndConfirm(o,void 0,n)}catch(c){throw(i=ie(c.code))!=null?i:fe("Unauthorized")}return{signature:a}}async joinChannel(e){var i,c;const[n]=await this.getMembershipPDA(e.channel),o=this.provider.publicKey,s=new oe;s.add(oo({channel:e.channel,key:this.keypair.publicKey,membership:n,authority:o},{data:{name:e.name,authority:(i=e.authority)!=null?i:null}}));let a;try{a=await this.provider.sendAndConfirm(s,[this.keypair],e.opts)}catch(h){throw(c=ie(h.code))!=null?c:h}return{signature:a}}async leaveChannel(e){var i;const[n]=await this.getMembershipPDA(e.channel),o=this.provider.publicKey,s=new oe;s.add(lo({channel:e.channel,membership:n,authority:o}));let a;try{a=await this.provider.sendAndConfirm(s)}catch(c){throw(i=ie(c.code))!=null?i:c}return{signature:a}}async addMember(e){var k,_,T;const n=(k=e.key)!=null?k:e.invitee,[o]=await this.getMembershipPDA(e.channel),[s]=await this.getMembershipPDA(e.channel,n),a=await this.loadMembership(o);if(!a.cek.encryptedKey)throw fe("Unauthorized");const i=await this.decryptCEK(a.cek),c=await this.encryptCEK(i,n),h=new oe;h.add(Vs({channel:e.channel,authority:this.provider.publicKey,invitee:e.invitee,authorityMembership:o,inviteeMembership:s},{data:{name:(_=e.name)!=null?_:"",cek:c,key:n}}));let p;try{p=await this.provider.sendAndConfirm(h)}catch(L){throw(T=ie(L.code))!=null?T:fe("Unauthorized")}return{signature:p}}async deleteMember(e){var i;const[n]=e.membership?[e.membership]:await this.getMembershipPDA(e.channel,e.key),o=this.provider.publicKey,s=new oe;s.add(Xs({channel:e.channel,membership:n,authority:o}));let a;try{a=await this.provider.sendAndConfirm(s)}catch(c){throw(i=ie(c.code))!=null?i:c}return{signature:a}}async authorizeMember(e){var p;const[n]=await this.getMembershipPDA(e.channel),[o]=await this.getMembershipPDA(e.channel,e.key),s=await this.loadMembership(n);if(!s.cek.encryptedKey)throw fe("Unauthorized");const a=await this.decryptCEK(s.cek),i=await this.encryptCEK(a,e.key),c=new oe;c.add(js({channel:e.channel,membership:o,authority:this.provider.publicKey,authorityMembership:n},{data:{cek:i}}));let h;try{h=await this.provider.sendAndConfirm(c)}catch(k){throw(p=ie(k.code))!=null?p:fe("Unauthorized")}return{signature:h}}async postMessage(e){var h;const[n]=await this.getMembershipPDA(e.channel),o=await this.loadMembership(n);if(!o.cek.header)throw fe("Unauthorized");const s=await this.decryptCEK(o.cek),a=await this.encryptMessage(e.message,s),i=new oe;i.add(mo({channel:e.channel,membership:n,authority:this.provider.publicKey},{message:a}));let c;try{c=await this.provider.sendAndConfirm(i)}catch(p){throw(h=ie(p.code))!=null?h:p}return{signature:c}}}const bt="***** *** *** *** *******",ae=lt("messenger",()=>{const t=dt(),e=Pe(),n=wt(),o=v(()=>e.keypair),s={allChannels:[],ownChannels:[],channel:void 0,channelAddr:void 0,channelMembershipAddr:void 0,channelMembership:void 0,channelMembers:[],channelMessages:[],channelLoading:!1,loading:!1,creating:!1,sending:!1},a=he({...s}),i=v(()=>{var f;return new ko(new yt(t.connection,(f=n.value)!=null?f:{publicKey:P.default},yt.defaultOptions()),e.keypair)});let c=[];ye(()=>t.cluster,()=>{k().then()},{immediate:!0}),ye(n,f=>{f||(_(),k().then())},{immediate:!0}),ye([o,()=>a.allChannels],()=>{h()},{immediate:!0});async function h(){var E;const A=(await i.value.loadMemberships((E=e.keypair)==null?void 0:E.publicKey)).map(H=>({pubkey:H.data[0].channel.toBase58(),status:H.data[0].status.__kind}));Xa.forEach(H=>{A.find(pe=>pe.pubkey===H)||A.push({pubkey:H,status:"Unauthorized"})}),a.ownChannels=A,console.log("myChannels ====== ",a.ownChannels)}async function p(){console.log("Register events...");for(const f of c)await i.value.removeEventListener(f);c.push(i.value.addEventListener("NewMessageEvent",async f=>{if(console.log("[Event] NewMessageEvent",f),`${f.channel}`!=`${a.channelAddr}`)return;let A=bt;const E=await y();E&&(A=await i.value.decryptMessage(f.message.content,E)),a.channelMessages.push({...f.message,content:A})})),c.push(i.value.addEventListener("AuthorizeMemberEvent",async f=>{console.log("[Event] AuthorizeMemberEvent",f),!(a.channelAddr&&`${f.channel}`!=`${a.channelAddr}`)&&(`${f.membership}`==`${a.channelMembershipAddr}`?w(a.channelAddr).then():N().then())})),c.push(i.value.addEventListener("JoinChannelEvent",async f=>{console.log("[Event] JoinChannelEvent",f),`${f.channel}`==`${a.channelAddr}`&&N().then()}))}async function k(){_(),c=[],a.loading=!0;const f=await i.value.loadAllChannels();await p(),a.allChannels=f,a.loading=!1,console.log(a)}function _(){Object.assign(a,s)}async function T(f,A=15){try{a.creating=!0;const{channel:E}=await i.value.initChannel({name:f,maxMessages:A,opts:{commitment:"confirmed"}});await w(E.publicKey),a.channel&&a.allChannels.push({pubkey:E.publicKey,data:a.channel})}finally{a.creating=!1}}async function L(f){const A=new P(f);await i.value.deleteChannel({channel:A,opts:{commitment:"confirmed"}}),await k()}async function D(f,A){const E=new P(f);await i.value.joinChannel({channel:E,name:A,opts:{commitment:"confirmed"}}),await w(f)}async function w(f){var A;a.channelLoading=!0,a.channelMessages=[],a.channelMembers=[],a.channelMembershipAddr=void 0,a.channelMembership=void 0,a.channelAddr=new P(f);try{if((A=n.value)!=null&&A.publicKey)try{const[E]=await i.value.getMembershipPDA(a.channelAddr);a.channelMembershipAddr=E,a.channelMembership=await i.value.loadMembership(E)}catch(E){console.log(E),a.channelMembershipAddr=void 0,a.channelMembership=void 0}await N(),await S()}catch(E){console.log("Error",E)}finally{a.channelLoading=!1}}async function y(){if(!!a.channelMembership)try{return await i.value.decryptCEK(a.channelMembership.cek)}catch(f){console.log(f)}}async function S(){if(!a.channelAddr){console.log("Invalid channel");return}a.channel=await i.value.loadChannel(a.channelAddr);const f=await y();a.channelMessages=await Promise.all(a.channel.messages.map(async A=>{var pe;let E=bt,H=Ue(A.sender);if((pe=n.value)!=null&&pe.publicKey){const se=a.channelMembers.find(({data:ge})=>ge.name!==""&&(`${ge.authority}`==`${A.sender}`||`${ge.key}`==`${A.sender}`));se&&se.data.name!==""&&(H=se.data.name)}if(f)try{E=await i.value.decryptMessage(A.content,f)}catch{console.log(`Failed to decrypt message #${A.id}`)}return{...A,senderFormatted:H,content:E}}))}async function N(){if(!a.channelAddr){console.error("Invalid channel");return}a.channelMembers=await i.value.loadChannelMembers(a.channelAddr)}async function I(f){if(!a.channelAddr){console.log("Please select a channel");return}try{a.sending=!0,await i.value.postMessage({channel:a.channelAddr,message:f}),await S()}finally{a.sending=!1}}async function C(f,A,E){if(!a.channelAddr){console.log("Invalid channel");return}await i.value.addMember({channel:a.channelAddr,invitee:new P(f),key:A?new P(A):void 0,name:E})}async function R(f){if(!a.channelAddr){console.log("Invalid channel");return}await i.value.deleteMember({channel:a.channelAddr,key:new P(f)})}async function K(f){if(!a.channelAddr){console.log("Invalid channel");return}await i.value.authorizeMember({channel:a.channelAddr,key:new P(f)}),await S()}async function G(){await k()}return{state:a,client:i.value,loadChannel:w,joinChannel:D,createChannel:T,deleteChannel:L,postMessage:I,addMember:C,deleteMember:R,authorizeMember:K,refreshList:G}}),xo=V({__name:"MemberListDialog",props:{membersDialog:{type:Boolean,default:!1},isAuthorizedMember:{type:Boolean,default:!1},authorizeMemberState:{type:Object},deleteMemberState:{type:Object},wallet:{type:Object}},emits:["submit","deleteMember"],setup(t,{emit:e}){const{state:n}=ae(),o=Pe(),s=v(()=>{var p;return((p=n.channelMembership)==null?void 0:p.status.__kind)==="Authorized"}),a=v(()=>s.value),i=p=>v(()=>{var k;return a.value&&String(p.key)!==String((k=o.keypair)==null?void 0:k.publicKey)}).value;function c(p){return(p==null?void 0:p.name)&&p.name!==""?p.name:Ue(p.authority)}function h(p){return(p==null?void 0:p.__kind)==="Authorized"?"positive":"grey"}return(p,k)=>(g(),b(Ae,null,{default:l(()=>[r(ne,null,{default:l(()=>[r(J,null,{default:l(()=>[r(Ne,{separator:""},{default:l(()=>[(g(!0),W(ee,null,be(d(n).channelMembers,_=>(g(),b(Y,{key:_.pubkey.toString(),"active-class":"bg-teal-1",active:`${_.pubkey}`==`${d(n).channelMembershipAddr}`},{default:l(()=>[r(q,null,{default:l(()=>[r(nt,null,{default:l(()=>[x(B(c(_.data))+" ",1),r(Sn,{color:h(_.data.status)},{default:l(()=>[x(B(_.data.status.__kind),1)]),_:2},1032,["color"])]),_:2},1024),r(nt,{caption:"",lines:"2"},{default:l(()=>[u("div",null,"Authority: "+B(_.data.authority),1),u("div",null,"Key: "+B(_.data.key),1)]),_:2},1024)]),_:2},1024),r(q,{side:"",class:"q-gutter-sm"},{default:l(()=>[_.data.status.__kind==="Pending"&&d(s)&&(!_.data.status.authority||String(_.data.status.authority)===String(t.wallet.publicKey.value))?(g(),b(z,{key:0,color:"teal",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:t.authorizeMemberState.loading,disabled:t.authorizeMemberState.loading,onClick:T=>p.$emit("submit",_.data.key)},{default:l(()=>[x(" Authorize ")]),_:2},1032,["loading","disabled","onClick"])):de("",!0),i(_.data)?(g(),b(z,{key:1,color:"negative",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:t.deleteMemberState.loading,disabled:t.deleteMemberState.loading,onClick:T=>p.$emit("deleteMember",_.data.key)},{default:l(()=>[x(" Delete ")]),_:2},1032,["loading","disabled","onClick"])):de("",!0)]),_:2},1024)]),_:2},1032,["active"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}}),Eo=t=>(Se("data-v-058651c4"),t=t(),Me(),t),$o=Eo(()=>u("br",null,null,-1)),Ko=V({__name:"JoinChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t,{emit:e}){const o=U(t.defaultState);return(s,a)=>(g(),b(Ae,{class:"join-channel-dialog",onHide:a[3]||(a[3]=i=>s.$emit("reset"))},{default:l(()=>[r(ne,null,{default:l(()=>[r(J,null,{default:l(()=>[r(Fe,{class:"join-channel-form",onSubmit:a[2]||(a[2]=Oe(i=>s.$emit("submit",o.value),["prevent"]))},{default:l(()=>[r(te,{modelValue:o.value.name,"onUpdate:modelValue":a[0]||(a[0]=i=>o.value.name=i),placeholder:"Member name *","lazy-rules":"",rules:[i=>i&&i.length>2||"Please type something"]},null,8,["modelValue","rules"]),r(te,{modelValue:o.value.authority,"onUpdate:modelValue":a[1]||(a[1]=i=>o.value.authority=i),placeholder:"Authorize By","lazy-rules":"",rules:[i=>!i||i&&i.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),$o,r(z,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:l(()=>[x(" Join Channel ")]),_:1})]),_:1}),r(De,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Do=F(Ko,[["__scopeId","data-v-058651c4"]]),Po=t=>(Se("data-v-a5f1d45d"),t=t(),Me(),t),Io=Po(()=>u("br",null,null,-1)),zo=V({__name:"AddMemberDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=U(t.defaultState);return(o,s)=>(g(),b(Ae,{class:"add-member-dialog",onHide:s[4]||(s[4]=a=>o.$emit("reset"))},{default:l(()=>[r(ne,null,{default:l(()=>[r(J,null,{default:l(()=>[r(Fe,{class:"add-member-form",onSubmit:s[3]||(s[3]=Oe(a=>o.$emit("submit",n.value),["prevent"]))},{default:l(()=>[r(te,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.name=a),label:"Member name *",hint:"Min length 3 chars","lazy-rules":"",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),r(te,{modelValue:n.value.key,"onUpdate:modelValue":s[1]||(s[1]=a=>n.value.key=a),label:"Member Wallet *","lazy-rules":"",rules:[a=>a&&a.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),r(te,{modelValue:n.value.key,"onUpdate:modelValue":s[2]||(s[2]=a=>n.value.key=a),label:"Member Device Key",hint:"Default: The same as member wallet","lazy-rules":"",rules:[a=>!a||a.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),Io,r(z,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:l(()=>[x(" Add Member ")]),_:1})]),_:1}),r(De,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Bo=F(zo,[["__scopeId","data-v-a5f1d45d"]]),To=V({__name:"NewChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=U(t.defaultState);return(o,s)=>(g(),b(Ae,{class:"new-channel-dialog",onHide:s[3]||(s[3]=a=>o.$emit("reset"))},{default:l(()=>[r(ne,null,{default:l(()=>[r(J,null,{default:l(()=>[r(Fe,{class:"messenger-new-channel-form",onSubmit:s[2]||(s[2]=Oe(a=>o.$emit("submit",n.value),["prevent"]))},{default:l(()=>[r(te,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.name=a),label:"Channel name *","lazy-rules":"",maxlength:"32",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),r(te,{modelValue:n.value.maxMessages,"onUpdate:modelValue":s[1]||(s[1]=a=>n.value.maxMessages=a),label:"Max messages","lazy-rules":"",rules:[a=>+a>0||"Invalid value"]},null,8,["modelValue","rules"]),r(z,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:l(()=>[x(" Create Channel ")]),_:1})]),_:1}),r(De,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Wo=F(To,[["__scopeId","data-v-d329d80c"]]),Lo=V({__name:"ChannelForm",props:{message:{type:String,default:""},disabled:{type:Boolean,default:!1},sending:{type:Boolean,default:!1}},emits:["submit"],setup(t,{emit:e}){const o=U(t.message),s=()=>{e("submit",o),o.value=""};return(a,i)=>(g(),b(Fe,{class:"channel-form",onSubmit:Oe(s,["prevent"])},{default:l(()=>[r(ct,{class:"row message-control"},{default:l(()=>[r(te,{ref:"inputFocus",modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=c=>o.value=c),class:"col-grow message-input","bg-color":"white",placeholder:"Type a message",dense:"",borderless:"",autofocus:"",disable:t.disabled},null,8,["modelValue","disable"]),r(z,{class:"send-btn",square:"",flat:"",type:"submit",disable:t.disabled,loading:t.sending},{default:l(()=>[x(" Send ")]),_:1},8,["disable","loading"])]),_:1})]),_:1},8,["onSubmit"]))}});const No=F(Lo,[["__scopeId","data-v-23f62c62"]]),Ro={key:0,class:"row justify-center channel-wrapper"},Vo={key:1,class:"messenger-empty"},Fo={key:1,class:"messenger-empty"},Oo=V({__name:"ChannelWrapper",props:{channel:{type:Object},messages:{type:Array},postMessageState:{type:Object},isSomeoneMessage:{type:Function,default:()=>!1},allowSend:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},channelLoadingState:{type:Boolean,default:!1}},emits:["sendMessage"],setup(t,{emit:e}){const n=a=>e("sendMessage",a),o=U(),s=U();return ye(s,a=>{a&&(o.value.scrollTop=a.scrollHeight)}),(a,i)=>{const c=No;return g(),b(ne,{class:"messenger-card",square:""},{default:l(()=>[u("div",{ref_key:"chat",ref:o,class:"messenger-content"},[t.channel?(g(),W("div",Ro,[t.messages.length>0?(g(),W("div",{key:0,ref_key:"mes",ref:s,class:"messenger-messages"},[(g(!0),W(ee,null,be(t.messages,h=>(g(),b(Mn,{key:h.id,name:h.senderFormatted,text:h.text,sent:t.isSomeoneMessage(h.sender)},null,8,["name","text","sent"]))),128))],512)):(g(),W("div",Vo," No messages "))])):(g(),W("div",Fo," Please select a channel "))],512),r(c,{message:t.postMessageState.message,sending:t.loading,disabled:!t.allowSend,onSubmit:n},null,8,["message","sending","disabled"]),r(De,{showing:t.channelLoadingState},null,8,["showing"])]),_:1})}}});const Uo=F(Oo,[["__scopeId","data-v-ba7810c9"]]),jo=V({props:{text:{type:String,default:""}}});function Qo(t,e,n,o,s,a){return g(),b(At,{anchor:"top middle",self:"center middle",class:"bg-grey-9 text-body2"},{default:l(()=>[x(B(t.text),1)]),_:1})}const Jo=F(jo,[["render",Qo]]),qo="/sol-messenger/assets/refresh.e0cf4262.svg",Go="/sol-messenger/assets/add.1481b8ed.svg",Ho="/sol-messenger/assets/join.627c8616.svg",mt=t=>(Se("data-v-18f1740e"),t=t(),Me(),t),Xo=mt(()=>u("img",{src:qo,alt:"refresh",title:"create channel"},null,-1)),Zo=mt(()=>u("img",{src:Go,alt:"create"},null,-1)),Yo=mt(()=>u("img",{src:Ho,alt:"join"},null,-1)),ei=V({__name:"ChannelControl",props:{isPendingMember:{type:Boolean,default:!1},canJoinChannel:{type:Boolean,default:!1},isJoining:{type:Boolean,default:!1}},emits:["createChannel","joinChannel","refreshList"],setup(t){return(e,n)=>{const o=Jo;return g(),b(Y,null,{default:l(()=>[r(q,{class:"button-wrapper"},{default:l(()=>[r(z,{class:"control-button",square:"",onClick:n[0]||(n[0]=s=>e.$emit("refreshList"))},{default:l(()=>[Xo,r(o,{text:"Refresh list"})]),_:1}),r(z,{class:"control-button",square:"",onClick:n[1]||(n[1]=s=>e.$emit("createChannel"))},{default:l(()=>[Zo,r(o,{text:"Create a channel"})]),_:1}),t.canJoinChannel?(g(),b(z,{key:0,class:"control-button",square:"",loading:t.isJoining,disable:t.isPendingMember,onClick:n[2]||(n[2]=s=>e.$emit("joinChannel"))},{default:l(()=>[Yo,r(o,{text:"Join the channel"})]),_:1},8,["loading","disable"])):de("",!0)]),_:1})]),_:1})}}});const ti=F(ei,[["__scopeId","data-v-18f1740e"]]),ni={class:"chat-name"},ai={key:0,class:"message-count"},si=V({__name:"MessengerChannel",props:{channel:Object,state:Object},emits:["selectChannel"],setup(t,{emit:e}){const n=()=>e("selectChannel"),o=s=>{if(!s)return{background:"#000"};let a=0;for(let c=0;c<s.length;c++)a=s.charCodeAt(c)+((a<<5)-a),a=a&a;let i="#";for(let c=0;c<3;c++)i+=`00${(a>>c*8&255).toString(16)}`.substr(-2);return{background:i}};return(s,a)=>(g(),b(Y,{"active-class":"bg-blue-grey-1 text-grey-8",active:`${t.state.channelAddr}`==`${t.channel.pubkey}`},{default:l(()=>[r(q,{class:"chat-item cursor-pointer",onClick:n},{default:l(()=>[u("div",{class:"chat-badge",style:kn(o(`${t.channel.pubkey}`))},[u("span",null,B(t.channel.data.name.slice(0,2)),1)],4),u("div",ni,B(t.channel.data.name),1),t.channel.data.messageCount?(g(),W("div",ai,B(t.channel.data.messageCount),1)):de("",!0)]),_:1})]),_:1},8,["active"]))}});const oi=F(si,[["__scopeId","data-v-d6198a98"]]),ii=15;function zt(){const t=me(),{state:e,refreshList:n}=ae(),o=Pe(),s=v(()=>!!t.publicKey.value),a=v(()=>{var y;return((y=e.channelMembership)==null?void 0:y.status.__kind)==="Authorized"}),i=v(()=>{var y;return((y=e.channelMembership)==null?void 0:y.status.__kind)==="Pending"}),c=v(()=>{var y,S;return a.value&&((y=e.channel)==null?void 0:y.creator.toString())===String((S=t.publicKey.value)!=null?S:"-")}),h=v(()=>a.value&&!e.sending),p=v(()=>a.value),k=y=>v(()=>{var S;return c.value&&String(y.key)!==String((S=o.keypair)==null?void 0:S.publicKey)}).value,_=v(()=>s.value&&!e.loading&&!a.value),T=v(()=>e.channelMembers.filter(y=>Ts(y.data.status)).length),L=v(()=>{const y=[];let S=0,N;for(const I of e.channelMessages)N&&`${I.sender}`==`${N}`?y[S-1].text.push(I.content):(N=I.sender,y.push({id:I.id,sender:I.sender,senderFormatted:I.senderFormatted,text:[I.content],date:I.createdAt}),S++);return y}),D=v(()=>e.allChannels.filter(y=>!!e.ownChannels.find(S=>S.pubkey===y.pubkey.toBase58()))),w=v(()=>e.allChannels);return{isWalletConnected:s,isAuthorizedMember:a,isPendingMember:i,isChannelCreator:c,canJoinChannel:_,canDeleteMember:k,canAddMember:p,allowSend:h,pendingMemberCount:T,ownChannels:D,allChannels:w,messages:L,refreshList:n,loading:v(()=>e.loading)}}function ri(){const{createChannel:t}=ae(),{isWalletConnected:e,ok:n,error:o}=Ie(),s=he({dialog:!1,name:"",maxMessages:ii,loading:!1});async function a(){if(e())try{await t(s.name,s.maxMessages),i(),n("Channel was created!")}catch(c){o("Something went wrong"),console.log(c)}}function i(){s.dialog=!1,s.loading=!1,s.name="",s.maxMessages=15}return{state:s,submit:a,reset:i}}function li(){const{authorizeMember:t}=ae(),{ok:e,error:n}=Ie(),o=he({loading:!1,dialog:!1});async function s(a){try{o.loading=!0,await t(a),e("Member was authorized")}catch(i){n("Something went wrong"),console.log(i)}finally{o.loading=!1}}return{state:o,submit:s}}function ci(){const{state:t,addMember:e}=ae(),{ok:n,info:o,error:s}=Ie(),a=he({dialog:!1,loading:!1});async function i(h){if(a.loading=!0,!t.channelAddr){o("Please select a channel");return}try{return await e(h.authority,h.key,h.name),n("Member was added"),!0}catch(p){s("Something went wrong"),console.log(p)}finally{a.loading=!1}return!1}function c(){a.loading=!1,a.dialog=!1}return{state:a,submit:i,reset:c}}function ui(){const{deleteMember:t}=ae(),{ok:e,error:n}=Ie(),o=he({loading:!1});async function s(a){try{o.loading=!0,await t(a),e("Member was deleted")}catch(i){n("Something went wrong"),console.log(i)}finally{o.loading=!1}}return{state:o,submit:s}}function di(){const{state:t,joinChannel:e}=ae(),{ok:n,info:o,error:s}=Ie(),a=he({dialog:!1,loading:!1,name:""});async function i(){if(!t.channelAddr){o("Please select a channel");return}a.loading=!0;try{await e(t.channelAddr,a.name),c(),n("Request was sent")}catch(h){console.log("Error",h),s("Something went wrong")}finally{a.loading=!1}}function c(){a.loading=!1,a.dialog=!1,a.name=""}return{state:a,submit:i,reset:c}}function Ie(){const t=me(),{notify:e}=Ce(),n=i=>e({type:"positive",message:i,timeout:2e3}),o=i=>e({type:"info",message:i,timeout:2e3}),s=i=>e({type:"negative",message:i,timeout:2e3});function a(){return t.publicKey.value?!0:(o("Please connect wallet"),!1)}return{ok:n,info:o,error:s,isWalletConnected:a}}const mi={class:"panel-search"},hi={class:"search-wrapper"},pi={class:"panel-info"},gi={class:"chat-info"},fi={class:"chat-members"},yi={class:"chat-messages"},bi={class:"chat-name"},_i=V({__name:"MessengerToolbar",emits:["search","showMembers","deleteChannel","addMember","showDeviceKey"],setup(t,{emit:e}){const n=me(),{state:o}=ae(),{canAddMember:s,isChannelCreator:a}=zt(),i=v(()=>!!n.publicKey.value),c=U(""),h=v(()=>o.channel),p=v(()=>{var D,w,y;return((D=h.value)==null?void 0:D.memberCount)===null||((w=h.value)==null?void 0:w.memberCount)===void 0?"":`${(y=h.value)==null?void 0:y.memberCount}\xA0members`}),k=v(()=>{var D,w,y;return((D=h.value)==null?void 0:D.messageCount)===null||((w=h.value)==null?void 0:w.messageCount)===void 0?"":`${(y=h.value)==null?void 0:y.messageCount}\xA0messages`}),_=D=>e("search",D),T=()=>e("showMembers"),L=()=>e("addMember");return ye(c,D=>{_(String(D))}),(D,w)=>(g(),b(ct,{class:"panel-toolbar"},{default:l(()=>{var y;return[u("div",mi,[u("div",hi,[r(te,{modelValue:c.value,"onUpdate:modelValue":w[0]||(w[0]=S=>c.value=S),class:"search-input no-margin q-pa-none",placeholder:"Search ...",clearable:"",debounce:"300",borderless:"",onClear:w[1]||(w[1]=S=>c.value="")},null,8,["modelValue"])])]),u("div",pi,[u("div",gi,[u("div",fi,B(d(p)),1),u("div",yi,B(d(k)),1)]),r(ut,{class:""}),u("div",bi,B((y=d(h))==null?void 0:y.name),1),u("div",null,[r(z,{class:"chat-menu",flat:"",unelevated:"",disable:!d(i)},{default:l(()=>[r(xn,{name:d(En)},null,8,["name"]),r($n,{anchor:"bottom left",self:"top left"},{default:l(()=>[r(Ne,{style:{"min-width":"150px"},bordered:""},{default:l(()=>[Ee((g(),b(Y,{clickable:"",onClick:w[2]||(w[2]=S=>D.$emit("showDeviceKey"))},{default:l(()=>[r(q,null,{default:l(()=>[x("Device key")]),_:1})]),_:1})),[[$e]]),Ee((g(),b(Y,{clickable:"",disable:!d(h),onClick:T},{default:l(()=>[r(q,null,{default:l(()=>[x("Members")]),_:1})]),_:1},8,["disable"])),[[$e]]),Ee((g(),b(Y,{clickable:"",disable:!d(s),onClick:L},{default:l(()=>[r(q,null,{default:l(()=>[x("Add member")]),_:1})]),_:1},8,["disable"])),[[$e]]),Ee((g(),b(Y,{clickable:"",disable:!d(a),onClick:w[3]||(w[3]=S=>D.$emit("deleteChannel"))},{default:l(()=>[r(q,null,{default:l(()=>[x("Delete")]),_:1})]),_:1},8,["disable"])),[[$e]])]),_:1})]),_:1})]),_:1},8,["disable"])])])]}),_:1}))}});const vi=F(_i,[["__scopeId","data-v-37687674"]]),wi={class:"messenger-wrapper"},Ci={class:"messenger-main"},Ai={key:1,class:"messenger-channels-empty"},Si={key:0,class:"q-my-md q-px-lg"},Mi={class:"col col-4"},ki={class:"col"},xi={class:"no-margin"},Ei=V({__name:"Messenger",setup(t){Ce();const e=me(),{state:n,postMessage:o,loadChannel:s}=ae(),{isWalletConnected:a,isAuthorizedMember:i,isPendingMember:c,messages:h,allowSend:p,canJoinChannel:k,isChannelCreator:_,loading:T,refreshList:L,ownChannels:D,allChannels:w}=zt(),y=ri(),S=di(),N=ci(),I=li(),C=ui(),R=he({message:""}),K=U([]),G=U("");async function f(Q){await o(Q.value),R.message=""}async function A(Q){await s(Q)}function E(Q){const M=e.publicKey.value;return M?String(M)!==String(Q):!0}const H=Q=>{if(Q===""){K.value=[],G.value="";return}K.value=w.value.filter(M=>M.data.name.toLocaleLowerCase().includes(Q.toLocaleLowerCase())||M.pubkey.toBase58().toLocaleLowerCase().includes(Q.toLocaleLowerCase())),G.value=Q},pe=()=>{I.state.dialog=!0},se=U(!1),ge=U(!1),Bt=Kn(ge),ht=v(()=>K.value.length>0||G.value.length>0?K.value:D.value);return(Q,M)=>{const Tt=vi,Wt=oi,Lt=ti,Nt=Uo,Rt=Wo,Vt=Bo,Ft=Do,Ot=xo,Ut=Ms;return g(),W(ee,null,[u("div",wi,[r(Tt,{onSearch:H,onShowMembers:pe,onDeleteChannel:M[0]||(M[0]=$=>d(C).submit(d(n).channelAddr)),onAddMember:M[1]||(M[1]=$=>d(N).state.dialog=!0),onShowDeviceKey:M[2]||(M[2]=$=>se.value=!0)}),u("div",Ci,[r(ne,{class:"messenger-channels"},{default:l(()=>[d(ht).length>0?(g(),b(Ne,{key:0,separator:"",class:"channels-list"},{default:l(()=>[(g(!0),W(ee,null,be(d(ht),$=>(g(),b(Wt,{key:$.name,channel:$,state:d(n),onSelectChannel:Yi=>A($.pubkey)},null,8,["channel","state","onSelectChannel"]))),128))]),_:1})):(g(),W("div",Ai," No channels ")),r(De,{showing:d(n).loading,color:"primary"},null,8,["showing"]),r(Lt,{"can-join-channel":d(k),"is-authorized-member":d(i),"is-pending-member":d(c),"is-wallet-connected":d(a),onCreateChannel:M[3]||(M[3]=$=>d(y).state.dialog=!0),onJoinChannel:M[4]||(M[4]=$=>d(S).state.dialog=!0),onRefreshList:d(L)},null,8,["can-join-channel","is-authorized-member","is-pending-member","is-wallet-connected","onRefreshList"])]),_:1}),r(Nt,{channel:d(n).channel,"allow-send":d(p),"channel-loading-state":d(n).channelLoading,"is-someone-message":E,messages:d(h),"post-message-state":R,"sending-state":d(n).sending,onSendMessage:f},null,8,["channel","allow-send","channel-loading-state","messages","post-message-state","sending-state"])])]),r(Rt,{modelValue:d(y).state.dialog,"onUpdate:modelValue":M[5]||(M[5]=$=>d(y).state.dialog=$),loading:d(y).state.loading,"default-state":d(y).state,onSubmit:d(y).submit,onReset:d(y).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),r(Vt,{modelValue:d(N).state.dialog,"onUpdate:modelValue":M[6]||(M[6]=$=>d(N).state.dialog=$),loading:d(N).state.loading,"default-state":d(N).state,onSubmit:d(N).submit,onReset:d(N).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),r(Ft,{modelValue:d(S).state.dialog,"onUpdate:modelValue":M[7]||(M[7]=$=>d(S).state.dialog=$),loading:d(S).state.loading,"default-state":d(S).state,onSubmit:d(S).submit,onReset:d(S).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),r(Ot,{modelValue:d(I).state.dialog,"onUpdate:modelValue":M[8]||(M[8]=$=>d(I).state.dialog=$),"is-authorized-member":d(i),wallet:d(e),"authorize-member-state":d(I).state,"delete-member-state":d(C).state,onSubmit:d(I).submit,onDeleteMember:d(C).submit},null,8,["modelValue","is-authorized-member","wallet","authorize-member-state","delete-member-state","onSubmit","onDeleteMember"]),r(Ut,{modelValue:se.value,"onUpdate:modelValue":M[9]||(M[9]=$=>se.value=$)},null,8,["modelValue"]),d(n).channel?(g(),W("div",Si,[r(z,{flat:"",class:"text-blue-2",onClick:M[10]||(M[10]=$=>d(Bt)())},{default:l(()=>[x(" debug info ")]),_:1}),ge.value?(g(!0),W(ee,{key:0},be([["Authorized",d(i)],["Pending Access",d(c)],["Channel Creator",d(_)],["Channel",d(n).channel],["Membership",d(n).channelMembership],["Members",d(n).channelMembers]],$=>(g(),W("div",{key:$[0],class:"row q-mt-md"},[u("div",Mi,B($[0]),1),u("div",ki,[u("pre",xi,B($[1]),1)])]))),128)):de("",!0)])):de("",!0)],64)}}});const $i=F(Ei,[["__scopeId","data-v-e03ac2a8"]]);const Ki={},Di={class:"container"},Pi={class:"messenger-container"},Ii={class:"container"};function zi(t,e){const n=$i,o=ws;return g(),b(Dn,{class:"page-wrapper"},{default:l(()=>[u("div",Di,[u("div",Pi,[r(n)])]),u("div",Ii,[r(o)])]),_:1})}const Bi=F(Ki,[["render",zi],["__scopeId","data-v-8f1b09e0"]]),Ti=()=>Ct(()=>import("./_...all_.91a49218.js"),["assets/_...all_.91a49218.js","assets/vendor.748b087f.js","assets/_...all_.73169310.css"]),Wi=[{name:"index",path:"/",component:Bi,props:!0},{name:"all",path:"/:all(.*)*",component:Ti,props:!0,meta:{layout:"empty"}}],Li=ds(Wi),Ni="/sol-messenger/",Ri=Pn({history:In(Ni),scrollBehavior:()=>({left:0,top:0}),strict:!0,routes:Li}),Vi=({app:t})=>{t.use(Ri)},Fi=Object.freeze(Object.defineProperty({__proto__:null,install:Vi},Symbol.toStringTag,{value:"Module"})),Oi=({app:t})=>{t.use(zn,{wallets:[new Bn,new Tn,new Wn,new Ln,new Nn,new Rn,new Vn,new Fn,new On,new Un,new jn,new Qn,new Jn,new qn,new Gn,new Hn,new Xn,new Zn,new Yn,new ea,new ta,new na,new aa,new sa,new oa,new ia,new ra,new la,new ca,new ua],autoConnect:!1})},Ui=Object.freeze(Object.defineProperty({__proto__:null,install:Oi},Symbol.toStringTag,{value:"Module"})),ji=da();function Qi(){return ji}const Ji=Symbol("WALLET_CONNECT_EVENT"),qi=Symbol("WALLET_DISCONNECT_EVENT"),Gi=Symbol("ACCOUNT_CHANGE_EVENT"),et=5e3;function Hi(){const{connection:t}=dt(),{emit:e}=Qi(),{notify:n}=Ce(),{wallet:o}=me();ye(o,s=>{if(!s)return;const a=()=>{const h=s.adapter.publicKey;t.onAccountChange(h,p=>{e(Gi,p)}),t.onLogs(h,p=>{console.log(p)}),n({message:"Wallet update",caption:`Connected to wallet ${Ue(h.toBase58(),7)}`,timeout:et}),e(Ji,s)},i=()=>{n({message:"Wallet update",caption:"Disconnected from wallet",timeout:et}),e(qi,s)},c=h=>{!(h!=null&&h.message)||n({type:"negative",message:"Wallet update",caption:h.message,timeout:et})};s.adapter.once("connect",a),s.adapter.once("disconnect",i),s.adapter.removeAllListeners("error"),s.adapter.on("error",c)},{immediate:!0})}const Xi=V({__name:"App",setup(t){return ma(()=>{Hi()}),(e,n)=>{const o=Re("router-view");return g(),b(o)}}});async function Zi(){const t=ha(Xi);Object.values(Object.assign({"./plugins/pinia.ts":ga,"./plugins/quasar.ts":ya,"./plugins/router.ts":Fi,"./plugins/wallet.ts":Ui})).forEach(e=>{var n;return(n=e.install)==null?void 0:n.call(e,{app:t})}),t.mount("#app")}Zi().then();export{F as _};
