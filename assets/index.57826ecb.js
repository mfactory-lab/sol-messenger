var qt=Object.defineProperty;var Jt=(a,e,t)=>e in a?qt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var N=(a,e,t)=>(Jt(a,typeof e!="symbol"?e+"":e,t),t);import{c as Ht,Q as Xt,P as Zt,D as Yt,N as en,a as tn,i as nn,b as x,d as be,u as Pe,e as De,f as z,r as xe,g as ze,o as g,h as E,j as y,k as S,w as l,l as M,t as K,m as ot,n as P,p as o,q,s as O,v as Ce,x as A,y as an,z as Ee,A as le,B as sn,C as ge,F as Q,E as rn,W as lt,G as yt,H as gt,I as on,J as Ze,K as ln,L as cn,M as Qe,O as oe,R as fe,S as B,T as un,U as ft,V as dn,X as ct,Y as J,Z as Ae,_ as bt,$ as ut,a0 as Ge,a1 as mn,a2 as hn,a3 as pn,a4 as _t,a5 as u,a6 as F,a7 as wt,a8 as ne,a9 as ae,aa as _e,ab as At,ac as ce,ad as yn,ae as Ie,af as vt,ag as je,ah as gn,ai as fn,aj as dt,ak as bn,al as _n,am as Z,an as ee,ao as mt,ap as kt,aq as wn,ar as ye,as as An,at as vn,au as ve,av as ke,aw as j,ax as kn,ay as Mn,az as Sn,aA as Cn,aB as xn,aC as En,aD as Kn,aE as Pn,aF as Dn,aG as zn,aH as In,aI as Nn,aJ as Tn,aK as Bn,aL as Wn,aM as $n,aN as Rn,aO as Ln,aP as Vn,aQ as Fn,aR as Un,aS as On,aT as Qn,aU as Gn,aV as jn,aW as qn,aX as Jn,aY as Hn,aZ as Xn,a_ as Zn,a$ as Yn,b0 as ea,b1 as ta,b2 as na,b3 as aa,b4 as sa,b5 as ra}from"./vendor.5cac5ab3.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();const ia=({app:a})=>{const e=Ht();a.use(e)},oa=Object.freeze(Object.defineProperty({__proto__:null,install:ia},Symbol.toStringTag,{value:"Module"})),la=({app:a})=>{a.use(Xt,{plugins:{Dark:Zt,Dialog:Yt,Notify:en,LocalStorage:tn},iconSet:nn})},ca=Object.freeze(Object.defineProperty({__proto__:null,install:la},Symbol.toStringTag,{value:"Module"}));function Ne(a,e=4){return a instanceof x&&(a=a.toBase58()),`${a.slice(0,e)}...${a.slice(-e)}`}const ua="/sol-messenger/assets/ledger.40cf6861.svg",da="/sol-messenger/assets/mathwallet.1d763e81.svg",Mt=a=>(yt("data-v-0bdf22f0"),a=a(),gt(),a),ma=Mt(()=>A("div",{class:"text-h6 text-center"}," Your wallet ",-1)),ha={class:"q-gutter-md row justify-between"},pa=Mt(()=>A("div",{class:"text-h6"}," Connect to a wallet ",-1)),ya={class:"text-light-gray text-caption full-width text-no-wrap",style:{"text-overflow":"ellipsis",overflow:"hidden"}},ga=["src"],fa=be({__name:"ConnectWallet",setup(a){const e={solflare:10,phantom:20,sollet:5,nufi:5,blocto:1},t={ledger:ua,mathwallet:da},n={close:rn},s=_=>[lt.Installed,lt.Loadable].includes(_.readyState);Pe();const r=De(),{connected:c,connecting:p}=r,w=z(()=>{var _,v;return(v=(_=r.publicKey.value)==null?void 0:_.toBase58())!=null?v:""}),b=z(()=>Ne(w.value)),I=z(()=>[...r.wallets.value].map(_=>(_.darkIcon=t[_.name.toLowerCase()],_)).sort((_,v)=>{var f,k;const L=(f=e[_.name.toLowerCase()])!=null?f:1;return((k=e[v.name.toLowerCase()])!=null?k:1)-L+((s(v)?1:0)-(s(_)?1:0))})),C=xe(!1);async function T(_){await r.select(_.name),C.value=!1,await r.connect()}function D(){C.value=!1,r.disconnect()}function R(){C.value=!0}function H(){C.value=!1}return(_,v)=>{const L=ze("copy-to-clipboard");return g(),E(Q,null,[y(c)?(g(),S(P,ot({key:0},_.$attrs,{class:_.$style.btn,ripple:!1,color:"primary-gray","text-color":"white",rounded:"",unelevated:"",onClick:R}),{default:l(()=>[M(K(y(b)),1)]),_:1},16,["class"])):(g(),S(P,ot({key:1},_.$attrs,{color:"primary-gray","text-color":"white",rounded:"",unelevated:"",ripple:!1,loading:y(p),onClick:R}),{default:l(()=>[M(" CONNECT WALLET ")]),_:1},16,["loading"])),o(ge,{modelValue:C.value,"onUpdate:modelValue":v[0]||(v[0]=d=>C.value=d),"transition-duration":"100","transition-show":"fade","transition-hide":"fade"},{default:l(()=>[y(c)?(g(),S(q,{key:0},{default:l(()=>[o(O,{class:"relative-position"},{default:l(()=>[ma,o(P,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:n.close,size:"md",onClick:H},null,8,["icon"])]),_:1}),o(Ce),o(O,null,{default:l(()=>[o(L,{text:y(w)},null,8,["text"]),M(" "+K(y(w)),1)]),_:1}),o(Ce),o(O,null,{default:l(()=>[A("div",ha,[o(P,{outline:"",rounded:"",onClick:D},{default:l(()=>[M(" Disconnect ")]),_:1}),o(P,{outline:"",rounded:"",onClick:H},{default:l(()=>[M(" Ok ")]),_:1})])]),_:1})]),_:1})):(g(),S(q,{key:1,class:"wallet-connect-card"},{default:l(()=>[o(O,null,{default:l(()=>[pa,o(P,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:n.close,size:"md",onClick:H},null,8,["icon"])]),_:1}),o(Ce),o(O,{style:{"max-height":"80vh"},class:"scroll"},{default:l(()=>[o(an,{grid:"",rows:y(I),"row-key":"name","hide-pagination":"","hide-header":"","rows-per-page-options":[100]},{item:l(({row:d})=>[(g(),E("div",{key:`wallet-${d.name}`,class:"col-12 col-md-6"},[o(Ee,{clickable:"",disable:!s(d),onClick:f=>T(d)},{default:l(()=>[o(le,null,{default:l(()=>[A("b",null,K(d.name),1),A("div",ya,K(d.url),1)]),_:2},1024),o(le,{avatar:""},{default:l(()=>[o(sn,{square:""},{default:l(()=>{var f;return[A("img",{src:_.$q.dark.isActive?d.icon:(f=d.darkIcon)!=null?f:d.icon,alt:""},null,8,ga)]}),_:2},1024)]),_:2},1024)]),_:2},1032,["disable","onClick"])]))]),_:1},8,["rows"])]),_:1})]),_:1}))]),_:1},8,["modelValue"])],64)}}});const ba="_btn_6n1iw_1",_a={btn:ba},Te=(a,e)=>{const t=a.__vccOpts||a;for(const[n,s]of e)t[n]=s;return t},wa={$style:_a},Aa=Te(fa,[["__cssModules",wa],["__scopeId","data-v-0bdf22f0"]]),ue=[{id:"serum-mainnet",name:"Serum RPC",cluster:"mainnet-beta",url:"https://solana-api.projectserum.com/"},{id:"rpcpool-mainnet",name:"RPCPool RPC",cluster:"mainnet-beta",url:"https://mainnet.rpcpool.com/"},{id:"mainnet",name:"Solana RPC",cluster:"mainnet-beta",url:on("mainnet-beta")}],St={id:"devnet",name:"DevNet",cluster:"devnet",url:"https://devnet.rpcpool.com/"};ue.push(St);const va={id:"testnet",name:"TestNet",cluster:"testnet",url:"https://testnet.rpcpool.com/"};ue.push(va);var pt;const ka=(pt=ue.find(a=>a.id==={VITE_BASE_PATH:"/sol-messenger/",BASE_URL:"/sol-messenger/",MODE:"staging",DEV:!1,PROD:!0}.VITE_CONNECTION_ENDPOINT))!=null?pt:St,Ma="confirmed",Sa=12e4,Ye=Ze({id:"connection",state:()=>({commitment:Ma,confirmTransactionInitialTimeout:Sa,rpc:ln("rpc","")}),getters:{endpoint(a){var e;return(e=ue.find(t=>t.id===a.rpc))!=null?e:ka},connection(a){return console.log("[connection]",this.endpoint.url),new cn(this.endpoint.url,{confirmTransactionInitialTimeout:a.confirmTransactionInitialTimeout,commitment:a.commitment})},cluster(){return this.endpoint.cluster}},actions:{setRpc(a){this.rpc=a},setCommitment(a){this.commitment=a}}}),Ca=be({__name:"ClusterSelector",setup(a){const e=Ye(),{connected:t,connect:n,disconnect:s,autoConnect:r}=De(),c=[ue.filter(b=>b.cluster==="mainnet-beta"),ue.filter(b=>b.cluster!=="mainnet-beta")],p=z(()=>e.endpoint),w=b=>{t&&e.cluster!==b.cluster&&(s(),r.value&&n()),e.setRpc(b.id)};return(b,I)=>(g(),S(un,{label:y(p).name,"model-value":!1,"auto-close":"",color:"secondary","text-color":"grey-8",rounded:"",unelevated:"",ripple:!1},{default:l(()=>[o(Qe,null,{default:l(()=>[(g(),E(Q,null,oe(c,(C,T)=>(g(),E(Q,{key:`${T}-cluster-group`},[(g(!0),E(Q,null,oe(C,D=>(g(),S(Ee,{key:D.id,clickable:"",onClick:R=>w(D)},{default:l(()=>[(g(),S(le,{key:`${D.id}-item`},{default:l(()=>[o(fe,null,{default:l(()=>[A("b",null,K(D.name),1)]),_:2},1024),M(" "+K(D.url),1)]),_:2},1024))]),_:2},1032,["onClick"]))),128)),T!==c.length-1?(g(),S(Ce,{key:0})):B("",!0)],64))),64))]),_:1})]),_:1},8,["label"]))}}),et=Ze("user",()=>{const a=ft(),e=xe();dn(()=>{var s;const n=(s=a.value)==null?void 0:s.publicKey;if(n){const r=ct(n.toString(),()=>Ae.encode(J.generate().secretKey));e.value=J.fromSecretKey(Ae.decode(r.value))}else e.value=void 0});function t(){var r;const n=(r=a.value)==null?void 0:r.publicKey;if(!n)return;const s=ct(n.toString(),"");s.value=Ae.encode(J.generate().secretKey),e.value=J.fromSecretKey(Ae.decode(s.value))}return{keypair:e,generateKey:t}}),xa={class:"container"},Ea={class:"app-header__logo"},Ka=A("div",{class:"app-header__nav"},[A("a",{href:"https://jpool.one",target:"_blank"},"JPOOL"),A("a",{href:"https://dev.svt.one",target:"_blank"},"Validator toolkit")],-1),Pa={key:0,class:"user-device"},Da=A("b",null,"Device Key",-1),za={class:"app-header__right"},Ia={class:"app-header__buttons"},Na=be({__name:"AppHeader",setup(a){const e=et(),{dialog:t}=Pe();function n(){t({title:"Confirm",message:"Are you sure?",cancel:!0,persistent:!0}).onOk(()=>{e.generateKey()})}return(s,r)=>{const c=ze("router-link"),p=Ca,w=Aa;return g(),S(mn,{class:"app-header"},{default:l(()=>[A("div",xa,[o(bt,null,{default:l(()=>[A("div",Ea,[o(c,{to:"/"},{default:l(()=>[M(" SOM ")]),_:1})]),o(ut),Ka,o(ut),y(e).keypair?(g(),E("div",Pa,[A("div",null,[Da,M(" \xA0 "),o(P,{size:"xs",rounded:"",unelevated:"",onClick:n},{default:l(()=>[M(" regenerate ")]),_:1})]),o(Ge,null,{default:l(()=>{var b;return[M(K((b=y(e).keypair)==null?void 0:b.publicKey),1)]}),_:1})])):B("",!0),A("div",za,[A("div",Ia,[o(p,{class:"app-header__cluster-btn"}),o(w,{class:"app-header__wallet-btn"})])])]),_:1})])]),_:1})}}});const Ta={};function Ba(a,e){const t=Na,n=ze("router-view");return g(),S(hn,{view:"lfh Lpr lff"},{default:l(()=>[o(t),o(pn,null,{default:l(()=>[o(n)]),_:1})]),_:1})}const Wa=Te(Ta,[["render",Ba]]),$a={default:Wa,empty:()=>_t(()=>import("./empty.b31c13a1.js"),["assets/empty.b31c13a1.js","assets/vendor.5cac5ab3.js"])};function Ra(a){return a.map(e=>{var t;return{path:e.path,component:$a[((t=e.meta)==null?void 0:t.layout)||"default"],children:[{...e,path:""}]}})}const La="0.0.5",Va="messenger",Fa=[{name:"initChannel",accounts:[{name:"channel",isMut:!0,isSigner:!0},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"InitChannelData"}}]},{name:"deleteChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"joinChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"JoinChannelData"}}]},{name:"addMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"invitee",isMut:!1,isSigner:!1},{name:"inviteeMembership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AddMemberData"}}]},{name:"authorizeMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AuthorizeMemberData"}}]},{name:"deleteMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"postMessage",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!1,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"message",type:"string"}]}],Ua=[{name:"Channel",type:{kind:"struct",fields:[{name:"name",docs:["Name of the channel"],type:"string"},{name:"creator",docs:["Channel creator"],type:"publicKey"},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"memberCount",docs:["Number of members"],type:"u16"},{name:"messageCount",docs:["Message counter"],type:"u32"},{name:"maxMessages",docs:["The maximum number of messages that are stored in [messages]"],type:"u16"},{name:"messages",docs:["List of messages"],type:{vec:{defined:"Message"}}}]}},{name:"ChannelMembership",type:{kind:"struct",fields:[{name:"channel",docs:["Associated [Channel] address"],type:"publicKey"},{name:"authority",docs:["Authority of membership"],type:"publicKey"},{name:"key",docs:["The public key used to encrypt the `CEK`"],type:"publicKey"},{name:"cek",docs:["The content encryption key (CEK) of the channel"],type:{defined:"CEKData"}},{name:"status",docs:["Status of membership"],type:{defined:"ChannelMembershipStatus"}},{name:"name",docs:["Name of the channel member"],type:"string"},{name:"invitedBy",docs:["Inviter address"],type:{option:"publicKey"}},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"bump",docs:["Bump seed for deriving PDA seeds"],type:"u8"}]}}],Oa=[{name:"AddMemberData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"cek",type:{defined:"CEKData"}},{name:"key",type:{option:"publicKey"}}]}},{name:"AuthorizeMemberData",type:{kind:"struct",fields:[{name:"cek",type:{defined:"CEKData"}}]}},{name:"InitChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"maxMessages",type:"u16"},{name:"memberName",type:"string"},{name:"cek",type:{defined:"CEKData"}}]}},{name:"JoinChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"authority",type:{option:"publicKey"}}]}},{name:"CEKData",type:{kind:"struct",fields:[{name:"header",docs:["The header information for the CEK"],type:"string"},{name:"encryptedKey",docs:["The CEK itself"],type:"string"}]}},{name:"Message",type:{kind:"struct",fields:[{name:"id",docs:["Uniq message id"],type:"u32"},{name:"sender",docs:["The message sender id"],type:"publicKey"},{name:"createdAt",docs:["The unix timestamp at which the message was received"],type:"i64"},{name:"content",docs:["The (typically encrypted) message content"],type:"string"}]}},{name:"ChannelMembershipStatus",type:{kind:"enum",variants:[{name:"Authorized",fields:[{name:"by",type:{option:"publicKey"}}]},{name:"Pending",fields:[{name:"authority",type:{option:"publicKey"}}]}]}}],Qa=[{name:"NewChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"NewMessageEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"message",type:{defined:"Message"},index:!1}]},{name:"JoinChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AddMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AuthorizeMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]}],Ga=[{code:6e3,name:"Unauthorized",msg:"Unauthorized"},{code:6001,name:"NameTooLong",msg:"Name too long"},{code:6002,name:"MessageTooLong",msg:"Message too long"},{code:6003,name:"AlreadyInUse",msg:"Already in use"},{code:6004,name:"UninitializedAccount",msg:"Uninitialized account"}],ja={address:"6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",origin:"anchor",binaryVersion:"0.25.0",libVersion:"0.25.0"},qa={version:La,name:Va,instructions:Fa,accounts:Ua,types:Oa,events:Qa,errors:Ga,metadata:ja},Ja=new u.FixableBeetArgsStruct([["id",u.u32],["sender",F],["createdAt",u.i64],["content",u.utf8String]],"Message"),qe=[49,159,99,106,220,87,219,88];class V{constructor(e,t,n,s,r,c,p){this.name=e,this.creator=t,this.createdAt=n,this.memberCount=s,this.messageCount=r,this.maxMessages=c,this.messages=p}static fromArgs(e){return new V(e.name,e.creator,e.createdAt,e.memberCount,e.messageCount,e.maxMessages,e.messages)}static fromAccountInfo(e,t=0){return V.deserialize(e.data,t)}static async fromAccountAddress(e,t,n){const s=await e.getAccountInfo(t,n);if(s==null)throw new Error(`Unable to find Channel account at ${t}`);return V.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return wt.fromStruct(e,Me)}static deserialize(e,t=0){return Me.deserialize(e,t)}serialize(){return Me.serialize({accountDiscriminator:qe,...this})}static byteSize(e){const t=V.fromArgs(e);return Me.toFixedFromValue({accountDiscriminator:qe,...t}).byteSize}static async getMinimumBalanceForRentExemption(e,t,n){return t.getMinimumBalanceForRentExemption(V.byteSize(e),n)}pretty(){return{name:this.name,creator:this.creator.toBase58(),createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),memberCount:this.memberCount,messageCount:this.messageCount,maxMessages:this.maxMessages,messages:this.messages}}}const Me=new u.FixableBeetStruct([["accountDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["name",u.utf8String],["creator",F],["createdAt",u.i64],["memberCount",u.u16],["messageCount",u.u32],["maxMessages",u.u16],["messages",u.array(Ja)]],V.fromArgs,"Channel"),Be=new u.FixableBeetArgsStruct([["header",u.utf8String],["encryptedKey",u.utf8String]],"CEKData"),Ha=a=>a.__kind==="Pending",Xa=u.dataEnum([["Authorized",new u.FixableBeetArgsStruct([["by",u.coption(F)]],'ChannelMembershipStatusRecord["Authorized"]')],["Pending",new u.FixableBeetArgsStruct([["authority",u.coption(F)]],'ChannelMembershipStatusRecord["Pending"]')]]),Ke=[238,149,255,251,116,131,86,170];class W{constructor(e,t,n,s,r,c,p,w,b){this.channel=e,this.authority=t,this.key=n,this.cek=s,this.status=r,this.name=c,this.invitedBy=p,this.createdAt=w,this.bump=b}static fromArgs(e){return new W(e.channel,e.authority,e.key,e.cek,e.status,e.name,e.invitedBy,e.createdAt,e.bump)}static fromAccountInfo(e,t=0){return W.deserialize(e.data,t)}static async fromAccountAddress(e,t,n){const s=await e.getAccountInfo(t,n);if(s==null)throw new Error(`Unable to find ChannelMembership account at ${t}`);return W.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return wt.fromStruct(e,Se)}static deserialize(e,t=0){return Se.deserialize(e,t)}serialize(){return Se.serialize({accountDiscriminator:Ke,...this})}static byteSize(e){const t=W.fromArgs(e);return Se.toFixedFromValue({accountDiscriminator:Ke,...t}).byteSize}static async getMinimumBalanceForRentExemption(e,t,n){return t.getMinimumBalanceForRentExemption(W.byteSize(e),n)}pretty(){return{channel:this.channel.toBase58(),authority:this.authority.toBase58(),key:this.key.toBase58(),cek:this.cek,status:this.status.__kind,name:this.name,invitedBy:this.invitedBy,createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),bump:this.bump}}}const Se=new u.FixableBeetStruct([["accountDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["channel",F],["authority",F],["key",F],["cek",Be],["status",Xa],["name",u.utf8String],["invitedBy",u.coption(F)],["createdAt",u.i64],["bump",u.u8]],W.fromArgs,"ChannelMembership"),me=new Map,he=new Map;class We extends Error{constructor(){super("Unauthorized");N(this,"code",6e3);N(this,"name","Unauthorized");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,We)}}me.set(6e3,()=>new We);he.set("Unauthorized",()=>new We);class $e extends Error{constructor(){super("Name too long");N(this,"code",6001);N(this,"name","NameTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,$e)}}me.set(6001,()=>new $e);he.set("NameTooLong",()=>new $e);class Re extends Error{constructor(){super("Message too long");N(this,"code",6002);N(this,"name","MessageTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Re)}}me.set(6002,()=>new Re);he.set("MessageTooLong",()=>new Re);class Le extends Error{constructor(){super("Already in use");N(this,"code",6003);N(this,"name","AlreadyInUse");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Le)}}me.set(6003,()=>new Le);he.set("AlreadyInUse",()=>new Le);class Ve extends Error{constructor(){super("Uninitialized account");N(this,"code",6004);N(this,"name","UninitializedAccount");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ve)}}me.set(6004,()=>new Ve);he.set("UninitializedAccount",()=>new Ve);function Y(a){const e=me.get(a);return e!=null?e():null}function ie(a){const e=he.get(a);return e!=null?e():null}const Za=new u.FixableBeetArgsStruct([["name",u.utf8String],["cek",Be],["key",u.coption(F)]],"AddMemberData"),Ya=new u.FixableBeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["data",Za]],"AddMemberInstructionArgs"),es=[13,116,123,130,126,198,57,34];function ts(a,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[n]=Ya.serialize({instructionDiscriminator:es,...e}),s=[{pubkey:a.channel,isWritable:!0,isSigner:!1},{pubkey:a.invitee,isWritable:!1,isSigner:!1},{pubkey:a.inviteeMembership,isWritable:!0,isSigner:!1},{pubkey:a.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:a.authority,isWritable:!0,isSigner:!0},{pubkey:(c=a.systemProgram)!=null?c:ne.programId,isWritable:!1,isSigner:!1}];if(a.anchorRemainingAccounts!=null)for(const p of a.anchorRemainingAccounts)s.push(p);return new ae({programId:t,keys:s,data:n})}const ns=new u.FixableBeetArgsStruct([["cek",Be]],"AuthorizeMemberData"),as=new u.FixableBeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["data",ns]],"AuthorizeMemberInstructionArgs"),ss=[194,123,189,175,86,225,93,128];function rs(a,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[n]=as.serialize({instructionDiscriminator:ss,...e}),s=[{pubkey:a.channel,isWritable:!1,isSigner:!1},{pubkey:a.membership,isWritable:!0,isSigner:!1},{pubkey:a.authority,isWritable:!1,isSigner:!0},{pubkey:a.authorityMembership,isWritable:!1,isSigner:!1},{pubkey:(c=a.systemProgram)!=null?c:ne.programId,isWritable:!1,isSigner:!1}];if(a.anchorRemainingAccounts!=null)for(const p of a.anchorRemainingAccounts)s.push(p);return new ae({programId:t,keys:s,data:n})}const is=new u.BeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)]],"DeleteChannelInstructionArgs"),os=[145,225,187,221,157,142,114,133];function ls(a,e=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[t]=is.serialize({instructionDiscriminator:os}),n=[{pubkey:a.channel,isWritable:!0,isSigner:!1},{pubkey:a.authority,isWritable:!0,isSigner:!0},{pubkey:a.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:(r=a.systemProgram)!=null?r:ne.programId,isWritable:!1,isSigner:!1}];if(a.anchorRemainingAccounts!=null)for(const c of a.anchorRemainingAccounts)n.push(c);return new ae({programId:e,keys:n,data:t})}const cs=new u.BeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)]],"DeleteMemberInstructionArgs"),us=[95,14,98,112,252,218,205,173];function ds(a,e=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[t]=cs.serialize({instructionDiscriminator:us}),n=[{pubkey:a.channel,isWritable:!0,isSigner:!1},{pubkey:a.membership,isWritable:!0,isSigner:!1},{pubkey:a.authority,isWritable:!0,isSigner:!0},{pubkey:a.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:(r=a.systemProgram)!=null?r:ne.programId,isWritable:!1,isSigner:!1}];if(a.anchorRemainingAccounts!=null)for(const c of a.anchorRemainingAccounts)n.push(c);return new ae({programId:e,keys:n,data:t})}const ms=new u.FixableBeetArgsStruct([["name",u.utf8String],["maxMessages",u.u16],["memberName",u.utf8String],["cek",Be]],"InitChannelData"),hs=new u.FixableBeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["data",ms]],"InitChannelInstructionArgs"),ps=[21,200,152,39,19,178,76,47];function ys(a,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[n]=hs.serialize({instructionDiscriminator:ps,...e}),s=[{pubkey:a.channel,isWritable:!0,isSigner:!0},{pubkey:a.membership,isWritable:!0,isSigner:!1},{pubkey:a.authority,isWritable:!0,isSigner:!0},{pubkey:a.key,isWritable:!1,isSigner:!0},{pubkey:(c=a.systemProgram)!=null?c:ne.programId,isWritable:!1,isSigner:!1}];if(a.anchorRemainingAccounts!=null)for(const p of a.anchorRemainingAccounts)s.push(p);return new ae({programId:t,keys:s,data:n})}const gs=new u.FixableBeetArgsStruct([["name",u.utf8String],["authority",u.coption(F)]],"JoinChannelData"),fs=new u.FixableBeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["data",gs]],"JoinChannelInstructionArgs"),bs=[124,39,115,89,217,26,38,29];function _s(a,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[n]=fs.serialize({instructionDiscriminator:bs,...e}),s=[{pubkey:a.channel,isWritable:!0,isSigner:!1},{pubkey:a.membership,isWritable:!0,isSigner:!1},{pubkey:a.authority,isWritable:!0,isSigner:!0},{pubkey:a.key,isWritable:!1,isSigner:!0},{pubkey:(c=a.systemProgram)!=null?c:ne.programId,isWritable:!1,isSigner:!1}];if(a.anchorRemainingAccounts!=null)for(const p of a.anchorRemainingAccounts)s.push(p);return new ae({programId:t,keys:s,data:n})}const ws=new u.FixableBeetArgsStruct([["instructionDiscriminator",u.uniformFixedSizeArray(u.u8,8)],["message",u.utf8String]],"PostMessageInstructionArgs"),As=[214,50,100,209,38,34,7,76];function vs(a,e,t=new x("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var c;const[n]=ws.serialize({instructionDiscriminator:As,...e}),s=[{pubkey:a.channel,isWritable:!0,isSigner:!1},{pubkey:a.membership,isWritable:!1,isSigner:!1},{pubkey:a.authority,isWritable:!1,isSigner:!0},{pubkey:(c=a.systemProgram)!=null?c:ne.programId,isWritable:!1,isSigner:!1}];if(a.anchorRemainingAccounts!=null)for(const p of a.anchorRemainingAccounts)s.push(p);return new ae({programId:t,keys:s,data:n})}const ks="6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",Ms=new x(ks);function Je(a,e=new Uint8Array(4)){const t=_e(a.toString(),"base10");return e.set(t,4-t.length),e}const Ue=a=>ce([Je(a.length),a]);function Ct(a,e,t){if(e!==256)throw new Error(`Unsupported key length: ${e}`);const n=ce([Ue(_e(t)),Ue(new Uint8Array(0)),Ue(new Uint8Array(0)),Je(e)]),s=1;return yn.hash(ce([Je(s),a,n]))}const He=a=>_e(a,"base64pad"),Xe=a=>At(a,"base64pad"),Ss=a=>_e(a),Cs=a=>At(a),xs=a=>_e(a,"base58btc"),te=Ie.NONCE_LENGTH,de=Ie.TAG_LENGTH,xt=a=>{const e=new Ie.XChaCha20Poly1305(a);return(t,n)=>{const s=vt.randomBytes(te),r=e.seal(s,t,n);return{ciphertext:r.subarray(0,r.length-de),tag:r.subarray(r.length-de),iv:s}}},Et=a=>{const e=new Ie.XChaCha20Poly1305(a);return(t,n,s,r)=>e.open(s,ce([t,n]),r)},Kt="ECDH-ES+XC20PKW",Pt=256,Es=a=>e=>{const t=je.generateKeyPair(),n=je.sharedKey(t.secretKey,a),s=Ct(n,Pt,Kt),r=xt(s)(e);return{encryptedKey:r.ciphertext,tag:r.tag,iv:r.iv,epPubKey:t.publicKey}},Ks=a=>(e,t,n,s)=>{const r=je.sharedKey(a,s),c=Ct(r,Pt,Kt);return Et(c)(e,t,n)},Ps=a=>{if(Array.isArray(a))return J.fromSecretKey(dt.Buffer.from(a));if(typeof a=="string")return J.fromSecretKey(xs(a));if(a instanceof dt.Buffer||a instanceof Uint8Array)return J.fromSecretKey(a);throw new Error("Incompatible private key format")},Ds=async(a=32)=>{const e=vt.randomBytes(a);return Promise.resolve(e)},zs=async(a,e)=>{const t=await Es(gn(e.toBytes()))(a);return{header:Xe(ce([t.iv,t.tag,t.epPubKey])),encryptedKey:Xe(t.encryptedKey)}},Is=async(a,e)=>{const t=He(a.header),n=t.subarray(0,te),s=t.subarray(te,te+de),r=t.subarray(te+de),c=He(a.encryptedKey),p=Ps(e).secretKey,w=fn(p),b=await Ks(w)(c,s,n,r);if(b===null)throw new Error("There was a problem decrypting the CEK");return b},Ns=async(a,e)=>{const t=await xt(e)(Ss(a));return Xe(ce([t.iv,t.ciphertext,t.tag]))},Ts=async(a,e)=>{const t=He(a),n=t.subarray(0,te),s=t.subarray(te,-de),r=t.subarray(-de),c=await Et(e)(s,r,n);if(c===null)throw new Error("There was an error decoding the message!");return Cs(c)};class Bs{constructor(e,t){N(this,"programId",Ms);N(this,"_coder");N(this,"_events");this.provider=e,this.keypair=t,this._coder=new bn(qa),this._events=new _n(this.programId,e,this._coder)}get connection(){return this.provider.connection}addEventListener(e,t){return this._events.addEventListener(e,t)}async removeEventListener(e){return await this._events.removeEventListener(e)}setKeypair(e){this.keypair=e}async loadAllChannels(){return(await V.gpaBuilder().addFilter("accountDiscriminator",qe).run(this.provider.connection)).map(t=>({pubkey:t.pubkey,data:V.fromAccountInfo(t.account)[0]}))}async loadChannel(e,t){return V.fromAccountAddress(this.provider.connection,e,t)}async loadMyChannels(){const e=await this.loadMemberships();return console.log(e),[]}async loadChannelMembers(e){return(await W.gpaBuilder().addFilter("accountDiscriminator",Ke).addFilter("channel",e).run(this.provider.connection)).map(n=>({pubkey:n.pubkey,data:W.fromAccountInfo(n.account)[0]}))}async loadMemberships(e){return(await W.gpaBuilder().addFilter("accountDiscriminator",Ke).addFilter("authority",this.provider.publicKey).addFilter("key",e).run(this.provider.connection)).map(n=>({pubkey:n.pubkey,data:W.fromAccountInfo(n.account)}))}async loadMembership(e,t){return W.fromAccountAddress(this.provider.connection,e,t)}async getMembershipPDA(e,t){return t=t!=null?t:this.keypair.publicKey,await x.findProgramAddress([e.toBuffer(),t.toBuffer()],this.programId)}async encryptCEK(e,t){return zs(e,t!=null?t:this.keypair.publicKey)}async decryptCEK(e,t){return Is(e,t!=null?t:this.keypair.secretKey)}async encryptMessage(e,t){return Ns(e,t)}async decryptMessage(e,t){return Ts(e,t)}async initChannel(e){var w,b,I;const t=(w=e.channel)!=null?w:J.generate(),n=await Ds(),s=await this.encryptCEK(n),[r]=await this.getMembershipPDA(t.publicKey),c=new Z;c.add(ys({channel:t.publicKey,membership:r,authority:this.provider.publicKey,key:this.keypair.publicKey},{data:{name:e.name,memberName:(b=e.memberName)!=null?b:"",maxMessages:e.maxMessages,cek:s}}));let p;try{p=await this.provider.sendAndConfirm(c,[t,this.keypair])}catch(C){throw(I=Y(C.code))!=null?I:C}return{signature:p,channel:t,cek:n,cekEncrypted:s}}async deleteChannel(e,t){var c;const[n]=await this.getMembershipPDA(e),s=new Z;s.add(ls({channel:e,authority:this.provider.publicKey,authorityMembership:t!=null?t:n}));let r;try{r=await this.provider.sendAndConfirm(s)}catch(p){throw(c=Y(p.code))!=null?c:ie("Unauthorized")}return{signature:r}}async joinChannel(e){var r;const[t]=await this.getMembershipPDA(e.channel),n=new Z;n.add(_s({channel:e.channel,authority:this.provider.publicKey,key:this.keypair.publicKey,membership:t},{data:{name:e.name,authority:e.authority}}));let s;try{s=await this.provider.sendAndConfirm(n,[this.keypair])}catch(c){throw(r=Y(c.code))!=null?r:c}return{signature:s}}async addMember(e){var I,C,T;const t=(I=e.key)!=null?I:e.invitee,[n]=await this.getMembershipPDA(e.channel),[s]=await this.getMembershipPDA(e.channel,t),r=await this.loadMembership(n);if(!r.cek.encryptedKey)throw ie("Unauthorized");const c=await this.decryptCEK(r.cek),p=await this.encryptCEK(c,t),w=new Z;w.add(ts({channel:e.channel,authority:this.provider.publicKey,invitee:e.invitee,authorityMembership:n,inviteeMembership:s},{data:{name:(C=e.name)!=null?C:"",cek:p,key:t}}));let b;try{b=await this.provider.sendAndConfirm(w)}catch(D){throw(T=Y(D.code))!=null?T:ie("Unauthorized")}return{signature:b}}async deleteMember(e){var c;const[t]=await this.getMembershipPDA(e.channel),[n]=await this.getMembershipPDA(e.channel,e.key),s=new Z;s.add(ds({channel:e.channel,authority:this.provider.publicKey,authorityMembership:t,membership:n}));let r;try{r=await this.provider.sendAndConfirm(s)}catch(p){throw(c=Y(p.code))!=null?c:p}return{signature:r}}async authorizeMember(e){var b;const[t]=await this.getMembershipPDA(e.channel),[n]=await this.getMembershipPDA(e.channel,e.key),s=await this.loadMembership(t);if(!s.cek.encryptedKey)throw ie("Unauthorized");const r=await this.decryptCEK(s.cek),c=await this.encryptCEK(r,e.key),p=new Z;p.add(rs({channel:e.channel,membership:n,authority:this.provider.publicKey,authorityMembership:t},{data:{cek:c}}));let w;try{w=await this.provider.sendAndConfirm(p)}catch(I){throw(b=Y(I.code))!=null?b:ie("Unauthorized")}return{signature:w}}async postMessage(e){var w;const[t]=await this.getMembershipPDA(e.channel),n=await this.loadMembership(t);if(!n.cek.header)throw ie("Unauthorized");const s=await this.decryptCEK(n.cek),r=await this.encryptMessage(e.message,s),c=new Z;c.add(vs({channel:e.channel,membership:t,authority:this.provider.publicKey},{message:r}));let p;try{p=await this.provider.sendAndConfirm(c)}catch(b){throw(w=Y(b.code))!=null?w:b}return{signature:p}}}const ht="***** *** *** *** *******",Ws=Ze("messenger",()=>{const a=Ye(),e=et(),t=ft(),n=ee({allChannels:[],channel:void 0,channelAddr:void 0,channelMembershipAddr:void 0,channelMembership:void 0,channelMembers:[],channelMessages:[],channelLoading:!1,loading:!1,creating:!1,sending:!1}),s=z(()=>{var d;return new Bs(new mt(a.connection,(d=t.value)!=null?d:{publicKey:x.default},mt.defaultOptions()),e.keypair)});p().then(),kt(t,()=>{n.channelAddr&&C(n.channelAddr).then()},{immediate:!0});const r=[];async function c(){console.log("Register events...");for(const d of r)await s.value.removeEventListener(d);r.push(s.value.addEventListener("NewMessageEvent",async d=>{if(console.log("[Event] NewMessageEvent",d),`${d.channel}`!=`${n.channelAddr}`)return;let f=ht;const k=await T();k&&(f=await s.value.decryptMessage(d.message.content,k)),n.channelMessages.push({...d.message,content:f})})),r.push(s.value.addEventListener("AuthorizeMemberEvent",async d=>{console.log("[Event] AuthorizeMemberEvent",d),!(n.channelAddr&&`${d.channel}`!=`${n.channelAddr}`)&&(`${d.membership}`==`${n.channelMembershipAddr}`?C(n.channelAddr).then():R().then())})),r.push(s.value.addEventListener("JoinChannelEvent",async d=>{console.log("[Event] JoinChannelEvent",d),`${d.channel}`==`${n.channelAddr}`&&R().then()}))}async function p(){n.loading=!0;const d=await s.value.loadAllChannels();await c(),n.allChannels=d,n.loading=!1}async function w(d,f=15){try{n.creating=!0;const{channel:k}=await s.value.initChannel({name:d,maxMessages:f});await C(k.publicKey),n.channel&&n.allChannels.push({pubkey:k.publicKey,data:n.channel})}finally{n.creating=!1}}async function b(d){const f=new x(d);await s.value.deleteChannel(f),await p()}async function I(d,f){const k=new x(d);await s.value.joinChannel({channel:k,name:f}),await C(d)}async function C(d){var f;n.channelLoading=!0,n.channelMessages=[],n.channelMembers=[],n.channelMembershipAddr=void 0,n.channelMembership=void 0,n.channelAddr=new x(d);try{if((f=t.value)!=null&&f.publicKey)try{const[k]=await s.value.getMembershipPDA(n.channelAddr);n.channelMembershipAddr=k,n.channelMembership=await s.value.loadMembership(k)}catch(k){console.log(k),n.channelMembershipAddr=void 0,n.channelMembership=void 0}await R(),await D()}catch(k){console.log("Error",k)}finally{n.channelLoading=!1}}async function T(){if(!!n.channelMembership)try{return await s.value.decryptCEK(n.channelMembership.cek)}catch(d){console.log(d)}}async function D(){if(!n.channelAddr){console.log("Invalid channel");return}n.channel=await s.value.loadChannel(n.channelAddr);const d=await T();n.channelMessages=await Promise.all(n.channel.messages.map(async f=>{var U;let k=ht,pe=Ne(f.sender);if((U=t.value)!=null&&U.publicKey){const G=n.channelMembers.find(({data:X})=>X.name!==""&&(`${X.authority}`==`${f.sender}`||`${X.key}`==`${f.sender}`));G&&G.data.name!==""&&(pe=G.data.name)}if(d)try{k=await s.value.decryptMessage(f.content,d)}catch{console.log(`Failed to decrypt message #${f.id}`)}return{...f,senderFormatted:pe,content:k}}))}async function R(){if(!n.channelAddr){console.error("Invalid channel");return}n.channelMembers=await s.value.loadChannelMembers(n.channelAddr)}async function H(d){if(!n.channelAddr){console.log("Please select a channel");return}try{n.sending=!0,await s.value.postMessage({channel:n.channelAddr,message:d}),await D()}finally{n.sending=!1}}async function _(d,f,k){if(!n.channelAddr){console.log("Invalid channel");return}await s.value.addMember({channel:n.channelAddr,invitee:new x(d),key:f?new x(f):void 0,name:k})}async function v(d){if(!n.channelAddr){console.log("Invalid channel");return}await s.value.deleteMember({channel:n.channelAddr,key:new x(d)})}async function L(d){if(!n.channelAddr){console.log("Invalid channel");return}await s.value.authorizeMember({channel:n.channelAddr,key:new x(d)}),await D()}return{state:n,client:s.value,loadChannel:C,joinChannel:I,createChannel:w,deleteChannel:b,postMessage:H,addMember:_,deleteMember:v,authorizeMember:L}}),Dt=a=>(yt("data-v-5327da6c"),a=a(),gt(),a),$s={class:"messenger"},Rs={class:"row q-gutter-md"},Ls={class:"col col-3"},Vs={class:"messenger-add-channel"},Fs={key:1,class:"messenger-channels-empty"},Us={class:"col"},Os={key:0},Qs={class:"row"},Gs={class:"col"},js={class:"col"},qs={class:"channel-name"},Js={key:0,class:"row justify-center"},Hs={key:0,class:"messenger-messages"},Xs={key:1,class:"messenger-empty"},Zs={key:1,class:"messenger-empty"},Ys={key:1,class:"q-my-md q-px-lg"},er={class:"col col-4"},tr={class:"col"},nr={class:"no-margin"},ar=Dt(()=>A("br",null,null,-1)),sr=Dt(()=>A("br",null,null,-1)),rr=be({__name:"Messenger",setup(a){const{notify:e}=Pe(),t=De(),{state:n,postMessage:s,addMember:r,deleteMember:c,authorizeMember:p,createChannel:w,loadChannel:b,deleteChannel:I,joinChannel:C}=Ws(),T=et(),D=xe(!1),R=xe(!1),H=wn(R),_=ee({dialog:!1,loading:!1,name:"",authority:""}),v=ee({dialog:!1,loading:!1,name:"",authority:"",key:""}),L=ee({loading:!1}),d=ee({loading:!1}),f=ee({dialog:!1,name:"",maxMessages:15}),k=ee({message:""}),pe=z(()=>!!t.publicKey.value),U=z(()=>{var m;return((m=n.channelMembership)==null?void 0:m.status.__kind)==="Authorized"}),G=z(()=>{var m;return((m=n.channelMembership)==null?void 0:m.status.__kind)==="Pending"}),X=z(()=>{var m,h;return U.value&&((m=n.channel)==null?void 0:m.creator.toString())===String((h=t.publicKey.value)!=null?h:"-")}),tt=z(()=>n.allChannels),nt=z(()=>{const m=[];let h=0,i;for(const $ of n.channelMessages)i&&`${$.sender}`==`${i}`?m[h-1].text.push($.content):(i=$.sender,m.push({id:$.id,sender:$.sender,senderFormatted:$.senderFormatted,text:[$.content],date:$.createdAt}),h++);return m}),at=z(()=>U.value&&!n.sending),zt=z(()=>U.value),It=m=>z(()=>{var h;return X.value&&String(m.key)!==String((h=T.keypair)==null?void 0:h.publicKey)}).value,Nt=z(()=>pe.value&&!n.loading&&!U.value),se=m=>e({type:"positive",message:m,timeout:2e3}),we=m=>e({type:"info",message:m,timeout:2e3}),re=m=>e({type:"negative",message:m,timeout:2e3}),st=z(()=>n.channelMembers.filter(m=>Ha(m.data.status)).length);async function Tt(){Fe()&&(await s(k.message),k.message="")}function Bt(){Fe()&&(f.dialog=!0)}async function Wt(){if(Fe())try{await w(f.name,f.maxMessages),$t(),se("Channel was created!")}catch(m){re("Something went wrong"),console.log(m)}}function $t(){f.dialog=!1,f.name="",f.maxMessages=15}async function Rt(){if(v.loading=!0,!n.channelAddr){we("Please select a channel");return}try{await r(v.authority,v.key,v.name),rt(),se("Member was added")}catch(m){re("Something went wrong"),console.log(m)}finally{v.loading=!1}}function rt(){v.loading=!1,v.name="",v.authority="",v.key=""}async function Lt(m){try{d.loading=!0,await c(m),se("Member was deleted")}catch(h){re("Something went wrong"),console.log(h)}finally{d.loading=!1}}async function Vt(m){try{L.loading=!0,await p(m),se("Member was authorized")}catch(h){re("Something went wrong"),console.log(h)}finally{L.loading=!1}}async function Ft(){if(!n.channelAddr){we("Please select a channel");return}_.loading=!0;try{await C(n.channelAddr,_.name),it(),se("Request was sent")}catch(m){console.log("Error",m),re("Something went wrong")}finally{_.loading=!1}}function it(){_.loading=!1,_.dialog=!1,_.name=""}async function Ut(){if(!n.channelAddr){we("Please select a channel");return}await I(n.channelAddr);try{await I(n.channelAddr),se("Channel was deleted!")}catch(m){console.log("Error",m),re("Something went wrong")}finally{_.loading=!1}}async function Ot(m){await b(m)}function Fe(){return t.publicKey.value?!0:(we("Please connect wallet"),!1)}function Qt(m){return(m==null?void 0:m.__kind)==="Authorized"?"positive":"grey"}function Gt(m){return(m==null?void 0:m.name)&&m.name!==""?m.name:Ne(m.authority)}function jt(m){const h=t.publicKey.value;return h?String(h)!==String(m):!0}return(m,h)=>(g(),E(Q,null,[A("div",$s,[A("div",Rs,[A("div",Ls,[A("div",Vs,[o(P,{color:"primary",rounded:"",onClick:Bt},{default:l(()=>[M(" Add New Channel ")]),_:1})]),o(q,{class:"messenger-channels"},{default:l(()=>[y(tt).length>0?(g(),S(Qe,{key:0,separator:""},{default:l(()=>[(g(!0),E(Q,null,oe(y(tt),i=>(g(),S(Ee,{key:i.name,"active-class":"bg-blue-grey-1 text-grey-8",active:String(y(n).channelAddr)===String(i.pubkey)},{default:l(()=>[o(le,{class:"cursor-pointer",onClick:$=>Ot(i.pubkey)},{default:l(()=>[o(fe,null,{default:l(()=>[M(K(i.data.name),1)]),_:2},1024),o(fe,{caption:"",lines:"2"},{default:l(()=>[A("div",null,"members: "+K(i.data.memberCount),1),A("div",null,"messages: "+K(i.data.messageCount),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["active"]))),128))]),_:1})):(g(),E("div",Fs," No channels ")),o(ye,{showing:y(n).loading,color:"primary"},null,8,["showing"])]),_:1})]),A("div",Us,[y(n).channel?(g(),E("div",Os,[A("div",Qs,[A("div",Gs,[o(An,{rounded:"",unelevated:""},{default:l(()=>[y(zt)?(g(),S(P,{key:0,color:"secondary","text-color":"dark",loading:v.loading,onClick:h[0]||(h[0]=i=>v.dialog=!0)},{default:l(()=>[M(" add\xA0member ")]),_:1},8,["loading"])):B("",!0),y(Nt)?(g(),S(P,{key:1,color:"secondary","text-color":"dark",loading:_.loading,disable:y(G),onClick:h[1]||(h[1]=i=>_.dialog=!0)},{default:l(()=>[M(K(y(G)?"pending\xA0access":"join\xA0channel"),1)]),_:1},8,["loading","disable"])):B("",!0),y(pe)?(g(),S(P,{key:2,color:"blue-grey",onClick:h[2]||(h[2]=i=>D.value=!0)},{default:l(()=>[M(" members "),y(st)>0?(g(),S(Ge,{key:0,color:"info",rounded:"",floating:""},{default:l(()=>[M(K(y(st)),1)]),_:1})):B("",!0)]),_:1})):B("",!0),y(X)?(g(),S(P,{key:3,color:"negative",onClick:Ut},{default:l(()=>[M(" delete ")]),_:1})):B("",!0)]),_:1})]),A("div",js,[A("div",qs,K(y(n).channel.name),1)])])])):B("",!0),o(q,{class:"messenger-card overflow-hidden"},{default:l(()=>[y(n).channel?(g(),E("div",Js,[y(nt).length>0?(g(),E("div",Hs,[(g(!0),E(Q,null,oe(y(nt),i=>(g(),S(vn,{key:i.id,name:i.senderFormatted,text:i.text,sent:jt(i.sender)},null,8,["name","text","sent"]))),128))])):(g(),E("div",Xs," No messages "))])):(g(),E("div",Zs," Please select a channel ")),o(ve,{class:"channel-form",onSubmit:ke(Tt,["prevent"])},{default:l(()=>[o(bt,{class:"bg-primary text-white row"},{default:l(()=>[o(j,{ref:"inputFocus",modelValue:k.message,"onUpdate:modelValue":h[3]||(h[3]=i=>k.message=i),class:"col-grow q-mr-sm","bg-color":"white",placeholder:"Type a message",dense:"",outlined:"",rounded:"",autofocus:"",disable:!y(at)},null,8,["modelValue","disable"]),o(P,{rounded:"",flat:"",type:"submit",disable:!y(at),loading:y(n).sending},{default:l(()=>[M(" Send ")]),_:1},8,["disable","loading"])]),_:1})]),_:1},8,["onSubmit"]),o(ye,{showing:y(n).channelLoading},null,8,["showing"])]),_:1}),y(n).channel?(g(),E("div",Ys,[o(P,{flat:"",class:"text-blue-2",onClick:h[4]||(h[4]=i=>y(H)())},{default:l(()=>[M(" debug info ")]),_:1}),R.value?(g(!0),E(Q,{key:0},oe([["Authorized",y(U)],["Pending Access",y(G)],["Channel Creator",y(X)],["Channel",y(n).channel],["Membership",y(n).channelMembership],["Members",y(n).channelMembers]],i=>(g(),E("div",{key:i[0],class:"row q-mt-md"},[A("div",er,K(i[0]),1),A("div",tr,[A("pre",nr,K(i[1]),1)])]))),128)):B("",!0)])):B("",!0)])])]),o(ge,{modelValue:f.dialog,"onUpdate:modelValue":h[7]||(h[7]=i=>f.dialog=i),class:"new-channel-dialog"},{default:l(()=>[o(q,null,{default:l(()=>[o(O,null,{default:l(()=>[o(ve,{class:"messenger-new-channel-form",onSubmit:ke(Wt,["prevent"])},{default:l(()=>[o(j,{modelValue:f.name,"onUpdate:modelValue":h[5]||(h[5]=i=>f.name=i),label:"Channel name *","lazy-rules":"",rules:[i=>i&&i.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(j,{modelValue:f.maxMessages,"onUpdate:modelValue":h[6]||(h[6]=i=>f.maxMessages=i),label:"Max messages","lazy-rules":"",rules:[i=>+i>0||"Invalid value"]},null,8,["modelValue","rules"]),o(P,{type:"submit",color:"info",ripple:!1,rounded:""},{default:l(()=>[M(" Create Channel ")]),_:1})]),_:1},8,["onSubmit"]),o(ye,{showing:y(n).creating},null,8,["showing"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ge,{modelValue:v.dialog,"onUpdate:modelValue":h[11]||(h[11]=i=>v.dialog=i),class:"add-member-dialog",onHide:rt},{default:l(()=>[o(q,null,{default:l(()=>[o(O,null,{default:l(()=>[o(ve,{class:"add-member-form",onSubmit:ke(Rt,["prevent"])},{default:l(()=>[o(j,{modelValue:v.name,"onUpdate:modelValue":h[8]||(h[8]=i=>v.name=i),label:"Member name *",hint:"Min length 3 chars","lazy-rules":"",rules:[i=>i&&i.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(j,{modelValue:v.key,"onUpdate:modelValue":h[9]||(h[9]=i=>v.key=i),label:"Member Wallet *","lazy-rules":"",rules:[i=>i&&i.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),o(j,{modelValue:v.key,"onUpdate:modelValue":h[10]||(h[10]=i=>v.key=i),label:"Member Device Key",hint:"Default: The same as member wallet","lazy-rules":"",rules:[i=>!i||i.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),ar,o(P,{type:"submit",color:"info",ripple:!1,rounded:""},{default:l(()=>[M(" Add Member ")]),_:1})]),_:1},8,["onSubmit"]),o(ye,{showing:v.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ge,{modelValue:_.dialog,"onUpdate:modelValue":h[14]||(h[14]=i=>_.dialog=i),class:"join-channel-dialog",onHide:it},{default:l(()=>[o(q,null,{default:l(()=>[o(O,null,{default:l(()=>[o(ve,{class:"join-channel-form",onSubmit:ke(Ft,["prevent"])},{default:l(()=>[o(j,{modelValue:_.name,"onUpdate:modelValue":h[12]||(h[12]=i=>_.name=i),placeholder:"Member name *","lazy-rules":"",rules:[i=>i&&i.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(j,{modelValue:_.authority,"onUpdate:modelValue":h[13]||(h[13]=i=>_.authority=i),placeholder:"Authorize By","lazy-rules":"",rules:[i=>!i||i&&i.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),sr,o(P,{type:"submit",color:"info",ripple:!1,rounded:""},{default:l(()=>[M(" Join Channel ")]),_:1})]),_:1},8,["onSubmit"]),o(ye,{showing:_.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ge,{modelValue:D.value,"onUpdate:modelValue":h[15]||(h[15]=i=>D.value=i)},{default:l(()=>[o(q,null,{default:l(()=>[o(O,null,{default:l(()=>[o(Qe,{separator:""},{default:l(()=>[(g(!0),E(Q,null,oe(y(n).channelMembers,i=>(g(),S(Ee,{key:i.pubkey.toString(),"active-class":"bg-teal-1",active:`${i.pubkey}`==`${y(n).channelMembershipAddr}`},{default:l(()=>[o(le,null,{default:l(()=>[o(fe,null,{default:l(()=>[M(K(Gt(i.data))+" ",1),o(Ge,{color:Qt(i.data.status)},{default:l(()=>[M(K(i.data.status.__kind),1)]),_:2},1032,["color"])]),_:2},1024),o(fe,{caption:"",lines:"2"},{default:l(()=>[A("div",null,"Authority: "+K(i.data.authority),1),A("div",null,"Key: "+K(i.data.key),1)]),_:2},1024)]),_:2},1024),o(le,{side:"",class:"q-gutter-sm"},{default:l(()=>[i.data.status.__kind==="Pending"&&y(U)&&(!i.data.status.authority||String(i.data.status.authority)===String(y(t).publicKey.value))?(g(),S(P,{key:0,color:"teal",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:L.loading,disabled:L.loading,onClick:$=>Vt(i.data.key)},{default:l(()=>[M(" Authorize ")]),_:2},1032,["loading","disabled","onClick"])):B("",!0),It(i.data)?(g(),S(P,{key:1,color:"negative",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:d.loading,disabled:d.loading,onClick:$=>Lt(i.data.key)},{default:l(()=>[M(" Delete ")]),_:2},1032,["loading","disabled","onClick"])):B("",!0)]),_:2},1024)]),_:2},1032,["active"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});const ir=Te(rr,[["__scopeId","data-v-5327da6c"]]);const or={},lr={class:"container"},cr={class:"messenger-container"};function ur(a,e){const t=ir;return g(),S(kn,null,{default:l(()=>[A("div",lr,[A("div",cr,[o(t)])])]),_:1})}const dr=Te(or,[["render",ur],["__scopeId","data-v-8856bd2a"]]),mr=()=>_t(()=>import("./_...all_.6dc74c95.js"),["assets/_...all_.6dc74c95.js","assets/_...all_.73169310.css","assets/vendor.5cac5ab3.js"]),hr=[{name:"index",path:"/",component:dr,props:!0},{name:"all",path:"/:all(.*)*",component:mr,props:!0,meta:{layout:"empty"}}],pr=Ra(hr),yr="/sol-messenger/",gr=Mn({history:Sn(yr),scrollBehavior:()=>({left:0,top:0}),strict:!0,routes:pr}),fr=({app:a})=>{a.use(gr)},br=Object.freeze(Object.defineProperty({__proto__:null,install:fr},Symbol.toStringTag,{value:"Module"})),_r=({app:a})=>{a.use(Cn,{wallets:[new xn,new En,new Kn,new Pn,new Dn,new zn,new In,new Nn,new Tn,new Bn,new Wn,new $n,new Rn,new Ln,new Vn,new Fn,new Un,new On,new Qn,new Gn,new jn,new qn,new Jn,new Hn,new Xn,new Zn,new Yn,new ea,new ta,new na],autoConnect:!1})},wr=Object.freeze(Object.defineProperty({__proto__:null,install:_r},Symbol.toStringTag,{value:"Module"})),Ar=aa();function vr(){return Ar}const kr=Symbol("WALLET_CONNECT_EVENT"),Mr=Symbol("WALLET_DISCONNECT_EVENT"),Sr=Symbol("ACCOUNT_CHANGE_EVENT"),Oe=5e3;function Cr(){const{connection:a}=Ye(),{emit:e}=vr(),{notify:t}=Pe(),{wallet:n}=De();kt(n,s=>{if(!s)return;const r=()=>{const w=s.publicKey;a.onAccountChange(w,b=>{console.log("ACCOUNT_CHANGE_EVENT",b),e(Sr,b)}),a.onLogs(w,b=>{console.log(b)}),t({message:"Wallet update",caption:`Connected to wallet ${Ne(w.toBase58(),7)}`,timeout:Oe}),e(kr,s)},c=()=>{t({message:"Wallet update",caption:"Disconnected from wallet",timeout:Oe}),e(Mr,s)},p=w=>{!(w!=null&&w.message)||t({type:"negative",message:"Wallet update",caption:w.message,timeout:Oe})};s.once("connect",r),s.once("disconnect",c),s.removeAllListeners("error"),s.on("error",p)},{immediate:!0})}const xr=be({__name:"App",setup(a){return sa(()=>{Cr()}),(e,t)=>{const n=ze("router-view");return g(),S(n)}}});async function Er(){const a=ra(xr);Object.values(Object.assign({"./plugins/pinia.ts":oa,"./plugins/quasar.ts":ca,"./plugins/router.ts":br,"./plugins/wallet.ts":wr})).forEach(e=>{var t;return(t=e.install)==null?void 0:t.call(e,{app:a})}),a.mount("#app")}Er().then();export{Te as _};
