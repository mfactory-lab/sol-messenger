var Lt=Object.defineProperty;var Rt=(t,e,n)=>e in t?Lt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var W=(t,e,n)=>(Rt(t,typeof e!="symbol"?e+"":e,n),n);import{c as Vt,Q as Ft,P as Ot,D as Ut,N as jt,a as Qt,i as Jt,u as ye,b as Xe,d as T,o as f,e as v,w as l,f as u,g as $,h as r,j as qt,k as d,l as Gt,r as Q,m as k,n as P,p as ue,q as Ht,s as Xt,S as Zt,t as I,v as B,x as ct,y as z,z as X,A as V,B as Ie,C as Yt,E as q,F,G as en,H as be,I as G,J as gt,W as ut,K as _e,L as ve,M as tn,O as ot,R as nn,T as an,U as Be,V as he,X as Ze,Y as ce,Z as sn,_ as ft,$ as on,a0 as te,a1 as De,a2 as Te,a3 as it,a4 as rt,a5 as rn,a6 as ln,a7 as cn,a8 as yt,a9 as Se,aa as Me,ab as un,ac as dn,ad as mn,ae as hn,af as m,ag as j,ah as bt,ai as ae,aj as se,ak as ke,al as _t,am as pe,an as pn,ao as We,ap as vt,aq as Ye,ar as gn,as as fn,at as dt,au as yn,av as bn,aw as Y,ax as ne,ay as mt,az as et,aA as _n,aB as Ne,aC as Le,aD as H,aE as xe,aF as vn,aG as wn,aH as An,aI as Cn,aJ as Sn,aK as Mn,aL as kn,aM as xn,aN as En,aO as $n,aP as Dn,aQ as Kn,aR as Pn,aS as In,aT as zn,aU as Bn,aV as Tn,aW as Wn,aX as Nn,aY as Ln,aZ as Rn,a_ as Vn,a$ as Fn,b0 as On,b1 as Un,b2 as jn,b3 as Qn,b4 as Jn,b5 as qn,b6 as Gn,b7 as Hn,b8 as Xn,b9 as Zn,ba as Yn,bb as ea,bc as ta,bd as na,be as aa,bf as sa,bg as oa,bh as ia,bi as ra,bj as la}from"./vendor.cf3dae5c.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();const ca=({app:t})=>{const e=Vt();t.use(e)},ua=Object.freeze(Object.defineProperty({__proto__:null,install:ca},Symbol.toStringTag,{value:"Module"})),da=({app:t})=>{t.use(Ft,{plugins:{Dark:Ot,Dialog:Ut,Notify:jt,LocalStorage:Qt},iconSet:Jt})},ma=Object.freeze(Object.defineProperty({__proto__:null,install:da},Symbol.toStringTag,{value:"Module"}));function ha(){const{dark:t}=ye(),e=Xe("theme-mode",t.isActive);return t.set(e.value),{isActive:e,set(n){t.set(n),e.value=t.isActive},toggle(){t.toggle(),e.value=t.isActive}}}const pa={class:"container"},ga={class:"row"},fa=u("div",{class:"col-12 col-md-6"},[u("div",{class:"footer-links"},[u("ul",null,[u("li",null,[u("a",{target:"_blank",href:"https://jpool.one"},"JPOOL")]),u("li",null,[u("a",{target:"_blank",href:"https://heartandsol.one"},"GAME")]),u("li",null,[u("a",{href:"https://magiceden.io/marketplace/heartandsol"},"NFT Marketplace")])])]),u("div",{class:"copyright"},[u("span",null,"\xA9 Copyright 2022 jpool.one. All rights reserved. Powered by mFactory GmbH")])],-1),ya={class:"col-12 col-md-6 social-col"},ba={class:"social"},_a={class:"theme"},va=u("div",{class:"social-link social-link-text"},[u("span",null,[$("official"),u("br"),$("channel")])],-1),wa=u("div",{class:"social-link telegram"},null,-1),Aa=u("div",{class:"social-link twitter"},null,-1),Ca=u("div",{class:"social-link discord"},null,-1),Sa=T({__name:"AppFooter",setup(t){const{toggle:e,isActive:n}=ha();return(o,a)=>(f(),v(Gt,null,{default:l(()=>[u("div",pa,[u("div",ga,[fa,u("div",ya,[u("div",ba,[u("div",_a,[$(" Dark theme "),r(qt,{"model-value":d(n),onClick:d(e)},null,8,["model-value","onClick"])]),va,wa,Aa,Ca])])])])]),_:1}))}});function Ma(){const t=Q(ka());return{userAgent:t,isMobileOs:k(()=>xa(t.value)),isWebView:k(()=>Ea(t.value))}}let qe;function ka(){var t,e;return qe===void 0&&(qe=(e=(t=globalThis.navigator)==null?void 0:t.userAgent)!=null?e:null),qe}function xa(t){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)}function Ea(t){return/(WebView|(Phantom|Solflare)|Version\/.+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+)|; wv\).+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+))/i.test(t)}function Re(t,e=4){return t instanceof P&&(t=t.toBase58()),`${t.slice(0,e)}...${t.slice(-e)}`}const $a="/sol-messenger/assets/clover.968404b0.svg",Da="/sol-messenger/assets/ledger.40cf6861.svg",Ka="/sol-messenger/assets/mathwallet.1d763e81.svg",wt=t=>(_e("data-v-b79b08f0"),t=t(),ve(),t),Pa=wt(()=>u("div",{class:"text-h6 text-center"}," Your wallet ",-1)),Ia={class:"q-gutter-md row justify-between"},za=wt(()=>u("div",{class:"text-h6"}," Connect to a wallet ",-1)),Ba={class:"text-light-gray text-caption full-width text-no-wrap",style:{"text-overflow":"ellipsis",overflow:"hidden"}},Ta=["src","alt"],Wa=T({__name:"ConnectWallet",setup(t){const e={priority:{solflare:10,phantom:20,sollet:5,nufi:5,blocto:1},icons:{clover:$a},darkIcons:{ledger:Da,mathwallet:Ka},deepLinks:{phantom:"https://phantom.app/ul/browse/{uri}?ref={ref}",solflare:"https://solflare.com/ul/browse/{uri}?ref={ref}"}},{userAgent:n,isWebView:o,isMobileOs:a}=Ma(),s={close:gt},i=C=>[ut.Installed,ut.Loadable].includes(C.readyState);ye();const c=ue(),{connected:g,connecting:h}=c;Ht();const D=k(()=>a.value&&!o.value);if(o.value){const C=String(n.value).toLowerCase();C.includes("phantom")?(c.select(Xt),c.connect()):C.includes("solflare")&&(c.select(Zt),c.connect())}const w=k(()=>{var C,p;return(p=(C=c.publicKey.value)==null?void 0:C.toBase58())!=null?p:""}),x=k(()=>Re(w.value)),y=k(()=>[...c.wallets.value].map(C=>{var b,M;const p=C.adapter.name.toLowerCase();return C.adapter.icon=(M=(b=e.darkIcons[p])!=null?b:e.icons[p])!=null?M:C.adapter.icon,D.value&&e.deepLinks[p]&&(C.deepLink=e.deepLinks[p].replace("{uri}",location.href).replace("{ref}",location.origin)),C}).sort((C,p)=>{var ie,J;const b=(ie=e.priority[C.adapter.name.toLowerCase()])!=null?ie:1;return((J=e.priority[p.adapter.name.toLowerCase()])!=null?J:1)-b+((i(p)?1:0)-(i(C)?1:0))})),A=k(()=>D.value?y.value.filter(C=>!!C.deepLink):y.value),_=Q(!1);async function S(C){await c.select(C.adapter.name),_.value=!1,await c.connect()}function L(){_.value=!1,c.disconnect()}function de(){_.value=!0}function oe(){_.value=!1}return(C,p)=>(f(),I(G,null,[d(g)?(f(),v(z,ct({key:0},C.$attrs,{class:C.$style.btn,ripple:!1,color:"primary-gray","text-color":"white",rounded:"",unelevated:"",onClick:de}),{default:l(()=>[$(B(d(x)),1)]),_:1},16,["class"])):(f(),v(z,ct({key:1},C.$attrs,{color:"primary-gray","text-color":"white",rounded:"",unelevated:"",ripple:!1,loading:d(h),onClick:de}),{default:l(()=>[$(" CONNECT WALLET ")]),_:1},16,["loading"])),r(be,{modelValue:_.value,"onUpdate:modelValue":p[0]||(p[0]=b=>_.value=b),"transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:l(()=>[d(g)?(f(),v(X,{key:0},{default:l(()=>[r(V,{class:"relative-position"},{default:l(()=>[Pa,r(z,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:s.close,size:"md",onClick:oe},null,8,["icon"])]),_:1}),r(Ie),r(V,null,{default:l(()=>[$(B(d(w)),1)]),_:1}),r(Ie),r(V,null,{default:l(()=>[u("div",Ia,[r(z,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:L},{default:l(()=>[$(" Disconnect ")]),_:1}),r(z,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:oe},{default:l(()=>[$(" Ok ")]),_:1})])]),_:1})]),_:1})):(f(),v(X,{key:1,class:"wallet-connect-card"},{default:l(()=>[r(V,null,{default:l(()=>[za,r(z,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:s.close,size:"md",onClick:oe},null,8,["icon"])]),_:1}),r(Ie),r(V,{style:{"max-height":"80vh"},class:"scroll"},{default:l(()=>[r(Yt,{grid:"",rows:d(A),"row-key":"name","hide-pagination":"","hide-header":"","rows-per-page-options":[100]},{item:l(({row:b})=>[(f(),I("div",{key:`wallet-${b.adapter.name}`,class:"col-12 col-md-6"},[r(q,{clickable:"",href:b.deepLink,onClick:M=>b.deepLink?!0:S(b)},{default:l(()=>[r(F,null,{default:l(()=>[u("b",null,B(b.adapter.name),1),u("div",Ba,B(b.adapter.url),1)]),_:2},1024),r(F,{avatar:""},{default:l(()=>[r(en,{square:""},{default:l(()=>[u("img",{src:b.adapter.icon,alt:b.adapter.name},null,8,Ta)]),_:2},1024)]),_:2},1024)]),_:2},1032,["href","onClick"])]))]),_:1},8,["rows"])]),_:1})]),_:1}))]),_:1},8,["modelValue"])],64))}});const Na="_btn_6n1iw_1",La={btn:Na},N=(t,e)=>{const n=t.__vccOpts||t;for(const[o,a]of e)n[o]=a;return n},Ra={$style:La},Va=N(Wa,[["__cssModules",Ra],["__scopeId","data-v-b79b08f0"]]),ge=[{id:"serum-mainnet",name:"Serum RPC",cluster:"mainnet-beta",url:"https://solana-api.projectserum.com/"},{id:"rpcpool-mainnet",name:"RPCPool RPC",cluster:"mainnet-beta",url:"https://mainnet.rpcpool.com/"},{id:"mainnet",name:"Solana RPC",cluster:"mainnet-beta",url:tn("mainnet-beta")}],At={id:"devnet",name:"DevNet",cluster:"devnet",url:"https://devnet.rpcpool.com/"};ge.push(At);const Fa={id:"testnet",name:"TestNet",cluster:"testnet",url:"https://testnet.rpcpool.com/"};ge.push(Fa);var pt;const Oa=(pt=ge.find(t=>t.id==={VITE_BASE_PATH:"/sol-messenger/",VITE_USER_NODE_ENV:"production",BASE_URL:"/sol-messenger/",MODE:"staging",DEV:!1,PROD:!0}.VITE_CONNECTION_ENDPOINT))!=null?pt:At,Ua="confirmed",ja=12e4,lt=ot({id:"connection",state:()=>({commitment:Ua,confirmTransactionInitialTimeout:ja,rpc:nn("rpc","")}),getters:{endpoint(t){var e;return(e=ge.find(n=>n.id===t.rpc))!=null?e:Oa},connection(t){return console.log("[connection]",this.endpoint.url),new an(this.endpoint.url,{confirmTransactionInitialTimeout:t.confirmTransactionInitialTimeout,commitment:t.commitment})},cluster(){return this.endpoint.cluster}},actions:{setRpc(t){this.rpc=t},setCommitment(t){this.commitment=t}}}),Qa=T({__name:"ClusterSelector",setup(t){const e=lt(),{connected:n,connect:o,disconnect:a,autoConnect:s}=ue(),i=[ge.filter(h=>h.cluster==="mainnet-beta"),ge.filter(h=>h.cluster!=="mainnet-beta")],c=k(()=>e.endpoint),g=h=>{n&&e.cluster!==h.cluster&&(a(),s.value&&o()),e.setRpc(h.id)};return(h,D)=>(f(),v(sn,{label:d(c).name,"model-value":!1,"auto-close":"",color:"secondary","text-color":"#000",rounded:"",unelevated:"",ripple:!1},{default:l(()=>[r(Be,null,{default:l(()=>[(f(),I(G,null,he(i,(w,x)=>(f(),I(G,{key:`${x}-cluster-group`},[(f(!0),I(G,null,he(w,y=>(f(),v(q,{key:y.id,clickable:"",onClick:A=>g(y)},{default:l(()=>[(f(),v(F,{key:`${y.id}-item`},{default:l(()=>[r(Ze,null,{default:l(()=>[u("b",null,B(y.name),1)]),_:2},1024),$(" "+B(y.url),1)]),_:2},1024))]),_:2},1032,["onClick"]))),128)),x!==i.length-1?(f(),v(Ie,{key:0})):ce("",!0)],64))),64))]),_:1})]),_:1},8,["label"]))}}),Ee=ot("user",()=>{const t=ft(),e=Q();on(()=>{var a;const o=(a=t.value)==null?void 0:a.publicKey;if(o){const s=Xe(o.toString(),()=>De.encode(te.generate().secretKey));e.value=te.fromSecretKey(De.decode(s.value))}else e.value=void 0});function n(){var s;const o=(s=t.value)==null?void 0:s.publicKey;if(!o)return;const a=Xe(o.toString(),"");a.value=De.encode(te.generate().secretKey),e.value=te.fromSecretKey(De.decode(a.value))}return{keypair:e,generateKey:n}}),Ja={class:"container"},qa={class:"app-header__info"},Ga={class:"app-header__logo"},Ha={class:"logo-wrapper"},Xa=u("div",{class:"app-header__title"},[u("h1",null,[$("BLOCKCHAIN messenger "),u("span",{class:"marked"},"SOLANA")])],-1),Za={class:"app-header__right"},Ya={class:"app-header__buttons"},es=T({__name:"AppHeader",setup(t){return Ee(),ye(),(e,n)=>{const o=Te("router-link"),a=Qa,s=Va;return f(),v(rn,{class:"app-header"},{default:l(()=>[u("div",Ja,[r(it,null,{default:l(()=>[u("div",qa,[u("div",Ga,[u("div",Ha,[r(o,{to:"/"})])]),Xa]),r(rt),u("div",Za,[u("div",Ya,[r(a,{class:"app-header__cluster-btn header-btn"}),r(s,{class:"app-header__wallet-btn header-btn"})])])]),_:1})])]),_:1})}}});const ts={};function ns(t,e){const n=es,o=Te("router-view"),a=Sa;return f(),v(ln,{view:"lfh Lpr lff"},{default:l(()=>[r(n),r(cn,null,{default:l(()=>[r(o)]),_:1}),r(a)]),_:1})}const as=N(ts,[["render",ns]]),ss={default:as,empty:()=>yt(()=>import("./empty.06be1943.js"),["assets/empty.06be1943.js","assets/vendor.cf3dae5c.js"])};function os(t){return t.map(e=>{var n;return{path:e.path,component:ss[((n=e.meta)==null?void 0:n.layout)||"default"],children:[{...e,path:""}]}})}const is="/sol-messenger/assets/solana-logo.3caace62.svg";const rs={},Ve=t=>(_e("data-v-885ea5eb"),t=t(),ve(),t),ls={class:"row info-row"},cs=Ve(()=>u("div",{class:"offset-0 offset-md-3"},null,-1)),us=Ve(()=>u("div",{class:"col-6 col-md-3 flex-center info-col"},[u("div",{class:"info-title"}," How IT WORKS "),u("div",{class:"info-text"},[u("ul",null,[u("li",null,"Connect your wallet"),u("li",null,"Enter the amount of JPLT you want to swap or enter the amount of JPLU you want to get"),u("li",null,"Click SWAP button"),u("li",null,"Confirm the transaction in your wallet"),u("li",null,"Done")])])],-1)),ds={class:"col-6 col-md-5 logo-wrap"},ms=Ve(()=>u("img",{src:is,alt:"solana logo"},null,-1)),hs=Ve(()=>u("div",{class:"offset-0 offset-md-1"},null,-1));function ps(t,e){const n=Te("router-link");return f(),I("div",ls,[cs,us,u("div",ds,[r(n,{to:"/"},{default:l(()=>[ms]),_:1})]),hs])}const gs=N(rs,[["render",ps],["__scopeId","data-v-885ea5eb"]]),fs=t=>(_e("data-v-b5d85bae"),t=t(),ve(),t),ys=fs(()=>u("div",{class:"text-h6"}," Device Key ",-1)),bs=T({__name:"UserInfoDialog",emits:["regenerate"],setup(t){const e=Ee(),n=()=>{var o,a;hn(((a=(o=e.keypair)==null?void 0:o.publicKey)!=null?a:"").toString())};return(o,a)=>(f(),v(be,{class:"dialog-wrapper"},{default:l(()=>[r(X,null,{default:l(()=>[r(V,{class:"row items-center q-pb-none"},{default:l(()=>[ys,r(rt),Se(r(z,{flat:"",round:"",dense:"",icon:d(gt)},null,8,["icon"]),[[Me]])]),_:1}),r(V,null,{default:l(()=>{var s;return[r(z,{flat:"",round:"",dense:"",icon:d(un),onClick:n},{default:l(()=>[r(dn,{delay:0,anchor:"bottom middle",self:"top middle","transition-duration":"0"},{default:l(()=>[$(" Copy to clipboard ")]),_:1})]),_:1},8,["icon"]),u("span",null,B((s=d(e).keypair)==null?void 0:s.publicKey),1)]}),_:1}),r(mn,{align:"right"},{default:l(()=>[r(z,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:d(e).generateKey},{default:l(()=>[$(" Regenerate ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}))}});const _s=N(bs,[["__scopeId","data-v-b5d85bae"]]),vs="0.0.6",ws="messenger",As=[{name:"initChannel",accounts:[{name:"channel",isMut:!0,isSigner:!0},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"InitChannelData"}}]},{name:"deleteChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"joinChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"JoinChannelData"}}]},{name:"leaveChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"addMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"invitee",isMut:!1,isSigner:!1},{name:"inviteeMembership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AddMemberData"}}]},{name:"authorizeMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AuthorizeMemberData"}}]},{name:"deleteMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"postMessage",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!1,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"message",type:"string"}]}],Cs=[{name:"Channel",type:{kind:"struct",fields:[{name:"name",docs:["Name of the channel"],type:"string"},{name:"creator",docs:["Channel creator"],type:"publicKey"},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"memberCount",docs:["Number of members"],type:"u16"},{name:"messageCount",docs:["Message counter"],type:"u32"},{name:"maxMessages",docs:["The maximum number of messages that are stored in [messages]"],type:"u16"},{name:"messages",docs:["List of messages"],type:{vec:{defined:"Message"}}}]}},{name:"ChannelMembership",type:{kind:"struct",fields:[{name:"channel",docs:["Associated [Channel] address"],type:"publicKey"},{name:"authority",docs:["Authority of membership"],type:"publicKey"},{name:"key",docs:["The device key used to encrypt the `CEK`"],type:"publicKey"},{name:"cek",docs:["The content encryption key (CEK) of the channel"],type:{defined:"CEKData"}},{name:"status",docs:["Status of membership"],type:{defined:"ChannelMembershipStatus"}},{name:"name",docs:["Name of the channel member"],type:"string"},{name:"invitedBy",docs:["Inviter address"],type:{option:"publicKey"}},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"bump",docs:["Bump seed for deriving PDA seeds"],type:"u8"}]}}],Ss=[{name:"AddMemberData",type:{kind:"struct",fields:[{name:"name",docs:["Member name"],type:"string"},{name:"cek",docs:["Content Encryption Key"],type:{defined:"CEKData"}},{name:"key",docs:["Device key"],type:{option:"publicKey"}}]}},{name:"AuthorizeMemberData",type:{kind:"struct",fields:[{name:"cek",type:{defined:"CEKData"}}]}},{name:"InitChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"maxMessages",type:"u16"},{name:"memberName",type:"string"},{name:"cek",type:{defined:"CEKData"}}]}},{name:"JoinChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"authority",type:{option:"publicKey"}}]}},{name:"CEKData",type:{kind:"struct",fields:[{name:"header",docs:["The header information for the CEK"],type:"string"},{name:"encryptedKey",docs:["The CEK itself"],type:"string"}]}},{name:"Message",type:{kind:"struct",fields:[{name:"id",docs:["Uniq message id"],type:"u32"},{name:"sender",docs:["The message sender id"],type:"publicKey"},{name:"createdAt",docs:["The unix timestamp at which the message was received"],type:"i64"},{name:"content",docs:["The (typically encrypted) message content"],type:"string"}]}},{name:"ChannelMembershipStatus",type:{kind:"enum",variants:[{name:"Authorized",fields:[{name:"by",type:{option:"publicKey"}}]},{name:"Pending",fields:[{name:"authority",type:{option:"publicKey"}}]}]}}],Ms=[{name:"NewChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"NewMessageEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"message",type:{defined:"Message"},index:!1}]},{name:"JoinChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"LeaveChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"authority",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AddMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AuthorizeMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]}],ks=[{code:6e3,name:"Unauthorized",msg:"Unauthorized"},{code:6001,name:"NameTooLong",msg:"Name too long"},{code:6002,name:"MessageTooLong",msg:"Message too long"},{code:6003,name:"AlreadyInUse",msg:"Already in use"},{code:6004,name:"UninitializedAccount",msg:"Uninitialized account"}],xs={address:"6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",origin:"anchor",binaryVersion:"0.25.0",libVersion:"0.25.0"},Es={version:vs,name:ws,instructions:As,accounts:Cs,types:Ss,events:Ms,errors:ks,metadata:xs},$s=new m.FixableBeetArgsStruct([["id",m.u32],["sender",j],["createdAt",m.i64],["content",m.utf8String]],"Message"),tt=[49,159,99,106,220,87,219,88];class U{constructor(e,n,o,a,s,i,c){this.name=e,this.creator=n,this.createdAt=o,this.memberCount=a,this.messageCount=s,this.maxMessages=i,this.messages=c}static fromArgs(e){return new U(e.name,e.creator,e.createdAt,e.memberCount,e.messageCount,e.maxMessages,e.messages)}static fromAccountInfo(e,n=0){return U.deserialize(e.data,n)}static async fromAccountAddress(e,n,o){const a=await e.getAccountInfo(n,o);if(a==null)throw new Error(`Unable to find Channel account at ${n}`);return U.fromAccountInfo(a,0)[0]}static gpaBuilder(e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return bt.fromStruct(e,Ke)}static deserialize(e,n=0){return Ke.deserialize(e,n)}serialize(){return Ke.serialize({accountDiscriminator:tt,...this})}static byteSize(e){const n=U.fromArgs(e);return Ke.toFixedFromValue({accountDiscriminator:tt,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,o){return n.getMinimumBalanceForRentExemption(U.byteSize(e),o)}pretty(){return{name:this.name,creator:this.creator.toBase58(),createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),memberCount:this.memberCount,messageCount:this.messageCount,maxMessages:this.maxMessages,messages:this.messages}}}const Ke=new m.FixableBeetStruct([["accountDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["name",m.utf8String],["creator",j],["createdAt",m.i64],["memberCount",m.u16],["messageCount",m.u32],["maxMessages",m.u16],["messages",m.array($s)]],U.fromArgs,"Channel"),Fe=new m.FixableBeetArgsStruct([["header",m.utf8String],["encryptedKey",m.utf8String]],"CEKData"),Ds=t=>t.__kind==="Pending",Ks=m.dataEnum([["Authorized",new m.FixableBeetArgsStruct([["by",m.coption(j)]],'ChannelMembershipStatusRecord["Authorized"]')],["Pending",new m.FixableBeetArgsStruct([["authority",m.coption(j)]],'ChannelMembershipStatusRecord["Pending"]')]]),ze=[238,149,255,251,116,131,86,170];class R{constructor(e,n,o,a,s,i,c,g,h){this.channel=e,this.authority=n,this.key=o,this.cek=a,this.status=s,this.name=i,this.invitedBy=c,this.createdAt=g,this.bump=h}static fromArgs(e){return new R(e.channel,e.authority,e.key,e.cek,e.status,e.name,e.invitedBy,e.createdAt,e.bump)}static fromAccountInfo(e,n=0){return R.deserialize(e.data,n)}static async fromAccountAddress(e,n,o){const a=await e.getAccountInfo(n,o);if(a==null)throw new Error(`Unable to find ChannelMembership account at ${n}`);return R.fromAccountInfo(a,0)[0]}static gpaBuilder(e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return bt.fromStruct(e,Pe)}static deserialize(e,n=0){return Pe.deserialize(e,n)}serialize(){return Pe.serialize({accountDiscriminator:ze,...this})}static byteSize(e){const n=R.fromArgs(e);return Pe.toFixedFromValue({accountDiscriminator:ze,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,o){return n.getMinimumBalanceForRentExemption(R.byteSize(e),o)}pretty(){return{channel:this.channel.toBase58(),authority:this.authority.toBase58(),key:this.key.toBase58(),cek:this.cek,status:this.status.__kind,name:this.name,invitedBy:this.invitedBy,createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),bump:this.bump}}}const Pe=new m.FixableBeetStruct([["accountDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["channel",j],["authority",j],["key",j],["cek",Fe],["status",Ks],["name",m.utf8String],["invitedBy",m.coption(j)],["createdAt",m.i64],["bump",m.u8]],R.fromArgs,"ChannelMembership"),we=new Map,Ae=new Map;class Oe extends Error{constructor(){super("Unauthorized");W(this,"code",6e3);W(this,"name","Unauthorized");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Oe)}}we.set(6e3,()=>new Oe);Ae.set("Unauthorized",()=>new Oe);class Ue extends Error{constructor(){super("Name too long");W(this,"code",6001);W(this,"name","NameTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ue)}}we.set(6001,()=>new Ue);Ae.set("NameTooLong",()=>new Ue);class je extends Error{constructor(){super("Message too long");W(this,"code",6002);W(this,"name","MessageTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,je)}}we.set(6002,()=>new je);Ae.set("MessageTooLong",()=>new je);class Qe extends Error{constructor(){super("Already in use");W(this,"code",6003);W(this,"name","AlreadyInUse");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Qe)}}we.set(6003,()=>new Qe);Ae.set("AlreadyInUse",()=>new Qe);class Je extends Error{constructor(){super("Uninitialized account");W(this,"code",6004);W(this,"name","UninitializedAccount");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Je)}}we.set(6004,()=>new Je);Ae.set("UninitializedAccount",()=>new Je);function ee(t){const e=we.get(t);return e!=null?e():null}function me(t){const e=Ae.get(t);return e!=null?e():null}const Ps=new m.FixableBeetArgsStruct([["name",m.utf8String],["cek",Fe],["key",m.coption(j)]],"AddMemberData"),Is=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["data",Ps]],"AddMemberInstructionArgs"),zs=[13,116,123,130,126,198,57,34];function Bs(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var i;const[o]=Is.serialize({instructionDiscriminator:zs,...e}),a=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.invitee,isWritable:!1,isSigner:!1},{pubkey:t.inviteeMembership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(i=t.systemProgram)!=null?i:ae.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const c of t.anchorRemainingAccounts)a.push(c);return new se({programId:n,keys:a,data:o})}const Ts=new m.FixableBeetArgsStruct([["cek",Fe]],"AuthorizeMemberData"),Ws=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["data",Ts]],"AuthorizeMemberInstructionArgs"),Ns=[194,123,189,175,86,225,93,128];function Ls(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var i;const[o]=Ws.serialize({instructionDiscriminator:Ns,...e}),a=[{pubkey:t.channel,isWritable:!1,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:t.authorityMembership,isWritable:!1,isSigner:!1},{pubkey:(i=t.systemProgram)!=null?i:ae.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const c of t.anchorRemainingAccounts)a.push(c);return new se({programId:n,keys:a,data:o})}const Rs=new m.BeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)]],"DeleteChannelInstructionArgs"),Vs=[145,225,187,221,157,142,114,133];function Fs(t,e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var s;const[n]=Rs.serialize({instructionDiscriminator:Vs}),o=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(s=t.systemProgram)!=null?s:ae.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const i of t.anchorRemainingAccounts)o.push(i);return new se({programId:e,keys:o,data:n})}const Os=new m.BeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)]],"DeleteMemberInstructionArgs"),Us=[95,14,98,112,252,218,205,173];function js(t,e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var s;const[n]=Os.serialize({instructionDiscriminator:Us}),o=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(s=t.systemProgram)!=null?s:ae.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const i of t.anchorRemainingAccounts)o.push(i);return new se({programId:e,keys:o,data:n})}const Qs=new m.FixableBeetArgsStruct([["name",m.utf8String],["maxMessages",m.u16],["memberName",m.utf8String],["cek",Fe]],"InitChannelData"),Js=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["data",Qs]],"InitChannelInstructionArgs"),qs=[21,200,152,39,19,178,76,47];function Gs(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var i;const[o]=Js.serialize({instructionDiscriminator:qs,...e}),a=[{pubkey:t.channel,isWritable:!0,isSigner:!0},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(i=t.systemProgram)!=null?i:ae.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const c of t.anchorRemainingAccounts)a.push(c);return new se({programId:n,keys:a,data:o})}const Hs=new m.FixableBeetArgsStruct([["name",m.utf8String],["authority",m.coption(j)]],"JoinChannelData"),Xs=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["data",Hs]],"JoinChannelInstructionArgs"),Zs=[124,39,115,89,217,26,38,29];function Ys(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var i;const[o]=Xs.serialize({instructionDiscriminator:Zs,...e}),a=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(i=t.systemProgram)!=null?i:ae.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const c of t.anchorRemainingAccounts)a.push(c);return new se({programId:n,keys:a,data:o})}const eo=new m.BeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)]],"LeaveChannelInstructionArgs"),to=[104,0,75,134,95,80,68,186];function no(t,e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var s;const[n]=eo.serialize({instructionDiscriminator:to}),o=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(s=t.systemProgram)!=null?s:ae.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const i of t.anchorRemainingAccounts)o.push(i);return new se({programId:e,keys:o,data:n})}const ao=new m.FixableBeetArgsStruct([["instructionDiscriminator",m.uniformFixedSizeArray(m.u8,8)],["message",m.utf8String]],"PostMessageInstructionArgs"),so=[214,50,100,209,38,34,7,76];function oo(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var i;const[o]=ao.serialize({instructionDiscriminator:so,...e}),a=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:(i=t.systemProgram)!=null?i:ae.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const c of t.anchorRemainingAccounts)a.push(c);return new se({programId:n,keys:a,data:o})}const io="6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",ro=new P(io);function nt(t,e=new Uint8Array(4)){const n=ke(t.toString(),"base10");return e.set(n,4-n.length),e}const Ge=t=>pe([nt(t.length),t]);function Ct(t,e,n){if(e!==256)throw new Error(`Unsupported key length: ${e}`);const o=pe([Ge(ke(n)),Ge(new Uint8Array(0)),Ge(new Uint8Array(0)),nt(e)]),a=1;return pn.hash(pe([nt(a),t,o]))}const at=t=>ke(t,"base64pad"),st=t=>_t(t,"base64pad"),lo=t=>ke(t),co=t=>_t(t),uo=t=>ke(t,"base58btc"),le=We.NONCE_LENGTH,fe=We.TAG_LENGTH,St=t=>{const e=new We.XChaCha20Poly1305(t);return(n,o)=>{const a=vt.randomBytes(le),s=e.seal(a,n,o);return{ciphertext:s.subarray(0,s.length-fe),tag:s.subarray(s.length-fe),iv:a}}},Mt=t=>{const e=new We.XChaCha20Poly1305(t);return(n,o,a,s)=>e.open(a,pe([n,o]),s)},kt="ECDH-ES+XC20PKW",xt=256,mo=t=>e=>{const n=Ye.generateKeyPair(),o=Ye.sharedKey(n.secretKey,t),a=Ct(o,xt,kt),s=St(a)(e);return{encryptedKey:s.ciphertext,tag:s.tag,iv:s.iv,epPubKey:n.publicKey}},ho=t=>(e,n,o,a)=>{const s=Ye.sharedKey(t,a),i=Ct(s,xt,kt);return Mt(i)(e,n,o)},po=t=>{if(Array.isArray(t))return te.fromSecretKey(dt.Buffer.from(t));if(typeof t=="string")return te.fromSecretKey(uo(t));if(t instanceof dt.Buffer||t instanceof Uint8Array)return te.fromSecretKey(t);throw new Error("Incompatible private key format")},go=async(t=32)=>{const e=vt.randomBytes(t);return Promise.resolve(e)},fo=async(t,e)=>{const n=await mo(gn(e.toBytes()))(t);return{header:st(pe([n.iv,n.tag,n.epPubKey])),encryptedKey:st(n.encryptedKey)}},yo=async(t,e)=>{const n=at(t.header),o=n.subarray(0,le),a=n.subarray(le,le+fe),s=n.subarray(le+fe),i=at(t.encryptedKey),c=po(e).secretKey,g=fn(c),h=await ho(g)(i,a,o,s);if(h===null)throw new Error("There was a problem decrypting the CEK");return h},bo=async(t,e)=>{const n=await St(e)(lo(t));return st(pe([n.iv,n.ciphertext,n.tag]))},_o=async(t,e)=>{const n=at(t),o=n.subarray(0,le),a=n.subarray(le,-fe),s=n.subarray(-fe),i=await Mt(e)(a,s,o);if(i===null)throw new Error("There was an error decoding the message!");return co(i)};class vo{constructor(e,n){W(this,"programId",ro);W(this,"_coder");W(this,"_events");this.provider=e,this.keypair=n,this._coder=new yn(Es),this._events=new bn(this.programId,e,this._coder)}get connection(){return this.provider.connection}addEventListener(e,n){return this._events.addEventListener(e,n)}async removeEventListener(e){return await this._events.removeEventListener(e)}setKeypair(e){this.keypair=e}async loadAllChannels(){return(await U.gpaBuilder().addFilter("accountDiscriminator",tt).run(this.provider.connection)).map(n=>({pubkey:n.pubkey,data:U.fromAccountInfo(n.account)[0]}))}async loadChannel(e,n){return U.fromAccountAddress(this.provider.connection,e,n)}async loadMyChannels(){const e=await this.loadMemberships();return console.log(e),[]}async loadChannelMembers(e){return(await R.gpaBuilder().addFilter("accountDiscriminator",ze).addFilter("channel",e).run(this.provider.connection)).map(o=>({pubkey:o.pubkey,data:R.fromAccountInfo(o.account)[0]}))}async loadMemberships(e){const n=R.gpaBuilder().addFilter("accountDiscriminator",ze).addFilter("authority",this.provider.publicKey);return e&&n.addFilter("key",e!=null?e:null),(await n.run(this.provider.connection)).map(a=>({pubkey:a.pubkey,data:R.fromAccountInfo(a.account)}))}async loadMembership(e,n){return R.fromAccountAddress(this.provider.connection,e,n)}async getMembershipPDA(e,n){return n=n!=null?n:this.keypair.publicKey,await P.findProgramAddress([e.toBuffer(),n.toBuffer()],this.programId)}async encryptCEK(e,n){return fo(e,n!=null?n:this.keypair.publicKey)}async decryptCEK(e,n){return yo(e,n!=null?n:this.keypair.secretKey)}async encryptMessage(e,n){return bo(e,n)}async decryptMessage(e,n){return _o(e,n)}async initChannel(e){var h,D,w;const n=(h=e.channel)!=null?h:te.generate(),o=await go(),a=await this.encryptCEK(o),[s]=await this.getMembershipPDA(n.publicKey),i=this.provider.publicKey,c=new Y;c.add(Gs({key:this.keypair.publicKey,channel:n.publicKey,membership:s,authority:i},{data:{name:e.name,memberName:(D=e.memberName)!=null?D:"",maxMessages:e.maxMessages,cek:a}}));let g;try{g=await this.provider.sendAndConfirm(c,[n,this.keypair],e.opts)}catch(x){throw(w=ee(x.code))!=null?w:x}return{signature:g,channel:n,cek:o,cekEncrypted:a}}async deleteChannel({channel:e,opts:n}){var i;const o=new Y,a=this.provider.publicKey;o.add(Fs({channel:e,authority:a}));let s;try{s=await this.provider.sendAndConfirm(o,void 0,n)}catch(c){throw(i=ee(c.code))!=null?i:me("Unauthorized")}return{signature:s}}async joinChannel(e){var i,c;const[n]=await this.getMembershipPDA(e.channel),o=this.provider.publicKey,a=new Y;a.add(Ys({channel:e.channel,key:this.keypair.publicKey,membership:n,authority:o},{data:{name:e.name,authority:(i=e.authority)!=null?i:null}}));let s;try{s=await this.provider.sendAndConfirm(a,[this.keypair],e.opts)}catch(g){throw(c=ee(g.code))!=null?c:g}return{signature:s}}async leaveChannel(e){var i;const[n]=await this.getMembershipPDA(e.channel),o=this.provider.publicKey,a=new Y;a.add(no({channel:e.channel,membership:n,authority:o}));let s;try{s=await this.provider.sendAndConfirm(a,[this.keypair])}catch(c){throw(i=ee(c.code))!=null?i:c}return{signature:s}}async addMember(e){var D,w,x;const n=(D=e.key)!=null?D:e.invitee,[o]=await this.getMembershipPDA(e.channel),[a]=await this.getMembershipPDA(e.channel,n),s=await this.loadMembership(o);if(!s.cek.encryptedKey)throw me("Unauthorized");const i=await this.decryptCEK(s.cek),c=await this.encryptCEK(i,n),g=new Y;g.add(Bs({channel:e.channel,authority:this.provider.publicKey,invitee:e.invitee,authorityMembership:o,inviteeMembership:a},{data:{name:(w=e.name)!=null?w:"",cek:c,key:n}}));let h;try{h=await this.provider.sendAndConfirm(g)}catch(y){throw(x=ee(y.code))!=null?x:me("Unauthorized")}return{signature:h}}async deleteMember(e){var i;const[n]=e.membership?[e.membership]:await this.getMembershipPDA(e.channel,e.key),o=this.provider.publicKey,a=new Y;a.add(js({channel:e.channel,membership:n,authority:o}));let s;try{s=await this.provider.sendAndConfirm(a)}catch(c){throw(i=ee(c.code))!=null?i:c}return{signature:s}}async authorizeMember(e){var h;const[n]=await this.getMembershipPDA(e.channel),[o]=await this.getMembershipPDA(e.channel,e.key),a=await this.loadMembership(n);if(!a.cek.encryptedKey)throw me("Unauthorized");const s=await this.decryptCEK(a.cek),i=await this.encryptCEK(s,e.key),c=new Y;c.add(Ls({channel:e.channel,membership:o,authority:this.provider.publicKey,authorityMembership:n},{data:{cek:i}}));let g;try{g=await this.provider.sendAndConfirm(c)}catch(D){throw(h=ee(D.code))!=null?h:me("Unauthorized")}return{signature:g}}async postMessage(e){var g;const[n]=await this.getMembershipPDA(e.channel),o=await this.loadMembership(n);if(!o.cek.header)throw me("Unauthorized");const a=await this.decryptCEK(o.cek),s=await this.encryptMessage(e.message,a),i=new Y;i.add(oo({channel:e.channel,membership:n,authority:this.provider.publicKey},{message:s}));let c;try{c=await this.provider.sendAndConfirm(i)}catch(h){throw(g=ee(h.code))!=null?g:h}return{signature:c}}}const ht="***** *** *** *** *******",Z=ot("messenger",()=>{const t=lt(),e=Ee(),n=ft(),o={allChannels:[],channel:void 0,channelAddr:void 0,channelMembershipAddr:void 0,channelMembership:void 0,channelMembers:[],channelMessages:[],channelLoading:!1,loading:!1,creating:!1,sending:!1},a=ne({...o}),s=k(()=>{var p;return new vo(new mt(t.connection,(p=n.value)!=null?p:{publicKey:P.default},mt.defaultOptions()),e.keypair)});let i=[];et(()=>t.cluster,p=>{console.log(p),g().then()},{immediate:!0}),et(n,()=>{a.channelAddr&&y(a.channelAddr).then()},{immediate:!0});async function c(){console.log("Register events...");for(const p of i)await s.value.removeEventListener(p);i.push(s.value.addEventListener("NewMessageEvent",async p=>{if(console.log("[Event] NewMessageEvent",p),`${p.channel}`!=`${a.channelAddr}`)return;let b=ht;const M=await A();M&&(b=await s.value.decryptMessage(p.message.content,M)),a.channelMessages.push({...p.message,content:b})})),i.push(s.value.addEventListener("AuthorizeMemberEvent",async p=>{console.log("[Event] AuthorizeMemberEvent",p),!(a.channelAddr&&`${p.channel}`!=`${a.channelAddr}`)&&(`${p.membership}`==`${a.channelMembershipAddr}`?y(a.channelAddr).then():S().then())})),i.push(s.value.addEventListener("JoinChannelEvent",async p=>{console.log("[Event] JoinChannelEvent",p),`${p.channel}`==`${a.channelAddr}`&&S().then()}))}async function g(){h(),i=[],a.loading=!0;const p=await s.value.loadAllChannels();await c(),a.allChannels=p,a.loading=!1}function h(){Object.assign(a,o)}async function D(p,b=15){try{a.creating=!0;const{channel:M}=await s.value.initChannel({name:p,maxMessages:b,opts:{commitment:"confirmed"}});await y(M.publicKey),a.channel&&a.allChannels.push({pubkey:M.publicKey,data:a.channel})}finally{a.creating=!1}}async function w(p){const b=new P(p);await s.value.deleteChannel({channel:b,opts:{commitment:"confirmed"}}),await g()}async function x(p,b){const M=new P(p);await s.value.joinChannel({channel:M,name:b,opts:{commitment:"confirmed"}}),await y(p)}async function y(p){var b;a.channelLoading=!0,a.channelMessages=[],a.channelMembers=[],a.channelMembershipAddr=void 0,a.channelMembership=void 0,a.channelAddr=new P(p);try{if((b=n.value)!=null&&b.publicKey)try{const[M]=await s.value.getMembershipPDA(a.channelAddr);a.channelMembershipAddr=M,a.channelMembership=await s.value.loadMembership(M)}catch(M){console.log(M),a.channelMembershipAddr=void 0,a.channelMembership=void 0}await S(),await _()}catch(M){console.log("Error",M)}finally{a.channelLoading=!1}}async function A(){if(!!a.channelMembership)try{return await s.value.decryptCEK(a.channelMembership.cek)}catch(p){console.log(p)}}async function _(){if(!a.channelAddr){console.log("Invalid channel");return}a.channel=await s.value.loadChannel(a.channelAddr);const p=await A();a.channelMessages=await Promise.all(a.channel.messages.map(async b=>{var J;let M=ht,ie=Re(b.sender);if((J=n.value)!=null&&J.publicKey){const re=a.channelMembers.find(({data:Ce})=>Ce.name!==""&&(`${Ce.authority}`==`${b.sender}`||`${Ce.key}`==`${b.sender}`));re&&re.data.name!==""&&(ie=re.data.name)}if(p)try{M=await s.value.decryptMessage(b.content,p)}catch{console.log(`Failed to decrypt message #${b.id}`)}return{...b,senderFormatted:ie,content:M}}))}async function S(){if(!a.channelAddr){console.error("Invalid channel");return}a.channelMembers=await s.value.loadChannelMembers(a.channelAddr)}async function L(p){if(!a.channelAddr){console.log("Please select a channel");return}try{a.sending=!0,await s.value.postMessage({channel:a.channelAddr,message:p}),await _()}finally{a.sending=!1}}async function de(p,b,M){if(!a.channelAddr){console.log("Invalid channel");return}await s.value.addMember({channel:a.channelAddr,invitee:new P(p),key:b?new P(b):void 0,name:M})}async function oe(p){if(!a.channelAddr){console.log("Invalid channel");return}await s.value.deleteMember({channel:a.channelAddr,key:new P(p)})}async function C(p){if(!a.channelAddr){console.log("Invalid channel");return}await s.value.authorizeMember({channel:a.channelAddr,key:new P(p)}),await _()}return{state:a,client:s.value,loadChannel:y,joinChannel:x,createChannel:D,deleteChannel:w,postMessage:L,addMember:de,deleteMember:oe,authorizeMember:C}}),wo=T({__name:"MemberListDialog",props:{membersDialog:{type:Boolean,default:!1},isAuthorizedMember:{type:Boolean,default:!1},authorizeMemberState:{type:Object},deleteMemberState:{type:Object},wallet:{type:Object}},emits:["submit","deleteMember"],setup(t,{emit:e}){const{state:n}=Z(),o=Ee(),a=k(()=>{var h;return((h=n.channelMembership)==null?void 0:h.status.__kind)==="Authorized"}),s=k(()=>a.value),i=h=>k(()=>{var D;return s.value&&String(h.key)!==String((D=o.keypair)==null?void 0:D.publicKey)}).value;function c(h){return(h==null?void 0:h.name)&&h.name!==""?h.name:Re(h.authority)}function g(h){return(h==null?void 0:h.__kind)==="Authorized"?"positive":"grey"}return(h,D)=>(f(),v(be,null,{default:l(()=>[r(X,null,{default:l(()=>[r(V,null,{default:l(()=>[r(Be,{separator:""},{default:l(()=>[(f(!0),I(G,null,he(d(n).channelMembers,w=>(f(),v(q,{key:w.pubkey.toString(),"active-class":"bg-teal-1",active:`${w.pubkey}`==`${d(n).channelMembershipAddr}`},{default:l(()=>[r(F,null,{default:l(()=>[r(Ze,null,{default:l(()=>[$(B(c(w.data))+" ",1),r(_n,{color:g(w.data.status)},{default:l(()=>[$(B(w.data.status.__kind),1)]),_:2},1032,["color"])]),_:2},1024),r(Ze,{caption:"",lines:"2"},{default:l(()=>[u("div",null,"Authority: "+B(w.data.authority),1),u("div",null,"Key: "+B(w.data.key),1)]),_:2},1024)]),_:2},1024),r(F,{side:"",class:"q-gutter-sm"},{default:l(()=>[w.data.status.__kind==="Pending"&&d(a)&&(!w.data.status.authority||String(w.data.status.authority)===String(t.wallet.publicKey.value))?(f(),v(z,{key:0,color:"teal",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:t.authorizeMemberState.loading,disabled:t.authorizeMemberState.loading,onClick:x=>h.$emit("submit",w.data.key)},{default:l(()=>[$(" Authorize ")]),_:2},1032,["loading","disabled","onClick"])):ce("",!0),i(w.data)?(f(),v(z,{key:1,color:"negative",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:t.deleteMemberState.loading,disabled:t.deleteMemberState.loading,onClick:x=>h.$emit("deleteMember",w.data.key)},{default:l(()=>[$(" Delete ")]),_:2},1032,["loading","disabled","onClick"])):ce("",!0)]),_:2},1024)]),_:2},1032,["active"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}}),Ao=t=>(_e("data-v-058651c4"),t=t(),ve(),t),Co=Ao(()=>u("br",null,null,-1)),So=T({__name:"JoinChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t,{emit:e}){const o=Q(t.defaultState);return(a,s)=>(f(),v(be,{class:"join-channel-dialog",onHide:s[3]||(s[3]=i=>a.$emit("reset"))},{default:l(()=>[r(X,null,{default:l(()=>[r(V,null,{default:l(()=>[r(Ne,{class:"join-channel-form",onSubmit:s[2]||(s[2]=Le(i=>a.$emit("submit",o.value),["prevent"]))},{default:l(()=>[r(H,{modelValue:o.value.name,"onUpdate:modelValue":s[0]||(s[0]=i=>o.value.name=i),placeholder:"Member name *","lazy-rules":"",rules:[i=>i&&i.length>2||"Please type something"]},null,8,["modelValue","rules"]),r(H,{modelValue:o.value.authority,"onUpdate:modelValue":s[1]||(s[1]=i=>o.value.authority=i),placeholder:"Authorize By","lazy-rules":"",rules:[i=>!i||i&&i.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),Co,r(z,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:l(()=>[$(" Join Channel ")]),_:1})]),_:1}),r(xe,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Mo=N(So,[["__scopeId","data-v-058651c4"]]),ko=t=>(_e("data-v-a5f1d45d"),t=t(),ve(),t),xo=ko(()=>u("br",null,null,-1)),Eo=T({__name:"AddMemberDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=Q(t.defaultState);return(o,a)=>(f(),v(be,{class:"add-member-dialog",onHide:a[4]||(a[4]=s=>o.$emit("reset"))},{default:l(()=>[r(X,null,{default:l(()=>[r(V,null,{default:l(()=>[r(Ne,{class:"add-member-form",onSubmit:a[3]||(a[3]=Le(s=>o.$emit("submit",n.value),["prevent"]))},{default:l(()=>[r(H,{modelValue:n.value.name,"onUpdate:modelValue":a[0]||(a[0]=s=>n.value.name=s),label:"Member name *",hint:"Min length 3 chars","lazy-rules":"",rules:[s=>s&&s.length>2||"Please type something"]},null,8,["modelValue","rules"]),r(H,{modelValue:n.value.key,"onUpdate:modelValue":a[1]||(a[1]=s=>n.value.key=s),label:"Member Wallet *","lazy-rules":"",rules:[s=>s&&s.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),r(H,{modelValue:n.value.key,"onUpdate:modelValue":a[2]||(a[2]=s=>n.value.key=s),label:"Member Device Key",hint:"Default: The same as member wallet","lazy-rules":"",rules:[s=>!s||s.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),xo,r(z,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:l(()=>[$(" Add Member ")]),_:1})]),_:1}),r(xe,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const $o=N(Eo,[["__scopeId","data-v-a5f1d45d"]]),Do=T({__name:"NewChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=Q(t.defaultState);return(o,a)=>(f(),v(be,{class:"new-channel-dialog",onHide:a[3]||(a[3]=s=>o.$emit("reset"))},{default:l(()=>[r(X,null,{default:l(()=>[r(V,null,{default:l(()=>[r(Ne,{class:"messenger-new-channel-form",onSubmit:a[2]||(a[2]=Le(s=>o.$emit("submit",n.value),["prevent"]))},{default:l(()=>[r(H,{modelValue:n.value.name,"onUpdate:modelValue":a[0]||(a[0]=s=>n.value.name=s),label:"Channel name *","lazy-rules":"",maxlength:"32",rules:[s=>s&&s.length>2||"Please type something"]},null,8,["modelValue","rules"]),r(H,{modelValue:n.value.maxMessages,"onUpdate:modelValue":a[1]||(a[1]=s=>n.value.maxMessages=s),label:"Max messages","lazy-rules":"",rules:[s=>+s>0||"Invalid value"]},null,8,["modelValue","rules"]),r(z,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:l(()=>[$(" Create Channel ")]),_:1})]),_:1}),r(xe,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Ko=N(Do,[["__scopeId","data-v-d329d80c"]]),Po=T({__name:"ChannelForm",props:{message:{type:String,default:""},disabled:{type:Boolean,default:!1},sending:{type:Boolean,default:!1}},emits:["submit"],setup(t,{emit:e}){const o=Q(t.message),a=()=>{e("submit",o),o.value=""};return(s,i)=>(f(),v(Ne,{class:"channel-form",onSubmit:Le(a,["prevent"])},{default:l(()=>[r(it,{class:"row message-control"},{default:l(()=>[r(H,{ref:"inputFocus",modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=c=>o.value=c),class:"col-grow message-input","bg-color":"white",placeholder:"Type a message",dense:"",borderless:"",autofocus:"",disable:t.disabled},null,8,["modelValue","disable"]),r(z,{class:"send-btn",square:"",flat:"",type:"submit",disable:t.disabled,loading:t.sending},{default:l(()=>[$(" Send ")]),_:1},8,["disable","loading"])]),_:1})]),_:1},8,["onSubmit"]))}});const Io=N(Po,[["__scopeId","data-v-23f62c62"]]),zo={class:"messenger-content"},Bo={key:0,class:"row justify-center channel-wrapper"},To={key:0,class:"messenger-messages"},Wo={key:1,class:"messenger-empty"},No={key:1,class:"messenger-empty"},Lo=T({__name:"ChannelWrapper",props:{channel:{type:Object},messages:{type:Array},postMessageState:{type:Object},isSomeoneMessage:{type:Function,default:()=>!1},allowSend:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},channelLoadingState:{type:Boolean,default:!1}},emits:["sendMessage"],setup(t,{emit:e}){const n=o=>e("sendMessage",o);return(o,a)=>{const s=Io;return f(),v(X,{class:"messenger-card",square:""},{default:l(()=>[u("div",zo,[t.channel?(f(),I("div",Bo,[t.messages.length>0?(f(),I("div",To,[(f(!0),I(G,null,he(t.messages.concat(t.messages),i=>(f(),v(vn,{key:i.id,name:i.senderFormatted,text:i.text,sent:t.isSomeoneMessage(i.sender)},null,8,["name","text","sent"]))),128))])):(f(),I("div",Wo," No messages "))])):(f(),I("div",No," Please select a channel "))]),r(s,{message:t.postMessageState.message,sending:t.loading,disabled:!t.allowSend,onSubmit:n},null,8,["message","sending","disabled"]),r(xe,{showing:t.channelLoadingState},null,8,["showing"])]),_:1})}}});const Ro=N(Lo,[["__scopeId","data-v-e4314e53"]]),Vo="/sol-messenger/assets/add.1481b8ed.svg",Fo="/sol-messenger/assets/join.627c8616.svg",Et=t=>(_e("data-v-12fda737"),t=t(),ve(),t),Oo=Et(()=>u("img",{src:Vo,alt:""},null,-1)),Uo=Et(()=>u("img",{src:Fo,alt:""},null,-1)),jo=T({__name:"ChannelControl",props:{isPendingMember:{type:Boolean,default:!1},canJoinChannel:{type:Boolean,default:!1},isJoining:{type:Boolean,default:!1}},emits:["createChannel","joinChannel"],setup(t){return(e,n)=>(f(),v(q,null,{default:l(()=>[r(F,{class:"button-wrapper"},{default:l(()=>[r(z,{class:"control-button",square:"",onClick:n[0]||(n[0]=o=>e.$emit("createChannel"))},{default:l(()=>[Oo]),_:1}),t.canJoinChannel?(f(),v(z,{key:0,class:"control-button",square:"",loading:t.isJoining,disable:t.isPendingMember,onClick:n[1]||(n[1]=o=>e.$emit("joinChannel"))},{default:l(()=>[Uo]),_:1},8,["loading","disable"])):ce("",!0)]),_:1})]),_:1}))}});const Qo=N(jo,[["__scopeId","data-v-12fda737"]]),Jo={class:"chat-name"},qo={key:0,class:"message-count"},Go=T({__name:"MessengerChannel",props:{channel:Object,state:Object},emits:["selectChannel"],setup(t,{emit:e}){const n=()=>e("selectChannel"),o=a=>{if(!a)return{background:"#000"};let s=0;for(let c=0;c<a.length;c++)s=a.charCodeAt(c)+((s<<5)-s),s=s&s;let i="#";for(let c=0;c<3;c++)i+=`00${(s>>c*8&255).toString(16)}`.substr(-2);return{background:i}};return(a,s)=>(f(),v(q,{"active-class":"bg-blue-grey-1 text-grey-8",active:`${t.state.channelAddr}`==`${t.channel.pubkey}`},{default:l(()=>[r(F,{class:"chat-item cursor-pointer",onClick:n},{default:l(()=>[u("div",{class:"chat-badge",style:wn(o(`${t.channel.pubkey}`))},[u("span",null,B(t.channel.data.name.slice(0,2)),1)],4),u("div",Jo,B(t.channel.data.name),1),t.channel.data.messageCount?(f(),I("div",qo,B(t.channel.data.messageCount),1)):ce("",!0)]),_:1})]),_:1},8,["active"]))}});const Ho=N(Go,[["__scopeId","data-v-81b27653"]]),Xo=15;function $t(){const t=ue(),{state:e}=Z(),n=Ee(),o=k(()=>!!t.publicKey.value),a=k(()=>{var y;return((y=e.channelMembership)==null?void 0:y.status.__kind)==="Authorized"}),s=k(()=>{var y;return((y=e.channelMembership)==null?void 0:y.status.__kind)==="Pending"}),i=k(()=>{var y,A;return a.value&&((y=e.channel)==null?void 0:y.creator.toString())===String((A=t.publicKey.value)!=null?A:"-")}),c=k(()=>a.value&&!e.sending),g=k(()=>a.value),h=y=>k(()=>{var A;return i.value&&String(y.key)!==String((A=n.keypair)==null?void 0:A.publicKey)}).value,D=k(()=>o.value&&!e.loading&&!a.value),w=k(()=>e.channelMembers.filter(y=>Ds(y.data.status)).length),x=k(()=>{const y=[];let A=0,_;for(const S of e.channelMessages)_&&`${S.sender}`==`${_}`?y[A-1].text.push(S.content):(_=S.sender,y.push({id:S.id,sender:S.sender,senderFormatted:S.senderFormatted,text:[S.content],date:S.createdAt}),A++);return y});return{isWalletConnected:o,isAuthorizedMember:a,isPendingMember:s,isChannelCreator:i,canJoinChannel:D,canDeleteMember:h,canAddMember:g,allowSend:c,pendingMemberCount:w,messages:x}}function Zo(){const{createChannel:t}=Z(),{isWalletConnected:e,ok:n,error:o}=$e(),a=ne({dialog:!1,name:"",maxMessages:Xo,loading:!1});async function s(){if(e())try{await t(a.name,a.maxMessages),i(),n("Channel was created!")}catch(c){o("Something went wrong"),console.log(c)}}function i(){a.dialog=!1,a.loading=!1,a.name="",a.maxMessages=15}return{state:a,submit:s,reset:i}}function Yo(){const{authorizeMember:t}=Z(),{ok:e,error:n}=$e(),o=ne({loading:!1,dialog:!1});async function a(s){try{o.loading=!0,await t(s),e("Member was authorized")}catch(i){n("Something went wrong"),console.log(i)}finally{o.loading=!1}}return{state:o,submit:a}}function ei(){const{state:t,addMember:e}=Z(),{ok:n,info:o,error:a}=$e(),s=ne({dialog:!1,loading:!1});async function i(g){if(s.loading=!0,!t.channelAddr){o("Please select a channel");return}try{return await e(g.authority,g.key,g.name),n("Member was added"),!0}catch(h){a("Something went wrong"),console.log(h)}finally{s.loading=!1}return!1}function c(){s.loading=!1,s.dialog=!1}return{state:s,submit:i,reset:c}}function ti(){const{deleteMember:t}=Z(),{ok:e,error:n}=$e(),o=ne({loading:!1});async function a(s){try{o.loading=!0,await t(s),e("Member was deleted")}catch(i){n("Something went wrong"),console.log(i)}finally{o.loading=!1}}return{state:o,submit:a}}function ni(){const{state:t,joinChannel:e}=Z(),{ok:n,info:o,error:a}=$e(),s=ne({dialog:!1,loading:!1,name:""});async function i(){if(!t.channelAddr){o("Please select a channel");return}s.loading=!0;try{await e(t.channelAddr,s.name),c(),n("Request was sent")}catch(g){console.log("Error",g),a("Something went wrong")}finally{s.loading=!1}}function c(){s.loading=!1,s.dialog=!1,s.name=""}return{state:s,submit:i,reset:c}}function $e(){const t=ue(),{notify:e}=ye(),n=i=>e({type:"positive",message:i,timeout:2e3}),o=i=>e({type:"info",message:i,timeout:2e3}),a=i=>e({type:"negative",message:i,timeout:2e3});function s(){return t.publicKey.value?!0:(o("Please connect wallet"),!1)}return{ok:n,info:o,error:a,isWalletConnected:s}}const ai={class:"panel-search"},si={class:"search-wrapper"},oi={class:"panel-info"},ii={class:"chat-info"},ri={class:"chat-members"},li={class:"chat-messages"},ci={class:"chat-name"},ui=T({__name:"MessengerToolbar",emits:["search","showMembers","deleteChannel","addMember","showDeviceKey"],setup(t,{emit:e}){const n=ue(),{state:o}=Z(),{canAddMember:a,isChannelCreator:s}=$t(),i=k(()=>!!n.publicKey.value),c=Q(""),g=k(()=>o.channel),h=k(()=>{var A,_,S;return((A=g.value)==null?void 0:A.memberCount)===null||((_=g.value)==null?void 0:_.memberCount)===void 0?"":`${(S=g.value)==null?void 0:S.memberCount}\xA0members`}),D=k(()=>{var A,_,S;return((A=g.value)==null?void 0:A.messageCount)===null||((_=g.value)==null?void 0:_.messageCount)===void 0?"":`${(S=g.value)==null?void 0:S.messageCount}\xA0messages`}),w=A=>e("search",A),x=()=>e("showMembers"),y=()=>e("addMember");return(A,_)=>(f(),v(it,{class:"panel-toolbar"},{default:l(()=>{var S;return[u("div",ai,[u("div",si,[r(H,{modelValue:c.value,"onUpdate:modelValue":[_[0]||(_[0]=L=>c.value=L),_[1]||(_[1]=L=>w(c.value))],class:"search-input no-margin q-pa-none",placeholder:"Search ...",clearable:"",debounce:"300",borderless:"",onClear:_[2]||(_[2]=L=>w(""))},null,8,["modelValue"])])]),u("div",oi,[u("div",ii,[u("div",ri,B(d(h)),1),u("div",li,B(d(D)),1)]),r(rt,{class:""}),u("div",ci,B((S=d(g))==null?void 0:S.name),1),u("div",null,[r(z,{class:"chat-menu",flat:"",unelevated:"",disable:!d(i)},{default:l(()=>[r(An,{name:d(Cn)},null,8,["name"]),r(Sn,{anchor:"bottom left",self:"top left"},{default:l(()=>[r(Be,{style:{"min-width":"150px"},bordered:""},{default:l(()=>[Se((f(),v(q,{clickable:"",onClick:_[3]||(_[3]=L=>A.$emit("showDeviceKey"))},{default:l(()=>[r(F,null,{default:l(()=>[$("Device key")]),_:1})]),_:1})),[[Me]]),Se((f(),v(q,{clickable:"",disable:!d(g),onClick:x},{default:l(()=>[r(F,null,{default:l(()=>[$("Members")]),_:1})]),_:1},8,["disable"])),[[Me]]),Se((f(),v(q,{clickable:"",disable:!d(a),onClick:y},{default:l(()=>[r(F,null,{default:l(()=>[$("Add member")]),_:1})]),_:1},8,["disable"])),[[Me]]),Se((f(),v(q,{clickable:"",disable:!d(s),onClick:_[4]||(_[4]=L=>A.$emit("deleteChannel"))},{default:l(()=>[r(F,null,{default:l(()=>[$("Delete")]),_:1})]),_:1},8,["disable"])),[[Me]])]),_:1})]),_:1})]),_:1},8,["disable"])])])]}),_:1}))}});const di=N(ui,[["__scopeId","data-v-83438506"]]),mi={class:"messenger-wrapper"},hi={class:"messenger-main"},pi={key:1,class:"messenger-channels-empty"},gi={key:0,class:"q-my-md q-px-lg"},fi={class:"col col-4"},yi={class:"col"},bi={class:"no-margin"},_i=T({__name:"Messenger",setup(t){ye();const e=ue(),{state:n,postMessage:o,loadChannel:a}=Z(),{isWalletConnected:s,isAuthorizedMember:i,isPendingMember:c,messages:g,allowSend:h,canJoinChannel:D,isChannelCreator:w}=$t(),x=Zo(),y=ni(),A=ei(),_=Yo(),S=ti(),L=ne({message:""});async function de(O){await o(O.value),L.message=""}async function oe(O){await a(O)}function C(O){const E=e.publicKey.value;return E?String(E)!==String(O):!0}const p=ne({text:""}),b=O=>{p.text=O},M=k(()=>n.allChannels.filter(O=>O.data.name.includes(p.text))),ie=()=>{_.state.dialog=!0},J=Q(!1),re=Q(!1),Ce=Mn(re);return(O,E)=>{const Dt=di,Kt=Ho,Pt=Qo,It=Ro,zt=Ko,Bt=$o,Tt=Mo,Wt=wo,Nt=_s;return f(),I(G,null,[u("div",mi,[r(Dt,{onSearch:b,onShowMembers:ie,onDeleteChannel:E[0]||(E[0]=K=>d(S).submit(d(n).channelAddr)),onAddMember:E[1]||(E[1]=K=>d(A).state.dialog=!0),onShowDeviceKey:E[2]||(E[2]=K=>J.value=!0)}),u("div",hi,[r(X,{class:"messenger-channels"},{default:l(()=>[d(M).length>0?(f(),v(Be,{key:0,separator:"",class:"channels-list"},{default:l(()=>[(f(!0),I(G,null,he(d(M),K=>(f(),v(Kt,{key:K.name,channel:K,state:d(n),onSelectChannel:Ui=>oe(K.pubkey)},null,8,["channel","state","onSelectChannel"]))),128))]),_:1})):(f(),I("div",pi," No channels ")),r(xe,{showing:d(n).loading,color:"primary"},null,8,["showing"]),r(Pt,{"can-join-channel":d(D),"is-authorized-member":d(i),"is-pending-member":d(c),"is-wallet-connected":d(s),onCreateChannel:E[3]||(E[3]=K=>d(x).state.dialog=!0),onJoinChannel:E[4]||(E[4]=K=>d(y).state.dialog=!0)},null,8,["can-join-channel","is-authorized-member","is-pending-member","is-wallet-connected"])]),_:1}),r(It,{channel:d(n).channel,"allow-send":d(h),"channel-loading-state":d(n).channelLoading,"is-someone-message":C,messages:d(g),"post-message-state":L,"sending-state":d(n).sending,onSendMessage:de},null,8,["channel","allow-send","channel-loading-state","messages","post-message-state","sending-state"])])]),r(zt,{modelValue:d(x).state.dialog,"onUpdate:modelValue":E[5]||(E[5]=K=>d(x).state.dialog=K),loading:d(x).state.loading,"default-state":d(x).state,onSubmit:d(x).submit,onReset:d(x).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),r(Bt,{modelValue:d(A).state.dialog,"onUpdate:modelValue":E[6]||(E[6]=K=>d(A).state.dialog=K),loading:d(A).state.loading,"default-state":d(A).state,onSubmit:d(A).submit,onReset:d(A).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),r(Tt,{modelValue:d(y).state.dialog,"onUpdate:modelValue":E[7]||(E[7]=K=>d(y).state.dialog=K),loading:d(y).state.loading,"default-state":d(y).state,onSubmit:d(y).submit,onReset:d(y).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),r(Wt,{modelValue:d(_).state.dialog,"onUpdate:modelValue":E[8]||(E[8]=K=>d(_).state.dialog=K),"is-authorized-member":d(i),wallet:d(e),"authorize-member-state":d(_).state,"delete-member-state":d(S).state,onSubmit:d(_).submit,onDeleteMember:d(S).submit},null,8,["modelValue","is-authorized-member","wallet","authorize-member-state","delete-member-state","onSubmit","onDeleteMember"]),r(Nt,{modelValue:J.value,"onUpdate:modelValue":E[9]||(E[9]=K=>J.value=K)},null,8,["modelValue"]),d(n).channel?(f(),I("div",gi,[r(z,{flat:"",class:"text-blue-2",onClick:E[10]||(E[10]=K=>d(Ce)())},{default:l(()=>[$(" debug info ")]),_:1}),re.value?(f(!0),I(G,{key:0},he([["Authorized",d(i)],["Pending Access",d(c)],["Channel Creator",d(w)],["Channel",d(n).channel],["Membership",d(n).channelMembership],["Members",d(n).channelMembers]],K=>(f(),I("div",{key:K[0],class:"row q-mt-md"},[u("div",fi,B(K[0]),1),u("div",yi,[u("pre",bi,B(K[1]),1)])]))),128)):ce("",!0)])):ce("",!0)],64)}}});const vi=N(_i,[["__scopeId","data-v-acf5c2d8"]]);const wi={},Ai={class:"container"},Ci={class:"messenger-container"},Si={class:"container"};function Mi(t,e){const n=vi,o=gs;return f(),v(kn,{class:"page-wrapper"},{default:l(()=>[u("div",Ai,[u("div",Ci,[r(n)])]),u("div",Si,[r(o)])]),_:1})}const ki=N(wi,[["render",Mi],["__scopeId","data-v-18bb8d3b"]]),xi=()=>yt(()=>import("./_...all_.4cb9a979.js"),["assets/_...all_.4cb9a979.js","assets/vendor.cf3dae5c.js","assets/_...all_.73169310.css"]),Ei=[{name:"index",path:"/",component:ki,props:!0},{name:"all",path:"/:all(.*)*",component:xi,props:!0,meta:{layout:"empty"}}],$i=os(Ei),Di="/sol-messenger/",Ki=xn({history:En(Di),scrollBehavior:()=>({left:0,top:0}),strict:!0,routes:$i}),Pi=({app:t})=>{t.use(Ki)},Ii=Object.freeze(Object.defineProperty({__proto__:null,install:Pi},Symbol.toStringTag,{value:"Module"})),zi=({app:t})=>{t.use($n,{wallets:[new Dn,new Kn,new Pn,new In,new zn,new Bn,new Tn,new Wn,new Nn,new Ln,new Rn,new Vn,new Fn,new On,new Un,new jn,new Qn,new Jn,new qn,new Gn,new Hn,new Xn,new Zn,new Yn,new ea,new ta,new na,new aa,new sa,new oa],autoConnect:!1})},Bi=Object.freeze(Object.defineProperty({__proto__:null,install:zi},Symbol.toStringTag,{value:"Module"})),Ti=ia();function Wi(){return Ti}const Ni=Symbol("WALLET_CONNECT_EVENT"),Li=Symbol("WALLET_DISCONNECT_EVENT"),Ri=Symbol("ACCOUNT_CHANGE_EVENT"),He=5e3;function Vi(){const{connection:t}=lt(),{emit:e}=Wi(),{notify:n}=ye(),{wallet:o}=ue();et(o,a=>{if(!a)return;const s=()=>{const g=a.adapter.publicKey;t.onAccountChange(g,h=>{e(Ri,h)}),t.onLogs(g,h=>{console.log(h)}),n({message:"Wallet update",caption:`Connected to wallet ${Re(g.toBase58(),7)}`,timeout:He}),e(Ni,a)},i=()=>{n({message:"Wallet update",caption:"Disconnected from wallet",timeout:He}),e(Li,a)},c=g=>{!(g!=null&&g.message)||n({type:"negative",message:"Wallet update",caption:g.message,timeout:He})};a.adapter.once("connect",s),a.adapter.once("disconnect",i),a.adapter.removeAllListeners("error"),a.adapter.on("error",c)},{immediate:!0})}const Fi=T({__name:"App",setup(t){return ra(()=>{Vi()}),(e,n)=>{const o=Te("router-view");return f(),v(o)}}});async function Oi(){const t=la(Fi);Object.values(Object.assign({"./plugins/pinia.ts":ua,"./plugins/quasar.ts":ma,"./plugins/router.ts":Ii,"./plugins/wallet.ts":Bi})).forEach(e=>{var n;return(n=e.install)==null?void 0:n.call(e,{app:t})}),t.mount("#app")}Oi().then();export{N as _};
