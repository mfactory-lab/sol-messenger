var Tt=Object.defineProperty;var Bt=(t,e,n)=>e in t?Tt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var L=(t,e,n)=>(Bt(t,typeof e!="symbol"?e+"":e,n),n);import{c as Wt,Q as Nt,P as Lt,D as Vt,N as Rt,a as Ot,i as Ft,u as We,b as at,d as V,o as g,e as b,w as c,f as u,g as D,h as o,j as st,k as p,l as Ut,r as U,m as y,n as P,p as de,q as jt,s as Qt,S as Jt,t as T,v as B,x as ft,y as z,z as ne,A as j,B as ue,C as Gt,E as ee,F as J,G as qt,H as me,I as Z,J as wt,W as yt,K as Ce,L as Ae,M as Ht,O as Ne,R as Xt,T as Zt,U as Le,V as _e,X as it,Y as re,Z as Yt,_ as Ve,$ as dt,a0 as mt,a1 as en,a2 as tn,a3 as nn,a4 as Mt,a5 as pt,a6 as an,a7 as ie,a8 as Ie,a9 as ke,aa as xe,ab as sn,ac as Ct,ad as rn,ae as on,af as h,ag as X,ah as At,ai as oe,aj as le,ak as Ee,al as St,am as ve,an as ln,ao as Re,ap as kt,aq as rt,ar as cn,as as un,at as dn,au as mn,av as pn,aw as ae,ax as pe,ay as bt,az as be,aA as hn,aB as Oe,aC as Fe,aD as te,aE as $e,aF as gn,aG as fn,aH as yn,aI as bn,aJ as _n,aK as vn,aL as wn,aM as Mn,aN as Cn,aO as An,aP as Sn,aQ as kn,aR as xn,aS as En,aT as $n,aU as Dn,aV as Kn,aW as Pn,aX as In,aY as zn,aZ as Tn,a_ as Bn,a$ as Wn,b0 as Nn,b1 as Ln,b2 as Vn,b3 as Rn,b4 as On,b5 as Fn,b6 as Un,b7 as jn,b8 as Qn,b9 as Jn,ba as Gn,bb as qn,bc as Hn,bd as Xn,be as Zn,bf as Yn,bg as ea,bh as ta,bi as na,bj as aa}from"./vendor.4e722742.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const sa=({app:t})=>{const e=Wt();t.use(e)},ia=Object.freeze(Object.defineProperty({__proto__:null,install:sa},Symbol.toStringTag,{value:"Module"})),ra=({app:t})=>{t.use(Nt,{plugins:{Dark:Lt,Dialog:Vt,Notify:Rt,LocalStorage:Ot},iconSet:Ft})},oa=Object.freeze(Object.defineProperty({__proto__:null,install:ra},Symbol.toStringTag,{value:"Module"}));function la(){const{dark:t}=We(),e=at("theme-mode",t.isActive);return t.set(e.value),{isActive:e,set(n){t.set(n),e.value=t.isActive},toggle(){t.toggle(),e.value=t.isActive}}}const ca={class:"container"},ua={class:"row"},da=u("div",{class:"col-12 col-md-6"},[u("div",{class:"footer-links"},[u("ul",null,[u("li",null,[u("a",{target:"_blank",href:"https://jpool.one"},"JPOOL")]),u("li",null,[u("a",{target:"_blank",href:"https://heartandsol.one"},"GAME")]),u("li",null,[u("a",{href:"https://magiceden.io/marketplace/heartandsol"},"NFT Marketplace")])])]),u("div",{class:"copyright"},[u("span",null,"\xA9 Copyright 2022 jpool.one. All rights reserved. Powered by mFactory GmbH")])],-1),ma={class:"col-12 col-md-6 social-col"},pa={class:"social"},ha={class:"theme"},ga=u("div",{class:"social-link social-link-text"},[u("span",null,[D("official"),u("br"),D("channel")])],-1),fa=u("div",{class:"social-link telegram"},null,-1),ya=u("div",{class:"social-link twitter"},null,-1),ba=u("div",{class:"social-link discord"},null,-1),_a=V({__name:"AppFooter",setup(t){const e=la();return(n,i)=>(g(),b(Ut,null,{default:c(()=>[u("div",ca,[u("div",ua,[da,u("div",ma,[u("div",pa,[u("div",ha,[D(" Dark theme "),o(st,{"model-value":p(e).isActive.value,onClick:p(e).toggle},null,8,["model-value","onClick"])]),ga,fa,ya,ba])])])])]),_:1}))}});function va(){const t=U(wa());return{userAgent:t,isMobileOs:y(()=>Ma(t.value)),isWebView:y(()=>Ca(t.value))}}let et;function wa(){var t,e;return et===void 0&&(et=(e=(t=globalThis.navigator)==null?void 0:t.userAgent)!=null?e:null),et}function Ma(t){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)}function Ca(t){return/(WebView|(Phantom|Solflare)|Version\/.+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+)|; wv\).+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+))/i.test(t)}function Ue(t,e=4){return t instanceof P&&(t=t.toBase58()),`${t.slice(0,e)}...${t.slice(-e)}`}const Aa=t=>{if(!t)return{background:"#000"};let e=0;for(let i=0;i<t.length;i++)e=t.charCodeAt(i)+((e<<5)-e),e=e&e;let n="#";for(let i=0;i<3;i++)n+=`00${(e>>i*8&255).toString(16)}`.substr(-2);return{background:n}},Sa="/sol-messenger/assets/clover.968404b0.svg",ka="/sol-messenger/assets/ledger.40cf6861.svg",xa="/sol-messenger/assets/mathwallet.1d763e81.svg",xt=t=>(Ce("data-v-b79b08f0"),t=t(),Ae(),t),Ea=xt(()=>u("div",{class:"text-h6 text-center"}," Your wallet ",-1)),$a={class:"q-gutter-md row justify-between"},Da=xt(()=>u("div",{class:"text-h6"}," Connect to a wallet ",-1)),Ka={class:"text-light-gray text-caption full-width text-no-wrap",style:{"text-overflow":"ellipsis",overflow:"hidden"}},Pa=["src","alt"],Ia=V({__name:"ConnectWallet",setup(t){const e={priority:{solflare:10,phantom:20,sollet:5,nufi:5,blocto:1},icons:{clover:Sa},darkIcons:{ledger:ka,mathwallet:xa},deepLinks:{phantom:"https://phantom.app/ul/browse/{uri}?ref={ref}",solflare:"https://solflare.com/ul/browse/{uri}?ref={ref}"}},{userAgent:n,isWebView:i,isMobileOs:s}=va(),a={close:wt},r=v=>[yt.Installed,yt.Loadable].includes(v.readyState);We();const l=de(),{connected:d,connecting:m}=l;jt();const _=y(()=>s.value&&!i.value);if(i.value){const v=String(n.value).toLowerCase();v.includes("phantom")?(l.select(Qt),l.connect()):v.includes("solflare")&&(l.select(Jt),l.connect())}const E=y(()=>{var v,W;return(W=(v=l.publicKey.value)==null?void 0:v.toBase58())!=null?W:""}),w=y(()=>Ue(E.value)),$=y(()=>[...l.wallets.value].map(v=>{var S,M;const W=v.adapter.name.toLowerCase();return v.adapter.icon=(M=(S=e.darkIcons[W])!=null?S:e.icons[W])!=null?M:v.adapter.icon,_.value&&e.deepLinks[W]&&(v.deepLink=e.deepLinks[W].replace("{uri}",location.href).replace("{ref}",location.origin)),v}).sort((v,W)=>{var f,A;const S=(f=e.priority[v.adapter.name.toLowerCase()])!=null?f:1;return((A=e.priority[W.adapter.name.toLowerCase()])!=null?A:1)-S+((r(W)?1:0)-(r(v)?1:0))})),k=y(()=>_.value?$.value.filter(v=>!!v.deepLink):$.value),C=U(!1);async function N(v){await l.select(v.adapter.name),C.value=!1,await l.connect()}function F(){C.value=!1,l.disconnect()}function K(){C.value=!0}function q(){C.value=!1}return(v,W)=>(g(),T(Z,null,[p(d)?(g(),b(z,ft({key:0},v.$attrs,{class:v.$style.btn,ripple:!1,color:"primary-gray","text-color":"white",rounded:"",unelevated:"",onClick:K}),{default:c(()=>[D(B(p(w)),1)]),_:1},16,["class"])):(g(),b(z,ft({key:1},v.$attrs,{color:"primary-gray","text-color":"white",rounded:"",unelevated:"",ripple:!1,loading:p(m),onClick:K}),{default:c(()=>[D(" CONNECT WALLET ")]),_:1},16,["loading"])),o(me,{modelValue:C.value,"onUpdate:modelValue":W[0]||(W[0]=S=>C.value=S),"transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:c(()=>[p(d)?(g(),b(ne,{key:0},{default:c(()=>[o(j,{class:"relative-position"},{default:c(()=>[Ea,o(z,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:q},null,8,["icon"])]),_:1}),o(ue),o(j,null,{default:c(()=>[D(B(p(E)),1)]),_:1}),o(ue),o(j,null,{default:c(()=>[u("div",$a,[o(z,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:F},{default:c(()=>[D(" Disconnect ")]),_:1}),o(z,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:q},{default:c(()=>[D(" Ok ")]),_:1})])]),_:1})]),_:1})):(g(),b(ne,{key:1,class:"wallet-connect-card"},{default:c(()=>[o(j,null,{default:c(()=>[Da,o(z,{padding:"md",color:"transparent","text-color":"primary-gray",unelevated:"",class:"absolute-right",icon:a.close,size:"md",onClick:q},null,8,["icon"])]),_:1}),o(ue),o(j,{style:{"max-height":"80vh"},class:"scroll"},{default:c(()=>[o(Gt,{grid:"",rows:p(k),"row-key":"name","hide-pagination":"","hide-header":"","rows-per-page-options":[100]},{item:c(({row:S})=>[(g(),T("div",{key:`wallet-${S.adapter.name}`,class:"col-12 col-md-6"},[o(ee,{clickable:"",href:S.deepLink,onClick:M=>S.deepLink?!0:N(S)},{default:c(()=>[o(J,null,{default:c(()=>[u("b",null,B(S.adapter.name),1),u("div",Ka,B(S.adapter.url),1)]),_:2},1024),o(J,{avatar:""},{default:c(()=>[o(qt,{square:""},{default:c(()=>[u("img",{src:S.adapter.icon,alt:S.adapter.name},null,8,Pa)]),_:2},1024)]),_:2},1024)]),_:2},1032,["href","onClick"])]))]),_:1},8,["rows"])]),_:1})]),_:1}))]),_:1},8,["modelValue"])],64))}});const za="_btn_6n1iw_1",Ta={btn:za},O=(t,e)=>{const n=t.__vccOpts||t;for(const[i,s]of e)n[i]=s;return n},Ba={$style:Ta},Wa=O(Ia,[["__cssModules",Ba],["__scopeId","data-v-b79b08f0"]]),we=[{id:"serum-mainnet",name:"Serum RPC",cluster:"mainnet-beta",url:"https://solana-api.projectserum.com/"},{id:"rpcpool-mainnet",name:"RPCPool RPC",cluster:"mainnet-beta",url:"https://mainnet.rpcpool.com/"},{id:"mainnet",name:"Solana RPC",cluster:"mainnet-beta",url:Ht("mainnet-beta")}],Et={id:"devnet",name:"DevNet",cluster:"devnet",url:"https://devnet.rpcpool.com/"};we.push(Et);const Na={id:"testnet",name:"TestNet",cluster:"testnet",url:"https://testnet.rpcpool.com/"};we.push(Na);var vt;const La=(vt=we.find(t=>t.id==={VITE_BASE_PATH:"/sol-messenger/",VITE_USER_NODE_ENV:"production",BASE_URL:"/sol-messenger/",MODE:"staging",DEV:!1,PROD:!0}.VITE_CONNECTION_ENDPOINT))!=null?vt:Et,Va="confirmed",Ra=12e4,Oa=["94ScvxCuJbVaS2YdaveHGijQ4vtHb6XCzT2ejXhwxiLB","o8vV9bLYBPwoWmS2meSXWyTLdwfhLhEzYsBkopWUNyY"],ht=Ne({id:"connection",state:()=>({commitment:Va,confirmTransactionInitialTimeout:Ra,rpc:Xt("rpc","")}),getters:{endpoint(t){var e;return(e=we.find(n=>n.id===t.rpc))!=null?e:La},connection(t){return console.log("[connection]",this.endpoint.url),new Zt(this.endpoint.url,{confirmTransactionInitialTimeout:t.confirmTransactionInitialTimeout,commitment:t.commitment})},cluster(){return this.endpoint.cluster}},actions:{setRpc(t){this.rpc=t},setCommitment(t){this.commitment=t}}}),Fa=V({__name:"ClusterSelector",setup(t){const e=ht(),{connected:n,connect:i,disconnect:s,autoConnect:a}=de(),r=[we.filter(m=>m.cluster==="mainnet-beta"),we.filter(m=>m.cluster!=="mainnet-beta")],l=y(()=>e.endpoint),d=m=>{n&&e.cluster!==m.cluster&&(s(),a.value&&i()),e.setRpc(m.id)};return(m,_)=>(g(),b(Yt,{label:p(l).name,"model-value":!1,"auto-close":"",color:"secondary","text-color":"#000",rounded:"",unelevated:"",ripple:!1},{default:c(()=>[o(Le,null,{default:c(()=>[(g(),T(Z,null,_e(r,(E,w)=>(g(),T(Z,{key:`${w}-cluster-group`},[(g(!0),T(Z,null,_e(E,$=>(g(),b(ee,{key:$.id,clickable:"",onClick:k=>d($)},{default:c(()=>[(g(),b(J,{key:`${$.id}-item`},{default:c(()=>[o(it,null,{default:c(()=>[u("b",null,B($.name),1)]),_:2},1024),D(" "+B($.url),1)]),_:2},1024))]),_:2},1032,["onClick"]))),128)),w!==r.length-1?(g(),b(ue,{key:0})):re("",!0)],64))),64))]),_:1})]),_:1},8,["label"]))}});const Ua={},ja={class:"container"},Qa={class:"app-header__info"},Ja={class:"app-header__logo"},Ga={class:"logo-wrapper"},qa=u("div",{class:"app-header__title"},[u("h1",null,[D("BLOCKCHAIN messenger "),u("span",{class:"marked"},"SOLANA")])],-1),Ha={class:"app-header__right"},Xa={class:"app-header__buttons"};function Za(t,e){const n=Ve("router-link"),i=Fa,s=Wa;return g(),b(en,{class:"app-header"},{default:c(()=>[u("div",ja,[o(dt,null,{default:c(()=>[u("div",Qa,[u("div",Ja,[u("div",Ga,[o(n,{to:"/"})])]),qa]),o(mt),u("div",Ha,[u("div",Xa,[o(i,{class:"app-header__cluster-btn header-btn"}),o(s,{class:"app-header__wallet-btn header-btn"})])])]),_:1})])]),_:1})}const Ya=O(Ua,[["render",Za]]),es={};function ts(t,e){const n=Ya,i=Ve("router-view"),s=_a;return g(),b(tn,{view:"lfh Lpr lff"},{default:c(()=>[o(n),o(nn,null,{default:c(()=>[o(i)]),_:1}),o(s)]),_:1})}const ns=O(es,[["render",ts]]),as={default:ns,empty:()=>Mt(()=>import("./empty.5b810678.js"),["assets/empty.5b810678.js","assets/vendor.4e722742.js"])};function ss(t){return t.map(e=>{var n;return{path:e.path,component:as[((n=e.meta)==null?void 0:n.layout)||"default"],children:[{...e,path:""}]}})}const is="/sol-messenger/assets/solana-logo.3caace62.svg";const rs={},je=t=>(Ce("data-v-5ffd3a8e"),t=t(),Ae(),t),os={class:"row info-row"},ls=je(()=>u("div",{class:"offset-0 offset-md-3"},null,-1)),cs=je(()=>u("div",{class:"col-6 col-md-3 flex-center info-col"},[u("div",{class:"info-title"}," How IT WORKS "),u("div",{class:"info-text"},[u("ul",null,[u("li",null,"Connect your wallet"),u("li",null,"Enter the amount of JPLT you want to swap or enter the amount of JPLU you want to get"),u("li",null,"Click SWAP button"),u("li",null,"Confirm the transaction in your wallet"),u("li",null,"Done")])])],-1)),us={class:"col-6 col-md-5 logo-wrap"},ds=je(()=>u("img",{src:is,alt:"solana logo"},null,-1)),ms=je(()=>u("div",{class:"offset-0 offset-md-1"},null,-1));function ps(t,e){const n=Ve("router-link");return g(),T("div",os,[ls,cs,u("div",us,[o(n,{to:"/"},{default:c(()=>[ds]),_:1})]),ms])}const hs=O(rs,[["render",ps],["__scopeId","data-v-5ffd3a8e"]]),$t=Ne("user",()=>{const t=pt(),e=U();an(()=>{var s;const i=(s=t.value)==null?void 0:s.publicKey;if(i){const a=at(i.toString(),()=>Ie.encode(ie.generate().secretKey));e.value=ie.fromSecretKey(Ie.decode(a.value))}else e.value=void 0});function n(){var a;const i=(a=t.value)==null?void 0:a.publicKey;if(!i)return;const s=at(i.toString(),"");s.value=Ie.encode(ie.generate().secretKey),e.value=ie.fromSecretKey(Ie.decode(s.value))}return{keypair:e,generateKey:n}}),gs=t=>(Ce("data-v-4f30d8b8"),t=t(),Ae(),t),fs=gs(()=>u("div",{class:"text-h6 text-center"}," Device Key ",-1)),ys={class:"q-gutter-md row justify-between"},bs=V({__name:"UserInfoDialog",emits:["regenerate"],setup(t){const e=$t(),n=()=>{var i,s;on(((s=(i=e.keypair)==null?void 0:i.publicKey)!=null?s:"").toString())};return(i,s)=>(g(),b(me,{class:"dialog-wrapper","transition-duration":"150","transition-show":"fade","transition-hide":"fade"},{default:c(()=>[o(ne,null,{default:c(()=>[o(j,{class:"row items-center"},{default:c(()=>[fs,o(mt),ke(o(z,{flat:"",round:"",dense:"",icon:p(wt)},null,8,["icon"]),[[xe]])]),_:1}),o(ue),o(j,null,{default:c(()=>{var a;return[o(z,{flat:"",round:"",dense:"",icon:p(sn),onClick:n},{default:c(()=>[o(Ct,{delay:0,anchor:"bottom middle",self:"top middle","transition-duration":"0"},{default:c(()=>[D(" Copy to clipboard ")]),_:1})]),_:1},8,["icon"]),u("span",null,B((a=p(e).keypair)==null?void 0:a.publicKey),1)]}),_:1}),o(ue),o(rn,{align:"right"},{default:c(()=>[u("div",ys,[o(z,{class:"dialog-submit-btn","text-color":"white",rounded:"",onClick:p(e).generateKey},{default:c(()=>[D(" Regenerate ")]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1}))}});const _s=O(bs,[["__scopeId","data-v-4f30d8b8"]]),vs="0.0.8",ws="messenger",Ms=[{name:"initChannel",accounts:[{name:"channel",isMut:!0,isSigner:!0},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"InitChannelData"}}]},{name:"deleteChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"joinChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"key",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"JoinChannelData"}}]},{name:"leaveChannel",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"grantAccessMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"GrantAccessMemberData"}}]},{name:"addMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"invitee",isMut:!1,isSigner:!1},{name:"inviteeMembership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AddMemberData"}}]},{name:"authorizeMember",accounts:[{name:"channel",isMut:!1,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"authorityMembership",isMut:!0,isSigner:!1},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"data",type:{defined:"AuthorizeMemberData"}}]},{name:"deleteMember",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!0,isSigner:!1},{name:"authorityMembership",isMut:!1,isSigner:!1},{name:"authority",isMut:!0,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[]},{name:"postMessage",accounts:[{name:"channel",isMut:!0,isSigner:!1},{name:"membership",isMut:!1,isSigner:!1},{name:"authority",isMut:!1,isSigner:!0},{name:"systemProgram",isMut:!1,isSigner:!1}],args:[{name:"message",type:"string"}]}],Cs=[{name:"Channel",type:{kind:"struct",fields:[{name:"name",docs:["Name of the channel"],type:"string"},{name:"creator",docs:["Channel creator"],type:"publicKey"},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"flags",docs:["Channel flags"],type:"u8"},{name:"memberCount",docs:["Number of members"],type:"u16"},{name:"messageCount",docs:["Message counter"],type:"u32"},{name:"maxMessages",docs:["The maximum number of messages that are stored in [messages]"],type:"u16"},{name:"messages",docs:["List of messages"],type:{vec:{defined:"Message"}}}]}},{name:"ChannelMembership",type:{kind:"struct",fields:[{name:"channel",docs:["Associated [Channel] address"],type:"publicKey"},{name:"authority",docs:["Authority of membership"],type:"publicKey"},{name:"key",docs:["The device key used to encrypt the `CEK`"],type:"publicKey"},{name:"cek",docs:["The content encryption key (CEK) of the channel"],type:{defined:"CEKData"}},{name:"status",docs:["Status of membership"],type:{defined:"ChannelMembershipStatus"}},{name:"name",docs:["Name of the channel member"],type:"string"},{name:"invitedBy",docs:["Inviter address"],type:{option:"publicKey"}},{name:"createdAt",docs:["Creation date"],type:"i64"},{name:"flags",docs:["Membership flags"],type:"u8"},{name:"bump",docs:["Bump seed for deriving PDA seeds"],type:"u8"}]}}],As=[{name:"AddMemberData",type:{kind:"struct",fields:[{name:"name",docs:["Member name"],type:"string"},{name:"flags",docs:["Membership flags, only `admin` and `owner` can set membership flags"],type:"u8"},{name:"cek",docs:["Content Encryption Key"],type:{defined:"CEKData"}},{name:"key",docs:["Device key"],type:{option:"publicKey"}}]}},{name:"AuthorizeMemberData",type:{kind:"struct",fields:[{name:"cek",type:{defined:"CEKData"}}]}},{name:"GrantAccessMemberData",type:{kind:"struct",fields:[{name:"flags",type:"u8"}]}},{name:"InitChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"maxMessages",type:"u16"},{name:"memberName",type:"string"},{name:"cek",type:{defined:"CEKData"}},{name:"public",type:"bool"},{name:"permissionless",type:"bool"}]}},{name:"JoinChannelData",type:{kind:"struct",fields:[{name:"name",type:"string"},{name:"authority",type:{option:"publicKey"}}]}},{name:"CEKData",type:{kind:"struct",fields:[{name:"header",docs:["The header information for the CEK"],type:"string"},{name:"encryptedKey",docs:["The CEK itself"],type:"string"}]}},{name:"Message",type:{kind:"struct",fields:[{name:"id",docs:["Uniq message id"],type:"u32"},{name:"sender",docs:["The message sender id"],type:"publicKey"},{name:"createdAt",docs:["The unix timestamp at which the message was received"],type:"i64"},{name:"flags",docs:["Message flags"],type:"u8"},{name:"content",docs:["The (typically encrypted) message content"],type:"string"}]}},{name:"ChannelMembershipStatus",type:{kind:"enum",variants:[{name:"Authorized",fields:[{name:"by",type:{option:"publicKey"}}]},{name:"Pending",fields:[{name:"authority",type:{option:"publicKey"}}]}]}}],Ss=[{name:"NewChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"name",type:"string",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"creator",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"NewMessageEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"message",type:{defined:"Message"},index:!1}]},{name:"JoinChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"LeaveChannelEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"authority",type:"publicKey",index:!0},{name:"timestamp",type:"i64",index:!1}]},{name:"AddMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"AuthorizeMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]},{name:"DeleteMemberEvent",fields:[{name:"channel",type:"publicKey",index:!0},{name:"membership",type:"publicKey",index:!0},{name:"by",type:"publicKey",index:!1},{name:"timestamp",type:"i64",index:!1}]}],ks=[{code:6e3,name:"Unauthorized",msg:"Unauthorized"},{code:6001,name:"InvalidChannel",msg:"Invalid channel"},{code:6002,name:"InvalidMembership",msg:"Invalid membership"},{code:6003,name:"InvalidMessage",msg:"Invalid message"},{code:6004,name:"NameTooLong",msg:"Name too long"},{code:6005,name:"MessageTooLong",msg:"Message too long"}],xs={address:"6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",origin:"anchor",binaryVersion:"0.25.0",libVersion:"0.25.0"},Es={version:vs,name:ws,instructions:Ms,accounts:Cs,types:As,events:Ss,errors:ks,metadata:xs},$s=new h.FixableBeetArgsStruct([["id",h.u32],["sender",X],["createdAt",h.i64],["flags",h.u8],["content",h.utf8String]],"Message"),ot=[49,159,99,106,220,87,219,88];class H{constructor(e,n,i,s,a,r,l,d){this.name=e,this.creator=n,this.createdAt=i,this.flags=s,this.memberCount=a,this.messageCount=r,this.maxMessages=l,this.messages=d}static fromArgs(e){return new H(e.name,e.creator,e.createdAt,e.flags,e.memberCount,e.messageCount,e.maxMessages,e.messages)}static fromAccountInfo(e,n=0){return H.deserialize(e.data,n)}static async fromAccountAddress(e,n,i){const s=await e.getAccountInfo(n,i);if(s==null)throw new Error(`Unable to find Channel account at ${n}`);return H.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return At.fromStruct(e,ze)}static deserialize(e,n=0){return ze.deserialize(e,n)}serialize(){return ze.serialize({accountDiscriminator:ot,...this})}static byteSize(e){const n=H.fromArgs(e);return ze.toFixedFromValue({accountDiscriminator:ot,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,i){return n.getMinimumBalanceForRentExemption(H.byteSize(e),i)}pretty(){return{name:this.name,creator:this.creator.toBase58(),createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,memberCount:this.memberCount,messageCount:this.messageCount,maxMessages:this.maxMessages,messages:this.messages}}}const ze=new h.FixableBeetStruct([["accountDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["name",h.utf8String],["creator",X],["createdAt",h.i64],["flags",h.u8],["memberCount",h.u16],["messageCount",h.u32],["maxMessages",h.u16],["messages",h.array($s)]],H.fromArgs,"Channel"),Qe=new h.FixableBeetArgsStruct([["header",h.utf8String],["encryptedKey",h.utf8String]],"CEKData"),Ds=h.dataEnum([["Authorized",new h.FixableBeetArgsStruct([["by",h.coption(X)]],'ChannelMembershipStatusRecord["Authorized"]')],["Pending",new h.FixableBeetArgsStruct([["authority",h.coption(X)]],'ChannelMembershipStatusRecord["Pending"]')]]),Be=[238,149,255,251,116,131,86,170];class Q{constructor(e,n,i,s,a,r,l,d,m,_){this.channel=e,this.authority=n,this.key=i,this.cek=s,this.status=a,this.name=r,this.invitedBy=l,this.createdAt=d,this.flags=m,this.bump=_}static fromArgs(e){return new Q(e.channel,e.authority,e.key,e.cek,e.status,e.name,e.invitedBy,e.createdAt,e.flags,e.bump)}static fromAccountInfo(e,n=0){return Q.deserialize(e.data,n)}static async fromAccountAddress(e,n,i){const s=await e.getAccountInfo(n,i);if(s==null)throw new Error(`Unable to find ChannelMembership account at ${n}`);return Q.fromAccountInfo(s,0)[0]}static gpaBuilder(e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){return At.fromStruct(e,Te)}static deserialize(e,n=0){return Te.deserialize(e,n)}serialize(){return Te.serialize({accountDiscriminator:Be,...this})}static byteSize(e){const n=Q.fromArgs(e);return Te.toFixedFromValue({accountDiscriminator:Be,...n}).byteSize}static async getMinimumBalanceForRentExemption(e,n,i){return n.getMinimumBalanceForRentExemption(Q.byteSize(e),i)}pretty(){return{channel:this.channel.toBase58(),authority:this.authority.toBase58(),key:this.key.toBase58(),cek:this.cek,status:this.status.__kind,name:this.name,invitedBy:this.invitedBy,createdAt:(()=>{const e=this.createdAt;if(typeof e.toNumber=="function")try{return e.toNumber()}catch{return e}return e})(),flags:this.flags,bump:this.bump}}}const Te=new h.FixableBeetStruct([["accountDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["channel",X],["authority",X],["key",X],["cek",Qe],["status",Ds],["name",h.utf8String],["invitedBy",h.coption(X)],["createdAt",h.i64],["flags",h.u8],["bump",h.u8]],Q.fromArgs,"ChannelMembership"),he=new Map,ge=new Map;class Je extends Error{constructor(){super("Unauthorized");L(this,"code",6e3);L(this,"name","Unauthorized");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Je)}}he.set(6e3,()=>new Je);ge.set("Unauthorized",()=>new Je);class Ge extends Error{constructor(){super("Invalid channel");L(this,"code",6001);L(this,"name","InvalidChannel");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ge)}}he.set(6001,()=>new Ge);ge.set("InvalidChannel",()=>new Ge);class qe extends Error{constructor(){super("Invalid membership");L(this,"code",6002);L(this,"name","InvalidMembership");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,qe)}}he.set(6002,()=>new qe);ge.set("InvalidMembership",()=>new qe);class He extends Error{constructor(){super("Invalid message");L(this,"code",6003);L(this,"name","InvalidMessage");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,He)}}he.set(6003,()=>new He);ge.set("InvalidMessage",()=>new He);class Xe extends Error{constructor(){super("Name too long");L(this,"code",6004);L(this,"name","NameTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Xe)}}he.set(6004,()=>new Xe);ge.set("NameTooLong",()=>new Xe);class Ze extends Error{constructor(){super("Message too long");L(this,"code",6005);L(this,"name","MessageTooLong");typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Ze)}}he.set(6005,()=>new Ze);ge.set("MessageTooLong",()=>new Ze);function se(t){const e=he.get(t);return e!=null?e():null}function ye(t){const e=ge.get(t);return e!=null?e():null}const Ks=new h.FixableBeetArgsStruct([["name",h.utf8String],["flags",h.u8],["cek",Qe],["key",h.coption(X)]],"AddMemberData"),Ps=new h.FixableBeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["data",Ks]],"AddMemberInstructionArgs"),Is=[13,116,123,130,126,198,57,34];function zs(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=Ps.serialize({instructionDiscriminator:Is,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.invitee,isWritable:!1,isSigner:!1},{pubkey:t.inviteeMembership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(r=t.systemProgram)!=null?r:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new le({programId:n,keys:s,data:i})}const Ts=new h.FixableBeetArgsStruct([["cek",Qe]],"AuthorizeMemberData"),Bs=new h.FixableBeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["data",Ts]],"AuthorizeMemberInstructionArgs"),Ws=[194,123,189,175,86,225,93,128];function Ns(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=Bs.serialize({instructionDiscriminator:Ws,...e}),s=[{pubkey:t.channel,isWritable:!1,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:(r=t.systemProgram)!=null?r:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new le({programId:n,keys:s,data:i})}const Ls=new h.BeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)]],"DeleteChannelInstructionArgs"),Vs=[145,225,187,221,157,142,114,133];function Rs(t,e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=Ls.serialize({instructionDiscriminator:Vs}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new le({programId:e,keys:i,data:n})}const Os=new h.BeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)]],"DeleteMemberInstructionArgs"),Fs=[95,14,98,112,252,218,205,173];function Us(t,e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=Os.serialize({instructionDiscriminator:Fs}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authorityMembership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new le({programId:e,keys:i,data:n})}const js=new h.BeetArgsStruct([["flags",h.u8]],"GrantAccessMemberData");new h.BeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["data",js]],"GrantAccessMemberInstructionArgs");const Qs=new h.FixableBeetArgsStruct([["name",h.utf8String],["maxMessages",h.u16],["memberName",h.utf8String],["cek",Qe],["public",h.bool],["permissionless",h.bool]],"InitChannelData"),Js=new h.FixableBeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["data",Qs]],"InitChannelInstructionArgs"),Gs=[21,200,152,39,19,178,76,47];function qs(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=Js.serialize({instructionDiscriminator:Gs,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!0},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(r=t.systemProgram)!=null?r:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new le({programId:n,keys:s,data:i})}const Hs=new h.FixableBeetArgsStruct([["name",h.utf8String],["authority",h.coption(X)]],"JoinChannelData"),Xs=new h.FixableBeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["data",Hs]],"JoinChannelInstructionArgs"),Zs=[124,39,115,89,217,26,38,29];function Ys(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=Xs.serialize({instructionDiscriminator:Zs,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:t.key,isWritable:!1,isSigner:!0},{pubkey:(r=t.systemProgram)!=null?r:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new le({programId:n,keys:s,data:i})}const ei=new h.BeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)]],"LeaveChannelInstructionArgs"),ti=[104,0,75,134,95,80,68,186];function ni(t,e=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var a;const[n]=ei.serialize({instructionDiscriminator:ti}),i=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!0,isSigner:!0},{pubkey:(a=t.systemProgram)!=null?a:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const r of t.anchorRemainingAccounts)i.push(r);return new le({programId:e,keys:i,data:n})}const ai=new h.FixableBeetArgsStruct([["instructionDiscriminator",h.uniformFixedSizeArray(h.u8,8)],["message",h.utf8String]],"PostMessageInstructionArgs"),si=[214,50,100,209,38,34,7,76];function ii(t,e,n=new P("6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm")){var r;const[i]=ai.serialize({instructionDiscriminator:si,...e}),s=[{pubkey:t.channel,isWritable:!0,isSigner:!1},{pubkey:t.membership,isWritable:!1,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!0},{pubkey:(r=t.systemProgram)!=null?r:oe.programId,isWritable:!1,isSigner:!1}];if(t.anchorRemainingAccounts!=null)for(const l of t.anchorRemainingAccounts)s.push(l);return new le({programId:n,keys:s,data:i})}const ri="6RSutwAoRcQPAMwyxZdNeG76fdAxzhgxkCJXpqKCBPdm",oi=new P(ri);function lt(t,e=new Uint8Array(4)){const n=Ee(t.toString(),"base10");return e.set(n,4-n.length),e}const tt=t=>ve([lt(t.length),t]);function Dt(t,e,n){if(e!==256)throw new Error(`Unsupported key length: ${e}`);const i=ve([tt(Ee(n)),tt(new Uint8Array(0)),tt(new Uint8Array(0)),lt(e)]),s=1;return ln.hash(ve([lt(s),t,i]))}const ct=t=>Ee(t,"base64pad"),ut=t=>St(t,"base64pad"),li=t=>Ee(t),ci=t=>St(t),ui=t=>Ee(t,"base58btc"),ce=Re.NONCE_LENGTH,Me=Re.TAG_LENGTH,Kt=t=>{const e=new Re.XChaCha20Poly1305(t);return(n,i)=>{const s=kt.randomBytes(ce),a=e.seal(s,n,i);return{ciphertext:a.subarray(0,a.length-Me),tag:a.subarray(a.length-Me),iv:s}}},Pt=t=>{const e=new Re.XChaCha20Poly1305(t);return(n,i,s,a)=>e.open(s,ve([n,i]),a)},It="ECDH-ES+XC20PKW",zt=256,di=t=>e=>{const n=rt.generateKeyPair(),i=rt.sharedKey(n.secretKey,t),s=Dt(i,zt,It),a=Kt(s)(e);return{encryptedKey:a.ciphertext,tag:a.tag,iv:a.iv,epPubKey:n.publicKey}},mi=t=>(e,n,i,s)=>{const a=rt.sharedKey(t,s),r=Dt(a,zt,It);return Pt(r)(e,n,i)},pi=t=>Array.isArray(t)?ie.fromSecretKey(dn.Buffer.from(t)):typeof t=="string"?ie.fromSecretKey(ui(t)):ie.fromSecretKey(t),hi=async(t=32)=>{const e=kt.randomBytes(t);return Promise.resolve(e)},gi=async(t,e)=>{const n=await di(cn(e.toBytes()))(t);return{header:ut(ve([n.iv,n.tag,n.epPubKey])),encryptedKey:ut(n.encryptedKey)}},fi=async(t,e)=>{const n=ct(t.header),i=n.subarray(0,ce),s=n.subarray(ce,ce+Me),a=n.subarray(ce+Me),r=ct(t.encryptedKey),l=pi(e).secretKey,d=un(l),m=await mi(d)(r,s,i,a);if(m===null)throw new Error("There was a problem decrypting the CEK");return m},yi=async(t,e)=>{const n=await Kt(e)(li(t));return ut(ve([n.iv,n.ciphertext,n.tag]))},bi=async(t,e)=>{const n=ct(t),i=n.subarray(0,ce),s=n.subarray(ce,-Me),a=n.subarray(-Me),r=await Pt(e)(s,a,i);if(r===null)throw new Error("There was an error decoding the message!");return ci(r)};class _i{constructor(e,n){L(this,"programId",oi);L(this,"_coder");L(this,"_events");L(this,"utils",{channel:{isPublic:e=>(e.flags&1)>0,isPermissionless:e=>(e.flags&2)>0},member:{isOwner:e=>e.flags>=255,isAdmin:e=>(e.flags&7)===7,canAddMember:e=>(e.flags&1)>0,canDeleteMember:e=>(e.flags&2)>0,canAuthorizeMember:e=>(e.flags&4)>0},message:{isEncrypted:e=>(e.flags&1)>0}});this.provider=e,this.keypair=n,this._coder=new mn(Es),this._events=new pn(this.programId,e,this._coder)}get connection(){return this.provider.connection}addEventListener(e,n){return this._events.addEventListener(e,n)}async removeEventListener(e){return await this._events.removeEventListener(e)}setKeypair(e){this.keypair=e}async loadAllChannels(){return(await H.gpaBuilder().addFilter("accountDiscriminator",ot).run(this.provider.connection)).map(n=>({pubkey:n.pubkey,data:H.fromAccountInfo(n.account)[0]}))}async loadChannel(e,n){return H.fromAccountAddress(this.provider.connection,e,n)}async loadMyChannels(){return await this.loadMemberships()}async loadChannelMembers(e){return(await Q.gpaBuilder().addFilter("accountDiscriminator",Be).addFilter("channel",e).run(this.provider.connection)).map(i=>({pubkey:i.pubkey,data:Q.fromAccountInfo(i.account)[0]}))}async loadMemberships(e){const n=Q.gpaBuilder().addFilter("accountDiscriminator",Be).addFilter("authority",this.provider.publicKey);return e&&n.addFilter("key",e),(await n.run(this.provider.connection)).map(s=>({pubkey:s.pubkey,data:Q.fromAccountInfo(s.account)}))}async loadMembership(e,n){return Q.fromAccountAddress(this.provider.connection,e,n)}async getMembershipPDA(e,n){return n=n!=null?n:this.keypair.publicKey,await P.findProgramAddress([e.toBuffer(),n.toBuffer()],this.programId)}async encryptCEK(e,n){return gi(e,n!=null?n:this.keypair.publicKey)}async decryptCEK(e,n){return fi(e,n!=null?n:this.keypair.secretKey)}async encryptMessage(e,n){return yi(e,n)}async decryptMessage(e,n){return bi(e,n)}async initChannel(e){var m,_,E,w,$;const n=(m=e.channel)!=null?m:ie.generate(),i=await hi(),s=await this.encryptCEK(i),[a]=await this.getMembershipPDA(n.publicKey),r=this.provider.publicKey,l=new ae;l.add(qs({key:this.keypair.publicKey,channel:n.publicKey,membership:a,authority:r},{data:{name:e.name,public:(_=e.public)!=null?_:!1,permissionless:(E=e.permissionless)!=null?E:!1,memberName:(w=e.memberName)!=null?w:"",maxMessages:e.maxMessages,cek:s}}));let d;try{d=await this.provider.sendAndConfirm(l,[n,this.keypair],e.opts)}catch(k){throw($=se(k.code))!=null?$:k}return{signature:d,channel:n,cek:i,cekEncrypted:s}}async deleteChannel({channel:e,opts:n}){var l;const i=this.provider.publicKey,[s]=await this.getMembershipPDA(e),a=new ae;a.add(Rs({channel:e,authority:i,authorityMembership:s}));let r;try{r=await this.provider.sendAndConfirm(a,void 0,n)}catch(d){throw(l=se(d.code))!=null?l:ye("Unauthorized")}return{signature:r}}async joinChannel(e){var r,l;const[n]=await this.getMembershipPDA(e.channel),i=this.provider.publicKey,s=new ae;s.add(Ys({channel:e.channel,key:this.keypair.publicKey,membership:n,authority:i},{data:{name:e.name,authority:(r=e.authority)!=null?r:null}}));let a;try{a=await this.provider.sendAndConfirm(s,[this.keypair],e.opts)}catch(d){throw(l=se(d.code))!=null?l:d}return{signature:a}}async leaveChannel(e){var r;const[n]=await this.getMembershipPDA(e.channel),i=this.provider.publicKey,s=new ae;s.add(ni({channel:e.channel,membership:n,authority:i}));let a;try{a=await this.provider.sendAndConfirm(s)}catch(l){throw(r=se(l.code))!=null?r:l}return{signature:a}}async addMember(e){var _,E,w,$;const n=(_=e.key)!=null?_:e.invitee,[i]=await this.getMembershipPDA(e.channel),[s]=await this.getMembershipPDA(e.channel,n),a=await this.loadMembership(i);if(!a.cek.encryptedKey)throw ye("Unauthorized");const r=await this.decryptCEK(a.cek),l=await this.encryptCEK(r,n),d=new ae;d.add(zs({channel:e.channel,authority:this.provider.publicKey,invitee:e.invitee,authorityMembership:i,inviteeMembership:s},{data:{name:(E=e.name)!=null?E:"",flags:(w=e.flags)!=null?w:0,cek:l,key:n}}));let m;try{m=await this.provider.sendAndConfirm(d)}catch(k){throw($=se(k.code))!=null?$:ye("Unauthorized")}return{signature:m}}async deleteMember(e){var l;const[n]=e.membership?[e.membership]:await this.getMembershipPDA(e.channel,e.key),[i]=await this.getMembershipPDA(e.channel),s=this.provider.publicKey,a=new ae;a.add(Us({channel:e.channel,membership:n,authority:s,authorityMembership:i}));let r;try{r=await this.provider.sendAndConfirm(a)}catch(d){throw(l=se(d.code))!=null?l:d}return{signature:r}}async authorizeMember(e){var m;const[n]=await this.getMembershipPDA(e.channel),[i]=await this.getMembershipPDA(e.channel,e.key),s=await this.loadMembership(n);if(!s.cek.encryptedKey)throw ye("Unauthorized");const a=await this.decryptCEK(s.cek),r=await this.encryptCEK(a,e.key),l=new ae;l.add(Ns({channel:e.channel,membership:i,authority:this.provider.publicKey,authorityMembership:n},{data:{cek:r}}));let d;try{d=await this.provider.sendAndConfirm(l)}catch(_){throw(m=se(_.code))!=null?m:ye("Unauthorized")}return{signature:d}}async postMessage(e){var l;const[n]=await this.getMembershipPDA(e.channel);let i,s=0;if(e.encrypt){const d=await this.loadMembership(n);if(!d.cek.header)throw ye("Unauthorized");const m=await this.decryptCEK(d.cek);i=await this.encryptMessage(e.message,m),s|=1}else i=e.message;const a=new ae;a.add(ii({channel:e.channel,membership:n,authority:this.provider.publicKey},{message:String.fromCharCode(s)+i}));let r;try{r=await this.provider.sendAndConfirm(a)}catch(d){throw(l=se(d.code))!=null?l:d}return{signature:r}}}const _t="***** *** *** *** *******",G=Ne("messenger",()=>{const t=ht(),e=$t(),n=pt(),i=y(()=>e.keypair),s={allChannels:[],ownChannels:[],channel:void 0,channelAddr:void 0,channelMembershipAddr:void 0,channelMembership:void 0,channelMembers:[],channelMessages:[],channelLoading:!1,loading:!1,creating:!1,sending:!1},a=pe({...s}),r=y(()=>{var f;return new _i(new bt(t.connection,(f=n.value)!=null?f:{publicKey:P.default},bt.defaultOptions()),e.keypair)});let l=[];be(()=>t.cluster,()=>{_().then()},{immediate:!0}),be(n,f=>{f||(E(),_().then())},{immediate:!0}),be([i,()=>a.allChannels],()=>{d().then()},{immediate:!0});async function d(){var x;const A=(await r.value.loadMemberships((x=e.keypair)==null?void 0:x.publicKey)).map(R=>({pubkey:R.data[0].channel.toBase58(),status:R.data[0].status.__kind}));Oa.forEach(R=>{A.find(Y=>Y.pubkey===R)||A.push({pubkey:R,status:"Unauthorized"})}),a.ownChannels=A,console.log("myChannels ====== ",a.ownChannels)}async function m(){console.log("Register events...");for(const f of l)await r.value.removeEventListener(f);l.push(r.value.addEventListener("NewMessageEvent",async f=>{if(console.log("[Event] NewMessageEvent",f),`${f.channel}`!=`${a.channelAddr}`)return;let A=f.message.content;if(r.value.utils.message.isEncrypted(f.message)){const R=await N();R?A=await r.value.decryptMessage(f.message.content,R):A=_t}a.channelMessages.push({...f.message,content:A})})),l.push(r.value.addEventListener("AuthorizeMemberEvent",async f=>{console.log("[Event] AuthorizeMemberEvent",f),!(a.channelAddr&&`${f.channel}`!=`${a.channelAddr}`)&&(`${f.membership}`==`${a.channelMembershipAddr}`?C(a.channelAddr).then():K().then())})),l.push(r.value.addEventListener("JoinChannelEvent",async f=>{console.log("[Event] JoinChannelEvent",f),`${f.channel}`==`${a.channelAddr}`&&K().then()})),l.push(r.value.addEventListener("LeaveChannelEvent",async f=>{console.log("[Event] LeaveChannelEvent",f),`${f.channel}`==`${a.channelAddr}`&&K().then()}))}async function _(){E(),l=[],a.loading=!0;const f=await r.value.loadAllChannels();await m(),a.allChannels=f,a.loading=!1,console.log(a)}function E(){Object.assign(a,s)}async function w(f,A){var x,R;try{a.creating=!0;const{channel:Y}=await r.value.initChannel({name:f,maxMessages:(x=A.maxMessages)!=null?x:15,public:A.public,permissionless:A.permissionless,opts:{commitment:(R=A.commitment)!=null?R:"confirmed"}});await C(Y.publicKey),a.channel&&a.allChannels.push({pubkey:Y.publicKey,data:a.channel})}finally{a.creating=!1}}async function $(f){const A=new P(f);await r.value.deleteChannel({channel:A,opts:{commitment:"confirmed"}}),await _()}async function k(f,A){const x=new P(f);await r.value.joinChannel({channel:x,name:A,opts:{commitment:"confirmed"}}),await C(f)}async function C(f){var A;a.channelLoading=!0,a.channelMessages=[],a.channelMembers=[],a.channelMembershipAddr=void 0,a.channelMembership=void 0,a.channelAddr=new P(f);try{if((A=n.value)!=null&&A.publicKey)try{const[x]=await r.value.getMembershipPDA(a.channelAddr);a.channelMembershipAddr=x,a.channelMembership=await r.value.loadMembership(x)}catch(x){console.log(x),a.channelMembershipAddr=void 0,a.channelMembership=void 0}await K(),await F()}catch(x){console.log("Error",x)}finally{a.channelLoading=!1}}async function N(){if(!!a.channelMembership)try{return await r.value.decryptCEK(a.channelMembership.cek)}catch(f){console.log(f)}}async function F(){if(!a.channelAddr){console.log("Invalid channel");return}a.channel=await r.value.loadChannel(a.channelAddr);const A=r.value.utils.channel.isPublic(a.channel)?null:await N();a.channelMessages=await Promise.all(a.channel.messages.map(async x=>{var Pe;let Y=r.value.utils.message.isEncrypted(x)?_t:x.content,Ke=Ue(x.sender);if((Pe=n.value)!=null&&Pe.publicKey){const fe=a.channelMembers.find(({data:Se})=>Se.name!==""&&(`${Se.authority}`==`${x.sender}`||`${Se.key}`==`${x.sender}`));fe&&fe.data.name!==""&&(Ke=fe.data.name)}if(A)try{Y=await r.value.decryptMessage(x.content,A)}catch{console.log(`Failed to decrypt message #${x.id}`)}return{...x,senderDisplayName:Ke,content:Y}}))}async function K(){if(!a.channelAddr){console.error("Invalid channel");return}a.channelMembers=await r.value.loadChannelMembers(a.channelAddr)}async function q(f){if(!a.channelAddr){console.log("Please select a channel");return}try{a.sending=!0,await r.value.postMessage({channel:a.channelAddr,message:f}),await F()}finally{a.sending=!1}}async function v(f,A,x,R){if(!a.channelAddr){console.log("Invalid channel");return}await r.value.addMember({channel:a.channelAddr,invitee:new P(f),key:A?new P(A):void 0,name:x,flags:R})}async function W(f){if(!a.channelAddr){console.log("Invalid channel");return}await r.value.deleteMember({channel:a.channelAddr,key:new P(f)})}async function S(f){if(!a.channelAddr){console.log("Invalid channel");return}await r.value.authorizeMember({channel:a.channelAddr,key:new P(f)}),await F()}async function M(){await _()}return{state:a,client:r.value,loadChannel:C,joinChannel:k,createChannel:w,deleteChannel:$,postMessage:q,addMember:v,deleteMember:W,authorizeMember:S,refreshList:M}}),Ye=Ne("channel",()=>{const t=pt(),{state:e,client:n}=G(),i=y(()=>{var K;return!!((K=t.value)!=null&&K.publicKey)}),s=y(()=>!!e.channel&&n.utils.channel.isPublic(e.channel)),a=y(()=>!!e.channel&&n.utils.channel.isPermissionless(e.channel)),r=y(()=>{var K;return((K=e.channelMembership)==null?void 0:K.status.__kind)==="Authorized"}),l=y(()=>{var K;return((K=e.channelMembership)==null?void 0:K.status.__kind)==="Pending"}),d=y(()=>{var K,q,v;return String((K=e.channel)==null?void 0:K.creator)===String((v=(q=t.value)==null?void 0:q.publicKey)!=null?v:"-")}),m=y(()=>!!e.channelMembership&&n.utils.member.canAddMember(e.channelMembership)),_=y(()=>!!e.channelMembership&&n.utils.member.canAuthorizeMember(e.channelMembership)),E=y(()=>!!e.channelMembership&&n.utils.member.canDeleteMember(e.channelMembership)),w=y(()=>!!e.channelMembership&&n.utils.member.isAdmin(e.channelMembership)),$=y(()=>!!e.channelMembership&&n.utils.member.isOwner(e.channelMembership)),k=y(()=>i.value&&!!e.channel&&!e.loading&&!r.value),C=y(()=>i.value),N=y(()=>$.value),F=y(()=>!e.sending&&(s.value||r.value));return{isPublicChannel:s,isPermissionlessChannel:a,isAuthorizedMember:r,isPendingMember:l,isChannelCreator:d,isAdmin:w,isOwner:$,canJoinChannel:k,canAddMember:m,canAuthorizeMember:_,canDeleteMember:E,canCreateChannel:C,canDeleteChannel:N,canPostMessage:F}}),vi=V({__name:"MemberListDialog",props:{membersDialog:{type:Boolean,default:!1},authorizeMemberState:{type:Object},deleteMemberState:{type:Object},wallet:{type:Object}},emits:["submit","deleteMember"],setup(t,{emit:e}){const{state:n}=G(),{isAuthorizedMember:i,canDeleteMember:s}=Ye();function a(l){return(l==null?void 0:l.name)&&l.name!==""?l.name:Ue(l.authority)}function r(l){return(l==null?void 0:l.__kind)==="Authorized"?"positive":"grey"}return(l,d)=>(g(),b(me,null,{default:c(()=>[o(ne,null,{default:c(()=>[o(j,null,{default:c(()=>[o(Le,{separator:""},{default:c(()=>[(g(!0),T(Z,null,_e(p(n).channelMembers,m=>(g(),b(ee,{key:m.pubkey.toString(),"active-class":"bg-teal-1",active:`${m.pubkey}`==`${p(n).channelMembershipAddr}`},{default:c(()=>[o(J,null,{default:c(()=>[o(it,null,{default:c(()=>[D(B(a(m.data))+" ",1),o(hn,{color:r(m.data.status)},{default:c(()=>[D(B(m.data.status.__kind),1)]),_:2},1032,["color"])]),_:2},1024),o(it,{caption:"",lines:"2"},{default:c(()=>[u("div",null,"Authority: "+B(m.data.authority),1),u("div",null,"Key: "+B(m.data.key),1)]),_:2},1024)]),_:2},1024),o(J,{side:"",class:"q-gutter-sm"},{default:c(()=>[m.data.status.__kind==="Pending"&&p(i)&&(!m.data.status.authority||String(m.data.status.authority)===String(t.wallet.publicKey.value))?(g(),b(z,{key:0,color:"teal",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:t.authorizeMemberState.loading,disabled:t.authorizeMemberState.loading,onClick:_=>l.$emit("submit",m.data.key)},{default:c(()=>[D(" Authorize ")]),_:2},1032,["loading","disabled","onClick"])):re("",!0),p(s)(m.data)?(g(),b(z,{key:1,color:"negative",rounded:"",size:"xs",unelevated:"",class:"full-width",loading:t.deleteMemberState.loading,disabled:t.deleteMemberState.loading,onClick:_=>l.$emit("deleteMember",m.data.key)},{default:c(()=>[D(" Delete ")]),_:2},1032,["loading","disabled","onClick"])):re("",!0)]),_:2},1024)]),_:2},1032,["active"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}}),wi=t=>(Ce("data-v-9bcdbebf"),t=t(),Ae(),t),Mi=wi(()=>u("br",null,null,-1)),Ci=V({__name:"JoinChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=U(t.defaultState);return(i,s)=>(g(),b(me,{class:"join-channel-dialog",onHide:s[3]||(s[3]=a=>i.$emit("reset"))},{default:c(()=>[o(ne,null,{default:c(()=>[o(j,null,{default:c(()=>[o(Oe,{class:"join-channel-form",onSubmit:s[2]||(s[2]=Fe(a=>i.$emit("submit",n.value),["prevent"]))},{default:c(()=>[o(te,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.name=a),placeholder:"Member name *","lazy-rules":"",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(te,{modelValue:n.value.authority,"onUpdate:modelValue":s[1]||(s[1]=a=>n.value.authority=a),placeholder:"Authorize By","lazy-rules":"",rules:[a=>!a||a&&a.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),Mi,o(z,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[D(" Join Channel ")]),_:1})]),_:1}),o($e,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Ai=O(Ci,[["__scopeId","data-v-9bcdbebf"]]),Si=t=>(Ce("data-v-a5f1d45d"),t=t(),Ae(),t),ki=Si(()=>u("br",null,null,-1)),xi=V({__name:"AddMemberDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=U(t.defaultState);return(i,s)=>(g(),b(me,{class:"add-member-dialog",onHide:s[4]||(s[4]=a=>i.$emit("reset"))},{default:c(()=>[o(ne,null,{default:c(()=>[o(j,null,{default:c(()=>[o(Oe,{class:"add-member-form",onSubmit:s[3]||(s[3]=Fe(a=>i.$emit("submit",n.value),["prevent"]))},{default:c(()=>[o(te,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.name=a),label:"Member name *",hint:"Min length 3 chars","lazy-rules":"",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(te,{modelValue:n.value.key,"onUpdate:modelValue":s[1]||(s[1]=a=>n.value.key=a),label:"Member Wallet *","lazy-rules":"",rules:[a=>a&&a.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),o(te,{modelValue:n.value.key,"onUpdate:modelValue":s[2]||(s[2]=a=>n.value.key=a),label:"Member Device Key",hint:"Default: The same as member wallet","lazy-rules":"",rules:[a=>!a||a.length>32||"Invalid public key"]},null,8,["modelValue","rules"]),ki,o(z,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[D(" Add Member ")]),_:1})]),_:1}),o($e,{showing:t.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1}))}});const Ei=O(xi,[["__scopeId","data-v-a5f1d45d"]]),$i={class:"row"},Di={class:"col"},Ki={class:"col"},Pi=V({__name:"NewChannelDialog",props:{loading:{type:Boolean,default:!1},defaultState:Object},emits:["submit","reset"],setup(t){const n=U(t.defaultState);return(i,s)=>(g(),b(me,{class:"new-channel-dialog",onHide:s[5]||(s[5]=a=>i.$emit("reset"))},{default:c(()=>[o(ne,null,{default:c(()=>[o(j,null,{default:c(()=>[o(Oe,{class:"messenger-new-channel-form",onSubmit:s[4]||(s[4]=Fe(a=>i.$emit("submit",n.value),["prevent"]))},{default:c(()=>[o(te,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.name=a),label:"Channel name *","lazy-rules":"",maxlength:"32",rules:[a=>a&&a.length>2||"Please type something"]},null,8,["modelValue","rules"]),o(te,{modelValue:n.value.maxMessages,"onUpdate:modelValue":s[1]||(s[1]=a=>n.value.maxMessages=a),label:"Max messages","lazy-rules":"",rules:[a=>+a>0||"Invalid value"]},null,8,["modelValue","rules"]),u("div",$i,[u("div",Di,[o(st,{modelValue:n.value.public,"onUpdate:modelValue":s[2]||(s[2]=a=>n.value.public=a),label:"Public"},null,8,["modelValue"])]),u("div",Ki,[n.value.public?re("",!0):(g(),b(st,{key:0,modelValue:n.value.permissionless,"onUpdate:modelValue":s[3]||(s[3]=a=>n.value.permissionless=a),label:"Permissionless"},null,8,["modelValue"]))])])]),_:1}),o($e,{showing:t.loading},null,8,["showing"])]),_:1}),o(ue),o(j,null,{default:c(()=>[o(z,{type:"submit",class:"dialog-submit-btn","text-color":"white",ripple:!1,rounded:""},{default:c(()=>[D(" Create Channel ")]),_:1})]),_:1})]),_:1})]),_:1}))}});const Ii=O(Pi,[["__scopeId","data-v-236c1e75"]]),zi=V({__name:"ChannelForm",props:{message:{type:String,default:""},disabled:{type:Boolean,default:!1},sending:{type:Boolean,default:!1}},emits:["submit"],setup(t,{emit:e}){const i=U(t.message),s=()=>{e("submit",i),i.value=""};return(a,r)=>(g(),b(Oe,{class:"channel-form",onSubmit:Fe(s,["prevent"])},{default:c(()=>[o(dt,{class:"row message-control"},{default:c(()=>[o(te,{ref:"inputFocus",modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=l=>i.value=l),class:"col-grow message-input","bg-color":"white",placeholder:"Type a message",dense:"",borderless:"",autofocus:"",disable:t.disabled},null,8,["modelValue","disable"]),o(z,{class:"send-btn",square:"",flat:"",type:"submit",disable:t.disabled,loading:t.sending},{default:c(()=>[D(" Send ")]),_:1},8,["disable","loading"])]),_:1})]),_:1},8,["onSubmit"]))}});const Ti=O(zi,[["__scopeId","data-v-23f62c62"]]),Bi={key:0,class:"row justify-center channel-wrapper"},Wi={key:1,class:"messenger-empty"},Ni={key:1,class:"messenger-empty"},Li=V({__name:"ChannelWrapper",props:{postMessageState:{type:Object}},emits:["sendMessage"],setup(t,{emit:e}){const n=de(),{state:i}=G();function s(m){const _=n.publicKey.value;return _?String(_)!==String(m):!0}const a=y(()=>{const m=[];let _=0,E;for(const w of i.channelMessages)E&&`${w.sender}`==`${E}`?m[_-1].text.push(w.content):(E=w.sender,m.push({id:w.id,sender:w.sender,senderDisplayName:w.senderDisplayName,text:[w.content],date:w.createdAt}),_++);return m}),r=m=>e("sendMessage",m),l=U(),d=U();return be(d,m=>{m&&(l.value.scrollTop=m.scrollHeight)}),(m,_)=>{const E=Ti;return g(),b(ne,{class:"messenger-card",square:""},{default:c(()=>[u("div",{ref_key:"chat",ref:l,class:"messenger-content"},[p(i).channel?(g(),T("div",Bi,[p(a).length>0?(g(),T("div",{key:0,ref_key:"mes",ref:d,class:"messenger-messages"},[(g(!0),T(Z,null,_e(p(a),w=>(g(),b(gn,{key:w.id,name:w.senderDisplayName,text:w.text,sent:s(w.sender)},null,8,["name","text","sent"]))),128))],512)):(g(),T("div",Wi," No messages "))])):(g(),T("div",Ni," Please select a channel "))],512),o(E,{message:t.postMessageState.message,sending:m.loading,disabled:!m.allowSend,onSubmit:r},null,8,["message","sending","disabled"]),o($e,{showing:m.channelLoadingState},null,8,["showing"])]),_:1})}}});const Vi=O(Li,[["__scopeId","data-v-3a34712d"]]),Ri=V({props:{text:{type:String,default:""}}});function Oi(t,e,n,i,s,a){return g(),b(Ct,{anchor:"top middle",self:"center middle",class:"bg-grey-9 text-body2"},{default:c(()=>[D(B(t.text),1)]),_:1})}const Fi=O(Ri,[["render",Oi]]),Ui="/sol-messenger/assets/refresh.e0cf4262.svg",ji="/sol-messenger/assets/add.1481b8ed.svg",Qi="/sol-messenger/assets/join.627c8616.svg",gt=t=>(Ce("data-v-d176f9d3"),t=t(),Ae(),t),Ji=gt(()=>u("img",{src:Ui,alt:"refresh"},null,-1)),Gi=gt(()=>u("img",{src:ji,alt:"create"},null,-1)),qi=gt(()=>u("img",{src:Qi,alt:"join"},null,-1)),Hi=V({__name:"ChannelControl",props:{isJoining:{type:Boolean,default:!1}},emits:["createChannel","joinChannel","refreshList"],setup(t){const e=Ye(),n=y(()=>e.canJoinChannel),i=y(()=>e.isPendingMember),s=y(()=>e.canCreateChannel);return(a,r)=>{const l=Fi;return g(),b(ee,null,{default:c(()=>[o(J,{class:"button-wrapper"},{default:c(()=>[o(z,{class:"control-button",square:"",onClick:r[0]||(r[0]=d=>a.$emit("refreshList"))},{default:c(()=>[Ji,o(l,{text:"Refresh list"})]),_:1}),p(s)?(g(),b(z,{key:0,class:"control-button",square:"",onClick:r[1]||(r[1]=d=>a.$emit("createChannel"))},{default:c(()=>[Gi,o(l,{text:"Create a channel"})]),_:1})):re("",!0),p(n)?(g(),b(z,{key:1,class:"control-button",square:"",loading:t.isJoining,disable:p(i),onClick:r[2]||(r[2]=d=>a.$emit("joinChannel"))},{default:c(()=>[qi,o(l,{text:"Join the channel"})]),_:1},8,["loading","disable"])):re("",!0)]),_:1})]),_:1})}}});const Xi=O(Hi,[["__scopeId","data-v-d176f9d3"]]),Zi={class:"chat-name"},Yi={key:0,class:"message-count"},er=V({__name:"MessengerChannel",props:{pubkey:{type:Object,required:!0},channel:{type:Object,required:!0},isActive:Boolean},emits:["select"],setup(t){const e=t,n=y(()=>e.channel.name.slice(0,2));return(i,s)=>(g(),b(ee,{"active-class":"bg-blue-grey-1 text-grey-8",active:t.isActive},{default:c(()=>[o(J,{class:"chat-item cursor-pointer",onClick:s[0]||(s[0]=a=>i.$emit("select"))},{default:c(()=>[u("div",{class:"chat-badge",style:fn(p(Aa)(`${t.pubkey}`))},[u("span",null,B(p(n)),1)],4),u("div",Zi,B(t.channel.name),1),+t.channel.messageCount>0?(g(),T("div",Yi,B(t.channel.messageCount),1)):re("",!0)]),_:1})]),_:1},8,["active"]))}});const tr=O(er,[["__scopeId","data-v-1abda3cf"]]),nr={class:"panel-search"},ar={class:"search-wrapper"},sr={class:"panel-info"},ir={class:"chat-info"},rr={class:"chat-members"},or={class:"chat-messages"},lr={class:"chat-name"},cr=V({__name:"MessengerToolbar",emits:["search","showMembers","deleteChannel","addMember","showDeviceKey"],setup(t,{emit:e}){const n=de(),{state:i}=G(),{canAddMember:s,isChannelCreator:a}=Ye(),r=y(()=>!!n.publicKey.value),l=U(""),d=y(()=>i.channel),m=y(()=>{var k,C,N;return((k=d.value)==null?void 0:k.memberCount)===null||((C=d.value)==null?void 0:C.memberCount)===void 0?"":`${(N=d.value)==null?void 0:N.memberCount}\xA0members`}),_=y(()=>{var k,C,N;return((k=d.value)==null?void 0:k.messageCount)===null||((C=d.value)==null?void 0:C.messageCount)===void 0?"":`${(N=d.value)==null?void 0:N.messageCount}\xA0messages`}),E=k=>e("search",k),w=()=>e("showMembers"),$=()=>e("addMember");return be(l,k=>{E(String(k))}),(k,C)=>(g(),b(dt,{class:"panel-toolbar"},{default:c(()=>{var N;return[u("div",nr,[u("div",ar,[o(te,{modelValue:l.value,"onUpdate:modelValue":C[0]||(C[0]=F=>l.value=F),class:"search-input no-margin q-pa-none",placeholder:"Search ...",clearable:"",debounce:"300",borderless:"",onClear:C[1]||(C[1]=F=>l.value="")},null,8,["modelValue"])])]),u("div",sr,[u("div",ir,[u("div",rr,B(p(m)),1),u("div",or,B(p(_)),1)]),o(mt,{class:""}),u("div",lr,B((N=p(d))==null?void 0:N.name),1),u("div",null,[o(z,{class:"chat-menu",flat:"",unelevated:"",disable:!p(r)},{default:c(()=>[o(yn,{name:p(bn)},null,8,["name"]),o(_n,{anchor:"bottom left",self:"top left"},{default:c(()=>[o(Le,{style:{"min-width":"150px"},bordered:""},{default:c(()=>[ke((g(),b(ee,{clickable:"",onClick:C[2]||(C[2]=F=>k.$emit("showDeviceKey"))},{default:c(()=>[o(J,null,{default:c(()=>[D("Device key")]),_:1})]),_:1})),[[xe]]),ke((g(),b(ee,{clickable:"",disable:!p(d),onClick:w},{default:c(()=>[o(J,null,{default:c(()=>[D("Members")]),_:1})]),_:1},8,["disable"])),[[xe]]),ke((g(),b(ee,{clickable:"",disable:!p(s),onClick:$},{default:c(()=>[o(J,null,{default:c(()=>[D("Add member")]),_:1})]),_:1},8,["disable"])),[[xe]]),ke((g(),b(ee,{clickable:"",disable:!p(a),onClick:C[3]||(C[3]=F=>k.$emit("deleteChannel"))},{default:c(()=>[o(J,null,{default:c(()=>[D("Delete")]),_:1})]),_:1},8,["disable"])),[[xe]])]),_:1})]),_:1})]),_:1},8,["disable"])])])]}),_:1}))}});const ur=O(cr,[["__scopeId","data-v-17b15bc6"]]),dr=15;function mr(){const{createChannel:t}=G(),{isWalletConnected:e,ok:n,error:i}=De(),s=pe({dialog:!1,name:"",maxMessages:dr,public:!1,permissionless:!1,loading:!1});async function a(){if(e())try{await t(s.name,{maxMessages:s.maxMessages,public:s.public,permissionless:s.permissionless}),r(),n("Channel was created!")}catch(l){i("Something went wrong"),console.log(l)}}function r(){s.dialog=!1,s.public=!1,s.loading=!1,s.name="",s.maxMessages=15}return{state:s,submit:a,reset:r}}function pr(){const{authorizeMember:t}=G(),{ok:e,error:n}=De(),i=pe({loading:!1,dialog:!1});async function s(a){try{i.loading=!0,await t(a),e("Member was authorized")}catch(r){n("Something went wrong"),console.log(r)}finally{i.loading=!1}}return{state:i,submit:s}}function hr(){const{state:t,addMember:e}=G(),{ok:n,info:i,error:s}=De(),a=pe({dialog:!1,loading:!1});async function r(d){if(a.loading=!0,!t.channelAddr){i("Please select a channel");return}try{return await e(d.authority,d.key,d.name),n("Member was added"),!0}catch(m){s("Something went wrong"),console.log(m)}finally{a.loading=!1}return!1}function l(){a.loading=!1,a.dialog=!1}return{state:a,submit:r,reset:l}}function gr(){const{deleteMember:t}=G(),{ok:e,error:n}=De(),i=pe({loading:!1});async function s(a){try{i.loading=!0,await t(a),e("Member was deleted")}catch(r){n("Something went wrong"),console.log(r)}finally{i.loading=!1}}return{state:i,submit:s}}function fr(){const{state:t,joinChannel:e}=G(),{ok:n,info:i,error:s}=De(),a=pe({dialog:!1,loading:!1,name:""});async function r(){if(!t.channelAddr){i("Please select a channel");return}a.loading=!0;try{await e(t.channelAddr,a.name),l(),n("Request was sent")}catch(d){console.log("Error",d),s("Something went wrong")}finally{a.loading=!1}}function l(){a.loading=!1,a.dialog=!1,a.name=""}return{state:a,submit:r,reset:l}}function De(){const t=de(),{notify:e}=We(),n=r=>e({type:"positive",message:r,timeout:2e3}),i=r=>e({type:"info",message:r,timeout:2e3}),s=r=>e({type:"negative",message:r,timeout:2e3});function a(){return t.publicKey.value?!0:(i("Please connect wallet"),!1)}return{ok:n,info:i,error:s,isWalletConnected:a}}const yr={class:"col col-4"},br={class:"col"},_r={class:"no-margin"},vr=V({__name:"DebugBtn",setup(t){const{state:e}=G(),{isAuthorizedMember:n,isPendingMember:i,isChannelCreator:s}=Ye(),a=U(!1),r=vn(a);return(l,d)=>(g(),T(Z,null,[o(z,{flat:"",class:"text-blue-2",onClick:d[0]||(d[0]=m=>p(r)())},{default:c(()=>[D(" Debug info ")]),_:1}),o(me,{modelValue:a.value,"onUpdate:modelValue":d[1]||(d[1]=m=>a.value=m)},{default:c(()=>[(g(!0),T(Z,null,_e([["Authorized",p(n)],["Pending Access",p(i)],["Channel Creator",p(s)],["Channel",p(e).channel],["Membership",p(e).channelMembership],["Members",p(e).channelMembers]],m=>(g(),T("div",{key:m[0],class:"row q-mt-md"},[u("div",yr,B(m[0]),1),u("div",br,[u("pre",_r,B(m[1]),1)])]))),128))]),_:1},8,["modelValue"])],64))}}),wr={class:"messenger-wrapper"},Mr={class:"messenger-main"},Cr={key:1,class:"messenger-channels-empty"},Ar={key:0,class:"q-my-md q-px-lg"},Sr=V({__name:"Messenger",setup(t){const e=de(),{state:n,postMessage:i,loadChannel:s,refreshList:a}=G(),r=mr(),l=fr(),d=hr(),m=pr(),_=gr(),E=pe({message:""}),w=y(()=>n.allChannels),$=U([]),k=U(""),C=y(()=>n.allChannels.filter(S=>!!n.ownChannels.find(M=>M.pubkey===S.pubkey.toBase58())));async function N(S){await i(S.value),E.message=""}async function F(S){await s(S)}const K=S=>{if(S===""){$.value=[],k.value="";return}$.value=w.value.filter(M=>M.data.name.toLocaleLowerCase().includes(S.toLocaleLowerCase())||M.pubkey.toBase58().toLocaleLowerCase().includes(S.toLocaleLowerCase())),k.value=S},q=()=>{m.state.dialog=!0},v=U(!1),W=y(()=>$.value.length>0||k.value.length>0?$.value:C.value);return(S,M)=>{const f=ur,A=tr,x=Xi,R=Vi,Y=Ii,Ke=Ei,Pe=Ai,fe=vi,Se=_s;return g(),T(Z,null,[u("div",wr,[o(f,{onSearch:K,onShowMembers:q,onDeleteChannel:M[0]||(M[0]=I=>p(_).submit(p(n).channelAddr)),onAddMember:M[1]||(M[1]=I=>p(d).state.dialog=!0),onShowDeviceKey:M[2]||(M[2]=I=>v.value=!0)}),u("div",Mr,[o(ne,{class:"messenger-channels"},{default:c(()=>[p(W).length>0?(g(),b(Le,{key:0,separator:"",class:"channels-list"},{default:c(()=>[(g(!0),T(Z,null,_e(p(W),I=>(g(),b(A,{key:I.name,pubkey:I.pubkey,channel:I.data,"is-active":`${p(n).channelAddr}`==`${I.pubkey}`,onSelect:Hr=>F(I.pubkey)},null,8,["pubkey","channel","is-active","onSelect"]))),128))]),_:1})):(g(),T("div",Cr," No channels ")),o(x,{"is-joining":p(l).state.loading,onCreateChannel:M[3]||(M[3]=I=>p(r).state.dialog=!0),onJoinChannel:M[4]||(M[4]=I=>p(l).state.dialog=!0),onRefreshList:p(a)},null,8,["is-joining","onRefreshList"])]),_:1}),o(R,{"post-message-state":E,onSendMessage:N},null,8,["post-message-state"]),o($e,{showing:p(n).loading,color:"primary"},null,8,["showing"])])]),o(Y,{modelValue:p(r).state.dialog,"onUpdate:modelValue":M[5]||(M[5]=I=>p(r).state.dialog=I),loading:p(r).state.loading,"default-state":p(r).state,onSubmit:p(r).submit,onReset:p(r).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),o(Ke,{modelValue:p(d).state.dialog,"onUpdate:modelValue":M[6]||(M[6]=I=>p(d).state.dialog=I),loading:p(d).state.loading,"default-state":p(d).state,onSubmit:p(d).submit,onReset:p(d).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),o(Pe,{modelValue:p(l).state.dialog,"onUpdate:modelValue":M[7]||(M[7]=I=>p(l).state.dialog=I),loading:p(l).state.loading,"default-state":p(l).state,onSubmit:p(l).submit,onReset:p(l).reset},null,8,["modelValue","loading","default-state","onSubmit","onReset"]),o(fe,{modelValue:p(m).state.dialog,"onUpdate:modelValue":M[8]||(M[8]=I=>p(m).state.dialog=I),wallet:p(e),"authorize-member-state":p(m).state,"delete-member-state":p(_).state,onSubmit:p(m).submit,onDeleteMember:p(_).submit},null,8,["modelValue","wallet","authorize-member-state","delete-member-state","onSubmit","onDeleteMember"]),o(Se,{modelValue:v.value,"onUpdate:modelValue":M[9]||(M[9]=I=>v.value=I)},null,8,["modelValue"]),p(n).channel?(g(),T("div",Ar,[o(vr)])):re("",!0)],64)}}});const kr=O(Sr,[["__scopeId","data-v-0faea6c3"]]);const xr={},Er={class:"container"},$r={class:"messenger-container"},Dr={class:"container"};function Kr(t,e){const n=kr,i=hs;return g(),b(wn,{class:"page-wrapper"},{default:c(()=>[u("div",Er,[u("div",$r,[o(n)])]),u("div",Dr,[o(i)])]),_:1})}const Pr=O(xr,[["render",Kr],["__scopeId","data-v-8f1b09e0"]]),Ir=()=>Mt(()=>import("./_...all_.e50b9310.js"),["assets/_...all_.e50b9310.js","assets/vendor.4e722742.js","assets/_...all_.73169310.css"]),zr=[{name:"index",path:"/",component:Pr,props:!0},{name:"all",path:"/:all(.*)*",component:Ir,props:!0,meta:{layout:"empty"}}],Tr=ss(zr),Br="/sol-messenger/",Wr=Mn({history:Cn(Br),scrollBehavior:()=>({left:0,top:0}),strict:!0,routes:Tr}),Nr=({app:t})=>{t.use(Wr)},Lr=Object.freeze(Object.defineProperty({__proto__:null,install:Nr},Symbol.toStringTag,{value:"Module"})),Vr=({app:t})=>{t.use(An,{wallets:[new Sn,new kn,new xn,new En,new $n,new Dn,new Kn,new Pn,new In,new zn,new Tn,new Bn,new Wn,new Nn,new Ln,new Vn,new Rn,new On,new Fn,new Un,new jn,new Qn,new Jn,new Gn,new qn,new Hn,new Xn,new Zn,new Yn,new ea],autoConnect:!1})},Rr=Object.freeze(Object.defineProperty({__proto__:null,install:Vr},Symbol.toStringTag,{value:"Module"})),Or=ta();function Fr(){return Or}const Ur=Symbol("WALLET_CONNECT_EVENT"),jr=Symbol("WALLET_DISCONNECT_EVENT"),Qr=Symbol("ACCOUNT_CHANGE_EVENT"),nt=5e3;function Jr(){const{connection:t}=ht(),{emit:e}=Fr(),{notify:n}=We(),{wallet:i}=de();be(i,s=>{if(!s)return;const a=()=>{const d=s.adapter.publicKey;t.onAccountChange(d,m=>{e(Qr,m)}),t.onLogs(d,m=>{console.log(m)}),n({message:"Wallet update",caption:`Connected to wallet ${Ue(d.toBase58(),7)}`,timeout:nt}),e(Ur,s)},r=()=>{n({message:"Wallet update",caption:"Disconnected from wallet",timeout:nt}),e(jr,s)},l=d=>{!(d!=null&&d.message)||n({type:"negative",message:"Wallet update",caption:d.message,timeout:nt})};s.adapter.once("connect",a),s.adapter.once("disconnect",r),s.adapter.removeAllListeners("error"),s.adapter.on("error",l)},{immediate:!0})}const Gr=V({__name:"App",setup(t){return na(()=>{Jr()}),(e,n)=>{const i=Ve("router-view");return g(),b(i)}}});async function qr(){const t=aa(Gr);Object.values(Object.assign({"./plugins/pinia.ts":ia,"./plugins/quasar.ts":oa,"./plugins/router.ts":Lr,"./plugins/wallet.ts":Rr})).forEach(e=>{var n;return(n=e.install)==null?void 0:n.call(e,{app:t})}),t.mount("#app")}qr().then();export{O as _};
